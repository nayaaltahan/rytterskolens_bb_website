(function(window,undefined){
var TraceKit={};
var _oldTraceKit=window.TraceKit;
var _slice=[].slice;
var UNKNOWN_FUNCTION='?';
function _has(object,key){
return Object.prototype.hasOwnProperty.call(object,key)
}
function _isUndefined(what){
return typeof what==='undefined'
}
TraceKit.noConflict=function noConflict(){
window.TraceKit=_oldTraceKit;
return TraceKit
};
TraceKit.wrap=function traceKitWrapper(func){
function wrapped(){
try{
return func.apply(this,arguments)
}catch(e){
TraceKit.report(e);
throw e
}
}
return wrapped
};
TraceKit.report=function reportModuleWrapper(){
var handlers=[],lastException=null,lastExceptionStack=null;
function subscribe(handler,installGlobal){
if(typeof installGlobal==='undefined'){
installGlobal=true
}
if(installGlobal){
installGlobalHandler()
}
handlers.push(handler)
}
function unsubscribe(handler){
for(var i=handlers.length-1;i>=0;--i){
if(handlers[i]===handler){
handlers.splice(i,1)
}
}
}
function notifyHandlers(stack,windowError){
var exception=null;
if(windowError&&!TraceKit.collectWindowErrors){
return
}
for(var i in handlers){
if(_has(handlers,i)){
try{
handlers[i].apply(null,[stack].concat(_slice.call(arguments,2)))
}catch(inner){
exception=inner
}
}
}
if(exception){
throw exception
}
}
var _oldOnerrorHandler,_onErrorHandlerInstalled;
function traceKitWindowOnError(message,url,lineNo){
var stack=null;
if(lastExceptionStack){
TraceKit.computeStackTrace.augmentStackTraceWithInitialElement(lastExceptionStack,url,lineNo,message);
stack=lastExceptionStack;
lastExceptionStack=null;
lastException=null
}else{
var location={
'url':url,
'line':lineNo
};
location.func=TraceKit.computeStackTrace.guessFunctionName(location.url,location.line);
location.context=TraceKit.computeStackTrace.gatherContext(location.url,location.line);
stack={
'mode':'onerror',
'message':message,
'url':document.location.href,
'stack':[location],
'useragent':navigator.userAgent
}
}
notifyHandlers(stack,'from window.onerror');
if(_oldOnerrorHandler){
return _oldOnerrorHandler.apply(this,arguments)
}
return false
}
function installGlobalHandler(){
if(_onErrorHandlerInstalled===true){
return
}
_oldOnerrorHandler=window.onerror;
window.onerror=traceKitWindowOnError;
(function extendToAsynchronousCallbacks(){
var _helper=function _helper(fnName){
var originalFn=window[fnName];
window[fnName]=function traceKitAsyncExtension(){
var args=_slice.call(arguments);
var originalCallback=args[0];
if(typeof originalCallback==='function'){
args[0]=TraceKit.wrap(originalCallback)
}
if(originalFn.apply){
return originalFn.apply(this,args)
}else{
return originalFn(args[0],args[1])
}
}
};
_helper('setTimeout');
_helper('setInterval')
}());
_onErrorHandlerInstalled=true
}
function report(ex,throwGlobal){
var args=_slice.call(arguments,1);
if(lastExceptionStack){
if(lastException===ex){
return
}else{
var s=lastExceptionStack;
lastExceptionStack=null;
lastException=null;
notifyHandlers.apply(null,[
s,
null
].concat(args))
}
}
var stack=TraceKit.computeStackTrace(ex);
lastExceptionStack=stack;
lastException=ex;
window.setTimeout(function(){
if(lastException===ex){
lastExceptionStack=null;
lastException=null;
notifyHandlers.apply(null,[
stack,
null
].concat(args))
}
},stack.incomplete?2000:0);
if(!throwGlobal){
return
}
throw ex
}
report.subscribe=subscribe;
report.unsubscribe=unsubscribe;
return report
}();
TraceKit.computeStackTrace=function computeStackTraceWrapper(){
var debug=false,sourceCache={};
function loadSource(url){
if(!TraceKit.remoteFetching){
return''
}
try{
var getXHR=function(){
try{
return new window.XMLHttpRequest
}catch(e){
return new window.ActiveXObject('Microsoft.XMLHTTP')
}
};
var request=getXHR();
request.open('GET',url,false);
request.send('');
return request.responseText
}catch(e){
return''
}
}
function getSource(url){
if(!_has(sourceCache,url)){
var source='';
if(url.indexOf(document.domain)!==-1){
source=loadSource(url)
}
sourceCache[url]=source?source.split('\n'):[]
}
return sourceCache[url]
}
function guessFunctionName(url,lineNo){
var reFunctionArgNames=/function ([^(]*)\(([^)]*)\)/,reGuessFunction=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,line='',maxLines=10,source=getSource(url),m;
if(!source.length){
return UNKNOWN_FUNCTION
}
for(var i=0;i<maxLines;++i){
line=source[lineNo-i]+line;
if(!_isUndefined(line)){
if(m=reGuessFunction.exec(line)){
return m[1]
}else if(m=reFunctionArgNames.exec(line)){
return m[1]
}
}
}
return UNKNOWN_FUNCTION
}
function gatherContext(url,line){
var source=getSource(url);
if(!source.length){
return null
}
var context=[],linesBefore=Math.floor(TraceKit.linesOfContext/2),linesAfter=linesBefore+TraceKit.linesOfContext%2,start=Math.max(0,line-linesBefore-1),end=Math.min(source.length,line+linesAfter-1);
line-=1;
for(var i=start;i<end;++i){
if(!_isUndefined(source[i])){
context.push(source[i])
}
}
return context.length>0?context:null
}
function escapeRegExp(text){
return text.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,'\\$&')
}
function escapeCodeAsRegExpForMatchingInsideHTML(body){
return escapeRegExp(body).replace('<','(?:<|&lt;)').replace('>','(?:>|&gt;)').replace('&','(?:&|&amp;)').replace('"','(?:"|&quot;)').replace(/\s+/g,'\\s+')
}
function findSourceInUrls(re,urls){
var source,m;
for(var i=0,j=urls.length;i<j;++i){
if((source=getSource(urls[i])).length){
source=source.join('\n');
if(m=re.exec(source)){
return{
'url':urls[i],
'line':source.substring(0,m.index).split('\n').length,
'column':m.index-source.lastIndexOf('\n',m.index)-1
}
}
}
}
return null
}
function findSourceInLine(fragment,url,line){
var source=getSource(url),re=new RegExp('\\b'+escapeRegExp(fragment)+'\\b'),m;
line-=1;
if(source&&source.length>line&&(m=re.exec(source[line]))){
return m.index
}
return null
}
function findSourceByFunctionBody(func){
var urls=[window.location.href],scripts=document.getElementsByTagName('script'),body,code=''+func,codeRE=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,eventRE=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,re,parts,result;
for(var i=0;i<scripts.length;++i){
var script=scripts[i];
if(script.src){
urls.push(script.src)
}
}
if(!(parts=codeRE.exec(code))){
re=new RegExp(escapeRegExp(code).replace(/\s+/g,'\\s+'))
}else{
var name=parts[1]?'\\s+'+parts[1]:'',args=parts[2].split(',').join('\\s*,\\s*');
body=escapeRegExp(parts[3]).replace(/;$/,';?');
re=new RegExp('function'+name+'\\s*\\(\\s*'+args+'\\s*\\)\\s*{\\s*'+body+'\\s*}')
}
if(result=findSourceInUrls(re,urls)){
return result
}
if(parts=eventRE.exec(code)){
var event=parts[1];
body=escapeCodeAsRegExpForMatchingInsideHTML(parts[2]);
re=new RegExp('on'+event+'=[\\\'"]\\s*'+body+'\\s*[\\\'"]','i');
if(result=findSourceInUrls(re,urls[0])){
return result
}
re=new RegExp(body);
if(result=findSourceInUrls(re,urls)){
return result
}
}
return null
}
function computeStackTraceFromStackProp(ex){
if(!ex.stack){
return null
}
var chrome=/^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|http|https):.*?):(\d+)(?::(\d+))?\)?\s*$/i,gecko=/^\s*(\S*)(?:\((.*?)\))?@((?:file|http|https).*?):(\d+)(?::(\d+))?\s*$/i,lines=ex.stack.split('\n'),stack=[],parts,element,reference=/^(.*) is undefined$/.exec(ex.message);
for(var i=0,j=lines.length;i<j;++i){
if(parts=gecko.exec(lines[i])){
element={
'url':parts[3],
'func':parts[1]||UNKNOWN_FUNCTION,
'args':parts[2]?parts[2].split(','):'',
'line':+parts[4],
'column':parts[5]?+parts[5]:null
}
}else if(parts=chrome.exec(lines[i])){
element={
'url':parts[2],
'func':parts[1]||UNKNOWN_FUNCTION,
'line':+parts[3],
'column':parts[4]?+parts[4]:null
}
}else{
continue
}
if(!element.func&&element.line){
element.func=guessFunctionName(element.url,element.line)
}
if(element.line){
element.context=gatherContext(element.url,element.line)
}
stack.push(element)
}
if(stack[0]&&stack[0].line&&!stack[0].column&&reference){
stack[0].column=findSourceInLine(reference[1],stack[0].url,stack[0].line)
}
if(!stack.length){
return null
}
return{
'mode':'stack',
'name':ex.name,
'message':ex.message,
'url':document.location.href,
'stack':stack,
'useragent':navigator.userAgent
}
}
function computeStackTraceFromStacktraceProp(ex){
var stacktrace=ex.stacktrace;
var testRE=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,lines=stacktrace.split('\n'),stack=[],parts;
for(var i=0,j=lines.length;i<j;i+=2){
if(parts=testRE.exec(lines[i])){
var element={
'line':+parts[1],
'column':+parts[2],
'func':parts[3]||parts[4],
'args':parts[5]?parts[5].split(','):[],
'url':parts[6]
};
if(!element.func&&element.line){
element.func=guessFunctionName(element.url,element.line)
}
if(element.line){
try{
element.context=gatherContext(element.url,element.line)
}catch(exc){
}
}
if(!element.context){
element.context=[lines[i+1]]
}
stack.push(element)
}
}
if(!stack.length){
return null
}
return{
'mode':'stacktrace',
'name':ex.name,
'message':ex.message,
'url':document.location.href,
'stack':stack,
'useragent':navigator.userAgent
}
}
function computeStackTraceFromOperaMultiLineMessage(ex){
var lines=ex.message.split('\n');
if(lines.length<4){
return null
}
var lineRE1=/^\s*Line (\d+) of linked script ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,lineRE2=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,lineRE3=/^\s*Line (\d+) of function script\s*$/i,stack=[],scripts=document.getElementsByTagName('script'),inlineScriptBlocks=[],parts,i,len,source;
for(i in scripts){
if(_has(scripts,i)&&!scripts[i].src){
inlineScriptBlocks.push(scripts[i])
}
}
for(i=2,len=lines.length;i<len;i+=2){
var item=null;
if(parts=lineRE1.exec(lines[i])){
item={
'url':parts[2],
'func':parts[3],
'line':+parts[1]
}
}else if(parts=lineRE2.exec(lines[i])){
item={
'url':parts[3],
'func':parts[4]
};
var relativeLine=+parts[1];
var script=inlineScriptBlocks[parts[2]-1];
if(script){
source=getSource(item.url);
if(source){
source=source.join('\n');
var pos=source.indexOf(script.innerText);
if(pos>=0){
item.line=relativeLine+source.substring(0,pos).split('\n').length
}
}
}
}else if(parts=lineRE3.exec(lines[i])){
var url=window.location.href.replace(/#.*$/,''),line=parts[1];
var re=new RegExp(escapeCodeAsRegExpForMatchingInsideHTML(lines[i+1]));
source=findSourceInUrls(re,[url]);
item={
'url':url,
'line':source?source.line:line,
'func':''
}
}
if(item){
if(!item.func){
item.func=guessFunctionName(item.url,item.line)
}
var context=gatherContext(item.url,item.line);
var midline=context?context[Math.floor(context.length/2)]:null;
if(context&&midline.replace(/^\s*/,'')===lines[i+1].replace(/^\s*/,'')){
item.context=context
}else{
item.context=[lines[i+1]]
}
stack.push(item)
}
}
if(!stack.length){
return null
}
return{
'mode':'multiline',
'name':ex.name,
'message':lines[0],
'url':document.location.href,
'stack':stack,
'useragent':navigator.userAgent
}
}
function augmentStackTraceWithInitialElement(stackInfo,url,lineNo,message){
var initial={
'url':url,
'line':lineNo
};
if(initial.url&&initial.line){
stackInfo.incomplete=false;
if(!initial.func){
initial.func=guessFunctionName(initial.url,initial.line)
}
if(!initial.context){
initial.context=gatherContext(initial.url,initial.line)
}
var reference=/ '([^']+)' /.exec(message);
if(reference){
initial.column=findSourceInLine(reference[1],initial.url,initial.line)
}
if(stackInfo.stack.length>0){
if(stackInfo.stack[0].url===initial.url){
if(stackInfo.stack[0].line===initial.line){
return false
}else if(!stackInfo.stack[0].line&&stackInfo.stack[0].func===initial.func){
stackInfo.stack[0].line=initial.line;
stackInfo.stack[0].context=initial.context;
return false
}
}
}
stackInfo.stack.unshift(initial);
stackInfo.partial=true;
return true
}else{
stackInfo.incomplete=true
}
return false
}
function computeStackTraceByWalkingCallerChain(ex,depth){
var functionName=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,stack=[],funcs={},recursion=false,parts,item,source;
for(var curr=computeStackTraceByWalkingCallerChain.caller;curr&&!recursion;curr=curr.caller){
if(curr===computeStackTrace||curr===TraceKit.report){
continue
}
item={
'url':null,
'func':UNKNOWN_FUNCTION,
'line':null,
'column':null
};
if(curr.name){
item.func=curr.name
}else if(parts=functionName.exec(curr.toString())){
item.func=parts[1]
}
if(source=findSourceByFunctionBody(curr)){
item.url=source.url;
item.line=source.line;
if(item.func===UNKNOWN_FUNCTION){
item.func=guessFunctionName(item.url,item.line)
}
var reference=/ '([^']+)' /.exec(ex.message||ex.description);
if(reference){
item.column=findSourceInLine(reference[1],source.url,source.line)
}
}
if(funcs[''+curr]){
recursion=true
}else{
funcs[''+curr]=true
}
stack.push(item)
}
if(depth){
stack.splice(0,depth)
}
var result={
'mode':'callers',
'name':ex.name,
'message':ex.message,
'url':document.location.href,
'stack':stack,
'useragent':navigator.userAgent
};
augmentStackTraceWithInitialElement(result,ex.sourceURL||ex.fileName,ex.line||ex.lineNumber,ex.message||ex.description);
return result
}
function computeStackTrace(ex,depth){
var stack=null;
depth=depth==null?0:+depth;
try{
stack=computeStackTraceFromStacktraceProp(ex);
if(stack){
return stack
}
}catch(e){
if(debug){
throw e
}
}
try{
stack=computeStackTraceFromStackProp(ex);
if(stack){
return stack
}
}catch(e){
if(debug){
throw e
}
}
try{
stack=computeStackTraceFromOperaMultiLineMessage(ex);
if(stack){
return stack
}
}catch(e){
if(debug){
throw e
}
}
try{
stack=computeStackTraceByWalkingCallerChain(ex,depth+1);
if(stack){
return stack
}
}catch(e){
if(debug){
throw e
}
}
return{'mode':'failed'}
}
function computeStackTraceOfCaller(depth){
depth=(depth==null?0:+depth)+1;
try{
throw new Error
}catch(ex){
return computeStackTrace(ex,depth+1)
}
}
computeStackTrace=function(computeStackTrace){
return function(ex,depth){
var ret=computeStackTrace(ex,depth);
ret.error=ex;
return ret
}
}(computeStackTrace);
computeStackTrace.augmentStackTraceWithInitialElement=augmentStackTraceWithInitialElement;
computeStackTrace.guessFunctionName=guessFunctionName;
computeStackTrace.gatherContext=gatherContext;
computeStackTrace.ofCaller=computeStackTraceOfCaller;
return computeStackTrace
}();
if(!TraceKit.remoteFetching){
TraceKit.remoteFetching=true
}
if(!TraceKit.collectWindowErrors){
TraceKit.collectWindowErrors=true
}
if(!TraceKit.linesOfContext||TraceKit.linesOfContext<1){
TraceKit.linesOfContext=11
}
window.TraceKit=TraceKit
}(window));
window.one=window.one||{};
(function(){
function CrashLogger(size){
this.logSize=size;
this.index=0;
this.logBuffer=[]
}
function leftPad(str,length,padChar){
str=String(str);
while(str.length<length){
str=(padChar||' ')+str
}
return str
}
CrashLogger.prototype.log=function(){
var args=Array.prototype.slice.call(arguments);
var d=new Date;
var timestamp=d.getHours()+':'+leftPad(d.getMinutes(),2,'0')+':'+leftPad(d.getSeconds(),2,'0')+'.'+leftPad(d.getMilliseconds(),3,'0');
this.logBuffer[this.index]=timestamp+': '+args.join(', ');
this.index=(this.index+1)%this.logSize
};
CrashLogger.prototype.getEntries=function(){
var result=[];
var start=this.index-this.logSize;
start=start<0?this.logSize+start:start;
for(var i=0;i<this.logSize;i+=1){
var entry=this.logBuffer[(start+i)%this.logSize];
if(entry){
result.push(entry)
}
}
return result
};
CrashLogger.prototype.toString=function(){
return this.getEntries().join('\n')
};
one.crashLogger=new CrashLogger(60)
}());
window.one=window.one||{};
(function(){
function CrashReporter(options){
var that=this;
options=options||{};
that.hash={};
that.reportUrl=options.reportUrl||'/api/crashreporter/';
function createApplicationCrash(error,additionalInfo){
error=error||new Error;
if(additionalInfo){
error.additionalInfo=additionalInfo;
if(additionalInfo.hasOwnProperty('message')){
error.customMessage=additionalInfo.message
}
}
return error
}
that.provokeScriptError=function(){
setTimeout(function(){
that.undefinedFunction()
},1)
};
that.reportCrash=function(error,additionalInfo){
try{
throw createApplicationCrash(error,additionalInfo)
}catch(e){
if(false){
that.sendReportFromTraceKit(e)
}else{
TraceKit.report(e)
}
}
};
function createTaggedErrorMessage(err,message,clean){
message=message?message:'Application error.';
if(err.tags){
message+=' tags: "'+err.tags.join(' ')+'"'
}
if(err.status){
message+=' ['+err.status+': '+err.statusText+']'
}
return message.replace(/\n/g,'\\n')
}
that.reportTaggedCrash=function(err,message){
that.reportCrash(err,{message:createTaggedErrorMessage(err,message)})
};
function isBlacklisted(err){
if(!window.JSON){
return true
}
var userAgentString=navigator.userAgent,matchMsieVersion=userAgentString&&userAgentString.match(/msie (\d+(\.\d+)?);/i);
if(matchMsieVersion&&parseInt(matchMsieVersion,10)<9){
return true
}
var ignoreUrls=[
'.cloudfront.net',
'chrome://',
'google-analytics.com',
'extension',
'superfish',
'admedia'
],url=err.fileName,found=false;
if(url){
ignoreUrls.forEach(function(ignoreUrl){
if(url.match(ignoreUrl)){
found=true;
return
}
});
if(found){
return true
}
}
if(err.message==='Script error.'&&err.fileName===''&&err.lineNumber===0||/TOOLBAR_READY/.test(err.message)||err.message==='RequireJS load error'||/conduitPage/.test(err.message)||false){
return true
}
return false
}
that.sendReport=function(err){
if(isBlacklisted(err)){
return
}
var xhr;
try{
xhr=new XMLHttpRequest
}catch(e){
try{
xhr=new ActiveXObject('Microsoft.XmlHTTP')
}catch(e2){
}
}
if(!xhr){
throw new Error('Couldn\'t initialize an XMLHttpRequest object.')
}
var fileNameMatch=(err.fileName||'').match(/^(?:https?:\/\/)(?:[^\/]+)(\/[^#]*)/);
fileNameMatch=fileNameMatch?fileNameMatch[1]:err.fileName;
var filePosition=fileNameMatch+':'+err.lineNumber;
var message=(err.message||err.customMessage)+' ('+filePosition+')';
if(err.name!=='Error'&&message.indexOf(err.name)===-1){
message=err.name+': '+message
}
var now=new Date;
var timestamp=now.getTime();
var then=that.hash[message];
if(then&&timestamp-then<120000){
that.hash[message]=timestamp;
return
}
that.hash[message]=timestamp;
var crashReport={
appData:{
location:err.pageName,
user:err.user,
locale:document.documentElement.getAttribute('lang'),
clientLog:one.crashLogger.toString(),
sourceMappedStack:err.sourceMappedStack,
sourceMappedStackError:err.sourceMappedStackError
},
browserLocalTime:now.toString(),
browserUTCTime:now.toUTCString(),
message:message,
crashReportId:err.crashReportId
};
if(err.additionalInfo){
crashReport.additionalInfo=err.additionalInfo
}
if(one.version){
crashReport.appData.serverVersion=one.version.serverVersion();
crashReport.appData.clientVersion=one.version.clientVersion()
}
crashReport.err={
name:err.name,
tags:err.tags,
message:err.message,
customMessage:err.customMessage,
fileName:err.fileName+':'+err.lineNumber
};
if(typeof err.status!=='undefined'){
crashReport.err.request={
method:err.requestMethod,
url:err.requestUrl
};
crashReport.err.response={
status:err.status,
statusText:err.statusText,
headers:err.responseHeaders,
body:err.response||err.responseText
};
if(typeof crashReport.err.response.body==='string'&&/<\/html>$/i.test(crashReport.err.response.body)){
crashReport.err.response.fromMitmProxy=true
}
}
if(err.hasOwnProperty('stack')){
crashReport.err.stack=err.stack
}
var crashReportStringified;
try{
crashReportStringified=JSON.stringify(crashReport)
}catch(e){
var newCrashReport={message:'Failed to stringify crash report: '+e.message};
if(typeof crashReport.message==='string'){
newCrashReport.err={message:crashReport.message}
}
crashReportStringified=JSON.stringify(newCrashReport)
}
xhr.open('post',that.reportUrl,true);
xhr.setRequestHeader('Content-Type','application/json');
if(oneTimeReadyStateChangeHandler){
xhr.onreadystatechange=oneTimeReadyStateChangeHandler;
oneTimeReadyStateChangeHandler=undefined
}
xhr.send(crashReportStringified)
};
var oneTimeReadyStateChangeHandler;
that.subscribeOneTimeOnReadyStateChangeHandler=function(handler){
if(typeof handler==='function'){
oneTimeReadyStateChangeHandler=handler
}
};
that.sendReportFromTraceKit=function(errorReport){
var firstFrame=errorReport.stack&&errorReport.stack.length>0?errorReport.stack[0]:{};
var err;
if(Object.prototype.toString.call(errorReport)==='[object Error]'){
err=errorReport
}else{
err=errorReport.error||function(){
var e=new Error;
e.message=errorReport.message;
return e
}()
}
err.fileName=firstFrame.url;
err.lineNumber=firstFrame.line;
err.pageName=errorReport.url;
err.sourceMappedStack=errorReport.sourceMappedStack;
err.sourceMappedStackError=errorReport.sourceMappedStackError;
that.sendReport(err)
}
}
var crashReporterConfig=one.crashReporterConfig||{};
one.crashReporter=new CrashReporter(crashReporterConfig)
}());
TraceKit.report.subscribe(one.crashReporter.sendReportFromTraceKit,!false);
window.undefined=window.undefined;
Ext={
version:'3.4.0',
versionDetail:{
major:3,
minor:4,
patch:0
}
};
Ext.apply=function(o,c,defaults){
if(defaults){
Ext.apply(o,defaults)
}
if(o&&c&&typeof c=='object'){
for(var p in c){
o[p]=c[p]
}
}
return o
};
(function(){
var idSeed=0,toString=Object.prototype.toString,ua=navigator.userAgent.toLowerCase(),check=function(r){
return r.test(ua)
},DOC=document,docMode=DOC.documentMode,isStrict=DOC.compatMode=='CSS1Compat',isOpera=check(/opera/),isChrome=check(/\bchrome\b/),isWebKit=check(/webkit/),isSafari=!isChrome&&check(/safari/),isSafari2=isSafari&&check(/applewebkit\/4/),isSafari3=isSafari&&check(/version\/3/),isSafari4=isSafari&&check(/version\/4/),isIE=!isOpera&&check(/msie/),isIE7=isIE&&(check(/msie 7/)||docMode==7),isIE8=isIE&&(check(/msie 8/)&&docMode!=7),isIE9=isIE&&check(/msie 9/),isIE6=isIE&&!isIE7&&!isIE8&&!isIE9,isGecko=!isWebKit&&check(/gecko/),isGecko2=isGecko&&check(/rv:1\.8/),isGecko3=isGecko&&check(/rv:1\.9/),isBorderBox=isIE&&!isStrict,isWindows=check(/windows|win32/),isMac=check(/macintosh|mac os x/),isAir=check(/adobeair/),isLinux=check(/linux/),isSecure=/^https/i.test(window.location.protocol);
if(isIE6){
try{
DOC.execCommand('BackgroundImageCache',false,true)
}catch(e){
}
}
Ext.apply(Ext,{
SSL_SECURE_URL:isSecure&&isIE?'javascript:""':'about:blank',
isStrict:isStrict,
isSecure:isSecure,
isReady:false,
enableForcedBoxModel:false,
enableGarbageCollector:true,
enableListenerCollection:false,
enableNestedListenerRemoval:false,
USE_NATIVE_JSON:false,
applyIf:function(o,c){
if(o){
for(var p in c){
if(!Ext.isDefined(o[p])){
o[p]=c[p]
}
}
}
return o
},
id:function(el,prefix){
el=Ext.getDom(el,true)||{};
if(!el.id){
el.id=(prefix||'ext-gen')+ ++idSeed
}
return el.id
},
extend:function(){
var io=function(o){
for(var m in o){
this[m]=o[m]
}
};
var oc=Object.prototype.constructor;
return function(sb,sp,overrides){
if(typeof sp=='object'){
overrides=sp;
sp=sb;
sb=overrides.constructor!=oc?overrides.constructor:function(){
sp.apply(this,arguments)
}
}
var F=function(){
},sbp,spp=sp.prototype;
F.prototype=spp;
sbp=sb.prototype=new F;
sbp.constructor=sb;
sb.superclass=spp;
if(spp.constructor==oc){
spp.constructor=sp
}
sb.override=function(o){
Ext.override(sb,o)
};
sbp.superclass=sbp.supr=function(){
return spp
};
sbp.override=io;
Ext.override(sb,overrides);
sb.extend=function(o){
return Ext.extend(sb,o)
};
return sb
}
}(),
override:function(origclass,overrides){
if(overrides){
var p=origclass.prototype;
Ext.apply(p,overrides);
if(Ext.isIE&&overrides.hasOwnProperty('toString')){
p.toString=overrides.toString
}
}
},
namespace:function(){
var len1=arguments.length,i=0,len2,j,main,ns,sub,current;
for(;i<len1;++i){
main=arguments[i];
ns=arguments[i].split('.');
current=window[ns[0]];
if(current===undefined){
current=window[ns[0]]={}
}
sub=ns.slice(1);
len2=sub.length;
for(j=0;j<len2;++j){
current=current[sub[j]]=current[sub[j]]||{}
}
}
return current
},
urlEncode:function(o,pre){
var empty,buf=[],e=encodeURIComponent;
Ext.iterate(o,function(key,item){
empty=Ext.isEmpty(item);
Ext.each(empty?key:item,function(val){
buf.push('&',e(key),'=',!Ext.isEmpty(val)&&(val!=key||!empty)?Ext.isDate(val)?Ext.encode(val).replace(/"/g,''):e(val):'')
})
});
if(!pre){
buf.shift();
pre=''
}
return pre+buf.join('')
},
urlDecode:function(string,overwrite){
if(Ext.isEmpty(string)){
return{}
}
var obj={},pairs=string.split('&'),d=decodeURIComponent,name,value;
Ext.each(pairs,function(pair){
pair=pair.split('=');
name=d(pair[0]);
value=d(pair[1]);
obj[name]=overwrite||!obj[name]?value:[].concat(obj[name]).concat(value)
});
return obj
},
urlAppend:function(url,s){
if(!Ext.isEmpty(s)){
return url+(url.indexOf('?')===-1?'?':'&')+s
}
return url
},
toArray:function(){
return isIE?function(a,i,j,res){
res=[];
for(var x=0,len=a.length;x<len;x++){
res.push(a[x])
}
return res.slice(i||0,j||res.length)
}:function(a,i,j){
return Array.prototype.slice.call(a,i||0,j||a.length)
}
}(),
isIterable:function(v){
if(Ext.isArray(v)||v.callee){
return true
}
if(/NodeList|HTMLCollection/.test(toString.call(v))){
return true
}
return(typeof v.nextNode!='undefined'||v.item)&&Ext.isNumber(v.length)
},
each:function(array,fn,scope){
if(Ext.isEmpty(array,true)){
return
}
if(!Ext.isIterable(array)||Ext.isPrimitive(array)){
array=[array]
}
for(var i=0,len=array.length;i<len;i++){
if(fn.call(scope||array[i],array[i],i,array)===false){
return i
}
;
}
},
iterate:function(obj,fn,scope){
if(Ext.isEmpty(obj)){
return
}
if(Ext.isIterable(obj)){
Ext.each(obj,fn,scope);
return
}else if(typeof obj=='object'){
for(var prop in obj){
if(obj.hasOwnProperty(prop)){
if(fn.call(scope||obj,prop,obj[prop],obj)===false){
return
}
;
}
}
}
},
getDom:function(el,strict){
if(!el||!DOC){
return null
}
if(el.dom){
return el.dom
}else{
if(typeof el=='string'){
var e=DOC.getElementById(el);
if(e&&isIE&&strict){
if(el==e.getAttribute('id')){
return e
}else{
return null
}
}
return e
}else{
return el
}
}
},
getBody:function(){
return Ext.get(DOC.body||DOC.documentElement)
},
getHead:function(){
var head;
return function(){
if(head==undefined){
head=Ext.get(DOC.getElementsByTagName('head')[0])
}
return head
}
}(),
removeNode:isIE&&!isIE8?function(){
var d;
return function(n){
if(n&&n.tagName!='BODY'){
Ext.enableNestedListenerRemoval?Ext.EventManager.purgeElement(n,true):Ext.EventManager.removeAll(n);
d=d||DOC.createElement('div');
d.appendChild(n);
d.innerHTML='';
delete Ext.elCache[n.id]
}
}
}():function(n){
if(n&&n.parentNode&&n.tagName!='BODY'){
Ext.enableNestedListenerRemoval?Ext.EventManager.purgeElement(n,true):Ext.EventManager.removeAll(n);
n.parentNode.removeChild(n);
delete Ext.elCache[n.id]
}
},
isEmpty:function(v,allowBlank){
return v===null||v===undefined||Ext.isArray(v)&&!v.length||(!allowBlank?v==='':false)
},
isArray:function(v){
return toString.apply(v)==='[object Array]'
},
isDate:function(v){
return toString.apply(v)==='[object Date]'
},
isObject:function(v){
return!!v&&Object.prototype.toString.call(v)==='[object Object]'
},
isPrimitive:function(v){
return Ext.isString(v)||Ext.isNumber(v)||Ext.isBoolean(v)
},
isFunction:function(v){
return toString.apply(v)==='[object Function]'
},
isNumber:function(v){
return typeof v==='number'&&isFinite(v)
},
isString:function(v){
return typeof v==='string'
},
isBoolean:function(v){
return typeof v==='boolean'
},
isElement:function(v){
return v?!!v.tagName:false
},
isDefined:function(v){
return typeof v!=='undefined'
},
isOpera:isOpera,
isWebKit:isWebKit,
isChrome:isChrome,
isSafari:isSafari,
isSafari3:isSafari3,
isSafari4:isSafari4,
isSafari2:isSafari2,
isIE:isIE,
isIE6:isIE6,
isIE7:isIE7,
isIE8:isIE8,
isIE9:isIE9,
isGecko:isGecko,
isGecko2:isGecko2,
isGecko3:isGecko3,
isBorderBox:isBorderBox,
isLinux:isLinux,
isWindows:isWindows,
isMac:isMac,
isAir:isAir
});
Ext.ns=Ext.namespace
}());
Ext.ns('Ext.util','Ext.lib','Ext.data','Ext.supports');
Ext.elCache={};
Ext.apply(Function.prototype,{
createInterceptor:function(fcn,scope){
var method=this;
return!Ext.isFunction(fcn)?this:function(){
var me=this,args=arguments;
fcn.target=me;
fcn.method=method;
return fcn.apply(scope||me||window,args)!==false?method.apply(me||window,args):null
}
},
createCallback:function(){
var args=arguments,method=this;
return function(){
return method.apply(window,args)
}
},
createDelegate:function(obj,args,appendArgs){
var method=this;
return function(){
var callArgs=args||arguments;
if(appendArgs===true){
callArgs=Array.prototype.slice.call(arguments,0);
callArgs=callArgs.concat(args)
}else if(Ext.isNumber(appendArgs)){
callArgs=Array.prototype.slice.call(arguments,0);
var applyArgs=[
appendArgs,
0
].concat(args);
Array.prototype.splice.apply(callArgs,applyArgs)
}
return method.apply(obj||window,callArgs)
}
},
defer:function(millis,obj,args,appendArgs){
var fn=this.createDelegate(obj,args,appendArgs);
if(millis>0){
return setTimeout(fn,millis)
}
fn();
return 0
}
});
Ext.applyIf(String,{
format:function(format){
var args=Ext.toArray(arguments,1);
return format.replace(/\{(\d+)\}/g,function(m,i){
return args[i]
})
}
});
Ext.applyIf(Array.prototype,{
indexOf:function(o,from){
var len=this.length;
from=from||0;
from+=from<0?len:0;
for(;from<len;++from){
if(this[from]===o){
return from
}
}
return-1
},
remove:function(o){
var index=this.indexOf(o);
if(index!=-1){
this.splice(index,1)
}
return this
}
});
Ext.util.TaskRunner=function(interval){
interval=interval||10;
var tasks=[],removeQueue=[],id=0,running=false,stopThread=function(){
running=false;
clearInterval(id);
id=0
},startThread=function(){
if(!running){
running=true;
id=setInterval(runTasks,interval)
}
},removeTask=function(t){
removeQueue.push(t);
if(t.onStop){
t.onStop.apply(t.scope||t)
}
},runTasks=function(){
var rqLen=removeQueue.length,now=new Date().getTime();
if(rqLen>0){
for(var i=0;i<rqLen;i++){
tasks.remove(removeQueue[i])
}
removeQueue=[];
if(tasks.length<1){
stopThread();
return
}
}
for(var i=0,t,itime,rt,len=tasks.length;i<len;++i){
t=tasks[i];
itime=now-t.taskRunTime;
if(t.interval<=itime){
rt=t.run.apply(t.scope||t,t.args||[++t.taskRunCount]);
t.taskRunTime=now;
if(rt===false||t.taskRunCount===t.repeat){
removeTask(t);
return
}
}
if(t.duration&&t.duration<=now-t.taskStartTime){
removeTask(t)
}
}
};
this.start=function(task){
tasks.push(task);
task.taskStartTime=new Date().getTime();
task.taskRunTime=0;
task.taskRunCount=0;
startThread();
return task
};
this.stop=function(task){
removeTask(task);
return task
};
this.stopAll=function(){
stopThread();
for(var i=0,len=tasks.length;i<len;i++){
if(tasks[i].onStop){
tasks[i].onStop()
}
}
tasks=[];
removeQueue=[]
}
};
Ext.TaskMgr=new Ext.util.TaskRunner;
(function(){
var libFlyweight;
function fly(el){
if(!libFlyweight){
libFlyweight=new Ext.Element.Flyweight
}
libFlyweight.dom=el;
return libFlyweight
}
(function(){
var doc=document,isCSS1=doc.compatMode=='CSS1Compat',MAX=Math.max,ROUND=Math.round,PARSEINT=parseInt;
Ext.lib.Dom={
isAncestor:function(p,c){
var ret=false;
p=Ext.getDom(p);
c=Ext.getDom(c);
if(p&&c){
if(p.contains){
return p.contains(c)
}else if(p.compareDocumentPosition){
return!!(p.compareDocumentPosition(c)&16)
}else{
while(c=c.parentNode){
ret=c==p||ret
}
}
}
return ret
},
getViewWidth:function(full){
return full?this.getDocumentWidth():this.getViewportWidth()
},
getViewHeight:function(full){
return full?this.getDocumentHeight():this.getViewportHeight()
},
getDocumentHeight:function(){
return MAX(!isCSS1?doc.body.scrollHeight:doc.documentElement.scrollHeight,this.getViewportHeight())
},
getDocumentWidth:function(){
return MAX(!isCSS1?doc.body.scrollWidth:doc.documentElement.scrollWidth,this.getViewportWidth())
},
getViewportHeight:function(){
return Ext.isIE?Ext.isStrict?doc.documentElement.clientHeight:doc.body.clientHeight:self.innerHeight
},
getViewportWidth:function(){
return!Ext.isStrict&&!Ext.isOpera?doc.body.clientWidth:Ext.isIE?doc.documentElement.clientWidth:self.innerWidth
},
getY:function(el){
return this.getXY(el)[1]
},
getX:function(el){
return this.getXY(el)[0]
},
getXY:function(el){
var p,pe,b,bt,bl,dbd,x=0,y=0,scroll,hasAbsolute,bd=doc.body||doc.documentElement,ret=[
0,
0
];
el=Ext.getDom(el);
if(el!=bd){
if(el.getBoundingClientRect){
b=el.getBoundingClientRect();
scroll=fly(document).getScroll();
ret=[
ROUND(b.left+scroll.left),
ROUND(b.top+scroll.top)
]
}else{
p=el;
hasAbsolute=fly(el).isStyle('position','absolute');
while(p){
pe=fly(p);
x+=p.offsetLeft;
y+=p.offsetTop;
hasAbsolute=hasAbsolute||pe.isStyle('position','absolute');
if(Ext.isGecko){
y+=bt=PARSEINT(pe.getStyle('borderTopWidth'),10)||0;
x+=bl=PARSEINT(pe.getStyle('borderLeftWidth'),10)||0;
if(p!=el&&!pe.isStyle('overflow','visible')){
x+=bl;
y+=bt
}
}
p=p.offsetParent
}
if(Ext.isSafari&&hasAbsolute){
x-=bd.offsetLeft;
y-=bd.offsetTop
}
if(Ext.isGecko&&!hasAbsolute){
dbd=fly(bd);
x+=PARSEINT(dbd.getStyle('borderLeftWidth'),10)||0;
y+=PARSEINT(dbd.getStyle('borderTopWidth'),10)||0
}
p=el.parentNode;
while(p&&p!=bd){
if(!Ext.isOpera||p.tagName!='TR'&&!fly(p).isStyle('display','inline')){
x-=p.scrollLeft;
y-=p.scrollTop
}
p=p.parentNode
}
ret=[
x,
y
]
}
}
return ret
},
setXY:function(el,xy){
(el=Ext.fly(el,'_setXY')).position();
var pts=el.translatePoints(xy),style=el.dom.style,pos;
for(pos in pts){
if(!isNaN(pts[pos])){
style[pos]=pts[pos]+'px'
}
}
},
setX:function(el,x){
this.setXY(el,[
x,
false
])
},
setY:function(el,y){
this.setXY(el,[
false,
y
])
}
}
}());
Ext.lib.Event=function(){
var loadComplete=false,unloadListeners={},retryCount=0,onAvailStack=[],_interval,locked=false,win=window,doc=document,POLL_RETRYS=200,POLL_INTERVAL=20,TYPE=0,FN=1,OBJ=2,ADJ_SCOPE=3,SCROLLLEFT='scrollLeft',SCROLLTOP='scrollTop',UNLOAD='unload',MOUSEOVER='mouseover',MOUSEOUT='mouseout',doAdd=function(){
var ret;
if(win.addEventListener){
ret=function(el,eventName,fn,capture){
if(eventName=='mouseenter'){
fn=fn.createInterceptor(checkRelatedTarget);
el.addEventListener(MOUSEOVER,fn,capture)
}else if(eventName=='mouseleave'){
fn=fn.createInterceptor(checkRelatedTarget);
el.addEventListener(MOUSEOUT,fn,capture)
}else{
el.addEventListener(eventName,fn,capture)
}
return fn
}
}else if(win.attachEvent){
ret=function(el,eventName,fn,capture){
el.attachEvent('on'+eventName,fn);
return fn
}
}else{
ret=function(){
}
}
return ret
}(),doRemove=function(){
var ret;
if(win.removeEventListener){
ret=function(el,eventName,fn,capture){
if(eventName=='mouseenter'){
eventName=MOUSEOVER
}else if(eventName=='mouseleave'){
eventName=MOUSEOUT
}
el.removeEventListener(eventName,fn,capture)
}
}else if(win.detachEvent){
ret=function(el,eventName,fn){
el.detachEvent('on'+eventName,fn)
}
}else{
ret=function(){
}
}
return ret
}();
function checkRelatedTarget(e){
return!elContains(e.currentTarget,pub.getRelatedTarget(e))
}
function elContains(parent,child){
if(parent&&parent.firstChild){
while(child){
if(child===parent){
return true
}
child=child.parentNode;
if(child&&child.nodeType!=1){
child=null
}
}
}
return false
}
function _tryPreloadAttach(){
var ret=false,notAvail=[],element,i,v,override,tryAgain=!loadComplete||retryCount>0;
if(!locked){
locked=true;
for(i=0;i<onAvailStack.length;++i){
v=onAvailStack[i];
if(v&&(element=doc.getElementById(v.id))){
if(!v.checkReady||loadComplete||element.nextSibling||doc&&doc.body){
override=v.override;
element=override?override===true?v.obj:override:element;
v.fn.call(element,v.obj);
onAvailStack.remove(v);
--i
}else{
notAvail.push(v)
}
}
}
retryCount=notAvail.length===0?0:retryCount-1;
if(tryAgain){
startInterval()
}else{
clearInterval(_interval);
_interval=null
}
ret=!(locked=false)
}
return ret
}
function startInterval(){
if(!_interval){
var callback=function(){
_tryPreloadAttach()
};
_interval=setInterval(callback,POLL_INTERVAL)
}
}
function getScroll(){
var dd=doc.documentElement,db=doc.body;
if(dd&&(dd[SCROLLTOP]||dd[SCROLLLEFT])){
return[
dd[SCROLLLEFT],
dd[SCROLLTOP]
]
}else if(db){
return[
db[SCROLLLEFT],
db[SCROLLTOP]
]
}else{
return[
0,
0
]
}
}
function getPageCoord(ev,xy){
ev=ev.browserEvent||ev;
var coord=ev['page'+xy];
if(!coord&&coord!==0){
coord=ev['client'+xy]||0;
if(Ext.isIE){
coord+=getScroll()[xy=='X'?0:1]
}
}
return coord
}
var pub={
extAdapter:true,
onAvailable:function(p_id,p_fn,p_obj,p_override){
onAvailStack.push({
id:p_id,
fn:p_fn,
obj:p_obj,
override:p_override,
checkReady:false
});
retryCount=POLL_RETRYS;
startInterval()
},
addListener:function(el,eventName,fn){
el=Ext.getDom(el);
if(el&&fn){
if(eventName==UNLOAD){
if(unloadListeners[el.id]===undefined){
unloadListeners[el.id]=[]
}
unloadListeners[el.id].push([
eventName,
fn
]);
return fn
}
return doAdd(el,eventName,fn,false)
}
return false
},
removeListener:function(el,eventName,fn){
el=Ext.getDom(el);
var i,len,li,lis;
if(el&&fn){
if(eventName==UNLOAD){
if((lis=unloadListeners[el.id])!==undefined){
for(i=0,len=lis.length;i<len;i++){
if((li=lis[i])&&li[TYPE]==eventName&&li[FN]==fn){
unloadListeners[el.id].splice(i,1)
}
}
}
return
}
doRemove(el,eventName,fn,false)
}
},
getTarget:function(ev){
ev=ev.browserEvent||ev;
return this.resolveTextNode(ev.target||ev.srcElement)
},
resolveTextNode:Ext.isGecko?function(node){
if(!node){
return
}
var s=HTMLElement.prototype.toString.call(node);
if(s=='[xpconnect wrapped native prototype]'||s=='[object XULElement]'){
return
}
return node.nodeType==3?node.parentNode:node
}:function(node){
return node&&node.nodeType==3?node.parentNode:node
},
getRelatedTarget:function(ev){
ev=ev.browserEvent||ev;
return this.resolveTextNode(ev.relatedTarget||(/(mouseout|mouseleave)/.test(ev.type)?ev.toElement:/(mouseover|mouseenter)/.test(ev.type)?ev.fromElement:null))
},
getPageX:function(ev){
return getPageCoord(ev,'X')
},
getPageY:function(ev){
return getPageCoord(ev,'Y')
},
getXY:function(ev){
return[
this.getPageX(ev),
this.getPageY(ev)
]
},
stopEvent:function(ev){
this.stopPropagation(ev);
this.preventDefault(ev)
},
stopPropagation:function(ev){
ev=ev.browserEvent||ev;
if(ev.stopPropagation){
ev.stopPropagation()
}else{
ev.cancelBubble=true
}
},
preventDefault:function(ev){
ev=ev.browserEvent||ev;
if(ev.preventDefault){
ev.preventDefault()
}else{
if(ev.keyCode){
ev.keyCode=0
}
ev.returnValue=false
}
},
getEvent:function(e){
e=e||win.event;
if(!e){
var c=this.getEvent.caller;
while(c){
e=c.arguments[0];
if(e&&Event==e.constructor){
break
}
c=c.caller
}
}
return e
},
getCharCode:function(ev){
ev=ev.browserEvent||ev;
return ev.charCode||ev.keyCode||0
},
getListeners:function(el,eventName){
Ext.EventManager.getListeners(el,eventName)
},
purgeElement:function(el,recurse,eventName){
Ext.EventManager.purgeElement(el,recurse,eventName)
},
_load:function(e){
loadComplete=true;
if(Ext.isIE&&e!==true){
doRemove(win,'load',arguments.callee)
}
},
_unload:function(e){
var EU=Ext.lib.Event,i,v,ul,id,len,scope;
for(id in unloadListeners){
ul=unloadListeners[id];
for(i=0,len=ul.length;i<len;i++){
v=ul[i];
if(v){
try{
scope=v[ADJ_SCOPE]?v[ADJ_SCOPE]===true?v[OBJ]:v[ADJ_SCOPE]:win;
v[FN].call(scope,EU.getEvent(e),v[OBJ])
}catch(ex){
}
}
}
}
;
Ext.EventManager._unload();
doRemove(win,UNLOAD,EU._unload)
}
};
pub.on=pub.addListener;
pub.un=pub.removeListener;
if(doc&&doc.body){
pub._load(true)
}else{
doAdd(win,'load',pub._load)
}
doAdd(win,UNLOAD,pub._unload);
_tryPreloadAttach();
return pub
}();
Ext.lib.Ajax=function(){
var activeX=[
'Msxml2.XMLHTTP.6.0',
'Msxml2.XMLHTTP.3.0',
'Msxml2.XMLHTTP'
],CONTENTTYPE='Content-Type';
function setHeader(o){
var conn=o.conn,prop,headers={};
function setTheHeaders(conn,headers){
for(prop in headers){
if(headers.hasOwnProperty(prop)){
conn.setRequestHeader(prop,headers[prop])
}
}
}
Ext.apply(headers,pub.headers,pub.defaultHeaders);
setTheHeaders(conn,headers);
delete pub.headers
}
function createExceptionObject(tId,callbackArg,isAbort,isTimeout){
return{
tId:tId,
status:isAbort?-1:0,
statusText:isAbort?'transaction aborted':'communication failure',
isAbort:isAbort,
isTimeout:isTimeout,
argument:callbackArg
}
}
function initHeader(label,value){
(pub.headers=pub.headers||{})[label]=value
}
function createResponseObject(o,callbackArg){
var headerObj={},headerStr,conn=o.conn,t,s,isBrokenStatus=conn.status==1223;
try{
headerStr=o.conn.getAllResponseHeaders();
Ext.each(headerStr.replace(/\r\n/g,'\n').split('\n'),function(v){
t=v.indexOf(':');
if(t>=0){
s=v.substr(0,t).toLowerCase();
if(v.charAt(t+1)==' '){
++t
}
headerObj[s]=v.substr(t+1)
}
})
}catch(e){
}
return{
tId:o.tId,
status:isBrokenStatus?204:conn.status,
statusText:isBrokenStatus?'No Content':conn.statusText,
getResponseHeader:function(header){
return headerObj[header.toLowerCase()]
},
getAllResponseHeaders:function(){
return headerStr
},
responseText:conn.responseText,
responseXML:conn.responseXML,
argument:callbackArg
}
}
function releaseObject(o){
if(o.tId){
pub.conn[o.tId]=null
}
o.conn=null;
o=null
}
function handleTransactionResponse(o,callback,isAbort,isTimeout){
if(!callback){
releaseObject(o);
return
}
var httpStatus,responseObject;
try{
if(o.conn.status!==undefined&&o.conn.status!=0){
httpStatus=o.conn.status
}else{
httpStatus=13030
}
}catch(e){
httpStatus=13030
}
if(httpStatus>=200&&httpStatus<300||Ext.isIE&&httpStatus==1223){
responseObject=createResponseObject(o,callback.argument);
if(callback.success){
if(!callback.scope){
callback.success(responseObject)
}else{
callback.success.apply(callback.scope,[responseObject])
}
}
}else{
switch(httpStatus){
case 12002:
case 12029:
case 12030:
case 12031:
case 12152:
case 13030:
responseObject=createExceptionObject(o.tId,callback.argument,isAbort?isAbort:false,isTimeout);
if(callback.failure){
if(!callback.scope){
callback.failure(responseObject)
}else{
callback.failure.apply(callback.scope,[responseObject])
}
}
break;
default:
responseObject=createResponseObject(o,callback.argument);
if(callback.failure){
if(!callback.scope){
callback.failure(responseObject)
}else{
callback.failure.apply(callback.scope,[responseObject])
}
}
}
}
releaseObject(o);
responseObject=null
}
function checkResponse(o,callback,conn,tId,poll,cbTimeout){
if(conn&&conn.readyState==4){
clearInterval(poll[tId]);
poll[tId]=null;
if(cbTimeout){
clearTimeout(pub.timeout[tId]);
pub.timeout[tId]=null
}
handleTransactionResponse(o,callback)
}
}
function checkTimeout(o,callback){
pub.abort(o,callback,true)
}
function handleReadyState(o,callback){
callback=callback||{};
var conn=o.conn,tId=o.tId,poll=pub.poll,cbTimeout=callback.timeout||null;
if(cbTimeout){
pub.conn[tId]=conn;
pub.timeout[tId]=setTimeout(checkTimeout.createCallback(o,callback),cbTimeout)
}
poll[tId]=setInterval(checkResponse.createCallback(o,callback,conn,tId,poll,cbTimeout),pub.pollInterval)
}
function asyncRequest(method,uri,callback,postData){
var o=getConnectionObject()||null;
if(o){
o.conn.open(method,uri,true);
if(pub.useDefaultXhrHeader){
initHeader('X-Requested-With',pub.defaultXhrHeader)
}
if(postData&&pub.useDefaultHeader&&(!pub.headers||!pub.headers[CONTENTTYPE])){
initHeader(CONTENTTYPE,pub.defaultPostHeader)
}
if(pub.defaultHeaders||pub.headers){
setHeader(o)
}
handleReadyState(o,callback);
o.conn.send(postData||null)
}
return o
}
function getConnectionObject(){
var o;
try{
if(o=createXhrObject(pub.transactionId)){
pub.transactionId++
}
}catch(e){
}finally{
return o
}
}
function createXhrObject(transactionId){
var http;
try{
http=new XMLHttpRequest
}catch(e){
for(var i=Ext.isIE6?1:0;i<activeX.length;++i){
try{
http=new ActiveXObject(activeX[i]);
break
}catch(e){
}
}
}finally{
return{
conn:http,
tId:transactionId
}
}
}
var pub={
request:function(method,uri,cb,data,options){
if(options){
var me=this,xmlData=options.xmlData,jsonData=options.jsonData,hs;
Ext.applyIf(me,options);
if(xmlData||jsonData){
hs=me.headers;
if(!hs||!hs[CONTENTTYPE]){
initHeader(CONTENTTYPE,xmlData?'text/xml':'application/json')
}
data=xmlData||(!Ext.isPrimitive(jsonData)?Ext.encode(jsonData):jsonData)
}
}
return asyncRequest(method||options.method||'POST',uri,cb,data)
},
serializeForm:function(form){
var fElements=form.elements||(document.forms[form]||Ext.getDom(form)).elements,hasSubmit=false,encoder=encodeURIComponent,name,data='',type,hasValue;
Ext.each(fElements,function(element){
name=element.name;
type=element.type;
if(!element.disabled&&name){
if(/select-(one|multiple)/i.test(type)){
Ext.each(element.options,function(opt){
if(opt.selected){
hasValue=opt.hasAttribute?opt.hasAttribute('value'):opt.getAttributeNode('value').specified;
data+=String.format('{0}={1}&',encoder(name),encoder(hasValue?opt.value:opt.text))
}
})
}else if(!/file|undefined|reset|button/i.test(type)){
if(!(/radio|checkbox/i.test(type)&&!element.checked)&&!(type=='submit'&&hasSubmit)){
data+=encoder(name)+'='+encoder(element.value)+'&';
hasSubmit=/submit/i.test(type)
}
}
}
});
return data.substr(0,data.length-1)
},
useDefaultHeader:true,
defaultPostHeader:'application/x-www-form-urlencoded; charset=UTF-8',
useDefaultXhrHeader:true,
defaultXhrHeader:'XMLHttpRequest',
poll:{},
timeout:{},
conn:{},
pollInterval:50,
transactionId:0,
abort:function(o,callback,isTimeout){
var me=this,tId=o.tId,isAbort=false;
if(me.isCallInProgress(o)){
o.conn.abort();
clearInterval(me.poll[tId]);
me.poll[tId]=null;
clearTimeout(pub.timeout[tId]);
me.timeout[tId]=null;
handleTransactionResponse(o,callback,isAbort=true,isTimeout)
}
return isAbort
},
isCallInProgress:function(o){
return o.conn&&!{
0:true,
4:true
}[o.conn.readyState]
}
};
return pub
}();
(function(){
var EXTLIB=Ext.lib,noNegatives=/width|height|opacity|padding/i,offsetAttribute=/^((width|height)|(top|left))$/,defaultUnit=/width|height|top$|bottom$|left$|right$/i,offsetUnit=/\d+(em|%|en|ex|pt|in|cm|mm|pc)$/i,isset=function(v){
return typeof v!=='undefined'
},now=function(){
return new Date
};
EXTLIB.Anim={
motion:function(el,args,duration,easing,cb,scope){
return this.run(el,args,duration,easing,cb,scope,Ext.lib.Motion)
},
run:function(el,args,duration,easing,cb,scope,type){
type=type||Ext.lib.AnimBase;
if(typeof easing=='string'){
easing=Ext.lib.Easing[easing]
}
var anim=new type(el,args,duration,easing);
anim.animateX(function(){
if(Ext.isFunction(cb)){
cb.call(scope)
}
});
return anim
}
};
EXTLIB.AnimBase=function(el,attributes,duration,method){
if(el){
this.init(el,attributes,duration,method)
}
};
EXTLIB.AnimBase.prototype={
doMethod:function(attr,start,end){
var me=this;
return me.method(me.curFrame,start,end-start,me.totalFrames)
},
setAttr:function(attr,val,unit){
if(noNegatives.test(attr)&&val<0){
val=0
}
Ext.fly(this.el,'_anim').setStyle(attr,val+unit)
},
getAttr:function(attr){
var el=Ext.fly(this.el),val=el.getStyle(attr),a=offsetAttribute.exec(attr)||[];
if(val!=='auto'&&!offsetUnit.test(val)){
return parseFloat(val)
}
return!!a[2]||el.getStyle('position')=='absolute'&&!!a[3]?el.dom['offset'+a[0].charAt(0).toUpperCase()+a[0].substr(1)]:0
},
getDefaultUnit:function(attr){
return defaultUnit.test(attr)?'px':''
},
animateX:function(callback,scope){
var me=this,f=function(){
me.onComplete.removeListener(f);
if(Ext.isFunction(callback)){
callback.call(scope||me,me)
}
};
me.onComplete.addListener(f,me);
me.animate()
},
setRunAttr:function(attr){
var me=this,a=this.attributes[attr],to=a.to,by=a.by,from=a.from,unit=a.unit,ra=this.runAttrs[attr]={},end;
if(!isset(to)&&!isset(by)){
return false
}
var start=isset(from)?from:me.getAttr(attr);
if(isset(to)){
end=to
}else if(isset(by)){
if(Ext.isArray(start)){
end=[];
for(var i=0,len=start.length;i<len;i++){
end[i]=start[i]+by[i]
}
}else{
end=start+by
}
}
Ext.apply(ra,{
start:start,
end:end,
unit:isset(unit)?unit:me.getDefaultUnit(attr)
})
},
init:function(el,attributes,duration,method){
var me=this,actualFrames=0,mgr=EXTLIB.AnimMgr;
Ext.apply(me,{
isAnimated:false,
startTime:null,
el:Ext.getDom(el),
attributes:attributes||{},
duration:duration||1,
method:method||EXTLIB.Easing.easeNone,
useSec:true,
curFrame:0,
totalFrames:mgr.fps,
runAttrs:{},
animate:function(){
var me=this,d=me.duration;
if(me.isAnimated){
return false
}
me.curFrame=0;
me.totalFrames=me.useSec?Math.ceil(mgr.fps*d):d;
mgr.registerElement(me)
},
stop:function(finish){
var me=this;
if(finish){
me.curFrame=me.totalFrames;
me._onTween.fire()
}
mgr.stop(me)
}
});
var onStart=function(){
var me=this,attr;
me.onStart.fire();
me.runAttrs={};
for(attr in this.attributes){
this.setRunAttr(attr)
}
me.isAnimated=true;
me.startTime=now();
actualFrames=0
};
var onTween=function(){
var me=this;
me.onTween.fire({
duration:now()-me.startTime,
curFrame:me.curFrame
});
var ra=me.runAttrs;
for(var attr in ra){
this.setAttr(attr,me.doMethod(attr,ra[attr].start,ra[attr].end),ra[attr].unit)
}
++actualFrames
};
var onComplete=function(){
var me=this,actual=(now()-me.startTime)/1000,data={
duration:actual,
frames:actualFrames,
fps:actualFrames/actual
};
me.isAnimated=false;
actualFrames=0;
me.onComplete.fire(data)
};
me.onStart=new Ext.util.Event(me);
me.onTween=new Ext.util.Event(me);
me.onComplete=new Ext.util.Event(me);
(me._onStart=new Ext.util.Event(me)).addListener(onStart);
(me._onTween=new Ext.util.Event(me)).addListener(onTween);
(me._onComplete=new Ext.util.Event(me)).addListener(onComplete)
}
};
Ext.lib.AnimMgr=new function(){
var me=this,thread=null,queue=[],tweenCount=0;
Ext.apply(me,{
fps:1000,
delay:1,
registerElement:function(tween){
queue.push(tween);
++tweenCount;
tween._onStart.fire();
me.start()
},
unRegister:function(tween,index){
tween._onComplete.fire();
index=index||getIndex(tween);
if(index!=-1){
queue.splice(index,1)
}
if(--tweenCount<=0){
me.stop()
}
},
start:function(){
if(thread===null){
thread=setInterval(me.run,me.delay)
}
},
stop:function(tween){
if(!tween){
clearInterval(thread);
for(var i=0,len=queue.length;i<len;++i){
if(queue[0].isAnimated){
me.unRegister(queue[0],0)
}
}
queue=[];
thread=null;
tweenCount=0
}else{
me.unRegister(tween)
}
},
run:function(){
var tf,i,len,tween;
for(i=0,len=queue.length;i<len;i++){
tween=queue[i];
if(tween&&tween.isAnimated){
tf=tween.totalFrames;
if(tween.curFrame<tf||tf===null){
++tween.curFrame;
if(tween.useSec){
correctFrame(tween)
}
tween._onTween.fire()
}else{
me.stop(tween)
}
}
}
}
});
var getIndex=function(anim){
var i,len;
for(i=0,len=queue.length;i<len;i++){
if(queue[i]===anim){
return i
}
}
return-1
};
var correctFrame=function(tween){
var frames=tween.totalFrames,frame=tween.curFrame,duration=tween.duration,expected=frame*duration*1000/frames,elapsed=now()-tween.startTime,tweak=0;
if(elapsed<duration*1000){
tweak=Math.round((elapsed/expected-1)*frame)
}else{
tweak=frames-(frame+1)
}
if(tweak>0&&isFinite(tweak)){
if(tween.curFrame+tweak>=frames){
tweak=frames-(frame+1)
}
tween.curFrame+=tweak
}
}
};
EXTLIB.Bezier=new function(){
this.getPosition=function(points,t){
var n=points.length,tmp=[],c=1-t,i,j;
for(i=0;i<n;++i){
tmp[i]=[
points[i][0],
points[i][1]
]
}
for(j=1;j<n;++j){
for(i=0;i<n-j;++i){
tmp[i][0]=c*tmp[i][0]+t*tmp[parseInt(i+1,10)][0];
tmp[i][1]=c*tmp[i][1]+t*tmp[parseInt(i+1,10)][1]
}
}
return[
tmp[0][0],
tmp[0][1]
]
}
};
EXTLIB.Easing={
easeNone:function(t,b,c,d){
return c*t/d+b
},
easeIn:function(t,b,c,d){
return c*(t/=d)*t+b
},
easeOut:function(t,b,c,d){
return-c*(t/=d)*(t-2)+b
}
};
(function(){
EXTLIB.Motion=function(el,attributes,duration,method){
if(el){
EXTLIB.Motion.superclass.constructor.call(this,el,attributes,duration,method)
}
};
Ext.extend(EXTLIB.Motion,Ext.lib.AnimBase);
var superclass=EXTLIB.Motion.superclass,pointsRe=/^points$/i;
Ext.apply(EXTLIB.Motion.prototype,{
setAttr:function(attr,val,unit){
var me=this,setAttr=superclass.setAttr;
if(pointsRe.test(attr)){
unit=unit||'px';
setAttr.call(me,'left',val[0],unit);
setAttr.call(me,'top',val[1],unit)
}else{
setAttr.call(me,attr,val,unit)
}
},
getAttr:function(attr){
var me=this,getAttr=superclass.getAttr;
return pointsRe.test(attr)?[
getAttr.call(me,'left'),
getAttr.call(me,'top')
]:getAttr.call(me,attr)
},
doMethod:function(attr,start,end){
var me=this;
return pointsRe.test(attr)?EXTLIB.Bezier.getPosition(me.runAttrs[attr],me.method(me.curFrame,0,100,me.totalFrames)/100):superclass.doMethod.call(me,attr,start,end)
},
setRunAttr:function(attr){
if(pointsRe.test(attr)){
var me=this,el=this.el,points=this.attributes.points,control=points.control||[],from=points.from,to=points.to,by=points.by,DOM=EXTLIB.Dom,start,i,end,len,ra;
if(control.length>0&&!Ext.isArray(control[0])){
control=[control]
}else{
}
Ext.fly(el,'_anim').position();
DOM.setXY(el,isset(from)?from:DOM.getXY(el));
start=me.getAttr('points');
if(isset(to)){
end=translateValues.call(me,to,start);
for(i=0,len=control.length;i<len;++i){
control[i]=translateValues.call(me,control[i],start)
}
}else if(isset(by)){
end=[
start[0]+by[0],
start[1]+by[1]
];
for(i=0,len=control.length;i<len;++i){
control[i]=[
start[0]+control[i][0],
start[1]+control[i][1]
]
}
}
ra=this.runAttrs[attr]=[start];
if(control.length>0){
ra=ra.concat(control)
}
ra[ra.length]=end
}else{
superclass.setRunAttr.call(this,attr)
}
}
});
var translateValues=function(val,start){
var pageXY=EXTLIB.Dom.getXY(this.el);
return[
val[0]-pageXY[0]+start[0],
val[1]-pageXY[1]+start[1]
]
}
}())
}());
(function(){
var abs=Math.abs,pi=Math.PI,asin=Math.asin,pow=Math.pow,sin=Math.sin,EXTLIB=Ext.lib;
Ext.apply(EXTLIB.Easing,{
easeBoth:function(t,b,c,d){
return(t/=d/2)<1?c/2*t*t+b:-c/2*(--t*(t-2)-1)+b
},
easeInStrong:function(t,b,c,d){
return c*(t/=d)*t*t*t+b
},
easeOutStrong:function(t,b,c,d){
return-c*((t=t/d-1)*t*t*t-1)+b
},
easeBothStrong:function(t,b,c,d){
return(t/=d/2)<1?c/2*t*t*t*t+b:-c/2*((t-=2)*t*t*t-2)+b
},
elasticIn:function(t,b,c,d,a,p){
if(t==0||(t/=d)==1){
return t==0?b:b+c
}
p=p||d*0.3;
var s;
if(a>=abs(c)){
s=p/(2*pi)*asin(c/a)
}else{
a=c;
s=p/4
}
return-(a*pow(2,10*(t-=1))*sin((t*d-s)*(2*pi)/p))+b
},
elasticOut:function(t,b,c,d,a,p){
if(t==0||(t/=d)==1){
return t==0?b:b+c
}
p=p||d*0.3;
var s;
if(a>=abs(c)){
s=p/(2*pi)*asin(c/a)
}else{
a=c;
s=p/4
}
return a*pow(2,-10*t)*sin((t*d-s)*(2*pi)/p)+c+b
},
elasticBoth:function(t,b,c,d,a,p){
if(t==0||(t/=d/2)==2){
return t==0?b:b+c
}
p=p||d*(0.3*1.5);
var s;
if(a>=abs(c)){
s=p/(2*pi)*asin(c/a)
}else{
a=c;
s=p/4
}
return t<1?-0.5*(a*pow(2,10*(t-=1))*sin((t*d-s)*(2*pi)/p))+b:a*pow(2,-10*(t-=1))*sin((t*d-s)*(2*pi)/p)*0.5+c+b
},
backIn:function(t,b,c,d,s){
s=s||1.70158;
return c*(t/=d)*t*((s+1)*t-s)+b
},
backOut:function(t,b,c,d,s){
if(!s){
s=1.70158
}
return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b
},
backBoth:function(t,b,c,d,s){
s=s||1.70158;
return(t/=d/2)<1?c/2*(t*t*(((s*=1.525)+1)*t-s))+b:c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b
},
bounceIn:function(t,b,c,d){
return c-EXTLIB.Easing.bounceOut(d-t,0,c,d)+b
},
bounceOut:function(t,b,c,d){
if((t/=d)<1/2.75){
return c*(7.5625*t*t)+b
}else if(t<2/2.75){
return c*(7.5625*(t-=1.5/2.75)*t+0.75)+b
}else if(t<2.5/2.75){
return c*(7.5625*(t-=2.25/2.75)*t+0.9375)+b
}
return c*(7.5625*(t-=2.625/2.75)*t+0.984375)+b
},
bounceBoth:function(t,b,c,d){
return t<d/2?EXTLIB.Easing.bounceIn(t*2,0,c,d)*0.5+b:EXTLIB.Easing.bounceOut(t*2-d,0,c,d)*0.5+c*0.5+b
}
})
}());
(function(){
var EXTLIB=Ext.lib;
EXTLIB.Anim.color=function(el,args,duration,easing,cb,scope){
return EXTLIB.Anim.run(el,args,duration,easing,cb,scope,EXTLIB.ColorAnim)
};
EXTLIB.ColorAnim=function(el,attributes,duration,method){
EXTLIB.ColorAnim.superclass.constructor.call(this,el,attributes,duration,method)
};
Ext.extend(EXTLIB.ColorAnim,EXTLIB.AnimBase);
var superclass=EXTLIB.ColorAnim.superclass,colorRE=/color$/i,transparentRE=/^transparent|rgba\(0, 0, 0, 0\)$/,rgbRE=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,hexRE=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,hex3RE=/^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i,isset=function(v){
return typeof v!=='undefined'
};
function parseColor(s){
var pi=parseInt,base,out=null,c;
if(s.length==3){
return s
}
Ext.each([
hexRE,
rgbRE,
hex3RE
],function(re,idx){
base=idx%2==0?16:10;
c=re.exec(s);
if(c&&c.length==4){
out=[
pi(c[1],base),
pi(c[2],base),
pi(c[3],base)
];
return false
}
});
return out
}
Ext.apply(EXTLIB.ColorAnim.prototype,{
getAttr:function(attr){
var me=this,el=me.el,val;
if(colorRE.test(attr)){
while(el&&transparentRE.test(val=Ext.fly(el).getStyle(attr))){
el=el.parentNode;
val='fff'
}
}else{
val=superclass.getAttr.call(me,attr)
}
return val
},
doMethod:function(attr,start,end){
var me=this,val,floor=Math.floor,i,len,v;
if(colorRE.test(attr)){
val=[];
end=end||[];
for(i=0,len=start.length;i<len;i++){
v=start[i];
val[i]=superclass.doMethod.call(me,attr,v,end[i])
}
val='rgb('+floor(val[0])+','+floor(val[1])+','+floor(val[2])+')'
}else{
val=superclass.doMethod.call(me,attr,start,end)
}
return val
},
setRunAttr:function(attr){
var me=this,a=me.attributes[attr],to=a.to,by=a.by,ra;
superclass.setRunAttr.call(me,attr);
ra=me.runAttrs[attr];
if(colorRE.test(attr)){
var start=parseColor(ra.start),end=parseColor(ra.end);
if(!isset(to)&&isset(by)){
end=parseColor(by);
for(var i=0,len=start.length;i<len;i++){
end[i]=start[i]+end[i]
}
}
ra.start=start;
ra.end=end
}
}
})
}());
(function(){
var EXTLIB=Ext.lib;
EXTLIB.Anim.scroll=function(el,args,duration,easing,cb,scope){
return EXTLIB.Anim.run(el,args,duration,easing,cb,scope,EXTLIB.Scroll)
};
EXTLIB.Scroll=function(el,attributes,duration,method){
if(el){
EXTLIB.Scroll.superclass.constructor.call(this,el,attributes,duration,method)
}
};
Ext.extend(EXTLIB.Scroll,EXTLIB.ColorAnim);
var superclass=EXTLIB.Scroll.superclass,SCROLL='scroll';
Ext.apply(EXTLIB.Scroll.prototype,{
doMethod:function(attr,start,end){
var val,me=this,curFrame=me.curFrame,totalFrames=me.totalFrames;
if(attr==SCROLL){
val=[
me.method(curFrame,start[0],end[0]-start[0],totalFrames),
me.method(curFrame,start[1],end[1]-start[1],totalFrames)
]
}else{
val=superclass.doMethod.call(me,attr,start,end)
}
return val
},
getAttr:function(attr){
var me=this;
if(attr==SCROLL){
return[
me.el.scrollLeft,
me.el.scrollTop
]
}else{
return superclass.getAttr.call(me,attr)
}
},
setAttr:function(attr,val,unit){
var me=this;
if(attr==SCROLL){
me.el.scrollLeft=val[0];
me.el.scrollTop=val[1]
}else{
superclass.setAttr.call(me,attr,val,unit)
}
}
})
}());
if(Ext.isIE){
function fnCleanUp(){
var p=Function.prototype;
delete p.createSequence;
delete p.defer;
delete p.createDelegate;
delete p.createCallback;
delete p.createInterceptor;
window.detachEvent('onunload',fnCleanUp)
}
window.attachEvent('onunload',fnCleanUp)
}
}());
(function(){
var EXTUTIL=Ext.util,EACH=Ext.each,TRUE=true,FALSE=false;
EXTUTIL.Observable=function(){
var me=this,e=me.events;
if(me.listeners){
me.on(me.listeners);
delete me.listeners
}
me.events=e||{}
};
EXTUTIL.Observable.prototype={
filterOptRe:/^(?:scope|delay|buffer|single)$/,
fireEvent:function(){
var a=Array.prototype.slice.call(arguments,0),ename=a[0].toLowerCase(),me=this,ret=TRUE,ce=me.events[ename],cc,q,c;
if(me.eventsSuspended===TRUE){
if(q=me.eventQueue){
q.push(a)
}
}else if(typeof ce=='object'){
if(ce.bubble){
if(ce.fire.apply(ce,a.slice(1))===FALSE){
return FALSE
}
c=me.getBubbleTarget&&me.getBubbleTarget();
if(c&&c.enableBubble){
cc=c.events[ename];
if(!cc||typeof cc!='object'||!cc.bubble){
c.enableBubble(ename)
}
return c.fireEvent.apply(c,a)
}
}else{
a.shift();
ret=ce.fire.apply(ce,a)
}
}
return ret
},
addListener:function(eventName,fn,scope,o){
var me=this,e,oe,ce;
if(typeof eventName=='object'){
o=eventName;
for(e in o){
oe=o[e];
if(!me.filterOptRe.test(e)){
me.addListener(e,oe.fn||oe,oe.scope||o.scope,oe.fn?oe:o)
}
}
}else{
eventName=eventName.toLowerCase();
ce=me.events[eventName]||TRUE;
if(typeof ce=='boolean'){
me.events[eventName]=ce=new EXTUTIL.Event(me,eventName)
}
ce.addListener(fn,scope,typeof o=='object'?o:{})
}
},
removeListener:function(eventName,fn,scope){
var ce=this.events[eventName.toLowerCase()];
if(typeof ce=='object'){
ce.removeListener(fn,scope)
}
},
purgeListeners:function(){
var events=this.events,evt,key;
for(key in events){
evt=events[key];
if(typeof evt=='object'){
evt.clearListeners()
}
}
},
addEvents:function(o){
var me=this;
me.events=me.events||{};
if(typeof o=='string'){
var a=arguments,i=a.length;
while(i--){
me.events[a[i]]=me.events[a[i]]||TRUE
}
}else{
Ext.applyIf(me.events,o)
}
},
hasListener:function(eventName){
var e=this.events[eventName.toLowerCase()];
return typeof e=='object'&&e.listeners.length>0
},
suspendEvents:function(queueSuspended){
this.eventsSuspended=TRUE;
if(queueSuspended&&!this.eventQueue){
this.eventQueue=[]
}
},
resumeEvents:function(){
var me=this,queued=me.eventQueue||[];
me.eventsSuspended=FALSE;
delete me.eventQueue;
EACH(queued,function(e){
me.fireEvent.apply(me,e)
})
}
};
var OBSERVABLE=EXTUTIL.Observable.prototype;
OBSERVABLE.on=OBSERVABLE.addListener;
OBSERVABLE.un=OBSERVABLE.removeListener;
EXTUTIL.Observable.releaseCapture=function(o){
o.fireEvent=OBSERVABLE.fireEvent
};
function createTargeted(h,o,scope){
return function(){
if(o.target==arguments[0]){
h.apply(scope,Array.prototype.slice.call(arguments,0))
}
}
}
;
function createBuffered(h,o,l,scope){
l.task=new EXTUTIL.DelayedTask;
return function(){
l.task.delay(o.buffer,h,scope,Array.prototype.slice.call(arguments,0))
}
}
;
function createSingle(h,e,fn,scope){
return function(){
e.removeListener(fn,scope);
return h.apply(scope,arguments)
}
}
;
function createDelayed(h,o,l,scope){
return function(){
var task=new EXTUTIL.DelayedTask,args=Array.prototype.slice.call(arguments,0);
if(!l.tasks){
l.tasks=[]
}
l.tasks.push(task);
task.delay(o.delay||10,function(){
l.tasks.remove(task);
h.apply(scope,args)
},scope)
}
}
;
EXTUTIL.Event=function(obj,name){
this.name=name;
this.obj=obj;
this.listeners=[]
};
EXTUTIL.Event.prototype={
addListener:function(fn,scope,options){
var me=this,l;
scope=scope||me.obj;
if(!me.isListening(fn,scope)){
l=me.createListener(fn,scope,options);
if(me.firing){
me.listeners=me.listeners.slice(0)
}
me.listeners.push(l)
}
},
createListener:function(fn,scope,o){
o=o||{};
scope=scope||this.obj;
var l={
fn:fn,
scope:scope,
options:o
},h=fn;
if(o.target){
h=createTargeted(h,o,scope)
}
if(o.delay){
h=createDelayed(h,o,l,scope)
}
if(o.single){
h=createSingle(h,this,fn,scope)
}
if(o.buffer){
h=createBuffered(h,o,l,scope)
}
l.fireFn=h;
return l
},
findListener:function(fn,scope){
var list=this.listeners,i=list.length,l;
scope=scope||this.obj;
while(i--){
l=list[i];
if(l){
if(l.fn==fn&&l.scope==scope){
return i
}
}
}
return-1
},
isListening:function(fn,scope){
return this.findListener(fn,scope)!=-1
},
removeListener:function(fn,scope){
var index,l,k,me=this,ret=FALSE;
if((index=me.findListener(fn,scope))!=-1){
if(me.firing){
me.listeners=me.listeners.slice(0)
}
l=me.listeners[index];
if(l.task){
l.task.cancel();
delete l.task
}
k=l.tasks&&l.tasks.length;
if(k){
while(k--){
l.tasks[k].cancel()
}
delete l.tasks
}
me.listeners.splice(index,1);
ret=TRUE
}
return ret
},
clearListeners:function(){
var me=this,l=me.listeners,i=l.length;
while(i--){
me.removeListener(l[i].fn,l[i].scope)
}
},
fire:function(){
var me=this,listeners=me.listeners,len=listeners.length,i=0,l;
if(len>0){
me.firing=TRUE;
var args=Array.prototype.slice.call(arguments,0);
for(;i<len;i++){
l=listeners[i];
if(l&&l.fireFn.apply(l.scope||me.obj||window,args)===FALSE){
return me.firing=FALSE
}
}
}
me.firing=FALSE;
return TRUE
}
}
}());
Ext.DomHelper=function(){
var tempTableEl=null,emptyTags=/^(?:br|frame|hr|img|input|link|meta|range|spacer|wbr|area|param|col)$/i,tableRe=/^table|tbody|tr|td$/i,confRe=/tag|children|cn|html$/i,tableElRe=/td|tr|tbody/i,cssRe=/([a-z0-9-]+)\s*:\s*([^;\s]+(?:\s*[^;\s]+)*);?/gi,endRe=/end/i,pub,afterbegin='afterbegin',afterend='afterend',beforebegin='beforebegin',beforeend='beforeend',ts='<table>',te='</table>',tbs=ts+'<tbody>',tbe='</tbody>'+te,trs=tbs+'<tr>',tre='</tr>'+tbe;
function doInsert(el,o,returnElement,pos,sibling,append){
var newNode=pub.insertHtml(pos,Ext.getDom(el),createHtml(o));
return returnElement?Ext.get(newNode,true):newNode
}
function createHtml(o){
var b='',attr,val,key,cn;
if(typeof o=='string'){
b=o
}else if(Ext.isArray(o)){
for(var i=0;i<o.length;i++){
if(o[i]){
b+=createHtml(o[i])
}
}
;
}else{
b+='<'+(o.tag=o.tag||'div');
for(attr in o){
val=o[attr];
if(!confRe.test(attr)){
if(typeof val=='object'){
b+=' '+attr+'="';
for(key in val){
b+=key+':'+val[key]+';'
}
;
b+='"'
}else{
b+=' '+({
cls:'class',
htmlFor:'for'
}[attr]||attr)+'="'+val+'"'
}
}
}
;
if(emptyTags.test(o.tag)){
b+='/>'
}else{
b+='>';
if(cn=o.children||o.cn){
b+=createHtml(cn)
}else if(o.html){
b+=o.html
}
b+='</'+o.tag+'>'
}
}
return b
}
function ieTable(depth,s,h,e){
tempTableEl.innerHTML=[
s,
h,
e
].join('');
var i=-1,el=tempTableEl,ns;
while(++i<depth){
el=el.firstChild
}
if(ns=el.nextSibling){
var df=document.createDocumentFragment();
while(el){
ns=el.nextSibling;
df.appendChild(el);
el=ns
}
el=df
}
return el
}
function insertIntoTable(tag,where,el,html){
var node,before;
tempTableEl=tempTableEl||document.createElement('div');
if(tag=='td'&&(where==afterbegin||where==beforeend)||!tableElRe.test(tag)&&(where==beforebegin||where==afterend)){
return
}
before=where==beforebegin?el:where==afterend?el.nextSibling:where==afterbegin?el.firstChild:null;
if(where==beforebegin||where==afterend){
el=el.parentNode
}
if(tag=='td'||tag=='tr'&&(where==beforeend||where==afterbegin)){
node=ieTable(4,trs,html,tre)
}else if(tag=='tbody'&&(where==beforeend||where==afterbegin)||tag=='tr'&&(where==beforebegin||where==afterend)){
node=ieTable(3,tbs,html,tbe)
}else{
node=ieTable(2,ts,html,te)
}
el.insertBefore(node,before);
return node
}
function createContextualFragment(html){
var div=document.createElement('div'),fragment=document.createDocumentFragment(),i=0,length,childNodes;
div.innerHTML=html;
childNodes=div.childNodes;
length=childNodes.length;
for(;i<length;i++){
fragment.appendChild(childNodes[i].cloneNode(true))
}
return fragment
}
pub={
markup:function(o){
return createHtml(o)
},
applyStyles:function(el,styles){
if(styles){
var matches;
el=Ext.fly(el);
if(typeof styles=='function'){
styles=styles.call()
}
if(typeof styles=='string'){
cssRe.lastIndex=0;
while(matches=cssRe.exec(styles)){
el.setStyle(matches[1],matches[2])
}
}else if(typeof styles=='object'){
el.setStyle(styles)
}
}
},
insertHtml:function(where,el,html){
var hash={},hashVal,range,rangeEl,setStart,frag,rs;
where=where.toLowerCase();
hash[beforebegin]=[
'BeforeBegin',
'previousSibling'
];
hash[afterend]=[
'AfterEnd',
'nextSibling'
];
if(el.insertAdjacentHTML){
if(tableRe.test(el.tagName)&&(rs=insertIntoTable(el.tagName.toLowerCase(),where,el,html))){
return rs
}
hash[afterbegin]=[
'AfterBegin',
'firstChild'
];
hash[beforeend]=[
'BeforeEnd',
'lastChild'
];
if(hashVal=hash[where]){
el.insertAdjacentHTML(hashVal[0],html);
return el[hashVal[1]]
}
}else{
range=el.ownerDocument.createRange();
setStart='setStart'+(endRe.test(where)?'After':'Before');
if(hash[where]){
range[setStart](el);
if(!range.createContextualFragment){
frag=createContextualFragment(html)
}else{
frag=range.createContextualFragment(html)
}
el.parentNode.insertBefore(frag,where==beforebegin?el:el.nextSibling);
return el[(where==beforebegin?'previous':'next')+'Sibling']
}else{
rangeEl=(where==afterbegin?'first':'last')+'Child';
if(el.firstChild){
range[setStart](el[rangeEl]);
if(!range.createContextualFragment){
frag=createContextualFragment(html)
}else{
frag=range.createContextualFragment(html)
}
if(where==afterbegin){
el.insertBefore(frag,el.firstChild)
}else{
el.appendChild(frag)
}
}else{
el.innerHTML=html
}
return el[rangeEl]
}
}
throw'Illegal insertion point -> "'+where+'"'
},
insertBefore:function(el,o,returnElement){
return doInsert(el,o,returnElement,beforebegin)
},
insertAfter:function(el,o,returnElement){
return doInsert(el,o,returnElement,afterend,'nextSibling')
},
insertFirst:function(el,o,returnElement){
return doInsert(el,o,returnElement,afterbegin,'firstChild')
},
append:function(el,o,returnElement){
return doInsert(el,o,returnElement,beforeend,'',true)
},
overwrite:function(el,o,returnElement){
el=Ext.getDom(el);
el.innerHTML=createHtml(o);
return returnElement?Ext.get(el.firstChild):el.firstChild
},
createHtml:createHtml
};
return pub
}();
Ext.Template=function(html){
var me=this,a=arguments,buf=[],v;
if(Ext.isArray(html)){
html=html.join('')
}else if(a.length>1){
for(var i=0,len=a.length;i<len;i++){
v=a[i];
if(typeof v=='object'){
Ext.apply(me,v)
}else{
buf.push(v)
}
}
;
html=buf.join('')
}
me.html=html;
if(me.compiled){
me.compile()
}
};
Ext.Template.prototype={
re:/\{([\w\-]+)\}/g,
applyTemplate:function(values){
var me=this;
return me.compiled?me.compiled(values):me.html.replace(me.re,function(m,name){
return values[name]!==undefined?values[name]:''
})
},
set:function(html,compile){
var me=this;
me.html=html;
me.compiled=null;
return compile?me.compile():me
},
compile:function(){
var me=this,sep=Ext.isGecko?'+':',';
function fn(m,name){
name='values[\''+name+'\']';
return'\''+sep+'('+name+' == undefined ? \'\' : '+name+')'+sep+'\''
}
eval('this.compiled = function(values){ return '+(Ext.isGecko?'\'':'[\'')+me.html.replace(/\\/g,'\\\\').replace(/(\r\n|\n)/g,'\\n').replace(/'/g,'\\\'').replace(this.re,fn)+(Ext.isGecko?'\';};':'\'].join(\'\');};'));
return me
},
insertFirst:function(el,values,returnElement){
return this.doInsert('afterBegin',el,values,returnElement)
},
insertBefore:function(el,values,returnElement){
return this.doInsert('beforeBegin',el,values,returnElement)
},
insertAfter:function(el,values,returnElement){
return this.doInsert('afterEnd',el,values,returnElement)
},
append:function(el,values,returnElement){
return this.doInsert('beforeEnd',el,values,returnElement)
},
doInsert:function(where,el,values,returnEl){
el=Ext.getDom(el);
var newNode=Ext.DomHelper.insertHtml(where,el,this.applyTemplate(values));
return returnEl?Ext.get(newNode,true):newNode
},
overwrite:function(el,values,returnElement){
el=Ext.getDom(el);
el.innerHTML=this.applyTemplate(values);
return returnElement?Ext.get(el.firstChild,true):el.firstChild
}
};
Ext.Template.prototype.apply=Ext.Template.prototype.applyTemplate;
Ext.Template.from=function(el,config){
el=Ext.getDom(el);
return new Ext.Template(el.value||el.innerHTML,config||'')
};
Ext.DomQuery=function(){
var cache={},simpleCache={},valueCache={},nonSpace=/\S/,trimRe=/^\s+|\s+$/g,tplRe=/\{(\d+)\}/g,modeRe=/^(\s?[\/>+~]\s?|\s|$)/,tagTokenRe=/^(#)?([\w\-\*]+)/,nthRe=/(\d*)n\+?(\d*)/,nthRe2=/\D/,isIE=window.ActiveXObject?true:false,key=30803;
eval('var batch = 30803;');
function child(parent,index){
var i=0,n=parent.firstChild;
while(n){
if(n.nodeType==1){
if(++i==index){
return n
}
}
n=n.nextSibling
}
return null
}
function next(n){
while((n=n.nextSibling)&&n.nodeType!=1);
return n
}
function prev(n){
while((n=n.previousSibling)&&n.nodeType!=1);
return n
}
function children(parent){
var n=parent.firstChild,nodeIndex=-1,nextNode;
while(n){
nextNode=n.nextSibling;
if(n.nodeType==3&&!nonSpace.test(n.nodeValue)){
parent.removeChild(n)
}else{
n.nodeIndex=++nodeIndex
}
n=nextNode
}
return this
}
function byClassName(nodeSet,cls){
if(!cls){
return nodeSet
}
var result=[],ri=-1;
for(var i=0,ci;ci=nodeSet[i];i++){
if((' '+ci.className+' ').indexOf(cls)!=-1){
result[++ri]=ci
}
}
return result
}
;
function attrValue(n,attr){
if(!n.tagName&&typeof n.length!='undefined'){
n=n[0]
}
if(!n){
return null
}
if(attr=='for'){
return n.htmlFor
}
if(attr=='class'||attr=='className'){
return n.className
}
return n.getAttribute(attr)||n[attr]
}
;
function getNodes(ns,mode,tagName){
var result=[],ri=-1,cs;
if(!ns){
return result
}
tagName=tagName||'*';
if(typeof ns.getElementsByTagName!='undefined'){
ns=[ns]
}
if(!mode){
for(var i=0,ni;ni=ns[i];i++){
cs=ni.getElementsByTagName(tagName);
for(var j=0,ci;ci=cs[j];j++){
result[++ri]=ci
}
}
}else if(mode=='/'||mode=='>'){
var utag=tagName.toUpperCase();
for(var i=0,ni,cn;ni=ns[i];i++){
cn=ni.childNodes;
for(var j=0,cj;cj=cn[j];j++){
if(cj.nodeName==utag||cj.nodeName==tagName||tagName=='*'){
result[++ri]=cj
}
}
}
}else if(mode=='+'){
var utag=tagName.toUpperCase();
for(var i=0,n;n=ns[i];i++){
while((n=n.nextSibling)&&n.nodeType!=1);
if(n&&(n.nodeName==utag||n.nodeName==tagName||tagName=='*')){
result[++ri]=n
}
}
}else if(mode=='~'){
var utag=tagName.toUpperCase();
for(var i=0,n;n=ns[i];i++){
while(n=n.nextSibling){
if(n.nodeName==utag||n.nodeName==tagName||tagName=='*'){
result[++ri]=n
}
}
}
}
return result
}
function concat(a,b){
if(b.slice){
return a.concat(b)
}
for(var i=0,l=b.length;i<l;i++){
a[a.length]=b[i]
}
return a
}
function byTag(cs,tagName){
if(cs.tagName||cs==document){
cs=[cs]
}
if(!tagName){
return cs
}
var result=[],ri=-1;
tagName=tagName.toLowerCase();
for(var i=0,ci;ci=cs[i];i++){
if(ci.nodeType==1&&ci.tagName.toLowerCase()==tagName){
result[++ri]=ci
}
}
return result
}
function byId(cs,id){
if(cs.tagName||cs==document){
cs=[cs]
}
if(!id){
return cs
}
var result=[],ri=-1;
for(var i=0,ci;ci=cs[i];i++){
if(ci&&ci.id==id){
result[++ri]=ci;
return result
}
}
return result
}
function byAttribute(cs,attr,value,op,custom){
var result=[],ri=-1,useGetStyle=custom=='{',fn=Ext.DomQuery.operators[op],a,xml,hasXml;
for(var i=0,ci;ci=cs[i];i++){
if(ci.nodeType!=1){
continue
}
if(!hasXml){
xml=Ext.DomQuery.isXml(ci);
hasXml=true
}
if(!xml){
if(useGetStyle){
a=Ext.DomQuery.getStyle(ci,attr)
}else if(attr=='class'||attr=='className'){
a=ci.className
}else if(attr=='for'){
a=ci.htmlFor
}else if(attr=='href'){
a=ci.getAttribute('href',2)
}else{
a=ci.getAttribute(attr)
}
}else{
a=ci.getAttribute(attr)
}
if(fn&&fn(a,value)||!fn&&a){
result[++ri]=ci
}
}
return result
}
function byPseudo(cs,name,value){
return Ext.DomQuery.pseudos[name](cs,value)
}
function nodupIEXml(cs){
var d=++key,r;
cs[0].setAttribute('_nodup',d);
r=[cs[0]];
for(var i=1,len=cs.length;i<len;i++){
var c=cs[i];
if(!c.getAttribute('_nodup')!=d){
c.setAttribute('_nodup',d);
r[r.length]=c
}
}
for(var i=0,len=cs.length;i<len;i++){
cs[i].removeAttribute('_nodup')
}
return r
}
function nodup(cs){
if(!cs){
return[]
}
var len=cs.length,c,i,r=cs,cj,ri=-1;
if(!len||typeof cs.nodeType!='undefined'||len==1){
return cs
}
if(isIE&&typeof cs[0].selectSingleNode!='undefined'){
return nodupIEXml(cs)
}
var d=++key;
cs[0]._nodup=d;
for(i=1;c=cs[i];i++){
if(c._nodup!=d){
c._nodup=d
}else{
r=[];
for(var j=0;j<i;j++){
r[++ri]=cs[j]
}
for(j=i+1;cj=cs[j];j++){
if(cj._nodup!=d){
cj._nodup=d;
r[++ri]=cj
}
}
return r
}
}
return r
}
function quickDiffIEXml(c1,c2){
var d=++key,r=[];
for(var i=0,len=c1.length;i<len;i++){
c1[i].setAttribute('_qdiff',d)
}
for(var i=0,len=c2.length;i<len;i++){
if(c2[i].getAttribute('_qdiff')!=d){
r[r.length]=c2[i]
}
}
for(var i=0,len=c1.length;i<len;i++){
c1[i].removeAttribute('_qdiff')
}
return r
}
function quickDiff(c1,c2){
var len1=c1.length,d=++key,r=[];
if(!len1){
return c2
}
if(isIE&&typeof c1[0].selectSingleNode!='undefined'){
return quickDiffIEXml(c1,c2)
}
for(var i=0;i<len1;i++){
c1[i]._qdiff=d
}
for(var i=0,len=c2.length;i<len;i++){
if(c2[i]._qdiff!=d){
r[r.length]=c2[i]
}
}
return r
}
function quickId(ns,mode,root,id){
if(ns==root){
var d=root.ownerDocument||root;
return d.getElementById(id)
}
ns=getNodes(ns,mode,'*');
return byId(ns,id)
}
return{
getStyle:function(el,name){
return Ext.fly(el).getStyle(name)
},
compile:function(path,type){
type=type||'select';
var fn=['var f = function(root){\n var mode; ++batch; var n = root || document;\n'],mode,lastPath,matchers=Ext.DomQuery.matchers,matchersLn=matchers.length,modeMatch,lmode=path.match(modeRe);
if(lmode&&lmode[1]){
fn[fn.length]='mode="'+lmode[1].replace(trimRe,'')+'";';
path=path.replace(lmode[1],'')
}
while(path.substr(0,1)=='/'){
path=path.substr(1)
}
while(path&&lastPath!=path){
lastPath=path;
var tokenMatch=path.match(tagTokenRe);
if(type=='select'){
if(tokenMatch){
if(tokenMatch[1]=='#'){
fn[fn.length]='n = quickId(n, mode, root, "'+tokenMatch[2]+'");'
}else{
fn[fn.length]='n = getNodes(n, mode, "'+tokenMatch[2]+'");'
}
path=path.replace(tokenMatch[0],'')
}else if(path.substr(0,1)!='@'){
fn[fn.length]='n = getNodes(n, mode, "*");'
}
}else{
if(tokenMatch){
if(tokenMatch[1]=='#'){
fn[fn.length]='n = byId(n, "'+tokenMatch[2]+'");'
}else{
fn[fn.length]='n = byTag(n, "'+tokenMatch[2]+'");'
}
path=path.replace(tokenMatch[0],'')
}
}
while(!(modeMatch=path.match(modeRe))){
var matched=false;
for(var j=0;j<matchersLn;j++){
var t=matchers[j];
var m=path.match(t.re);
if(m){
fn[fn.length]=t.select.replace(tplRe,function(x,i){
return m[i]
});
path=path.replace(m[0],'');
matched=true;
break
}
}
if(!matched){
throw'Error parsing selector, parsing failed at "'+path+'"'
}
}
if(modeMatch[1]){
fn[fn.length]='mode="'+modeMatch[1].replace(trimRe,'')+'";';
path=path.replace(modeMatch[1],'')
}
}
fn[fn.length]='return nodup(n);\n}';
eval(fn.join(''));
return f
},
jsSelect:function(path,root,type){
root=root||document;
if(typeof root=='string'){
root=document.getElementById(root)
}
var paths=path.split(','),results=[];
for(var i=0,len=paths.length;i<len;i++){
var subPath=paths[i].replace(trimRe,'');
if(!cache[subPath]){
cache[subPath]=Ext.DomQuery.compile(subPath);
if(!cache[subPath]){
throw subPath+' is not a valid selector'
}
}
var result=cache[subPath](root);
if(result&&result!=document){
results=results.concat(result)
}
}
if(paths.length>1){
return nodup(results)
}
return results
},
isXml:function(el){
var docEl=(el?el.ownerDocument||el:0).documentElement;
return docEl?docEl.nodeName!=='HTML':false
},
select:document.querySelectorAll?function(path,root,type){
root=root||document;
if(!Ext.DomQuery.isXml(root)){
try{
var cs=root.querySelectorAll(path);
return Ext.toArray(cs)
}catch(ex){
}
}
return Ext.DomQuery.jsSelect.call(this,path,root,type)
}:function(path,root,type){
return Ext.DomQuery.jsSelect.call(this,path,root,type)
},
selectNode:function(path,root){
return Ext.DomQuery.select(path,root)[0]
},
selectValue:function(path,root,defaultValue){
path=path.replace(trimRe,'');
if(!valueCache[path]){
valueCache[path]=Ext.DomQuery.compile(path,'select')
}
var n=valueCache[path](root),v;
n=n[0]?n[0]:n;
if(typeof n.normalize=='function')
n.normalize();
v=n&&n.firstChild?n.firstChild.nodeValue:null;
return v===null||v===undefined||v===''?defaultValue:v
},
selectNumber:function(path,root,defaultValue){
var v=Ext.DomQuery.selectValue(path,root,defaultValue||0);
return parseFloat(v)
},
is:function(el,ss){
if(typeof el=='string'){
el=document.getElementById(el)
}
var isArray=Ext.isArray(el),result=Ext.DomQuery.filter(isArray?el:[el],ss);
return isArray?result.length==el.length:result.length>0
},
filter:function(els,ss,nonMatches){
ss=ss.replace(trimRe,'');
if(!simpleCache[ss]){
simpleCache[ss]=Ext.DomQuery.compile(ss,'simple')
}
var result=simpleCache[ss](els);
return nonMatches?quickDiff(result,els):result
},
matchers:[
{
re:/^\.([\w\-]+)/,
select:'n = byClassName(n, " {1} ");'
},
{
re:/^\:([\w\-]+)(?:\(((?:[^\s>\/]*|.*?))\))?/,
select:'n = byPseudo(n, "{1}", "{2}");'
},
{
re:/^(?:([\[\{])(?:@)?([\w\-]+)\s?(?:(=|.=)\s?(["']?)(.*?)\4)?[\]\}])/,
select:'n = byAttribute(n, "{2}", "{5}", "{3}", "{1}");'
},
{
re:/^#([\w\-]+)/,
select:'n = byId(n, "{1}");'
},
{
re:/^@([\w\-]+)/,
select:'return {firstChild:{nodeValue:attrValue(n, "{1}")}};'
}
],
operators:{
'=':function(a,v){
return a==v
},
'!=':function(a,v){
return a!=v
},
'^=':function(a,v){
return a&&a.substr(0,v.length)==v
},
'$=':function(a,v){
return a&&a.substr(a.length-v.length)==v
},
'*=':function(a,v){
return a&&a.indexOf(v)!==-1
},
'%=':function(a,v){
return a%v==0
},
'|=':function(a,v){
return a&&(a==v||a.substr(0,v.length+1)==v+'-')
},
'~=':function(a,v){
return a&&(' '+a+' ').indexOf(' '+v+' ')!=-1
}
},
pseudos:{
'first-child':function(c){
var r=[],ri=-1,n;
for(var i=0,ci;ci=n=c[i];i++){
while((n=n.previousSibling)&&n.nodeType!=1);
if(!n){
r[++ri]=ci
}
}
return r
},
'last-child':function(c){
var r=[],ri=-1,n;
for(var i=0,ci;ci=n=c[i];i++){
while((n=n.nextSibling)&&n.nodeType!=1);
if(!n){
r[++ri]=ci
}
}
return r
},
'nth-child':function(c,a){
var r=[],ri=-1,m=nthRe.exec(a=='even'&&'2n'||a=='odd'&&'2n+1'||!nthRe2.test(a)&&'n+'+a||a),f=(m[1]||1)-0,l=m[2]-0;
for(var i=0,n;n=c[i];i++){
var pn=n.parentNode;
if(batch!=pn._batch){
var j=0;
for(var cn=pn.firstChild;cn;cn=cn.nextSibling){
if(cn.nodeType==1){
cn.nodeIndex=++j
}
}
pn._batch=batch
}
if(f==1){
if(l==0||n.nodeIndex==l){
r[++ri]=n
}
}else if((n.nodeIndex+l)%f==0){
r[++ri]=n
}
}
return r
},
'only-child':function(c){
var r=[],ri=-1;
;
for(var i=0,ci;ci=c[i];i++){
if(!prev(ci)&&!next(ci)){
r[++ri]=ci
}
}
return r
},
'empty':function(c){
var r=[],ri=-1;
for(var i=0,ci;ci=c[i];i++){
var cns=ci.childNodes,j=0,cn,empty=true;
while(cn=cns[j]){
++j;
if(cn.nodeType==1||cn.nodeType==3){
empty=false;
break
}
}
if(empty){
r[++ri]=ci
}
}
return r
},
'contains':function(c,v){
var r=[],ri=-1;
for(var i=0,ci;ci=c[i];i++){
if((ci.textContent||ci.innerText||'').indexOf(v)!=-1){
r[++ri]=ci
}
}
return r
},
'nodeValue':function(c,v){
var r=[],ri=-1;
for(var i=0,ci;ci=c[i];i++){
if(ci.firstChild&&ci.firstChild.nodeValue==v){
r[++ri]=ci
}
}
return r
},
'checked':function(c){
var r=[],ri=-1;
for(var i=0,ci;ci=c[i];i++){
if(ci.checked==true){
r[++ri]=ci
}
}
return r
},
'not':function(c,ss){
return Ext.DomQuery.filter(c,ss,true)
},
'any':function(c,selectors){
var ss=selectors.split('|'),r=[],ri=-1,s;
for(var i=0,ci;ci=c[i];i++){
for(var j=0;s=ss[j];j++){
if(Ext.DomQuery.is(ci,s)){
r[++ri]=ci;
break
}
}
}
return r
},
'odd':function(c){
return this['nth-child'](c,'odd')
},
'even':function(c){
return this['nth-child'](c,'even')
},
'nth':function(c,a){
return c[a-1]||[]
},
'first':function(c){
return c[0]||[]
},
'last':function(c){
return c[c.length-1]||[]
},
'has':function(c,ss){
var s=Ext.DomQuery.select,r=[],ri=-1;
for(var i=0,ci;ci=c[i];i++){
if(s(ss,ci).length>0){
r[++ri]=ci
}
}
return r
},
'next':function(c,ss){
var is=Ext.DomQuery.is,r=[],ri=-1;
for(var i=0,ci;ci=c[i];i++){
var n=next(ci);
if(n&&is(n,ss)){
r[++ri]=ci
}
}
return r
},
'prev':function(c,ss){
var is=Ext.DomQuery.is,r=[],ri=-1;
for(var i=0,ci;ci=c[i];i++){
var n=prev(ci);
if(n&&is(n,ss)){
r[++ri]=ci
}
}
return r
}
}
}
}();
Ext.query=Ext.DomQuery.select;
Ext.util.DelayedTask=function(fn,scope,args){
var me=this,id,call=function(){
clearInterval(id);
id=null;
fn.apply(scope,args||[])
};
me.delay=function(delay,newFn,newScope,newArgs){
me.cancel();
fn=newFn||fn;
scope=newScope||scope;
args=newArgs||args;
id=setInterval(call,delay)
};
me.cancel=function(){
if(id){
clearInterval(id);
id=null
}
}
};
(function(){
var DOC=document;
Ext.Element=function(element,forceNew){
var dom=typeof element=='string'?DOC.getElementById(element):element,id;
if(!dom)
return null;
id=dom.id;
if(!forceNew&&id&&Ext.elCache[id]){
return Ext.elCache[id].el
}
this.dom=dom;
this.id=id||Ext.id(dom)
};
var DH=Ext.DomHelper,El=Ext.Element,EC=Ext.elCache;
El.prototype={
set:function(o,useSet){
var el=this.dom,attr,val,useSet=useSet!==false&&!!el.setAttribute;
for(attr in o){
if(o.hasOwnProperty(attr)){
val=o[attr];
if(attr=='style'){
DH.applyStyles(el,val)
}else if(attr=='cls'){
el.className=val
}else if(useSet){
el.setAttribute(attr,val)
}else{
el[attr]=val
}
}
}
return this
},
defaultUnit:'px',
is:function(simpleSelector){
return Ext.DomQuery.is(this.dom,simpleSelector)
},
focus:function(defer,dom){
var me=this,dom=dom||me.dom;
try{
if(Number(defer)){
me.focus.defer(defer,null,[
null,
dom
])
}else{
dom.focus()
}
}catch(e){
}
return me
},
blur:function(){
try{
this.dom.blur()
}catch(e){
}
return this
},
getValue:function(asNumber){
var val=this.dom.value;
return asNumber?parseInt(val,10):val
},
addListener:function(eventName,fn,scope,options){
Ext.EventManager.on(this.dom,eventName,fn,scope||this,options);
return this
},
removeListener:function(eventName,fn,scope){
Ext.EventManager.removeListener(this.dom,eventName,fn,scope||this);
return this
},
removeAllListeners:function(){
Ext.EventManager.removeAll(this.dom);
return this
},
purgeAllListeners:function(){
Ext.EventManager.purgeElement(this,true);
return this
},
addUnits:function(size){
if(size===''||size=='auto'||size===undefined){
size=size||''
}else if(!isNaN(size)||!unitPattern.test(size)){
size=size+(this.defaultUnit||'px')
}
return size
},
load:function(url,params,cb){
Ext.Ajax.request(Ext.apply({
params:params,
url:url.url||url,
callback:cb,
el:this.dom,
indicatorText:url.indicatorText||''
},Ext.isObject(url)?url:{}));
return this
},
isBorderBox:function(){
return Ext.isBorderBox||Ext.isForcedBorderBox||noBoxAdjust[(this.dom.tagName||'').toLowerCase()]
},
remove:function(){
var me=this,dom=me.dom;
if(dom){
delete me.dom;
Ext.removeNode(dom)
}
},
hover:function(overFn,outFn,scope,options){
var me=this;
me.on('mouseenter',overFn,scope||me.dom,options);
me.on('mouseleave',outFn,scope||me.dom,options);
return me
},
contains:function(el){
return!el?false:Ext.lib.Dom.isAncestor(this.dom,el.dom?el.dom:el)
},
getAttributeNS:function(ns,name){
return this.getAttribute(name,ns)
},
getAttribute:function(){
var test=document.createElement('table'),isBrokenOnTable=false,hasGetAttribute='getAttribute'in test,unknownRe=/undefined|unknown/;
if(hasGetAttribute){
try{
test.getAttribute('ext:qtip')
}catch(e){
isBrokenOnTable=true
}
return function(name,ns){
var el=this.dom,value;
if(el.getAttributeNS){
value=el.getAttributeNS(ns,name)||null
}
if(value==null){
if(ns){
if(isBrokenOnTable&&el.tagName.toUpperCase()=='TABLE'){
try{
value=el.getAttribute(ns+':'+name)
}catch(e){
value=''
}
}else{
value=el.getAttribute(ns+':'+name)
}
}else{
value=el.getAttribute(name)||el[name]
}
}
return value||''
}
}else{
return function(name,ns){
var el=this.om,value,attribute;
if(ns){
attribute=el[ns+':'+name];
value=unknownRe.test(typeof attribute)?undefined:attribute
}else{
value=el[name]
}
return value||''
}
}
test=null
}(),
update:function(html){
if(this.dom){
this.dom.innerHTML=html
}
return this
}
};
var ep=El.prototype;
El.addMethods=function(o){
Ext.apply(ep,o)
};
ep.on=ep.addListener;
ep.un=ep.removeListener;
ep.autoBoxAdjust=true;
var unitPattern=/\d+(px|em|%|en|ex|pt|in|cm|mm|pc)$/i,docEl;
El.get=function(el){
var ex,elm,id;
if(!el){
return null
}
if(typeof el=='string'){
if(!(elm=DOC.getElementById(el))){
return null
}
if(EC[el]&&EC[el].el){
ex=EC[el].el;
ex.dom=elm
}else{
ex=El.addToCache(new El(elm))
}
return ex
}else if(el.tagName){
if(!(id=el.id)){
id=Ext.id(el)
}
if(EC[id]&&EC[id].el){
ex=EC[id].el;
ex.dom=el
}else{
ex=El.addToCache(new El(el))
}
return ex
}else if(el instanceof El){
if(el!=docEl){
if(Ext.isIE&&(el.id==undefined||el.id=='')){
el.dom=el.dom
}else{
el.dom=DOC.getElementById(el.id)||el.dom
}
}
return el
}else if(el.isComposite){
return el
}else if(Ext.isArray(el)){
return El.select(el)
}else if(el==DOC){
if(!docEl){
var f=function(){
};
f.prototype=El.prototype;
docEl=new f;
docEl.dom=DOC
}
return docEl
}
return null
};
El.addToCache=function(el,id){
id=id||el.id;
EC[id]={
el:el,
data:{},
events:{}
};
return el
};
El.data=function(el,key,value){
el=El.get(el);
if(!el){
return null
}
var c=EC[el.id].data;
if(arguments.length==2){
return c[key]
}else{
return c[key]=value
}
};
function garbageCollect(){
if(!Ext.enableGarbageCollector){
clearInterval(El.collectorThreadId)
}else{
var eid,el,d,o;
for(eid in EC){
o=EC[eid];
if(o.skipGC){
continue
}
el=o.el;
d=el.dom;
if(!d||!d.parentNode||!d.offsetParent&&!DOC.getElementById(eid)){
if(Ext.enableListenerCollection){
Ext.EventManager.removeAll(d)
}
delete EC[eid]
}
}
if(Ext.isIE){
var t={};
for(eid in EC){
t[eid]=EC[eid]
}
EC=Ext.elCache=t
}
}
}
El.collectorThreadId=setInterval(garbageCollect,30000);
var flyFn=function(){
};
flyFn.prototype=El.prototype;
El.Flyweight=function(dom){
this.dom=dom
};
El.Flyweight.prototype=new flyFn;
El.Flyweight.prototype.isFlyweight=true;
El._flyweights={};
El.fly=function(el,named){
var ret=null;
named=named||'_global';
if(el=Ext.getDom(el)){
(El._flyweights[named]=El._flyweights[named]||new El.Flyweight()).dom=el;
ret=El._flyweights[named]
}
return ret
};
Ext.get=El.get;
Ext.fly=El.fly;
var noBoxAdjust=Ext.isStrict?{select:1}:{
input:1,
select:1,
textarea:1
};
if(Ext.isIE||Ext.isGecko){
noBoxAdjust['button']=1
}
}());
Ext.Element.addMethods(function(){
var PARENTNODE='parentNode',NEXTSIBLING='nextSibling',PREVIOUSSIBLING='previousSibling',DQ=Ext.DomQuery,GET=Ext.get;
return{
findParent:function(simpleSelector,maxDepth,returnEl){
var p=this.dom,b=document.body,depth=0,stopEl;
if(Ext.isGecko&&Object.prototype.toString.call(p)=='[object XULElement]'){
return null
}
maxDepth=maxDepth||50;
if(isNaN(maxDepth)){
stopEl=Ext.getDom(maxDepth);
maxDepth=Number.MAX_VALUE
}
while(p&&p.nodeType==1&&depth<maxDepth&&p!=b&&p!=stopEl){
if(DQ.is(p,simpleSelector)){
return returnEl?GET(p):p
}
depth++;
p=p.parentNode
}
return null
},
findParentNode:function(simpleSelector,maxDepth,returnEl){
var p=Ext.fly(this.dom.parentNode,'_internal');
return p?p.findParent(simpleSelector,maxDepth,returnEl):null
},
up:function(simpleSelector,maxDepth){
return this.findParentNode(simpleSelector,maxDepth,true)
},
select:function(selector){
return Ext.Element.select(selector,this.dom)
},
query:function(selector){
return DQ.select(selector,this.dom)
},
child:function(selector,returnDom){
var n=DQ.selectNode(selector,this.dom);
return returnDom?n:GET(n)
},
down:function(selector,returnDom){
var n=DQ.selectNode(' > '+selector,this.dom);
return returnDom?n:GET(n)
},
parent:function(selector,returnDom){
return this.matchNode(PARENTNODE,PARENTNODE,selector,returnDom)
},
next:function(selector,returnDom){
return this.matchNode(NEXTSIBLING,NEXTSIBLING,selector,returnDom)
},
prev:function(selector,returnDom){
return this.matchNode(PREVIOUSSIBLING,PREVIOUSSIBLING,selector,returnDom)
},
first:function(selector,returnDom){
return this.matchNode(NEXTSIBLING,'firstChild',selector,returnDom)
},
last:function(selector,returnDom){
return this.matchNode(PREVIOUSSIBLING,'lastChild',selector,returnDom)
},
matchNode:function(dir,start,selector,returnDom){
var n=this.dom[start];
while(n){
if(n.nodeType==1&&(!selector||DQ.is(n,selector))){
return!returnDom?GET(n):n
}
n=n[dir]
}
return null
}
}
}());
Ext.Element.addMethods(function(){
var GETDOM=Ext.getDom,GET=Ext.get,DH=Ext.DomHelper;
return{
appendChild:function(el){
return GET(el).appendTo(this)
},
appendTo:function(el){
GETDOM(el).appendChild(this.dom);
return this
},
insertBefore:function(el){
(el=GETDOM(el)).parentNode.insertBefore(this.dom,el);
return this
},
insertAfter:function(el){
(el=GETDOM(el)).parentNode.insertBefore(this.dom,el.nextSibling);
return this
},
insertFirst:function(el,returnDom){
el=el||{};
if(el.nodeType||el.dom||typeof el=='string'){
el=GETDOM(el);
this.dom.insertBefore(el,this.dom.firstChild);
return!returnDom?GET(el):el
}else{
return this.createChild(el,this.dom.firstChild,returnDom)
}
},
replace:function(el){
el=GET(el);
this.insertBefore(el);
el.remove();
return this
},
replaceWith:function(el){
var me=this;
if(el.nodeType||el.dom||typeof el=='string'){
el=GETDOM(el);
me.dom.parentNode.insertBefore(el,me.dom)
}else{
el=DH.insertBefore(me.dom,el)
}
delete Ext.elCache[me.id];
Ext.removeNode(me.dom);
me.id=Ext.id(me.dom=el);
Ext.Element.addToCache(me.isFlyweight?new Ext.Element(me.dom):me);
return me
},
createChild:function(config,insertBefore,returnDom){
config=config||{tag:'div'};
return insertBefore?DH.insertBefore(insertBefore,config,returnDom!==true):DH[!this.dom.firstChild?'overwrite':'append'](this.dom,config,returnDom!==true)
},
wrap:function(config,returnDom){
var newEl=DH.insertBefore(this.dom,config||{tag:'div'},!returnDom);
newEl.dom?newEl.dom.appendChild(this.dom):newEl.appendChild(this.dom);
return newEl
},
insertHtml:function(where,html,returnEl){
var el=DH.insertHtml(where,this.dom,html);
return returnEl?Ext.get(el):el
}
}
}());
Ext.Element.addMethods(function(){
var supports=Ext.supports,propCache={},camelRe=/(-[a-z])/gi,view=document.defaultView,opacityRe=/alpha\(opacity=(.*)\)/i,trimRe=/^\s+|\s+$/g,EL=Ext.Element,spacesRe=/\s+/,wordsRe=/\w/g,PADDING='padding',MARGIN='margin',BORDER='border',LEFT='-left',RIGHT='-right',TOP='-top',BOTTOM='-bottom',WIDTH='-width',MATH=Math,HIDDEN='hidden',ISCLIPPED='isClipped',OVERFLOW='overflow',OVERFLOWX='overflow-x',OVERFLOWY='overflow-y',ORIGINALCLIP='originalClip',borders={
l:BORDER+LEFT+WIDTH,
r:BORDER+RIGHT+WIDTH,
t:BORDER+TOP+WIDTH,
b:BORDER+BOTTOM+WIDTH
},paddings={
l:PADDING+LEFT,
r:PADDING+RIGHT,
t:PADDING+TOP,
b:PADDING+BOTTOM
},margins={
l:MARGIN+LEFT,
r:MARGIN+RIGHT,
t:MARGIN+TOP,
b:MARGIN+BOTTOM
},data=Ext.Element.data;
function camelFn(m,a){
return a.charAt(1).toUpperCase()
}
function chkCache(prop){
return propCache[prop]||(propCache[prop]=prop=='float'?supports.cssFloat?'cssFloat':'styleFloat':prop.replace(camelRe,camelFn))
}
return{
adjustWidth:function(width){
var me=this;
var isNum=typeof width=='number';
if(isNum&&me.autoBoxAdjust&&!me.isBorderBox()){
width-=me.getBorderWidth('lr')+me.getPadding('lr')
}
return isNum&&width<0?0:width
},
adjustHeight:function(height){
var me=this;
var isNum=typeof height=='number';
if(isNum&&me.autoBoxAdjust&&!me.isBorderBox()){
height-=me.getBorderWidth('tb')+me.getPadding('tb')
}
return isNum&&height<0?0:height
},
addClass:function(className){
var me=this,i,len,v,cls=[];
if(!Ext.isArray(className)){
if(typeof className=='string'&&!this.hasClass(className)){
me.dom.className+=' '+className
}
}else{
for(i=0,len=className.length;i<len;i++){
v=className[i];
if(typeof v=='string'&&(' '+me.dom.className+' ').indexOf(' '+v+' ')==-1){
cls.push(v)
}
}
if(cls.length){
me.dom.className+=' '+cls.join(' ')
}
}
return me
},
removeClass:function(className){
var me=this,i,idx,len,cls,elClasses;
if(!Ext.isArray(className)){
className=[className]
}
if(me.dom&&me.dom.className){
elClasses=me.dom.className.replace(trimRe,'').split(spacesRe);
for(i=0,len=className.length;i<len;i++){
cls=className[i];
if(typeof cls=='string'){
cls=cls.replace(trimRe,'');
idx=elClasses.indexOf(cls);
if(idx!=-1){
elClasses.splice(idx,1)
}
}
}
me.dom.className=elClasses.join(' ')
}
return me
},
radioClass:function(className){
var cn=this.dom.parentNode.childNodes,v,i,len;
className=Ext.isArray(className)?className:[className];
for(i=0,len=cn.length;i<len;i++){
v=cn[i];
if(v&&v.nodeType==1){
Ext.fly(v,'_internal').removeClass(className)
}
}
;
return this.addClass(className)
},
toggleClass:function(className){
return this.hasClass(className)?this.removeClass(className):this.addClass(className)
},
hasClass:function(className){
return className&&(' '+this.dom.className+' ').indexOf(' '+className+' ')!=-1
},
replaceClass:function(oldClassName,newClassName){
return this.removeClass(oldClassName).addClass(newClassName)
},
isStyle:function(style,val){
return this.getStyle(style)==val
},
getStyle:function(){
return view&&view.getComputedStyle?function(prop){
var el=this.dom,v,cs,out,display;
if(el==document){
return null
}
prop=chkCache(prop);
out=(v=el.style[prop])?v:(cs=view.getComputedStyle(el,''))?cs[prop]:null;
if(prop=='marginRight'&&out!='0px'&&!supports.correctRightMargin){
display=el.style.display;
el.style.display='inline-block';
out=view.getComputedStyle(el,'').marginRight;
el.style.display=display
}
if(prop=='backgroundColor'&&out=='rgba(0, 0, 0, 0)'&&!supports.correctTransparentColor){
out='transparent'
}
return out
}:function(prop){
var el=this.dom,m,cs;
if(el==document)
return null;
if(prop=='opacity'){
if(el.style.filter.match){
if(m=el.style.filter.match(opacityRe)){
var fv=parseFloat(m[1]);
if(!isNaN(fv)){
return fv?fv/100:0
}
}
}
return 1
}
prop=chkCache(prop);
return el.style[prop]||((cs=el.currentStyle)?cs[prop]:null)
}
}(),
getColor:function(attr,defaultValue,prefix){
var v=this.getStyle(attr),color=typeof prefix!='undefined'?prefix:'#',h;
if(!v||/transparent|inherit/.test(v)){
return defaultValue
}
if(/^r/.test(v)){
Ext.each(v.slice(4,v.length-1).split(','),function(s){
h=parseInt(s,10);
color+=(h<16?'0':'')+h.toString(16)
})
}else{
v=v.replace('#','');
color+=v.length==3?v.replace(/^(\w)(\w)(\w)$/,'$1$1$2$2$3$3'):v
}
return color.length>5?color.toLowerCase():defaultValue
},
setStyle:function(prop,value){
var tmp,style;
if(typeof prop!='object'){
tmp={};
tmp[prop]=value;
prop=tmp
}
for(style in prop){
value=prop[style];
style=='opacity'?this.setOpacity(value):this.dom.style[chkCache(style)]=value
}
return this
},
setOpacity:function(opacity,animate){
var me=this,s=me.dom.style;
if(!animate||!me.anim){
if(Ext.isIE){
var opac=opacity<1?'alpha(opacity='+opacity*100+')':'',val=s.filter.replace(opacityRe,'').replace(trimRe,'');
s.zoom=1;
s.filter=val+(val.length>0?' ':'')+opac
}else{
s.opacity=opacity
}
}else{
me.anim({opacity:{to:opacity}},me.preanim(arguments,1),null,0.35,'easeIn')
}
return me
},
clearOpacity:function(){
var style=this.dom.style;
if(Ext.isIE){
if(!Ext.isEmpty(style.filter)){
style.filter=style.filter.replace(opacityRe,'').replace(trimRe,'')
}
}else{
style.opacity=style['-moz-opacity']=style['-khtml-opacity']=''
}
return this
},
getHeight:function(contentHeight){
var me=this,dom=me.dom,hidden=Ext.isIE&&me.isStyle('display','none'),h=MATH.max(dom.offsetHeight,hidden?0:dom.clientHeight)||0;
h=!contentHeight?h:h-me.getBorderWidth('tb')-me.getPadding('tb');
return h<0?0:h
},
getWidth:function(contentWidth){
var me=this,dom=me.dom,hidden=Ext.isIE&&me.isStyle('display','none'),w=MATH.max(dom.offsetWidth,hidden?0:dom.clientWidth)||0;
w=!contentWidth?w:w-me.getBorderWidth('lr')-me.getPadding('lr');
return w<0?0:w
},
setWidth:function(width,animate){
var me=this;
width=me.adjustWidth(width);
!animate||!me.anim?me.dom.style.width=me.addUnits(width):me.anim({width:{to:width}},me.preanim(arguments,1));
return me
},
setHeight:function(height,animate){
var me=this;
height=me.adjustHeight(height);
!animate||!me.anim?me.dom.style.height=me.addUnits(height):me.anim({height:{to:height}},me.preanim(arguments,1));
return me
},
getBorderWidth:function(side){
return this.addStyles(side,borders)
},
getPadding:function(side){
return this.addStyles(side,paddings)
},
clip:function(){
var me=this,dom=me.dom;
if(!data(dom,ISCLIPPED)){
data(dom,ISCLIPPED,true);
data(dom,ORIGINALCLIP,{
o:me.getStyle(OVERFLOW),
x:me.getStyle(OVERFLOWX),
y:me.getStyle(OVERFLOWY)
});
me.setStyle(OVERFLOW,HIDDEN);
me.setStyle(OVERFLOWX,HIDDEN);
me.setStyle(OVERFLOWY,HIDDEN)
}
return me
},
unclip:function(){
var me=this,dom=me.dom;
if(data(dom,ISCLIPPED)){
data(dom,ISCLIPPED,false);
var o=data(dom,ORIGINALCLIP);
if(o.o){
me.setStyle(OVERFLOW,o.o)
}
if(o.x){
me.setStyle(OVERFLOWX,o.x)
}
if(o.y){
me.setStyle(OVERFLOWY,o.y)
}
}
return me
},
addStyles:function(sides,styles){
var ttlSize=0,sidesArr=sides.match(wordsRe),side,size,i,len=sidesArr.length;
for(i=0;i<len;i++){
side=sidesArr[i];
size=side&&parseInt(this.getStyle(styles[side]),10);
if(size){
ttlSize+=MATH.abs(size)
}
}
return ttlSize
},
margins:margins
}
}());
(function(){
var D=Ext.lib.Dom,LEFT='left',RIGHT='right',TOP='top',BOTTOM='bottom',POSITION='position',STATIC='static',RELATIVE='relative',AUTO='auto',ZINDEX='z-index';
Ext.Element.addMethods({
getX:function(){
return D.getX(this.dom)
},
getY:function(){
return D.getY(this.dom)
},
getXY:function(){
return D.getXY(this.dom)
},
getOffsetsTo:function(el){
var o=this.getXY(),e=Ext.fly(el,'_internal').getXY();
return[
o[0]-e[0],
o[1]-e[1]
]
},
setX:function(x,animate){
return this.setXY([
x,
this.getY()
],this.animTest(arguments,animate,1))
},
setY:function(y,animate){
return this.setXY([
this.getX(),
y
],this.animTest(arguments,animate,1))
},
setLeft:function(left){
this.setStyle(LEFT,this.addUnits(left));
return this
},
setTop:function(top){
this.setStyle(TOP,this.addUnits(top));
return this
},
setRight:function(right){
this.setStyle(RIGHT,this.addUnits(right));
return this
},
setBottom:function(bottom){
this.setStyle(BOTTOM,this.addUnits(bottom));
return this
},
setXY:function(pos,animate){
var me=this;
if(!animate||!me.anim){
D.setXY(me.dom,pos)
}else{
me.anim({points:{to:pos}},me.preanim(arguments,1),'motion')
}
return me
},
setLocation:function(x,y,animate){
return this.setXY([
x,
y
],this.animTest(arguments,animate,2))
},
moveTo:function(x,y,animate){
return this.setXY([
x,
y
],this.animTest(arguments,animate,2))
},
getLeft:function(local){
return!local?this.getX():parseInt(this.getStyle(LEFT),10)||0
},
getRight:function(local){
var me=this;
return!local?me.getX()+me.getWidth():me.getLeft(true)+me.getWidth()||0
},
getTop:function(local){
return!local?this.getY():parseInt(this.getStyle(TOP),10)||0
},
getBottom:function(local){
var me=this;
return!local?me.getY()+me.getHeight():me.getTop(true)+me.getHeight()||0
},
position:function(pos,zIndex,x,y){
var me=this;
if(!pos&&me.isStyle(POSITION,STATIC)){
me.setStyle(POSITION,RELATIVE)
}else if(pos){
me.setStyle(POSITION,pos)
}
if(zIndex){
me.setStyle(ZINDEX,zIndex)
}
if(x||y)
me.setXY([
x||false,
y||false
])
},
clearPositioning:function(value){
value=value||'';
this.setStyle({
left:value,
right:value,
top:value,
bottom:value,
'z-index':'',
position:STATIC
});
return this
},
getPositioning:function(){
var l=this.getStyle(LEFT);
var t=this.getStyle(TOP);
return{
'position':this.getStyle(POSITION),
'left':l,
'right':l?'':this.getStyle(RIGHT),
'top':t,
'bottom':t?'':this.getStyle(BOTTOM),
'z-index':this.getStyle(ZINDEX)
}
},
setPositioning:function(pc){
var me=this,style=me.dom.style;
me.setStyle(pc);
if(pc.right==AUTO){
style.right=''
}
if(pc.bottom==AUTO){
style.bottom=''
}
return me
},
translatePoints:function(x,y){
y=isNaN(x[1])?y:x[1];
x=isNaN(x[0])?x:x[0];
var me=this,relative=me.isStyle(POSITION,RELATIVE),o=me.getXY(),l=parseInt(me.getStyle(LEFT),10),t=parseInt(me.getStyle(TOP),10);
l=!isNaN(l)?l:relative?0:me.dom.offsetLeft;
t=!isNaN(t)?t:relative?0:me.dom.offsetTop;
return{
left:x-o[0]+l,
top:y-o[1]+t
}
},
animTest:function(args,animate,i){
return!!animate&&this.preanim?this.preanim(args,i):false
}
})
}());
Ext.Element.addMethods({
isScrollable:function(){
var dom=this.dom;
return dom.scrollHeight>dom.clientHeight||dom.scrollWidth>dom.clientWidth
},
scrollTo:function(side,value){
this.dom['scroll'+(/top/i.test(side)?'Top':'Left')]=value;
return this
},
getScroll:function(){
var d=this.dom,doc=document,body=doc.body,docElement=doc.documentElement,l,t,ret;
if(d==doc||d==body){
if(Ext.isIE&&Ext.isStrict){
l=docElement.scrollLeft;
t=docElement.scrollTop
}else{
l=window.pageXOffset;
t=window.pageYOffset
}
ret={
left:l||(body?body.scrollLeft:0),
top:t||(body?body.scrollTop:0)
}
}else{
ret={
left:d.scrollLeft,
top:d.scrollTop
}
}
return ret
}
});
Ext.Element.VISIBILITY=1;
Ext.Element.DISPLAY=2;
Ext.Element.OFFSETS=3;
Ext.Element.ASCLASS=4;
Ext.Element.visibilityCls='x-hide-nosize';
Ext.Element.addMethods(function(){
var El=Ext.Element,OPACITY='opacity',VISIBILITY='visibility',DISPLAY='display',HIDDEN='hidden',OFFSETS='offsets',ASCLASS='asclass',NONE='none',NOSIZE='nosize',ORIGINALDISPLAY='originalDisplay',VISMODE='visibilityMode',ISVISIBLE='isVisible',data=El.data,getDisplay=function(dom){
var d=data(dom,ORIGINALDISPLAY);
if(d===undefined){
data(dom,ORIGINALDISPLAY,d='')
}
return d
},getVisMode=function(dom){
var m=data(dom,VISMODE);
if(m===undefined){
data(dom,VISMODE,m=1)
}
return m
};
return{
originalDisplay:'',
visibilityMode:1,
setVisibilityMode:function(visMode){
data(this.dom,VISMODE,visMode);
return this
},
animate:function(args,duration,onComplete,easing,animType){
this.anim(args,{
duration:duration,
callback:onComplete,
easing:easing
},animType);
return this
},
anim:function(args,opt,animType,defaultDur,defaultEase,cb){
animType=animType||'run';
opt=opt||{};
var me=this,anim=Ext.lib.Anim[animType](me.dom,args,opt.duration||defaultDur||0.35,opt.easing||defaultEase||'easeOut',function(){
if(cb)
cb.call(me);
if(opt.callback)
opt.callback.call(opt.scope||me,me,opt)
},me);
opt.anim=anim;
return anim
},
preanim:function(a,i){
return!a[i]?false:typeof a[i]=='object'?a[i]:{
duration:a[i+1],
callback:a[i+2],
easing:a[i+3]
}
},
isVisible:function(){
var me=this,dom=me.dom,visible=data(dom,ISVISIBLE);
if(typeof visible=='boolean'){
return visible
}
visible=!me.isStyle(VISIBILITY,HIDDEN)&&!me.isStyle(DISPLAY,NONE)&&!(getVisMode(dom)==El.ASCLASS&&me.hasClass(me.visibilityCls||El.visibilityCls));
data(dom,ISVISIBLE,visible);
return visible
},
setVisible:function(visible,animate){
var me=this,isDisplay,isVisibility,isOffsets,isNosize,dom=me.dom,visMode=getVisMode(dom);
if(typeof animate=='string'){
switch(animate){
case DISPLAY:
visMode=El.DISPLAY;
break;
case VISIBILITY:
visMode=El.VISIBILITY;
break;
case OFFSETS:
visMode=El.OFFSETS;
break;
case NOSIZE:
case ASCLASS:
visMode=El.ASCLASS;
break
}
me.setVisibilityMode(visMode);
animate=false
}
if(!animate||!me.anim){
if(visMode==El.ASCLASS){
me[visible?'removeClass':'addClass'](me.visibilityCls||El.visibilityCls)
}else if(visMode==El.DISPLAY){
return me.setDisplayed(visible)
}else if(visMode==El.OFFSETS){
if(!visible){
me.hideModeStyles={
position:me.getStyle('position'),
top:me.getStyle('top'),
left:me.getStyle('left')
};
me.applyStyles({
position:'absolute',
top:'-10000px',
left:'-10000px'
})
}else{
me.applyStyles(me.hideModeStyles||{
position:'',
top:'',
left:''
});
delete me.hideModeStyles
}
}else{
me.fixDisplay();
dom.style.visibility=visible?'visible':HIDDEN
}
}else{
if(visible){
me.setOpacity(0.01);
me.setVisible(true)
}
me.anim({opacity:{to:visible?1:0}},me.preanim(arguments,1),null,0.35,'easeIn',function(){
visible||me.setVisible(false).setOpacity(1)
})
}
data(dom,ISVISIBLE,visible);
return me
},
hasMetrics:function(){
var dom=this.dom;
return this.isVisible()||getVisMode(dom)==El.VISIBILITY
},
toggle:function(animate){
var me=this;
me.setVisible(!me.isVisible(),me.preanim(arguments,0));
return me
},
setDisplayed:function(value){
if(typeof value=='boolean'){
value=value?getDisplay(this.dom):NONE
}
this.setStyle(DISPLAY,value);
return this
},
fixDisplay:function(){
var me=this;
if(me.isStyle(DISPLAY,NONE)){
me.setStyle(VISIBILITY,HIDDEN);
me.setStyle(DISPLAY,getDisplay(this.dom));
if(me.isStyle(DISPLAY,NONE)){
me.setStyle(DISPLAY,'block')
}
}
},
hide:function(animate){
if(typeof animate=='string'){
this.setVisible(false,animate);
return this
}
this.setVisible(false,this.preanim(arguments,0));
return this
},
show:function(animate){
if(typeof animate=='string'){
this.setVisible(true,animate);
return this
}
this.setVisible(true,this.preanim(arguments,0));
return this
}
}
}());
(function(){
var NULL=null,UNDEFINED=undefined,TRUE=true,FALSE=false,SETX='setX',SETY='setY',SETXY='setXY',LEFT='left',BOTTOM='bottom',TOP='top',RIGHT='right',HEIGHT='height',WIDTH='width',POINTS='points',HIDDEN='hidden',ABSOLUTE='absolute',VISIBLE='visible',MOTION='motion',POSITION='position',EASEOUT='easeOut',flyEl=new Ext.Element.Flyweight,queues={},getObject=function(o){
return o||{}
},fly=function(dom){
flyEl.dom=dom;
flyEl.id=Ext.id(dom);
return flyEl
},getQueue=function(id){
if(!queues[id]){
queues[id]=[]
}
return queues[id]
},setQueue=function(id,value){
queues[id]=value
};
Ext.enableFx=TRUE;
Ext.Fx={
switchStatements:function(key,fn,argHash){
return fn.apply(this,argHash[key])
},
slideIn:function(anchor,o){
o=getObject(o);
var me=this,dom=me.dom,st=dom.style,xy,r,b,wrap,after,st,args,pt,bw,bh;
anchor=anchor||'t';
me.queueFx(o,function(){
xy=fly(dom).getXY();
fly(dom).fixDisplay();
r=fly(dom).getFxRestore();
b={
x:xy[0],
y:xy[1],
0:xy[0],
1:xy[1],
width:dom.offsetWidth,
height:dom.offsetHeight
};
b.right=b.x+b.width;
b.bottom=b.y+b.height;
fly(dom).setWidth(b.width).setHeight(b.height);
wrap=fly(dom).fxWrap(r.pos,o,HIDDEN);
st.visibility=VISIBLE;
st.position=ABSOLUTE;
function after(){
fly(dom).fxUnwrap(wrap,r.pos,o);
st.width=r.width;
st.height=r.height;
fly(dom).afterFx(o)
}
pt={
to:[
b.x,
b.y
]
};
bw={to:b.width};
bh={to:b.height};
function argCalc(wrap,style,ww,wh,sXY,sXYval,s1,s2,w,h,p){
var ret={};
fly(wrap).setWidth(ww).setHeight(wh);
if(fly(wrap)[sXY]){
fly(wrap)[sXY](sXYval)
}
style[s1]=style[s2]='0';
if(w){
ret.width=w
}
if(h){
ret.height=h
}
if(p){
ret.points=p
}
return ret
}
;
args=fly(dom).switchStatements(anchor.toLowerCase(),argCalc,{
t:[
wrap,
st,
b.width,
0,
NULL,
NULL,
LEFT,
BOTTOM,
NULL,
bh,
NULL
],
l:[
wrap,
st,
0,
b.height,
NULL,
NULL,
RIGHT,
TOP,
bw,
NULL,
NULL
],
r:[
wrap,
st,
b.width,
b.height,
SETX,
b.right,
LEFT,
TOP,
NULL,
NULL,
pt
],
b:[
wrap,
st,
b.width,
b.height,
SETY,
b.bottom,
LEFT,
TOP,
NULL,
bh,
pt
],
tl:[
wrap,
st,
0,
0,
NULL,
NULL,
RIGHT,
BOTTOM,
bw,
bh,
pt
],
bl:[
wrap,
st,
0,
0,
SETY,
b.y+b.height,
RIGHT,
TOP,
bw,
bh,
pt
],
br:[
wrap,
st,
0,
0,
SETXY,
[
b.right,
b.bottom
],
LEFT,
TOP,
bw,
bh,
pt
],
tr:[
wrap,
st,
0,
0,
SETX,
b.x+b.width,
LEFT,
BOTTOM,
bw,
bh,
pt
]
});
st.visibility=VISIBLE;
fly(wrap).show();
arguments.callee.anim=fly(wrap).fxanim(args,o,MOTION,0.5,EASEOUT,after)
});
return me
},
slideOut:function(anchor,o){
o=getObject(o);
var me=this,dom=me.dom,st=dom.style,xy=me.getXY(),wrap,r,b,a,zero={to:0};
anchor=anchor||'t';
me.queueFx(o,function(){
r=fly(dom).getFxRestore();
b={
x:xy[0],
y:xy[1],
0:xy[0],
1:xy[1],
width:dom.offsetWidth,
height:dom.offsetHeight
};
b.right=b.x+b.width;
b.bottom=b.y+b.height;
fly(dom).setWidth(b.width).setHeight(b.height);
wrap=fly(dom).fxWrap(r.pos,o,VISIBLE);
st.visibility=VISIBLE;
st.position=ABSOLUTE;
fly(wrap).setWidth(b.width).setHeight(b.height);
function after(){
o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();
fly(dom).fxUnwrap(wrap,r.pos,o);
st.width=r.width;
st.height=r.height;
fly(dom).afterFx(o)
}
function argCalc(style,s1,s2,p1,v1,p2,v2,p3,v3){
var ret={};
style[s1]=style[s2]='0';
ret[p1]=v1;
if(p2){
ret[p2]=v2
}
if(p3){
ret[p3]=v3
}
return ret
}
;
a=fly(dom).switchStatements(anchor.toLowerCase(),argCalc,{
t:[
st,
LEFT,
BOTTOM,
HEIGHT,
zero
],
l:[
st,
RIGHT,
TOP,
WIDTH,
zero
],
r:[
st,
LEFT,
TOP,
WIDTH,
zero,
POINTS,
{
to:[
b.right,
b.y
]
}
],
b:[
st,
LEFT,
TOP,
HEIGHT,
zero,
POINTS,
{
to:[
b.x,
b.bottom
]
}
],
tl:[
st,
RIGHT,
BOTTOM,
WIDTH,
zero,
HEIGHT,
zero
],
bl:[
st,
RIGHT,
TOP,
WIDTH,
zero,
HEIGHT,
zero,
POINTS,
{
to:[
b.x,
b.bottom
]
}
],
br:[
st,
LEFT,
TOP,
WIDTH,
zero,
HEIGHT,
zero,
POINTS,
{
to:[
b.x+b.width,
b.bottom
]
}
],
tr:[
st,
LEFT,
BOTTOM,
WIDTH,
zero,
HEIGHT,
zero,
POINTS,
{
to:[
b.right,
b.y
]
}
]
});
arguments.callee.anim=fly(wrap).fxanim(a,o,MOTION,0.5,EASEOUT,after)
});
return me
},
puff:function(o){
o=getObject(o);
var me=this,dom=me.dom,st=dom.style,width,height,r;
me.queueFx(o,function(){
width=fly(dom).getWidth();
height=fly(dom).getHeight();
fly(dom).clearOpacity();
fly(dom).show();
r=fly(dom).getFxRestore();
function after(){
o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();
fly(dom).clearOpacity();
fly(dom).setPositioning(r.pos);
st.width=r.width;
st.height=r.height;
st.fontSize='';
fly(dom).afterFx(o)
}
arguments.callee.anim=fly(dom).fxanim({
width:{to:fly(dom).adjustWidth(width*2)},
height:{to:fly(dom).adjustHeight(height*2)},
points:{
by:[
-width*0.5,
-height*0.5
]
},
opacity:{to:0},
fontSize:{
to:200,
unit:'%'
}
},o,MOTION,0.5,EASEOUT,after)
});
return me
},
switchOff:function(o){
o=getObject(o);
var me=this,dom=me.dom,st=dom.style,r;
me.queueFx(o,function(){
fly(dom).clearOpacity();
fly(dom).clip();
r=fly(dom).getFxRestore();
function after(){
o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();
fly(dom).clearOpacity();
fly(dom).setPositioning(r.pos);
st.width=r.width;
st.height=r.height;
fly(dom).afterFx(o)
}
;
fly(dom).fxanim({opacity:{to:0.3}},NULL,NULL,0.1,NULL,function(){
fly(dom).clearOpacity();
(function(){
fly(dom).fxanim({
height:{to:1},
points:{
by:[
0,
fly(dom).getHeight()*0.5
]
}
},o,MOTION,0.3,'easeIn',after)
}.defer(100))
})
});
return me
},
highlight:function(color,o){
o=getObject(o);
var me=this,dom=me.dom,attr=o.attr||'backgroundColor',a={},restore;
me.queueFx(o,function(){
fly(dom).clearOpacity();
fly(dom).show();
function after(){
dom.style[attr]=restore;
fly(dom).afterFx(o)
}
restore=dom.style[attr];
a[attr]={
from:color||'ffff9c',
to:o.endColor||fly(dom).getColor(attr)||'ffffff'
};
arguments.callee.anim=fly(dom).fxanim(a,o,'color',1,'easeIn',after)
});
return me
},
frame:function(color,count,o){
o=getObject(o);
var me=this,dom=me.dom,proxy,active;
me.queueFx(o,function(){
color=color||'#C3DAF9';
if(color.length==6){
color='#'+color
}
count=count||1;
fly(dom).show();
var xy=fly(dom).getXY(),b={
x:xy[0],
y:xy[1],
0:xy[0],
1:xy[1],
width:dom.offsetWidth,
height:dom.offsetHeight
},queue=function(){
proxy=fly(document.body||document.documentElement).createChild({
style:{
position:ABSOLUTE,
'z-index':35000,
border:'0px solid '+color
}
});
return proxy.queueFx({},animFn)
};
arguments.callee.anim={
isAnimated:true,
stop:function(){
count=0;
proxy.stopFx()
}
};
function animFn(){
var scale=Ext.isBorderBox?2:1;
active=proxy.anim({
top:{
from:b.y,
to:b.y-20
},
left:{
from:b.x,
to:b.x-20
},
borderWidth:{
from:0,
to:10
},
opacity:{
from:1,
to:0
},
height:{
from:b.height,
to:b.height+20*scale
},
width:{
from:b.width,
to:b.width+20*scale
}
},{
duration:o.duration||1,
callback:function(){
proxy.remove();
--count>0?queue():fly(dom).afterFx(o)
}
});
arguments.callee.anim={
isAnimated:true,
stop:function(){
active.stop()
}
}
}
;
queue()
});
return me
},
pause:function(seconds){
var dom=this.dom,t;
this.queueFx({},function(){
t=setTimeout(function(){
fly(dom).afterFx({})
},seconds*1000);
arguments.callee.anim={
isAnimated:true,
stop:function(){
clearTimeout(t);
fly(dom).afterFx({})
}
}
});
return this
},
fadeIn:function(o){
o=getObject(o);
var me=this,dom=me.dom,to=o.endOpacity||1;
me.queueFx(o,function(){
fly(dom).setOpacity(0);
fly(dom).fixDisplay();
dom.style.visibility=VISIBLE;
arguments.callee.anim=fly(dom).fxanim({opacity:{to:to}},o,NULL,0.5,EASEOUT,function(){
if(to==1){
fly(dom).clearOpacity()
}
fly(dom).afterFx(o)
})
});
return me
},
fadeOut:function(o){
o=getObject(o);
var me=this,dom=me.dom,style=dom.style,to=o.endOpacity||0;
me.queueFx(o,function(){
arguments.callee.anim=fly(dom).fxanim({opacity:{to:to}},o,NULL,0.5,EASEOUT,function(){
if(to==0){
Ext.Element.data(dom,'visibilityMode')==Ext.Element.DISPLAY||o.useDisplay?style.display='none':style.visibility=HIDDEN;
fly(dom).clearOpacity()
}
fly(dom).afterFx(o)
})
});
return me
},
scale:function(w,h,o){
this.shift(Ext.apply({},o,{
width:w,
height:h
}));
return this
},
shift:function(o){
o=getObject(o);
var dom=this.dom,a={};
this.queueFx(o,function(){
for(var prop in o){
if(o[prop]!=UNDEFINED){
a[prop]={to:o[prop]}
}
}
a.width?a.width.to=fly(dom).adjustWidth(o.width):a;
a.height?a.height.to=fly(dom).adjustWidth(o.height):a;
if(a.x||a.y||a.xy){
a.points=a.xy||{
to:[
a.x?a.x.to:fly(dom).getX(),
a.y?a.y.to:fly(dom).getY()
]
}
}
arguments.callee.anim=fly(dom).fxanim(a,o,MOTION,0.35,EASEOUT,function(){
fly(dom).afterFx(o)
})
});
return this
},
ghost:function(anchor,o){
o=getObject(o);
var me=this,dom=me.dom,st=dom.style,a={
opacity:{to:0},
points:{}
},pt=a.points,r,w,h;
anchor=anchor||'b';
me.queueFx(o,function(){
r=fly(dom).getFxRestore();
w=fly(dom).getWidth();
h=fly(dom).getHeight();
function after(){
o.useDisplay?fly(dom).setDisplayed(FALSE):fly(dom).hide();
fly(dom).clearOpacity();
fly(dom).setPositioning(r.pos);
st.width=r.width;
st.height=r.height;
fly(dom).afterFx(o)
}
pt.by=fly(dom).switchStatements(anchor.toLowerCase(),function(v1,v2){
return[
v1,
v2
]
},{
t:[
0,
-h
],
l:[
-w,
0
],
r:[
w,
0
],
b:[
0,
h
],
tl:[
-w,
-h
],
bl:[
-w,
h
],
br:[
w,
h
],
tr:[
w,
-h
]
});
arguments.callee.anim=fly(dom).fxanim(a,o,MOTION,0.5,EASEOUT,after)
});
return me
},
syncFx:function(){
var me=this;
me.fxDefaults=Ext.apply(me.fxDefaults||{},{
block:FALSE,
concurrent:TRUE,
stopFx:FALSE
});
return me
},
sequenceFx:function(){
var me=this;
me.fxDefaults=Ext.apply(me.fxDefaults||{},{
block:FALSE,
concurrent:FALSE,
stopFx:FALSE
});
return me
},
nextFx:function(){
var ef=getQueue(this.dom.id)[0];
if(ef){
ef.call(this)
}
},
hasActiveFx:function(){
return getQueue(this.dom.id)[0]
},
stopFx:function(finish){
var me=this,id=me.dom.id;
if(me.hasActiveFx()){
var cur=getQueue(id)[0];
if(cur&&cur.anim){
if(cur.anim.isAnimated){
setQueue(id,[cur]);
cur.anim.stop(finish!==undefined?finish:TRUE)
}else{
setQueue(id,[])
}
}
}
return me
},
beforeFx:function(o){
if(this.hasActiveFx()&&!o.concurrent){
if(o.stopFx){
this.stopFx();
return TRUE
}
return FALSE
}
return TRUE
},
hasFxBlock:function(){
var q=getQueue(this.dom.id);
return q&&q[0]&&q[0].block
},
queueFx:function(o,fn){
var me=fly(this.dom);
if(!me.hasFxBlock()){
Ext.applyIf(o,me.fxDefaults);
if(!o.concurrent){
var run=me.beforeFx(o);
fn.block=o.block;
getQueue(me.dom.id).push(fn);
if(run){
me.nextFx()
}
}else{
fn.call(me)
}
}
return me
},
fxWrap:function(pos,o,vis){
var dom=this.dom,wrap,wrapXY;
if(!o.wrap||!(wrap=Ext.getDom(o.wrap))){
if(o.fixPosition){
wrapXY=fly(dom).getXY()
}
var div=document.createElement('div');
div.style.visibility=vis;
wrap=dom.parentNode.insertBefore(div,dom);
fly(wrap).setPositioning(pos);
if(fly(wrap).isStyle(POSITION,'static')){
fly(wrap).position('relative')
}
fly(dom).clearPositioning('auto');
fly(wrap).clip();
wrap.appendChild(dom);
if(wrapXY){
fly(wrap).setXY(wrapXY)
}
}
return wrap
},
fxUnwrap:function(wrap,pos,o){
var dom=this.dom;
fly(dom).clearPositioning();
fly(dom).setPositioning(pos);
if(!o.wrap){
var pn=fly(wrap).dom.parentNode;
pn.insertBefore(dom,wrap);
fly(wrap).remove()
}
},
getFxRestore:function(){
var st=this.dom.style;
return{
pos:this.getPositioning(),
width:st.width,
height:st.height
}
},
afterFx:function(o){
var dom=this.dom,id=dom.id;
if(o.afterStyle){
fly(dom).setStyle(o.afterStyle)
}
if(o.afterCls){
fly(dom).addClass(o.afterCls)
}
if(o.remove==TRUE){
fly(dom).remove()
}
if(o.callback){
o.callback.call(o.scope,fly(dom))
}
if(!o.concurrent){
getQueue(id).shift();
fly(dom).nextFx()
}
},
fxanim:function(args,opt,animType,defaultDur,defaultEase,cb){
animType=animType||'run';
opt=opt||{};
var anim=Ext.lib.Anim[animType](this.dom,args,opt.duration||defaultDur||0.35,opt.easing||defaultEase||EASEOUT,cb,this);
opt.anim=anim;
return anim
}
};
Ext.Fx.resize=Ext.Fx.scale;
Ext.Element.addMethods(Ext.Fx)
}());
Ext.CompositeElementLite=function(els,root){
this.elements=[];
this.add(els,root);
this.el=new Ext.Element.Flyweight
};
Ext.CompositeElementLite.prototype={
isComposite:true,
getElement:function(el){
var e=this.el;
e.dom=el;
e.id=el.id;
return e
},
transformElement:function(el){
return Ext.getDom(el)
},
getCount:function(){
return this.elements.length
},
add:function(els,root){
var me=this,elements=me.elements;
if(!els){
return this
}
if(typeof els=='string'){
els=Ext.Element.selectorFunction(els,root)
}else if(els.isComposite){
els=els.elements
}else if(!Ext.isIterable(els)){
els=[els]
}
for(var i=0,len=els.length;i<len;++i){
elements.push(me.transformElement(els[i]))
}
return me
},
invoke:function(fn,args){
var me=this,els=me.elements,len=els.length,e,i;
for(i=0;i<len;i++){
e=els[i];
if(e){
Ext.Element.prototype[fn].apply(me.getElement(e),args)
}
}
return me
},
item:function(index){
var me=this,el=me.elements[index],out=null;
if(el){
out=me.getElement(el)
}
return out
},
addListener:function(eventName,handler,scope,opt){
var els=this.elements,len=els.length,i,e;
for(i=0;i<len;i++){
e=els[i];
if(e){
Ext.EventManager.on(e,eventName,handler,scope||e,opt)
}
}
return this
},
each:function(fn,scope){
var me=this,els=me.elements,len=els.length,i,e;
for(i=0;i<len;i++){
e=els[i];
if(e){
e=this.getElement(e);
if(fn.call(scope||e,e,me,i)===false){
break
}
}
}
return me
},
fill:function(els){
var me=this;
me.elements=[];
me.add(els);
return me
},
filter:function(selector){
var els=[],me=this,fn=Ext.isFunction(selector)?selector:function(el){
return el.is(selector)
};
me.each(function(el,self,i){
if(fn(el,i)!==false){
els[els.length]=me.transformElement(el)
}
});
me.elements=els;
return me
},
indexOf:function(el){
return this.elements.indexOf(this.transformElement(el))
},
replaceElement:function(el,replacement,domReplace){
var index=!isNaN(el)?el:this.indexOf(el),d;
if(index>-1){
replacement=Ext.getDom(replacement);
if(domReplace){
d=this.elements[index];
d.parentNode.insertBefore(replacement,d);
Ext.removeNode(d)
}
this.elements.splice(index,1,replacement)
}
return this
},
clear:function(){
this.elements=[]
}
};
Ext.CompositeElementLite.prototype.on=Ext.CompositeElementLite.prototype.addListener;
Ext.CompositeElementLite.importElementMethods=function(){
var fnName,ElProto=Ext.Element.prototype,CelProto=Ext.CompositeElementLite.prototype;
for(fnName in ElProto){
if(typeof ElProto[fnName]=='function'){
(function(fnName){
CelProto[fnName]=CelProto[fnName]||function(){
return this.invoke(fnName,arguments)
}
}.call(CelProto,fnName))
}
}
};
Ext.CompositeElementLite.importElementMethods();
if(Ext.DomQuery){
Ext.Element.selectorFunction=Ext.DomQuery.select
}
Ext.Element.select=function(selector,root){
var els;
if(typeof selector=='string'){
els=Ext.Element.selectorFunction(selector,root)
}else if(selector.length!==undefined){
els=selector
}else{
throw'Invalid selector'
}
return new Ext.CompositeElementLite(els)
};
Ext.select=Ext.Element.select;
(function(){
var BEFOREREQUEST='beforerequest',REQUESTCOMPLETE='requestcomplete',REQUESTEXCEPTION='requestexception',UNDEFINED=undefined,LOAD='load',POST='POST',GET='GET',WINDOW=window;
Ext.data.Connection=function(config){
Ext.apply(this,config);
this.addEvents(BEFOREREQUEST,REQUESTCOMPLETE,REQUESTEXCEPTION);
Ext.data.Connection.superclass.constructor.call(this)
};
Ext.extend(Ext.data.Connection,Ext.util.Observable,{
timeout:30000,
autoAbort:false,
disableCaching:true,
disableCachingParam:'_dc',
request:function(o){
var me=this;
if(me.fireEvent(BEFOREREQUEST,me,o)){
if(o.el){
if(!Ext.isEmpty(o.indicatorText)){
me.indicatorText='<div class="loading-indicator">'+o.indicatorText+'</div>'
}
if(me.indicatorText){
Ext.getDom(o.el).innerHTML=me.indicatorText
}
o.success=(Ext.isFunction(o.success)?o.success:function(){
}).createInterceptor(function(response){
Ext.getDom(o.el).innerHTML=response.responseText
})
}
var p=o.params,url=o.url||me.url,method,cb={
success:me.handleResponse,
failure:me.handleFailure,
scope:me,
argument:{options:o},
timeout:Ext.num(o.timeout,me.timeout)
},form,serForm;
if(Ext.isFunction(p)){
p=p.call(o.scope||WINDOW,o)
}
p=Ext.urlEncode(me.extraParams,Ext.isObject(p)?Ext.urlEncode(p):p);
if(Ext.isFunction(url)){
url=url.call(o.scope||WINDOW,o)
}
if(form=Ext.getDom(o.form)){
url=url||form.action;
if(o.isUpload||/multipart\/form-data/i.test(form.getAttribute('enctype'))){
return me.doFormUpload.call(me,o,p,url)
}
serForm=Ext.lib.Ajax.serializeForm(form);
p=p?p+'&'+serForm:serForm
}
method=o.method||me.method||(p||o.xmlData||o.jsonData?POST:GET);
if(method===GET&&(me.disableCaching&&o.disableCaching!==false)||o.disableCaching===true){
var dcp=o.disableCachingParam||me.disableCachingParam;
url=Ext.urlAppend(url,dcp+'='+new Date().getTime())
}
o.headers=Ext.applyIf(o.headers||{},me.defaultHeaders||{});
if(o.autoAbort===true||me.autoAbort){
me.abort()
}
if((method==GET||o.xmlData||o.jsonData)&&p){
url=Ext.urlAppend(url,p);
p=''
}
return me.transId=Ext.lib.Ajax.request(method,url,cb,p,o)
}else{
return o.callback?o.callback.apply(o.scope,[
o,
UNDEFINED,
UNDEFINED
]):null
}
},
isLoading:function(transId){
return transId?Ext.lib.Ajax.isCallInProgress(transId):!!this.transId
},
abort:function(transId){
if(transId||this.isLoading()){
Ext.lib.Ajax.abort(transId||this.transId)
}
},
handleResponse:function(response){
this.transId=false;
var options=response.argument.options;
response.argument=options?options.argument:null;
this.fireEvent(REQUESTCOMPLETE,this,response,options);
if(options.success){
options.success.call(options.scope,response,options)
}
if(options.callback){
options.callback.call(options.scope,options,true,response)
}
},
handleFailure:function(response,e){
this.transId=false;
var options=response.argument.options;
response.argument=options?options.argument:null;
this.fireEvent(REQUESTEXCEPTION,this,response,options,e);
if(options.failure){
options.failure.call(options.scope,response,options)
}
if(options.callback){
options.callback.call(options.scope,options,false,response)
}
},
doFormUpload:function(o,ps,url){
var id=Ext.id(),doc=document,frame=doc.createElement('iframe'),form=Ext.getDom(o.form),hiddens=[],hd,encoding='multipart/form-data',buf={
target:form.target,
method:form.method,
encoding:form.encoding,
enctype:form.enctype,
action:form.action
};
Ext.fly(frame).set({
id:id,
name:id,
cls:'x-hidden',
src:Ext.SSL_SECURE_URL
});
doc.body.appendChild(frame);
if(Ext.isIE){
document.frames[id].name=id
}
Ext.fly(form).set({
target:id,
method:POST,
enctype:encoding,
encoding:encoding,
action:url||buf.action
});
Ext.iterate(Ext.urlDecode(ps,false),function(k,v){
hd=doc.createElement('input');
Ext.fly(hd).set({
type:'hidden',
value:v,
name:k
});
form.appendChild(hd);
hiddens.push(hd)
});
function cb(){
var me=this,r={
responseText:'',
responseXML:null,
argument:o.argument
},doc,firstChild;
try{
doc=frame.contentWindow.document||frame.contentDocument||WINDOW.frames[id].document;
if(doc){
if(doc.body){
if(/textarea/i.test((firstChild=doc.body.firstChild||{}).tagName)){
r.responseText=firstChild.value
}else{
r.responseText=doc.body.innerHTML
}
}
r.responseXML=doc.XMLDocument||doc
}
}catch(e){
}
Ext.EventManager.removeListener(frame,LOAD,cb,me);
me.fireEvent(REQUESTCOMPLETE,me,r,o);
function runCallback(fn,scope,args){
if(Ext.isFunction(fn)){
fn.apply(scope,args)
}
}
runCallback(o.success,o.scope,[
r,
o
]);
runCallback(o.callback,o.scope,[
o,
true,
r
]);
if(!me.debugUploads){
setTimeout(function(){
Ext.removeNode(frame)
},100)
}
}
Ext.EventManager.on(frame,LOAD,cb,this);
form.submit();
Ext.fly(form).set(buf);
Ext.each(hiddens,function(h){
Ext.removeNode(h)
})
}
})
}());
Ext.Ajax=new Ext.data.Connection({
autoAbort:false,
serializeForm:function(form){
return Ext.lib.Ajax.serializeForm(form)
}
});
Ext.util.JSON=new function(){
var useHasOwn=!!{}.hasOwnProperty,isNative=function(){
var useNative=null;
return function(){
if(useNative===null){
useNative=Ext.USE_NATIVE_JSON&&window.JSON&&JSON.toString()=='[object JSON]'
}
return useNative
}
}(),pad=function(n){
return n<10?'0'+n:n
},doDecode=function(json){
return json?eval('('+json+')'):''
},doEncode=function(o){
if(!Ext.isDefined(o)||o===null){
return'null'
}else if(Ext.isArray(o)){
return encodeArray(o)
}else if(Ext.isDate(o)){
return Ext.util.JSON.encodeDate(o)
}else if(Ext.isString(o)){
return encodeString(o)
}else if(typeof o=='number'){
return isFinite(o)?String(o):'null'
}else if(Ext.isBoolean(o)){
return String(o)
}else{
var a=['{'],b,i,v;
for(i in o){
if(!o.getElementsByTagName){
if(!useHasOwn||o.hasOwnProperty(i)){
v=o[i];
switch(typeof v){
case'undefined':
case'function':
case'unknown':
break;
default:
if(b){
a.push(',')
}
a.push(doEncode(i),':',v===null?'null':doEncode(v));
b=true
}
}
}
}
a.push('}');
return a.join('')
}
},m={
'':'\\b',
'	':'\\t',
'\n':'\\n',
'':'\\f',
'\r':'\\r',
'"':'\\"',
'\\':'\\\\'
},encodeString=function(s){
if(/["\\\x00-\x1f]/.test(s)){
return'"'+s.replace(/([\x00-\x1f\\"])/g,function(a,b){
var c=m[b];
if(c){
return c
}
c=b.charCodeAt();
return'\\u00'+Math.floor(c/16).toString(16)+(c%16).toString(16)
})+'"'
}
return'"'+s+'"'
},encodeArray=function(o){
var a=['['],b,i,l=o.length,v;
for(i=0;i<l;i+=1){
v=o[i];
switch(typeof v){
case'undefined':
case'function':
case'unknown':
break;
default:
if(b){
a.push(',')
}
a.push(v===null?'null':Ext.util.JSON.encode(v));
b=true
}
}
a.push(']');
return a.join('')
};
this.encodeDate=function(o){
return'"'+o.getFullYear()+'-'+pad(o.getMonth()+1)+'-'+pad(o.getDate())+'T'+pad(o.getHours())+':'+pad(o.getMinutes())+':'+pad(o.getSeconds())+'"'
};
this.encode=function(){
var ec;
return function(o){
if(!ec){
ec=isNative()?JSON.stringify:doEncode
}
return ec(o)
}
}();
this.decode=function(){
var dc;
return function(json){
if(!dc){
dc=isNative()?JSON.parse:doDecode
}
return dc(json)
}
}()
};
Ext.encode=Ext.util.JSON.encode;
Ext.decode=Ext.util.JSON.decode;
Ext.EventManager=function(){
var docReadyEvent,docReadyProcId,docReadyState=false,DETECT_NATIVE=Ext.isGecko||Ext.isWebKit||Ext.isSafari,E=Ext.lib.Event,D=Ext.lib.Dom,DOC=document,WINDOW=window,DOMCONTENTLOADED='DOMContentLoaded',COMPLETE='complete',propRe=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,specialElCache=[];
function getId(el){
var id=false,i=0,len=specialElCache.length,skip=false,o;
if(el){
if(el.getElementById||el.navigator){
for(;i<len;++i){
o=specialElCache[i];
if(o.el===el){
id=o.id;
break
}
}
if(!id){
id=Ext.id(el);
specialElCache.push({
id:id,
el:el
});
skip=true
}
}else{
id=Ext.id(el)
}
if(!Ext.elCache[id]){
Ext.Element.addToCache(new Ext.Element(el),id);
if(skip){
Ext.elCache[id].skipGC=true
}
}
}
return id
}
function addListener(el,ename,fn,task,wrap,scope){
el=Ext.getDom(el);
var id=getId(el),es=Ext.elCache[id].events,wfn;
wfn=E.on(el,ename,wrap);
es[ename]=es[ename]||[];
es[ename].push([
fn,
wrap,
scope,
wfn,
task
]);
if(el.addEventListener&&ename=='mousewheel'){
var args=[
'DOMMouseScroll',
wrap,
false
];
el.addEventListener.apply(el,args);
Ext.EventManager.addListener(WINDOW,'unload',function(){
el.removeEventListener.apply(el,args)
})
}
if(el==DOC&&ename=='mousedown'){
Ext.EventManager.stoppedMouseDownEvent.addListener(wrap)
}
}
function doScrollChk(){
if(window!=top){
return false
}
try{
DOC.documentElement.doScroll('left')
}catch(e){
return false
}
fireDocReady();
return true
}
function checkReadyState(e){
if(Ext.isIE&&doScrollChk()){
return true
}
if(DOC.readyState==COMPLETE){
fireDocReady();
return true
}
docReadyState||(docReadyProcId=setTimeout(arguments.callee,2));
return false
}
var styles;
function checkStyleSheets(e){
styles||(styles=Ext.query('style, link[rel=stylesheet]'));
if(styles.length==DOC.styleSheets.length){
fireDocReady();
return true
}
docReadyState||(docReadyProcId=setTimeout(arguments.callee,2));
return false
}
function OperaDOMContentLoaded(e){
DOC.removeEventListener(DOMCONTENTLOADED,arguments.callee,false);
checkStyleSheets()
}
function fireDocReady(e){
if(!docReadyState){
docReadyState=true;
if(docReadyProcId){
clearTimeout(docReadyProcId)
}
if(DETECT_NATIVE){
DOC.removeEventListener(DOMCONTENTLOADED,fireDocReady,false)
}
if(Ext.isIE&&checkReadyState.bindIE){
DOC.detachEvent('onreadystatechange',checkReadyState)
}
E.un(WINDOW,'load',arguments.callee)
}
if(docReadyEvent&&!Ext.isReady){
Ext.isReady=true;
docReadyEvent.fire();
docReadyEvent.listeners=[]
}
}
function initDocReady(){
docReadyEvent||(docReadyEvent=new Ext.util.Event);
if(DETECT_NATIVE){
DOC.addEventListener(DOMCONTENTLOADED,fireDocReady,false)
}
if(Ext.isIE){
if(!checkReadyState()){
checkReadyState.bindIE=true;
DOC.attachEvent('onreadystatechange',checkReadyState)
}
}else if(Ext.isOpera){
DOC.readyState==COMPLETE&&checkStyleSheets()||DOC.addEventListener(DOMCONTENTLOADED,OperaDOMContentLoaded,false)
}else if(Ext.isWebKit){
checkReadyState()
}
E.on(WINDOW,'load',fireDocReady)
}
function createTargeted(h,o){
return function(){
var args=Ext.toArray(arguments);
if(o.target==Ext.EventObject.setEvent(args[0]).target){
h.apply(this,args)
}
}
}
function createBuffered(h,o,task){
return function(e){
task.delay(o.buffer,h,null,[new Ext.EventObjectImpl(e)])
}
}
function createSingle(h,el,ename,fn,scope){
return function(e){
Ext.EventManager.removeListener(el,ename,fn,scope);
h(e)
}
}
function createDelayed(h,o,fn){
return function(e){
var task=new Ext.util.DelayedTask(h);
if(!fn.tasks){
fn.tasks=[]
}
fn.tasks.push(task);
task.delay(o.delay||10,h,null,[new Ext.EventObjectImpl(e)])
}
}
function listen(element,ename,opt,fn,scope){
var o=!opt||typeof opt=='boolean'?{}:opt,el=Ext.getDom(element),task;
fn=fn||o.fn;
scope=scope||o.scope;
if(!el){
throw'Error listening for "'+ename+'". Element "'+element+'" doesn\'t exist.'
}
function h(e){
if(!Ext){
return
}
e=Ext.EventObject.setEvent(e);
var t;
if(o.delegate){
if(!(t=e.getTarget(o.delegate,el))){
return
}
}else{
t=e.target
}
if(o.stopEvent){
e.stopEvent()
}
if(o.preventDefault){
e.preventDefault()
}
if(o.stopPropagation){
e.stopPropagation()
}
if(o.normalized===false){
e=e.browserEvent
}
fn.call(scope||el,e,t,o)
}
if(o.target){
h=createTargeted(h,o)
}
if(o.delay){
h=createDelayed(h,o,fn)
}
if(o.single){
h=createSingle(h,el,ename,fn,scope)
}
if(o.buffer){
task=new Ext.util.DelayedTask(h);
h=createBuffered(h,o,task)
}
addListener(el,ename,fn,task,h,scope);
return h
}
var pub={
addListener:function(element,eventName,fn,scope,options){
if(typeof eventName=='object'){
var o=eventName,e,val;
for(e in o){
val=o[e];
if(!propRe.test(e)){
if(Ext.isFunction(val)){
listen(element,e,o,val,o.scope)
}else{
listen(element,e,val)
}
}
}
}else{
listen(element,eventName,options,fn,scope)
}
},
removeListener:function(el,eventName,fn,scope){
el=Ext.getDom(el);
var id=getId(el),f=el&&Ext.elCache[id].events[eventName]||[],wrap,i,l,k,len,fnc;
for(i=0,len=f.length;i<len;i++){
if(Ext.isArray(fnc=f[i])&&fnc[0]==fn&&(!scope||fnc[2]==scope)){
if(fnc[4]){
fnc[4].cancel()
}
k=fn.tasks&&fn.tasks.length;
if(k){
while(k--){
fn.tasks[k].cancel()
}
delete fn.tasks
}
wrap=fnc[1];
E.un(el,eventName,E.extAdapter?fnc[3]:wrap);
if(wrap&&el.addEventListener&&eventName=='mousewheel'){
el.removeEventListener('DOMMouseScroll',wrap,false)
}
if(wrap&&el==DOC&&eventName=='mousedown'){
Ext.EventManager.stoppedMouseDownEvent.removeListener(wrap)
}
f.splice(i,1);
if(f.length===0){
delete Ext.elCache[id].events[eventName]
}
for(k in Ext.elCache[id].events){
return false
}
Ext.elCache[id].events={};
return false
}
}
},
removeAll:function(el){
el=Ext.getDom(el);
var id=getId(el),ec=Ext.elCache[id]||{},es=ec.events||{},f,i,len,ename,fn,k,wrap;
for(ename in es){
if(es.hasOwnProperty(ename)){
f=es[ename];
for(i=0,len=f.length;i<len;i++){
fn=f[i];
if(fn[4]){
fn[4].cancel()
}
if(fn[0].tasks&&(k=fn[0].tasks.length)){
while(k--){
fn[0].tasks[k].cancel()
}
delete fn.tasks
}
wrap=fn[1];
E.un(el,ename,E.extAdapter?fn[3]:wrap);
if(el.addEventListener&&wrap&&ename=='mousewheel'){
el.removeEventListener('DOMMouseScroll',wrap,false)
}
if(wrap&&el==DOC&&ename=='mousedown'){
Ext.EventManager.stoppedMouseDownEvent.removeListener(wrap)
}
}
}
}
if(Ext.elCache[id]){
Ext.elCache[id].events={}
}
},
getListeners:function(el,eventName){
el=Ext.getDom(el);
var id=getId(el),ec=Ext.elCache[id]||{},es=ec.events||{},results=[];
if(es&&es[eventName]){
return es[eventName]
}else{
return null
}
},
purgeElement:function(el,recurse,eventName){
el=Ext.getDom(el);
var id=getId(el),ec=Ext.elCache[id]||{},es=ec.events||{},i,f,len;
if(eventName){
if(es&&es.hasOwnProperty(eventName)){
f=es[eventName];
for(i=0,len=f.length;i<len;i++){
Ext.EventManager.removeListener(el,eventName,f[i][0])
}
}
}else{
Ext.EventManager.removeAll(el)
}
if(recurse&&el&&el.childNodes){
for(i=0,len=el.childNodes.length;i<len;i++){
Ext.EventManager.purgeElement(el.childNodes[i],recurse,eventName)
}
}
},
_unload:function(){
var el;
for(el in Ext.elCache){
Ext.EventManager.removeAll(el)
}
delete Ext.elCache;
delete Ext.Element._flyweights;
var c,conn,tid,ajax=Ext.lib.Ajax;
typeof ajax.conn=='object'?conn=ajax.conn:conn={};
for(tid in conn){
c=conn[tid];
if(c){
ajax.abort({
conn:c,
tId:tid
})
}
}
},
onDocumentReady:function(fn,scope,options){
if(Ext.isReady){
docReadyEvent||(docReadyEvent=new Ext.util.Event);
docReadyEvent.addListener(fn,scope,options);
docReadyEvent.fire();
docReadyEvent.listeners=[]
}else{
if(!docReadyEvent){
initDocReady()
}
options=options||{};
options.delay=options.delay||1;
docReadyEvent.addListener(fn,scope,options)
}
},
fireDocReady:fireDocReady
};
pub.on=pub.addListener;
pub.un=pub.removeListener;
pub.stoppedMouseDownEvent=new Ext.util.Event;
return pub
}();
Ext.onReady=Ext.EventManager.onDocumentReady;
(function(){
var initExtCss=function(){
var bd=document.body||document.getElementsByTagName('body')[0];
if(!bd){
return false
}
var cls=[
' ',
Ext.isIE?'ext-ie '+(Ext.isIE6?'ext-ie6':Ext.isIE7?'ext-ie7':Ext.isIE8?'ext-ie8':'ext-ie9'):Ext.isGecko?'ext-gecko '+(Ext.isGecko2?'ext-gecko2':'ext-gecko3'):Ext.isOpera?'ext-opera':Ext.isWebKit?'ext-webkit':''
];
if(Ext.isSafari){
cls.push('ext-safari '+(Ext.isSafari2?'ext-safari2':Ext.isSafari3?'ext-safari3':'ext-safari4'))
}else if(Ext.isChrome){
cls.push('ext-chrome')
}
if(Ext.isMac){
cls.push('ext-mac')
}
if(Ext.isLinux){
cls.push('ext-linux')
}
if(Ext.isStrict||Ext.isBorderBox){
var p=bd.parentNode;
if(p){
if(!Ext.isStrict){
Ext.fly(p,'_internal').addClass('x-quirks');
if(Ext.isIE&&!Ext.isStrict){
Ext.isIEQuirks=true
}
}
Ext.fly(p,'_internal').addClass(Ext.isStrict&&Ext.isIE||!Ext.enableForcedBoxModel&&!Ext.isIE?' ext-strict':' ext-border-box')
}
}
if(Ext.enableForcedBoxModel&&!Ext.isIE){
Ext.isForcedBorderBox=true;
cls.push('ext-forced-border-box')
}
Ext.fly(bd,'_internal').addClass(cls);
return true
};
if(!initExtCss()){
Ext.onReady(initExtCss)
}
}());
(function(){
var supports=Ext.apply(Ext.supports,{
correctRightMargin:true,
correctTransparentColor:true,
cssFloat:true
});
var supportTests=function(){
var div=document.createElement('div'),doc=document,view,last;
div.innerHTML='<div style="height:30px;width:50px;"><div style="height:20px;width:20px;"></div></div><div style="float:left;background-color:transparent;">';
doc.body.appendChild(div);
last=div.lastChild;
if(view=doc.defaultView){
if(view.getComputedStyle(div.firstChild.firstChild,null).marginRight!='0px'){
supports.correctRightMargin=false
}
if(view.getComputedStyle(last,null).backgroundColor!='transparent'){
supports.correctTransparentColor=false
}
}
supports.cssFloat=!!last.style.cssFloat;
doc.body.removeChild(div)
};
if(Ext.isReady){
supportTests()
}else{
Ext.onReady(supportTests)
}
}());
Ext.EventObject=function(){
var E=Ext.lib.Event,clickRe=/(dbl)?click/,safariKeys={
3:13,
63234:37,
63235:39,
63232:38,
63233:40,
63276:33,
63277:34,
63272:46,
63273:36,
63275:35
},btnMap=Ext.isIE?{
1:0,
4:1,
2:2
}:{
0:0,
1:1,
2:2
};
Ext.EventObjectImpl=function(e){
if(e){
this.setEvent(e.browserEvent||e)
}
};
Ext.EventObjectImpl.prototype={
setEvent:function(e){
var me=this;
if(e==me||e&&e.browserEvent){
return e
}
me.browserEvent=e;
if(e){
me.button=e.button?btnMap[e.button]:e.which?e.which-1:-1;
if(clickRe.test(e.type)&&me.button==-1){
me.button=0
}
me.type=e.type;
me.shiftKey=e.shiftKey;
me.ctrlKey=e.ctrlKey||e.metaKey||false;
me.altKey=e.altKey;
me.keyCode=e.keyCode;
me.charCode=e.charCode;
me.target=E.getTarget(e);
me.xy=E.getXY(e)
}else{
me.button=-1;
me.shiftKey=false;
me.ctrlKey=false;
me.altKey=false;
me.keyCode=0;
me.charCode=0;
me.target=null;
me.xy=[
0,
0
]
}
return me
},
stopEvent:function(){
var me=this;
if(me.browserEvent){
if(me.browserEvent.type=='mousedown'){
Ext.EventManager.stoppedMouseDownEvent.fire(me)
}
E.stopEvent(me.browserEvent)
}
},
preventDefault:function(){
if(this.browserEvent){
E.preventDefault(this.browserEvent)
}
},
stopPropagation:function(){
var me=this;
if(me.browserEvent){
if(me.browserEvent.type=='mousedown'){
Ext.EventManager.stoppedMouseDownEvent.fire(me)
}
E.stopPropagation(me.browserEvent)
}
},
getCharCode:function(){
return this.charCode||this.keyCode
},
getKey:function(){
return this.normalizeKey(this.keyCode||this.charCode)
},
normalizeKey:function(k){
return Ext.isSafari?safariKeys[k]||k:k
},
getPageX:function(){
return this.xy[0]
},
getPageY:function(){
return this.xy[1]
},
getXY:function(){
return this.xy
},
getTarget:function(selector,maxDepth,returnEl){
return selector?Ext.fly(this.target).findParent(selector,maxDepth,returnEl):returnEl?Ext.get(this.target):this.target
},
getRelatedTarget:function(){
return this.browserEvent?E.getRelatedTarget(this.browserEvent):null
},
getWheelDelta:function(){
var e=this.browserEvent;
var delta=0;
if(e.wheelDelta){
delta=e.wheelDelta/120
}else if(e.detail){
delta=-e.detail/3
}
return delta
},
within:function(el,related,allowEl){
if(el){
var t=this[related?'getRelatedTarget':'getTarget']();
return t&&((allowEl?t==Ext.getDom(el):false)||Ext.fly(el).contains(t))
}
return false
}
};
return new Ext.EventObjectImpl
}();
Ext.Loader=Ext.apply({},{
load:function(fileList,callback,scope,preserveOrder){
var scope=scope||this,head=document.getElementsByTagName('head')[0],fragment=document.createDocumentFragment(),numFiles=fileList.length,loadedFiles=0,me=this;
var loadFileIndex=function(index){
head.appendChild(me.buildScriptTag(fileList[index],onFileLoaded))
};
var onFileLoaded=function(){
loadedFiles++;
if(numFiles==loadedFiles&&typeof callback=='function'){
callback.call(scope)
}else{
if(preserveOrder===true){
loadFileIndex(loadedFiles)
}
}
};
if(preserveOrder===true){
loadFileIndex.call(this,0)
}else{
Ext.each(fileList,function(file,index){
fragment.appendChild(this.buildScriptTag(file,onFileLoaded))
},this);
head.appendChild(fragment)
}
},
buildScriptTag:function(filename,callback){
var script=document.createElement('script');
script.type='text/javascript';
script.src=filename;
if(script.readyState){
script.onreadystatechange=function(){
if(script.readyState=='loaded'||script.readyState=='complete'){
script.onreadystatechange=null;
callback()
}
}
}else{
script.onload=callback
}
return script
}
});
Ext.ns('Ext.grid','Ext.list','Ext.dd','Ext.tree','Ext.form','Ext.menu','Ext.state','Ext.layout.boxOverflow','Ext.app','Ext.ux','Ext.chart','Ext.direct','Ext.slider');
Ext.apply(Ext,function(){
var E=Ext,idSeed=0,scrollWidth=null;
return{
emptyFn:function(){
},
BLANK_IMAGE_URL:Ext.isIE6||Ext.isIE7||Ext.isAir?'http:/'+'/www.extjs.com/s.gif':'data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==',
extendX:function(supr,fn){
return Ext.extend(supr,fn(supr.prototype))
},
getDoc:function(){
return Ext.get(document)
},
num:function(v,defaultValue){
v=Number(Ext.isEmpty(v)||Ext.isArray(v)||typeof v=='boolean'||typeof v=='string'&&v.trim().length==0?NaN:v);
return isNaN(v)?defaultValue:v
},
value:function(v,defaultValue,allowBlank){
return Ext.isEmpty(v,allowBlank)?defaultValue:v
},
escapeRe:function(s){
return s.replace(/([-.*+?^${}()|[\]\/\\])/g,'\\$1')
},
sequence:function(o,name,fn,scope){
o[name]=o[name].createSequence(fn,scope)
},
addBehaviors:function(o){
if(!Ext.isReady){
Ext.onReady(function(){
Ext.addBehaviors(o)
})
}else{
var cache={},parts,b,s;
for(b in o){
if((parts=b.split('@'))[1]){
s=parts[0];
if(!cache[s]){
cache[s]=Ext.select(s)
}
cache[s].on(parts[1],o[b])
}
}
cache=null
}
},
getScrollBarWidth:function(force){
if(!Ext.isReady){
return 0
}
if(force===true||scrollWidth===null){
var div=Ext.getBody().createChild('<div class="x-hide-offsets" style="width:100px;height:50px;overflow:hidden;"><div style="height:200px;"></div></div>'),child=div.child('div',true);
var w1=child.offsetWidth;
div.setStyle('overflow',Ext.isWebKit||Ext.isGecko?'auto':'scroll');
var w2=child.offsetWidth;
div.remove();
scrollWidth=w1-w2+2
}
return scrollWidth
},
combine:function(){
var as=arguments,l=as.length,r=[];
for(var i=0;i<l;i++){
var a=as[i];
if(Ext.isArray(a)){
r=r.concat(a)
}else if(a.length!==undefined&&!a.substr){
r=r.concat(Array.prototype.slice.call(a,0))
}else{
r.push(a)
}
}
return r
},
copyTo:function(dest,source,names){
if(typeof names=='string'){
names=names.split(/[,;\s]/)
}
Ext.each(names,function(name){
if(source.hasOwnProperty(name)){
dest[name]=source[name]
}
},this);
return dest
},
destroy:function(){
Ext.each(arguments,function(arg){
if(arg){
if(Ext.isArray(arg)){
this.destroy.apply(this,arg)
}else if(typeof arg.destroy=='function'){
arg.destroy()
}else if(arg.dom){
arg.remove()
}
}
},this)
},
destroyMembers:function(o,arg1,arg2,etc){
for(var i=1,a=arguments,len=a.length;i<len;i++){
Ext.destroy(o[a[i]]);
delete o[a[i]]
}
},
clean:function(arr){
var ret=[];
Ext.each(arr,function(v){
if(!!v){
ret.push(v)
}
});
return ret
},
unique:function(arr){
var ret=[],collect={};
Ext.each(arr,function(v){
if(!collect[v]){
ret.push(v)
}
collect[v]=true
});
return ret
},
flatten:function(arr){
var worker=[];
function rFlatten(a){
Ext.each(a,function(v){
if(Ext.isArray(v)){
rFlatten(v)
}else{
worker.push(v)
}
});
return worker
}
return rFlatten(arr)
},
min:function(arr,comp){
var ret=arr[0];
comp=comp||function(a,b){
return a<b?-1:1
};
Ext.each(arr,function(v){
ret=comp(ret,v)==-1?ret:v
});
return ret
},
max:function(arr,comp){
var ret=arr[0];
comp=comp||function(a,b){
return a>b?1:-1
};
Ext.each(arr,function(v){
ret=comp(ret,v)==1?ret:v
});
return ret
},
mean:function(arr){
return arr.length>0?Ext.sum(arr)/arr.length:undefined
},
sum:function(arr){
var ret=0;
Ext.each(arr,function(v){
ret+=v
});
return ret
},
partition:function(arr,truth){
var ret=[
[],
[]
];
Ext.each(arr,function(v,i,a){
ret[truth&&truth(v,i,a)||!truth&&v?0:1].push(v)
});
return ret
},
invoke:function(arr,methodName){
var ret=[],args=Array.prototype.slice.call(arguments,2);
Ext.each(arr,function(v,i){
if(v&&typeof v[methodName]=='function'){
ret.push(v[methodName].apply(v,args))
}else{
ret.push(undefined)
}
});
return ret
},
pluck:function(arr,prop){
var ret=[];
Ext.each(arr,function(v){
ret.push(v[prop])
});
return ret
},
zip:function(){
var parts=Ext.partition(arguments,function(val){
return typeof val!='function'
}),arrs=parts[0],fn=parts[1][0],len=Ext.max(Ext.pluck(arrs,'length')),ret=[];
for(var i=0;i<len;i++){
ret[i]=[];
if(fn){
ret[i]=fn.apply(fn,Ext.pluck(arrs,i))
}else{
for(var j=0,aLen=arrs.length;j<aLen;j++){
ret[i].push(arrs[j][i])
}
}
}
return ret
},
getCmp:function(id){
return Ext.ComponentMgr.get(id)
},
useShims:E.isIE6||E.isMac&&E.isGecko2,
type:function(o){
if(o===undefined||o===null){
return false
}
if(o.htmlElement){
return'element'
}
var t=typeof o;
if(t=='object'&&o.nodeName){
switch(o.nodeType){
case 1:
return'element';
case 3:
return/\S/.test(o.nodeValue)?'textnode':'whitespace'
}
}
if(t=='object'||t=='function'){
switch(o.constructor){
case Array:
return'array';
case RegExp:
return'regexp';
case Date:
return'date'
}
if(typeof o.length=='number'&&typeof o.item=='function'){
return'nodelist'
}
}
return t
},
intercept:function(o,name,fn,scope){
o[name]=o[name].createInterceptor(fn,scope)
},
callback:function(cb,scope,args,delay){
if(typeof cb=='function'){
if(delay){
cb.defer(delay,scope,args||[])
}else{
cb.apply(scope,args||[])
}
}
}
}
}());
Ext.apply(Function.prototype,{
createSequence:function(fcn,scope){
var method=this;
return typeof fcn!='function'?this:function(){
var retval=method.apply(this||window,arguments);
fcn.apply(scope||this||window,arguments);
return retval
}
}
});
Ext.applyIf(String,{
escape:function(string){
return string.replace(/('|\\)/g,'\\$1')
},
leftPad:function(val,size,ch){
var result=String(val);
if(!ch){
ch=' '
}
while(result.length<size){
result=ch+result
}
return result
}
});
String.prototype.toggle=function(value,other){
return this==value?other:value
};
String.prototype.trim=function(){
var re=/^\s+|\s+$/g;
return function(){
return this.replace(re,'')
}
}();
Date.prototype.getElapsed=function(date){
return Math.abs((date||new Date()).getTime()-this.getTime())
};
Ext.applyIf(Number.prototype,{
constrain:function(min,max){
return Math.min(Math.max(this,min),max)
}
});
Ext.lib.Dom.getRegion=function(el){
return Ext.lib.Region.getRegion(el)
};
Ext.lib.Region=function(t,r,b,l){
var me=this;
me.top=t;
me[1]=t;
me.right=r;
me.bottom=b;
me.left=l;
me[0]=l
};
Ext.lib.Region.prototype={
contains:function(region){
var me=this;
return region.left>=me.left&&region.right<=me.right&&region.top>=me.top&&region.bottom<=me.bottom
},
getArea:function(){
var me=this;
return(me.bottom-me.top)*(me.right-me.left)
},
intersect:function(region){
var me=this,t=Math.max(me.top,region.top),r=Math.min(me.right,region.right),b=Math.min(me.bottom,region.bottom),l=Math.max(me.left,region.left);
if(b>=t&&r>=l){
return new Ext.lib.Region(t,r,b,l)
}
},
union:function(region){
var me=this,t=Math.min(me.top,region.top),r=Math.max(me.right,region.right),b=Math.max(me.bottom,region.bottom),l=Math.min(me.left,region.left);
return new Ext.lib.Region(t,r,b,l)
},
constrainTo:function(r){
var me=this;
me.top=me.top.constrain(r.top,r.bottom);
me.bottom=me.bottom.constrain(r.top,r.bottom);
me.left=me.left.constrain(r.left,r.right);
me.right=me.right.constrain(r.left,r.right);
return me
},
adjust:function(t,l,b,r){
var me=this;
me.top+=t;
me.left+=l;
me.right+=r;
me.bottom+=b;
return me
}
};
Ext.lib.Region.getRegion=function(el){
var p=Ext.lib.Dom.getXY(el),t=p[1],r=p[0]+el.offsetWidth,b=p[1]+el.offsetHeight,l=p[0];
return new Ext.lib.Region(t,r,b,l)
};
Ext.lib.Point=function(x,y){
if(Ext.isArray(x)){
y=x[1];
x=x[0]
}
var me=this;
me.x=me.right=me.left=me[0]=x;
me.y=me.top=me.bottom=me[1]=y
};
Ext.lib.Point.prototype=new Ext.lib.Region;
Ext.apply(Ext.DomHelper,function(){
var pub,afterbegin='afterbegin',afterend='afterend',beforebegin='beforebegin',beforeend='beforeend',confRe=/tag|children|cn|html$/i;
function doInsert(el,o,returnElement,pos,sibling,append){
el=Ext.getDom(el);
var newNode;
if(pub.useDom){
newNode=createDom(o,null);
if(append){
el.appendChild(newNode)
}else{
(sibling=='firstChild'?el:el.parentNode).insertBefore(newNode,el[sibling]||el)
}
}else{
newNode=Ext.DomHelper.insertHtml(pos,el,Ext.DomHelper.createHtml(o))
}
return returnElement?Ext.get(newNode,true):newNode
}
function createDom(o,parentNode){
var el,doc=document,useSet,attr,val,cn;
if(Ext.isArray(o)){
el=doc.createDocumentFragment();
for(var i=0,l=o.length;i<l;i++){
createDom(o[i],el)
}
}else if(typeof o=='string'){
el=doc.createTextNode(o)
}else{
el=doc.createElement(o.tag||'div');
useSet=!!el.setAttribute;
for(var attr in o){
if(!confRe.test(attr)){
val=o[attr];
if(attr=='cls'){
el.className=val
}else{
if(useSet){
el.setAttribute(attr,val)
}else{
el[attr]=val
}
}
}
}
Ext.DomHelper.applyStyles(el,o.style);
if(cn=o.children||o.cn){
createDom(cn,el)
}else if(o.html){
el.innerHTML=o.html
}
}
if(parentNode){
parentNode.appendChild(el)
}
return el
}
pub={
createTemplate:function(o){
var html=Ext.DomHelper.createHtml(o);
return new Ext.Template(html)
},
useDom:false,
insertBefore:function(el,o,returnElement){
return doInsert(el,o,returnElement,beforebegin)
},
insertAfter:function(el,o,returnElement){
return doInsert(el,o,returnElement,afterend,'nextSibling')
},
insertFirst:function(el,o,returnElement){
return doInsert(el,o,returnElement,afterbegin,'firstChild')
},
append:function(el,o,returnElement){
return doInsert(el,o,returnElement,beforeend,'',true)
},
createDom:createDom
};
return pub
}());
Ext.apply(Ext.Template.prototype,{
disableFormats:false,
re:/\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,
argsRe:/^\s*['"](.*)["']\s*$/,
compileARe:/\\/g,
compileBRe:/(\r\n|\n)/g,
compileCRe:/'/g,
applyTemplate:function(values){
var me=this,useF=me.disableFormats!==true,fm=Ext.util.Format,tpl=me;
if(me.compiled){
return me.compiled(values)
}
function fn(m,name,format,args){
if(format&&useF){
if(format.substr(0,5)=='this.'){
return tpl.call(format.substr(5),values[name],values)
}else{
if(args){
var re=me.argsRe;
args=args.split(',');
for(var i=0,len=args.length;i<len;i++){
args[i]=args[i].replace(re,'$1')
}
args=[values[name]].concat(args)
}else{
args=[values[name]]
}
return fm[format].apply(fm,args)
}
}else{
return values[name]!==undefined?values[name]:''
}
}
return me.html.replace(me.re,fn)
},
compile:function(){
var me=this,fm=Ext.util.Format,useF=me.disableFormats!==true,sep=Ext.isGecko?'+':',',body;
function fn(m,name,format,args){
if(format&&useF){
args=args?','+args:'';
if(format.substr(0,5)!='this.'){
format='fm.'+format+'('
}else{
format='this.call("'+format.substr(5)+'", ';
args=', values'
}
}else{
args='';
format='(values[\''+name+'\'] == undefined ? \'\' : '
}
return'\''+sep+format+'values[\''+name+'\']'+args+')'+sep+'\''
}
if(Ext.isGecko){
body='this.compiled = function(values){ return \''+me.html.replace(me.compileARe,'\\\\').replace(me.compileBRe,'\\n').replace(me.compileCRe,'\\\'').replace(me.re,fn)+'\';};'
}else{
body=['this.compiled = function(values){ return [\''];
body.push(me.html.replace(me.compileARe,'\\\\').replace(me.compileBRe,'\\n').replace(me.compileCRe,'\\\'').replace(me.re,fn));
body.push('\'].join(\'\');};');
body=body.join('')
}
eval(body);
return me
},
call:function(fnName,value,allValues){
return this[fnName](value,allValues)
}
});
Ext.Template.prototype.apply=Ext.Template.prototype.applyTemplate;
Ext.util.Functions={
createInterceptor:function(origFn,newFn,scope){
var method=origFn;
if(!Ext.isFunction(newFn)){
return origFn
}else{
return function(){
var me=this,args=arguments;
newFn.target=me;
newFn.method=origFn;
return newFn.apply(scope||me||window,args)!==false?origFn.apply(me||window,args):null
}
}
},
createDelegate:function(fn,obj,args,appendArgs){
if(!Ext.isFunction(fn)){
return fn
}
return function(){
var callArgs=args||arguments;
if(appendArgs===true){
callArgs=Array.prototype.slice.call(arguments,0);
callArgs=callArgs.concat(args)
}else if(Ext.isNumber(appendArgs)){
callArgs=Array.prototype.slice.call(arguments,0);
var applyArgs=[
appendArgs,
0
].concat(args);
Array.prototype.splice.apply(callArgs,applyArgs)
}
return fn.apply(obj||window,callArgs)
}
},
defer:function(fn,millis,obj,args,appendArgs){
fn=Ext.util.Functions.createDelegate(fn,obj,args,appendArgs);
if(millis>0){
return setTimeout(fn,millis)
}
fn();
return 0
},
createSequence:function(origFn,newFn,scope){
if(!Ext.isFunction(newFn)){
return origFn
}else{
return function(){
var retval=origFn.apply(this||window,arguments);
newFn.apply(scope||this||window,arguments);
return retval
}
}
}
};
Ext.defer=Ext.util.Functions.defer;
Ext.createInterceptor=Ext.util.Functions.createInterceptor;
Ext.createSequence=Ext.util.Functions.createSequence;
Ext.createDelegate=Ext.util.Functions.createDelegate;
Ext.apply(Ext.util.Observable.prototype,function(){
function getMethodEvent(method){
var e=(this.methodEvents=this.methodEvents||{})[method],returnValue,v,cancel,obj=this;
if(!e){
this.methodEvents[method]=e={};
e.originalFn=this[method];
e.methodName=method;
e.before=[];
e.after=[];
var makeCall=function(fn,scope,args){
if((v=fn.apply(scope||obj,args))!==undefined){
if(typeof v=='object'){
if(v.returnValue!==undefined){
returnValue=v.returnValue
}else{
returnValue=v
}
cancel=!!v.cancel
}else if(v===false){
cancel=true
}else{
returnValue=v
}
}
};
this[method]=function(){
var args=Array.prototype.slice.call(arguments,0),b;
returnValue=v=undefined;
cancel=false;
for(var i=0,len=e.before.length;i<len;i++){
b=e.before[i];
makeCall(b.fn,b.scope,args);
if(cancel){
return returnValue
}
}
if((v=e.originalFn.apply(obj,args))!==undefined){
returnValue=v
}
for(var i=0,len=e.after.length;i<len;i++){
b=e.after[i];
makeCall(b.fn,b.scope,args);
if(cancel){
return returnValue
}
}
return returnValue
}
}
return e
}
return{
beforeMethod:function(method,fn,scope){
getMethodEvent.call(this,method).before.push({
fn:fn,
scope:scope
})
},
afterMethod:function(method,fn,scope){
getMethodEvent.call(this,method).after.push({
fn:fn,
scope:scope
})
},
removeMethodListener:function(method,fn,scope){
var e=this.getMethodEvent(method);
for(var i=0,len=e.before.length;i<len;i++){
if(e.before[i].fn==fn&&e.before[i].scope==scope){
e.before.splice(i,1);
return
}
}
for(var i=0,len=e.after.length;i<len;i++){
if(e.after[i].fn==fn&&e.after[i].scope==scope){
e.after.splice(i,1);
return
}
}
},
relayEvents:function(o,events){
var me=this;
function createHandler(ename){
return function(){
return me.fireEvent.apply(me,[ename].concat(Array.prototype.slice.call(arguments,0)))
}
}
for(var i=0,len=events.length;i<len;i++){
var ename=events[i];
me.events[ename]=me.events[ename]||true;
o.on(ename,createHandler(ename),me)
}
},
enableBubble:function(events){
var me=this;
if(!Ext.isEmpty(events)){
events=Ext.isArray(events)?events:Array.prototype.slice.call(arguments,0);
for(var i=0,len=events.length;i<len;i++){
var ename=events[i];
ename=ename.toLowerCase();
var ce=me.events[ename]||true;
if(typeof ce=='boolean'){
ce=new Ext.util.Event(me,ename);
me.events[ename]=ce
}
ce.bubble=true
}
}
}
}
}());
Ext.util.Observable.capture=function(o,fn,scope){
o.fireEvent=o.fireEvent.createInterceptor(fn,scope)
};
Ext.util.Observable.observeClass=function(c,listeners){
if(c){
if(!c.fireEvent){
Ext.apply(c,new Ext.util.Observable);
Ext.util.Observable.capture(c.prototype,c.fireEvent,c)
}
if(typeof listeners=='object'){
c.on(listeners)
}
return c
}
};
Ext.apply(Ext.EventManager,function(){
var resizeEvent,resizeTask,textEvent,textSize,D=Ext.lib.Dom,propRe=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,unload=Ext.EventManager._unload,curWidth=0,curHeight=0,useKeydown=Ext.isWebKit?Ext.num(navigator.userAgent.match(/AppleWebKit\/(\d+)/)[1])>=525:!(Ext.isGecko&&!Ext.isWindows||Ext.isOpera);
return{
_unload:function(){
Ext.EventManager.un(window,'resize',this.fireWindowResize,this);
unload.call(Ext.EventManager)
},
doResizeEvent:function(){
var h=D.getViewHeight(),w=D.getViewWidth();
if(curHeight!=h||curWidth!=w){
resizeEvent.fire(curWidth=w,curHeight=h)
}
},
onWindowResize:function(fn,scope,options){
if(!resizeEvent){
resizeEvent=new Ext.util.Event;
resizeTask=new Ext.util.DelayedTask(this.doResizeEvent);
Ext.EventManager.on(window,'resize',this.fireWindowResize,this)
}
resizeEvent.addListener(fn,scope,options)
},
fireWindowResize:function(){
if(resizeEvent){
resizeTask.delay(100)
}
},
onTextResize:function(fn,scope,options){
if(!textEvent){
textEvent=new Ext.util.Event;
var textEl=new Ext.Element(document.createElement('div'));
textEl.dom.className='x-text-resize';
textEl.dom.innerHTML='X';
textEl.appendTo(document.body);
textSize=textEl.dom.offsetHeight;
setInterval(function(){
if(textEl.dom.offsetHeight!=textSize){
textEvent.fire(textSize,textSize=textEl.dom.offsetHeight)
}
},this.textResizeInterval)
}
textEvent.addListener(fn,scope,options)
},
removeResizeListener:function(fn,scope){
if(resizeEvent){
resizeEvent.removeListener(fn,scope)
}
},
fireResize:function(){
if(resizeEvent){
resizeEvent.fire(D.getViewWidth(),D.getViewHeight())
}
},
textResizeInterval:50,
ieDeferSrc:false,
getKeyEvent:function(){
return useKeydown?'keydown':'keypress'
},
useKeydown:useKeydown
}
}());
Ext.EventManager.on=Ext.EventManager.addListener;
Ext.apply(Ext.EventObjectImpl.prototype,{
BACKSPACE:8,
TAB:9,
NUM_CENTER:12,
ENTER:13,
RETURN:13,
SHIFT:16,
CTRL:17,
CONTROL:17,
ALT:18,
PAUSE:19,
CAPS_LOCK:20,
ESC:27,
SPACE:32,
PAGE_UP:33,
PAGEUP:33,
PAGE_DOWN:34,
PAGEDOWN:34,
END:35,
HOME:36,
LEFT:37,
UP:38,
RIGHT:39,
DOWN:40,
PRINT_SCREEN:44,
INSERT:45,
DELETE:46,
ZERO:48,
ONE:49,
TWO:50,
THREE:51,
FOUR:52,
FIVE:53,
SIX:54,
SEVEN:55,
EIGHT:56,
NINE:57,
A:65,
B:66,
C:67,
D:68,
E:69,
F:70,
G:71,
H:72,
I:73,
J:74,
K:75,
L:76,
M:77,
N:78,
O:79,
P:80,
Q:81,
R:82,
S:83,
T:84,
U:85,
V:86,
W:87,
X:88,
Y:89,
Z:90,
CONTEXT_MENU:93,
NUM_ZERO:96,
NUM_ONE:97,
NUM_TWO:98,
NUM_THREE:99,
NUM_FOUR:100,
NUM_FIVE:101,
NUM_SIX:102,
NUM_SEVEN:103,
NUM_EIGHT:104,
NUM_NINE:105,
NUM_MULTIPLY:106,
NUM_PLUS:107,
NUM_MINUS:109,
NUM_PERIOD:110,
NUM_DIVISION:111,
F1:112,
F2:113,
F3:114,
F4:115,
F5:116,
F6:117,
F7:118,
F8:119,
F9:120,
F10:121,
F11:122,
F12:123,
isNavKeyPress:function(){
var me=this,k=this.normalizeKey(me.keyCode);
return k>=33&&k<=40||k==me.RETURN||k==me.TAB||k==me.ESC
},
isSpecialKey:function(){
var k=this.normalizeKey(this.keyCode);
return this.type=='keypress'&&this.ctrlKey||this.isNavKeyPress()||k==this.BACKSPACE||k>=16&&k<=20||k>=44&&k<=46
},
getPoint:function(){
return new Ext.lib.Point(this.xy[0],this.xy[1])
},
hasModifier:function(){
return this.ctrlKey||this.altKey||this.shiftKey
}
});
Ext.Element.addMethods({
swallowEvent:function(eventName,preventDefault){
var me=this;
function fn(e){
e.stopPropagation();
if(preventDefault){
e.preventDefault()
}
}
if(Ext.isArray(eventName)){
Ext.each(eventName,function(e){
me.on(e,fn)
});
return me
}
me.on(eventName,fn);
return me
},
relayEvent:function(eventName,observable){
this.on(eventName,function(e){
observable.fireEvent(eventName,e)
})
},
clean:function(forceReclean){
var me=this,dom=me.dom,n=dom.firstChild,ni=-1;
if(Ext.Element.data(dom,'isCleaned')&&forceReclean!==true){
return me
}
while(n){
var nx=n.nextSibling;
if(n.nodeType==3&&!/\S/.test(n.nodeValue)){
dom.removeChild(n)
}else{
n.nodeIndex=++ni
}
n=nx
}
Ext.Element.data(dom,'isCleaned',true);
return me
},
load:function(){
var updateManager=this.getUpdater();
updateManager.update.apply(updateManager,arguments);
return this
},
getUpdater:function(){
return this.updateManager||(this.updateManager=new Ext.Updater(this))
},
update:function(html,loadScripts,callback){
if(!this.dom){
return this
}
html=html||'';
if(loadScripts!==true){
this.dom.innerHTML=html;
if(typeof callback=='function'){
callback()
}
return this
}
var id=Ext.id(),dom=this.dom;
html+='<span id="'+id+'"></span>';
Ext.lib.Event.onAvailable(id,function(){
var DOC=document,hd=DOC.getElementsByTagName('head')[0],re=/(?:<script([^>]*)?>)((\n|\r|.)*?)(?:<\/script>)/gi,srcRe=/\ssrc=([\'\"])(.*?)\1/i,typeRe=/\stype=([\'\"])(.*?)\1/i,match,attrs,srcMatch,typeMatch,el,s;
while(match=re.exec(html)){
attrs=match[1];
srcMatch=attrs?attrs.match(srcRe):false;
if(srcMatch&&srcMatch[2]){
s=DOC.createElement('script');
s.src=srcMatch[2];
typeMatch=attrs.match(typeRe);
if(typeMatch&&typeMatch[2]){
s.type=typeMatch[2]
}
hd.appendChild(s)
}else if(match[2]&&match[2].length>0){
if(window.execScript){
window.execScript(match[2])
}else{
window.eval(match[2])
}
}
}
el=DOC.getElementById(id);
if(el){
Ext.removeNode(el)
}
if(typeof callback=='function'){
callback()
}
});
dom.innerHTML=html.replace(/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/gi,'');
return this
},
removeAllListeners:function(){
this.removeAnchor();
Ext.EventManager.removeAll(this.dom);
return this
},
createProxy:function(config,renderTo,matchBox){
config=typeof config=='object'?config:{
tag:'div',
cls:config
};
var me=this,proxy=renderTo?Ext.DomHelper.append(renderTo,config,true):Ext.DomHelper.insertBefore(me.dom,config,true);
if(matchBox&&me.setBox&&me.getBox){
proxy.setBox(me.getBox())
}
return proxy
}
});
Ext.Element.prototype.getUpdateManager=Ext.Element.prototype.getUpdater;
Ext.Element.addMethods({
getAnchorXY:function(anchor,local,s){
anchor=(anchor||'tl').toLowerCase();
s=s||{};
var me=this,vp=me.dom==document.body||me.dom==document,w=s.width||vp?Ext.lib.Dom.getViewWidth():me.getWidth(),h=s.height||vp?Ext.lib.Dom.getViewHeight():me.getHeight(),xy,r=Math.round,o=me.getXY(),scroll=me.getScroll(),extraX=vp?scroll.left:!local?o[0]:0,extraY=vp?scroll.top:!local?o[1]:0,hash={
c:[
r(w*0.5),
r(h*0.5)
],
t:[
r(w*0.5),
0
],
l:[
0,
r(h*0.5)
],
r:[
w,
r(h*0.5)
],
b:[
r(w*0.5),
h
],
tl:[
0,
0
],
bl:[
0,
h
],
br:[
w,
h
],
tr:[
w,
0
]
};
xy=hash[anchor];
return[
xy[0]+extraX,
xy[1]+extraY
]
},
anchorTo:function(el,alignment,offsets,animate,monitorScroll,callback){
var me=this,dom=me.dom,scroll=!Ext.isEmpty(monitorScroll),action=function(){
Ext.fly(dom).alignTo(el,alignment,offsets,animate);
Ext.callback(callback,Ext.fly(dom))
},anchor=this.getAnchor();
this.removeAnchor();
Ext.apply(anchor,{
fn:action,
scroll:scroll
});
Ext.EventManager.onWindowResize(action,null);
if(scroll){
Ext.EventManager.on(window,'scroll',action,null,{buffer:!isNaN(monitorScroll)?monitorScroll:50})
}
action.call(me);
return me
},
removeAnchor:function(){
var me=this,anchor=this.getAnchor();
if(anchor&&anchor.fn){
Ext.EventManager.removeResizeListener(anchor.fn);
if(anchor.scroll){
Ext.EventManager.un(window,'scroll',anchor.fn)
}
delete anchor.fn
}
return me
},
getAnchor:function(){
var data=Ext.Element.data,dom=this.dom;
if(!dom){
return
}
var anchor=data(dom,'_anchor');
if(!anchor){
anchor=data(dom,'_anchor',{})
}
return anchor
},
getAlignToXY:function(el,p,o){
el=Ext.get(el);
if(!el||!el.dom){
throw'Element.alignToXY with an element that doesn\'t exist'
}
o=o||[
0,
0
];
p=(!p||p=='?'?'tl-bl?':!/-/.test(p)&&p!==''?'tl-'+p:p||'tl-bl').toLowerCase();
var me=this,d=me.dom,a1,a2,x,y,w,h,r,dw=Ext.lib.Dom.getViewWidth()-10,dh=Ext.lib.Dom.getViewHeight()-10,p1y,p1x,p2y,p2x,swapY,swapX,doc=document,docElement=doc.documentElement,docBody=doc.body,scrollX=(docElement.scrollLeft||docBody.scrollLeft||0)+5,scrollY=(docElement.scrollTop||docBody.scrollTop||0)+5,c=false,p1='',p2='',m=p.match(/^([a-z]+)-([a-z]+)(\?)?$/);
if(!m){
throw'Element.alignTo with an invalid alignment '+p
}
p1=m[1];
p2=m[2];
c=!!m[3];
a1=me.getAnchorXY(p1,true);
a2=el.getAnchorXY(p2,false);
x=a2[0]-a1[0]+o[0];
y=a2[1]-a1[1]+o[1];
if(c){
w=me.getWidth();
h=me.getHeight();
r=el.getRegion();
p1y=p1.charAt(0);
p1x=p1.charAt(p1.length-1);
p2y=p2.charAt(0);
p2x=p2.charAt(p2.length-1);
swapY=p1y=='t'&&p2y=='b'||p1y=='b'&&p2y=='t';
swapX=p1x=='r'&&p2x=='l'||p1x=='l'&&p2x=='r';
if(x+w>dw+scrollX){
x=swapX?r.left-w:dw+scrollX-w
}
if(x<scrollX){
x=swapX?r.right:scrollX
}
if(y+h>dh+scrollY){
y=swapY?r.top-h:dh+scrollY-h
}
if(y<scrollY){
y=swapY?r.bottom:scrollY
}
}
return[
x,
y
]
},
alignTo:function(element,position,offsets,animate){
var me=this;
return me.setXY(me.getAlignToXY(element,position,offsets),me.preanim&&!!animate?me.preanim(arguments,3):false)
},
adjustForConstraints:function(xy,parent,offsets){
return this.getConstrainToXY(parent||document,false,offsets,xy)||xy
},
getConstrainToXY:function(el,local,offsets,proposedXY){
var os={
top:0,
left:0,
bottom:0,
right:0
};
return function(el,local,offsets,proposedXY){
el=Ext.get(el);
offsets=offsets?Ext.applyIf(offsets,os):os;
var vw,vh,vx=0,vy=0;
if(el.dom==document.body||el.dom==document){
vw=Ext.lib.Dom.getViewWidth();
vh=Ext.lib.Dom.getViewHeight()
}else{
vw=el.dom.clientWidth;
vh=el.dom.clientHeight;
if(!local){
var vxy=el.getXY();
vx=vxy[0];
vy=vxy[1]
}
}
var s=el.getScroll();
vx+=offsets.left+s.left;
vy+=offsets.top+s.top;
vw-=offsets.right;
vh-=offsets.bottom;
var vr=vx+vw,vb=vy+vh,xy=proposedXY||(!local?this.getXY():[
this.getLeft(true),
this.getTop(true)
]),x=xy[0],y=xy[1],offset=this.getConstrainOffset(),w=this.dom.offsetWidth+offset,h=this.dom.offsetHeight+offset;
var moved=false;
if(x+w>vr){
x=vr-w;
moved=true
}
if(y+h>vb){
y=vb-h;
moved=true
}
if(x<vx){
x=vx;
moved=true
}
if(y<vy){
y=vy;
moved=true
}
return moved?[
x,
y
]:false
}
}(),
getConstrainOffset:function(){
return 0
},
getCenterXY:function(){
return this.getAlignToXY(document,'c-c')
},
center:function(centerIn){
return this.alignTo(centerIn||document,'c-c')
}
});
Ext.Element.addMethods({
select:function(selector,unique){
return Ext.Element.select(selector,unique,this.dom)
}
});
Ext.apply(Ext.Element.prototype,function(){
var GETDOM=Ext.getDom,GET=Ext.get,DH=Ext.DomHelper;
return{
insertSibling:function(el,where,returnDom){
var me=this,rt,isAfter=(where||'before').toLowerCase()=='after',insertEl;
if(Ext.isArray(el)){
insertEl=me;
Ext.each(el,function(e){
rt=Ext.fly(insertEl,'_internal').insertSibling(e,where,returnDom);
if(isAfter){
insertEl=rt
}
});
return rt
}
el=el||{};
if(el.nodeType||el.dom){
rt=me.dom.parentNode.insertBefore(GETDOM(el),isAfter?me.dom.nextSibling:me.dom);
if(!returnDom){
rt=GET(rt)
}
}else{
if(isAfter&&!me.dom.nextSibling){
rt=DH.append(me.dom.parentNode,el,!returnDom)
}else{
rt=DH[isAfter?'insertAfter':'insertBefore'](me.dom,el,!returnDom)
}
}
return rt
}
}
}());
Ext.Element.boxMarkup=[
'<div class="{0}-tc"></div>',
'<div class="{0}-mc"></div>',
'<div class="{0}-bc"></div>'
].join('');
Ext.Element.addMethods(function(){
var INTERNAL='_internal',pxMatch=/(\d+\.?\d+)px/;
return{
applyStyles:function(style){
Ext.DomHelper.applyStyles(this.dom,style);
return this
},
getStyles:function(){
var ret={};
Ext.each(arguments,function(v){
ret[v]=this.getStyle(v)
},this);
return ret
},
setOverflow:function(v){
var dom=this.dom;
if(v=='auto'&&Ext.isMac&&Ext.isGecko2){
dom.style.overflow='hidden';
(function(){
dom.style.overflow='auto'
}.defer(1))
}else{
dom.style.overflow=v
}
},
boxWrap:function(cls){
cls=cls||'x-box';
var el=Ext.get(this.insertHtml('beforeBegin','<div class=\''+cls+'\'>'+String.format(Ext.Element.boxMarkup,cls)+'</div>'));
Ext.DomQuery.selectNode('.'+cls+'-mc',el.dom).appendChild(this.dom);
return el
},
setSize:function(width,height,animate){
var me=this;
if(typeof width=='object'){
height=width.height;
width=width.width
}
width=me.adjustWidth(width);
height=me.adjustHeight(height);
if(!animate||!me.anim){
me.dom.style.width=me.addUnits(width);
me.dom.style.height=me.addUnits(height)
}else{
me.anim({
width:{to:width},
height:{to:height}
},me.preanim(arguments,2))
}
return me
},
getComputedHeight:function(){
var me=this,h=Math.max(me.dom.offsetHeight,me.dom.clientHeight);
if(!h){
h=parseFloat(me.getStyle('height'))||0;
if(!me.isBorderBox()){
h+=me.getFrameWidth('tb')
}
}
return h
},
getComputedWidth:function(){
var w=Math.max(this.dom.offsetWidth,this.dom.clientWidth);
if(!w){
w=parseFloat(this.getStyle('width'))||0;
if(!this.isBorderBox()){
w+=this.getFrameWidth('lr')
}
}
return w
},
getFrameWidth:function(sides,onlyContentBox){
return onlyContentBox&&this.isBorderBox()?0:this.getPadding(sides)+this.getBorderWidth(sides)
},
addClassOnOver:function(className){
this.hover(function(){
Ext.fly(this,INTERNAL).addClass(className)
},function(){
Ext.fly(this,INTERNAL).removeClass(className)
});
return this
},
addClassOnFocus:function(className){
this.on('focus',function(){
Ext.fly(this,INTERNAL).addClass(className)
},this.dom);
this.on('blur',function(){
Ext.fly(this,INTERNAL).removeClass(className)
},this.dom);
return this
},
addClassOnClick:function(className){
var dom=this.dom;
this.on('mousedown',function(){
Ext.fly(dom,INTERNAL).addClass(className);
var d=Ext.getDoc(),fn=function(){
Ext.fly(dom,INTERNAL).removeClass(className);
d.removeListener('mouseup',fn)
};
d.on('mouseup',fn)
});
return this
},
getViewSize:function(){
var doc=document,d=this.dom,isDoc=d==doc||d==doc.body;
if(isDoc){
var extdom=Ext.lib.Dom;
return{
width:extdom.getViewWidth(),
height:extdom.getViewHeight()
}
}else{
return{
width:d.clientWidth,
height:d.clientHeight
}
}
},
getStyleSize:function(){
var me=this,w,h,doc=document,d=this.dom,isDoc=d==doc||d==doc.body,s=d.style;
if(isDoc){
var extdom=Ext.lib.Dom;
return{
width:extdom.getViewWidth(),
height:extdom.getViewHeight()
}
}
if(s.width&&s.width!='auto'){
w=parseFloat(s.width);
if(me.isBorderBox()){
w-=me.getFrameWidth('lr')
}
}
if(s.height&&s.height!='auto'){
h=parseFloat(s.height);
if(me.isBorderBox()){
h-=me.getFrameWidth('tb')
}
}
return{
width:w||me.getWidth(true),
height:h||me.getHeight(true)
}
},
getSize:function(contentSize){
return{
width:this.getWidth(contentSize),
height:this.getHeight(contentSize)
}
},
repaint:function(){
var dom=this.dom;
this.addClass('x-repaint');
setTimeout(function(){
Ext.fly(dom).removeClass('x-repaint')
},1);
return this
},
unselectable:function(){
this.dom.unselectable='on';
return this.swallowEvent('selectstart',true).applyStyles('-moz-user-select:none;-khtml-user-select:none;').addClass('x-unselectable')
},
getMargins:function(side){
var me=this,key,hash={
t:'top',
l:'left',
r:'right',
b:'bottom'
},o={};
if(!side){
for(key in me.margins){
o[hash[key]]=parseFloat(me.getStyle(me.margins[key]))||0
}
return o
}else{
return me.addStyles.call(me,side,me.margins)
}
}
}
}());
Ext.Element.addMethods({
setBox:function(box,adjust,animate){
var me=this,w=box.width,h=box.height;
if(adjust&&!me.autoBoxAdjust&&!me.isBorderBox()){
w-=me.getBorderWidth('lr')+me.getPadding('lr');
h-=me.getBorderWidth('tb')+me.getPadding('tb')
}
me.setBounds(box.x,box.y,w,h,me.animTest.call(me,arguments,animate,2));
return me
},
getBox:function(contentBox,local){
var me=this,xy,left,top,getBorderWidth=me.getBorderWidth,getPadding=me.getPadding,l,r,t,b;
if(!local){
xy=me.getXY()
}else{
left=parseInt(me.getStyle('left'),10)||0;
top=parseInt(me.getStyle('top'),10)||0;
xy=[
left,
top
]
}
var el=me.dom,w=el.offsetWidth,h=el.offsetHeight,bx;
if(!contentBox){
bx={
x:xy[0],
y:xy[1],
0:xy[0],
1:xy[1],
width:w,
height:h
}
}else{
l=getBorderWidth.call(me,'l')+getPadding.call(me,'l');
r=getBorderWidth.call(me,'r')+getPadding.call(me,'r');
t=getBorderWidth.call(me,'t')+getPadding.call(me,'t');
b=getBorderWidth.call(me,'b')+getPadding.call(me,'b');
bx={
x:xy[0]+l,
y:xy[1]+t,
0:xy[0]+l,
1:xy[1]+t,
width:w-(l+r),
height:h-(t+b)
}
}
bx.right=bx.x+bx.width;
bx.bottom=bx.y+bx.height;
return bx
},
move:function(direction,distance,animate){
var me=this,xy=me.getXY(),x=xy[0],y=xy[1],left=[
x-distance,
y
],right=[
x+distance,
y
],top=[
x,
y-distance
],bottom=[
x,
y+distance
],hash={
l:left,
left:left,
r:right,
right:right,
t:top,
top:top,
up:top,
b:bottom,
bottom:bottom,
down:bottom
};
direction=direction.toLowerCase();
me.moveTo(hash[direction][0],hash[direction][1],me.animTest.call(me,arguments,animate,2))
},
setLeftTop:function(left,top){
var me=this,style=me.dom.style;
style.left=me.addUnits(left);
style.top=me.addUnits(top);
return me
},
getRegion:function(){
return Ext.lib.Dom.getRegion(this.dom)
},
setBounds:function(x,y,width,height,animate){
var me=this;
if(!animate||!me.anim){
me.setSize(width,height);
me.setLocation(x,y)
}else{
me.anim({
points:{
to:[
x,
y
]
},
width:{to:me.adjustWidth(width)},
height:{to:me.adjustHeight(height)}
},me.preanim(arguments,4),'motion')
}
return me
},
setRegion:function(region,animate){
return this.setBounds(region.left,region.top,region.right-region.left,region.bottom-region.top,this.animTest.call(this,arguments,animate,1))
}
});
Ext.Element.addMethods({
scrollTo:function(side,value,animate){
var top=/top/i.test(side),me=this,dom=me.dom,prop;
if(!animate||!me.anim){
prop='scroll'+(top?'Top':'Left');
dom[prop]=value
}else{
prop='scroll'+(top?'Left':'Top');
me.anim({
scroll:{
to:top?[
dom[prop],
value
]:[
value,
dom[prop]
]
}
},me.preanim(arguments,2),'scroll')
}
return me
},
scrollIntoView:function(container,hscroll){
var c=Ext.getDom(container)||Ext.getBody().dom,el=this.dom,o=this.getOffsetsTo(c),l=o[0]+c.scrollLeft,t=o[1]+c.scrollTop,b=t+el.offsetHeight,r=l+el.offsetWidth,ch=c.clientHeight,ct=parseInt(c.scrollTop,10),cl=parseInt(c.scrollLeft,10),cb=ct+ch,cr=cl+c.clientWidth;
if(el.offsetHeight>ch||t<ct){
c.scrollTop=t
}else if(b>cb){
c.scrollTop=b-ch
}
c.scrollTop=c.scrollTop;
if(hscroll!==false){
if(el.offsetWidth>c.clientWidth||l<cl){
c.scrollLeft=l
}else if(r>cr){
c.scrollLeft=r-c.clientWidth
}
c.scrollLeft=c.scrollLeft
}
return this
},
scrollChildIntoView:function(child,hscroll){
Ext.fly(child,'_scrollChildIntoView').scrollIntoView(this,hscroll)
},
scroll:function(direction,distance,animate){
if(!this.isScrollable()){
return false
}
var el=this.dom,l=el.scrollLeft,t=el.scrollTop,w=el.scrollWidth,h=el.scrollHeight,cw=el.clientWidth,ch=el.clientHeight,scrolled=false,v,hash={
l:Math.min(l+distance,w-cw),
r:v=Math.max(l-distance,0),
t:Math.max(t-distance,0),
b:Math.min(t+distance,h-ch)
};
hash.d=hash.b;
hash.u=hash.t;
direction=direction.substr(0,1);
if((v=hash[direction])>-1){
scrolled=true;
this.scrollTo(direction=='l'||direction=='r'?'left':'top',v,this.preanim(arguments,2))
}
return scrolled
}
});
Ext.Element.addMethods(function(){
var VISIBILITY='visibility',DISPLAY='display',HIDDEN='hidden',NONE='none',XMASKED='x-masked',XMASKEDRELATIVE='x-masked-relative',data=Ext.Element.data;
return{
isVisible:function(deep){
var vis=!this.isStyle(VISIBILITY,HIDDEN)&&!this.isStyle(DISPLAY,NONE),p=this.dom.parentNode;
if(deep!==true||!vis){
return vis
}
while(p&&!/^body/i.test(p.tagName)){
if(!Ext.fly(p,'_isVisible').isVisible()){
return false
}
p=p.parentNode
}
return true
},
isDisplayed:function(){
return!this.isStyle(DISPLAY,NONE)
},
enableDisplayMode:function(display){
this.setVisibilityMode(Ext.Element.DISPLAY);
if(!Ext.isEmpty(display)){
data(this.dom,'originalDisplay',display)
}
return this
},
mask:function(msg,msgCls,noDefaultClass,noDefaultMessage){
var me=this,dom=me.dom,dh=Ext.DomHelper,EXTELMASKMSG='ext-el-mask-msg',el,mask;
if(!/^body/i.test(dom.tagName)&&me.getStyle('position')=='static'){
me.addClass(XMASKEDRELATIVE)
}
if(el=data(dom,'maskMsg')){
el.remove()
}
if(el=data(dom,'mask')){
el.remove()
}
mask=dh.append(dom,{cls:'ext-el-mask'},true);
data(dom,'mask',mask);
me.addClass(XMASKED);
mask.setDisplayed(true);
if(typeof msg=='string'){
var mm;
if(!noDefaultClass){
mm=dh.append(dom,{
cls:EXTELMASKMSG,
cn:{tag:'div'}
},true)
}else{
mm=dh.append(dom,{
cls:msgCls,
cn:{tag:'div'}
},true)
}
data(dom,'maskMsg',mm);
if(!noDefaultClass){
mm.dom.className=msgCls?EXTELMASKMSG+' '+msgCls:EXTELMASKMSG
}
if(!noDefaultMessage){
mm.dom.firstChild.innerHTML=msg
}
mm.setDisplayed(true);
mm.center(me)
}
if(Ext.isIE&&!(Ext.isIE7&&Ext.isStrict)&&me.getStyle('height')=='auto'){
mask.setSize(undefined,me.getHeight())
}
return mask
},
unmask:function(){
var me=this,dom=me.dom,mask=data(dom,'mask'),maskMsg=data(dom,'maskMsg');
if(mask){
if(maskMsg){
maskMsg.remove();
data(dom,'maskMsg',undefined)
}
mask.remove();
data(dom,'mask',undefined);
me.removeClass([
XMASKED,
XMASKEDRELATIVE
])
}
},
isMasked:function(){
var m=data(this.dom,'mask');
return m&&m.isVisible()
}
}
}());
Ext.Element.addMethods({
addKeyListener:function(key,fn,scope){
var config;
if(typeof key!='object'||Ext.isArray(key)){
config={
key:key,
fn:fn,
scope:scope
}
}else{
config={
key:key.key,
shift:key.shift,
ctrl:key.ctrl,
alt:key.alt,
fn:fn,
scope:scope
}
}
return new Ext.KeyMap(this,config)
},
addKeyMap:function(config){
return new Ext.KeyMap(this,config)
}
});
Ext.CompositeElementLite.importElementMethods();
Ext.apply(Ext.CompositeElementLite.prototype,{
addElements:function(els,root){
if(!els){
return this
}
if(typeof els=='string'){
els=Ext.Element.selectorFunction(els,root)
}
var yels=this.elements;
Ext.each(els,function(e){
yels.push(Ext.get(e))
});
return this
},
first:function(){
return this.item(0)
},
last:function(){
return this.item(this.getCount()-1)
},
contains:function(el){
return this.indexOf(el)!=-1
},
removeElement:function(keys,removeDom){
var me=this,els=this.elements,el;
Ext.each(keys,function(val){
if(el=els[val]||els[val=me.indexOf(val)]){
if(removeDom){
if(el.dom){
el.remove()
}else{
Ext.removeNode(el)
}
}
els.splice(val,1)
}
});
return this
}
});
Ext.CompositeElement=Ext.extend(Ext.CompositeElementLite,{
constructor:function(els,root){
this.elements=[];
this.add(els,root)
},
getElement:function(el){
return el
},
transformElement:function(el){
return Ext.get(el)
}
});
Ext.Element.select=function(selector,unique,root){
var els;
if(typeof selector=='string'){
els=Ext.Element.selectorFunction(selector,root)
}else if(selector.length!==undefined){
els=selector
}else{
throw'Invalid selector'
}
return unique===true?new Ext.CompositeElement(els):new Ext.CompositeElementLite(els)
};
Ext.select=Ext.Element.select;
Ext.UpdateManager=Ext.Updater=Ext.extend(Ext.util.Observable,function(){
var BEFOREUPDATE='beforeupdate',UPDATE='update',FAILURE='failure';
function processSuccess(response){
var me=this;
me.transaction=null;
if(response.argument.form&&response.argument.reset){
try{
response.argument.form.reset()
}catch(e){
}
}
if(me.loadScripts){
me.renderer.render(me.el,response,me,updateComplete.createDelegate(me,[response]))
}else{
me.renderer.render(me.el,response,me);
updateComplete.call(me,response)
}
}
function updateComplete(response,type,success){
this.fireEvent(type||UPDATE,this.el,response);
if(Ext.isFunction(response.argument.callback)){
response.argument.callback.call(response.argument.scope,this.el,Ext.isEmpty(success)?true:false,response,response.argument.options)
}
}
function processFailure(response){
updateComplete.call(this,response,FAILURE,!!(this.transaction=null))
}
return{
constructor:function(el,forceNew){
var me=this;
el=Ext.get(el);
if(!forceNew&&el.updateManager){
return el.updateManager
}
me.el=el;
me.defaultUrl=null;
me.addEvents(BEFOREUPDATE,UPDATE,FAILURE);
Ext.apply(me,Ext.Updater.defaults);
me.transaction=null;
me.refreshDelegate=me.refresh.createDelegate(me);
me.updateDelegate=me.update.createDelegate(me);
me.formUpdateDelegate=(me.formUpdate||function(){
}).createDelegate(me);
me.renderer=me.renderer||me.getDefaultRenderer();
Ext.Updater.superclass.constructor.call(me)
},
setRenderer:function(renderer){
this.renderer=renderer
},
getRenderer:function(){
return this.renderer
},
getDefaultRenderer:function(){
return new Ext.Updater.BasicRenderer
},
setDefaultUrl:function(defaultUrl){
this.defaultUrl=defaultUrl
},
getEl:function(){
return this.el
},
update:function(url,params,callback,discardUrl){
var me=this,cfg,callerScope;
if(me.fireEvent(BEFOREUPDATE,me.el,url,params)!==false){
if(Ext.isObject(url)){
cfg=url;
url=cfg.url;
params=params||cfg.params;
callback=callback||cfg.callback;
discardUrl=discardUrl||cfg.discardUrl;
callerScope=cfg.scope;
if(!Ext.isEmpty(cfg.nocache)){
me.disableCaching=cfg.nocache
}
;
if(!Ext.isEmpty(cfg.text)){
me.indicatorText='<div class="loading-indicator">'+cfg.text+'</div>'
}
;
if(!Ext.isEmpty(cfg.scripts)){
me.loadScripts=cfg.scripts
}
;
if(!Ext.isEmpty(cfg.timeout)){
me.timeout=cfg.timeout
}
;
}
me.showLoading();
if(!discardUrl){
me.defaultUrl=url
}
if(Ext.isFunction(url)){
url=url.call(me)
}
var o=Ext.apply({},{
url:url,
params:Ext.isFunction(params)&&callerScope?params.createDelegate(callerScope):params,
success:processSuccess,
failure:processFailure,
scope:me,
callback:undefined,
timeout:me.timeout*1000,
disableCaching:me.disableCaching,
argument:{
'options':cfg,
'url':url,
'form':null,
'callback':callback,
'scope':callerScope||window,
'params':params
}
},cfg);
me.transaction=Ext.Ajax.request(o)
}
},
formUpdate:function(form,url,reset,callback){
var me=this;
if(me.fireEvent(BEFOREUPDATE,me.el,form,url)!==false){
if(Ext.isFunction(url)){
url=url.call(me)
}
form=Ext.getDom(form);
me.transaction=Ext.Ajax.request({
form:form,
url:url,
success:processSuccess,
failure:processFailure,
scope:me,
timeout:me.timeout*1000,
argument:{
'url':url,
'form':form,
'callback':callback,
'reset':reset
}
});
me.showLoading.defer(1,me)
}
},
startAutoRefresh:function(interval,url,params,callback,refreshNow){
var me=this;
if(refreshNow){
me.update(url||me.defaultUrl,params,callback,true)
}
if(me.autoRefreshProcId){
clearInterval(me.autoRefreshProcId)
}
me.autoRefreshProcId=setInterval(me.update.createDelegate(me,[
url||me.defaultUrl,
params,
callback,
true
]),interval*1000)
},
stopAutoRefresh:function(){
if(this.autoRefreshProcId){
clearInterval(this.autoRefreshProcId);
delete this.autoRefreshProcId
}
},
isAutoRefreshing:function(){
return!!this.autoRefreshProcId
},
showLoading:function(){
if(this.showLoadIndicator){
this.el.dom.innerHTML=this.indicatorText
}
},
abort:function(){
if(this.transaction){
Ext.Ajax.abort(this.transaction)
}
},
isUpdating:function(){
return this.transaction?Ext.Ajax.isLoading(this.transaction):false
},
refresh:function(callback){
if(this.defaultUrl){
this.update(this.defaultUrl,null,callback,true)
}
}
}
}());
Ext.Updater.defaults={
timeout:30,
disableCaching:false,
showLoadIndicator:true,
indicatorText:'<div class="loading-indicator">Loading...</div>',
loadScripts:false,
sslBlankUrl:Ext.SSL_SECURE_URL
};
Ext.Updater.updateElement=function(el,url,params,options){
var um=Ext.get(el).getUpdater();
Ext.apply(um,options);
um.update(url,params,options?options.callback:null)
};
Ext.Updater.BasicRenderer=function(){
};
Ext.Updater.BasicRenderer.prototype={
render:function(el,response,updateManager,callback){
el.update(response.responseText,updateManager.loadScripts,callback)
}
};
(function(){
Date.useStrict=false;
function xf(format){
var args=Array.prototype.slice.call(arguments,1);
return format.replace(/\{(\d+)\}/g,function(m,i){
return args[i]
})
}
Date.formatCodeToRegex=function(character,currentGroup){
var p=Date.parseCodes[character];
if(p){
p=typeof p=='function'?p():p;
Date.parseCodes[character]=p
}
return p?Ext.applyIf({c:p.c?xf(p.c,currentGroup||'{0}'):p.c},p):{
g:0,
c:null,
s:Ext.escapeRe(character)
}
};
var $f=Date.formatCodeToRegex;
Ext.apply(Date,{
parseFunctions:{
'M$':function(input,strict){
var re=new RegExp('\\/Date\\(([-+])?(\\d+)(?:[+-]\\d{4})?\\)\\/');
var r=(input||'').match(re);
return r?new Date(((r[1]||'')+r[2])*1):null
}
},
parseRegexes:[],
formatFunctions:{
'M$':function(){
return'\\/Date('+this.getTime()+')\\/'
}
},
y2kYear:50,
MILLI:'ms',
SECOND:'s',
MINUTE:'mi',
HOUR:'h',
DAY:'d',
MONTH:'mo',
YEAR:'y',
defaults:{},
dayNames:[
'Sunday',
'Monday',
'Tuesday',
'Wednesday',
'Thursday',
'Friday',
'Saturday'
],
monthNames:[
'January',
'February',
'March',
'April',
'May',
'June',
'July',
'August',
'September',
'October',
'November',
'December'
],
monthNumbers:{
Jan:0,
Feb:1,
Mar:2,
Apr:3,
May:4,
Jun:5,
Jul:6,
Aug:7,
Sep:8,
Oct:9,
Nov:10,
Dec:11
},
getShortMonthName:function(month){
return Date.monthNames[month].substring(0,3)
},
getShortDayName:function(day){
return Date.dayNames[day].substring(0,3)
},
getMonthNumber:function(name){
return Date.monthNumbers[name.substring(0,1).toUpperCase()+name.substring(1,3).toLowerCase()]
},
formatContainsHourInfo:function(){
var stripEscapeRe=/(\\.)/g,hourInfoRe=/([gGhHisucUOPZ]|M\$)/;
return function(format){
return hourInfoRe.test(format.replace(stripEscapeRe,''))
}
}(),
formatCodes:{
d:'String.leftPad(this.getDate(), 2, \'0\')',
D:'Date.getShortDayName(this.getDay())',
j:'this.getDate()',
l:'Date.dayNames[this.getDay()]',
N:'(this.getDay() ? this.getDay() : 7)',
S:'this.getSuffix()',
w:'this.getDay()',
z:'this.getDayOfYear()',
W:'String.leftPad(this.getWeekOfYear(), 2, \'0\')',
F:'Date.monthNames[this.getMonth()]',
m:'String.leftPad(this.getMonth() + 1, 2, \'0\')',
M:'Date.getShortMonthName(this.getMonth())',
n:'(this.getMonth() + 1)',
t:'this.getDaysInMonth()',
L:'(this.isLeapYear() ? 1 : 0)',
o:'(this.getFullYear() + (this.getWeekOfYear() == 1 && this.getMonth() > 0 ? +1 : (this.getWeekOfYear() >= 52 && this.getMonth() < 11 ? -1 : 0)))',
Y:'String.leftPad(this.getFullYear(), 4, \'0\')',
y:'(\'\' + this.getFullYear()).substring(2, 4)',
a:'(this.getHours() < 12 ? \'am\' : \'pm\')',
A:'(this.getHours() < 12 ? \'AM\' : \'PM\')',
g:'((this.getHours() % 12) ? this.getHours() % 12 : 12)',
G:'this.getHours()',
h:'String.leftPad((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, \'0\')',
H:'String.leftPad(this.getHours(), 2, \'0\')',
i:'String.leftPad(this.getMinutes(), 2, \'0\')',
s:'String.leftPad(this.getSeconds(), 2, \'0\')',
u:'String.leftPad(this.getMilliseconds(), 3, \'0\')',
O:'this.getGMTOffset()',
P:'this.getGMTOffset(true)',
T:'this.getTimezone()',
Z:'(this.getTimezoneOffset() * -60)',
c:function(){
for(var c='Y-m-dTH:i:sP',code=[],i=0,l=c.length;i<l;++i){
var e=c.charAt(i);
code.push(e=='T'?'\'T\'':Date.getFormatCode(e))
}
return code.join(' + ')
},
U:'Math.round(this.getTime() / 1000)'
},
isValid:function(y,m,d,h,i,s,ms){
h=h||0;
i=i||0;
s=s||0;
ms=ms||0;
var dt=new Date(y<100?100:y,m-1,d,h,i,s,ms).add(Date.YEAR,y<100?y-100:0);
return y==dt.getFullYear()&&m==dt.getMonth()+1&&d==dt.getDate()&&h==dt.getHours()&&i==dt.getMinutes()&&s==dt.getSeconds()&&ms==dt.getMilliseconds()
},
parseDate:function(input,format,strict){
var p=Date.parseFunctions;
if(p[format]==null){
Date.createParser(format)
}
return p[format](input,Ext.isDefined(strict)?strict:Date.useStrict)
},
getFormatCode:function(character){
var f=Date.formatCodes[character];
if(f){
f=typeof f=='function'?f():f;
Date.formatCodes[character]=f
}
return f||'\''+String.escape(character)+'\''
},
createFormat:function(format){
var code=[],special=false,ch='';
for(var i=0;i<format.length;++i){
ch=format.charAt(i);
if(!special&&ch=='\\'){
special=true
}else if(special){
special=false;
code.push('\''+String.escape(ch)+'\'')
}else{
code.push(Date.getFormatCode(ch))
}
}
Date.formatFunctions[format]=new Function('return '+code.join('+'))
},
createParser:function(){
var code=[
'var dt, y, m, d, h, i, s, ms, o, z, zz, u, v,',
'def = Date.defaults,',
'results = String(input).match(Date.parseRegexes[{0}]);',
'if(results){',
'{1}',
'if(u != null){',
'v = new Date(u * 1000);',
'}else{',
'dt = (new Date()).clearTime();',
'y = Ext.num(y, Ext.num(def.y, dt.getFullYear()));',
'm = Ext.num(m, Ext.num(def.m - 1, dt.getMonth()));',
'd = Ext.num(d, Ext.num(def.d, dt.getDate()));',
'h  = Ext.num(h, Ext.num(def.h, dt.getHours()));',
'i  = Ext.num(i, Ext.num(def.i, dt.getMinutes()));',
's  = Ext.num(s, Ext.num(def.s, dt.getSeconds()));',
'ms = Ext.num(ms, Ext.num(def.ms, dt.getMilliseconds()));',
'if(z >= 0 && y >= 0){',
'v = new Date(y < 100 ? 100 : y, 0, 1, h, i, s, ms).add(Date.YEAR, y < 100 ? y - 100 : 0);',
'v = !strict? v : (strict === true && (z <= 364 || (v.isLeapYear() && z <= 365))? v.add(Date.DAY, z) : null);',
'}else if(strict === true && !Date.isValid(y, m + 1, d, h, i, s, ms)){',
'v = null;',
'}else{',
'v = new Date(y < 100 ? 100 : y, m, d, h, i, s, ms).add(Date.YEAR, y < 100 ? y - 100 : 0);',
'}',
'}',
'}',
'if(v){',
'if(zz != null){',
'v = v.add(Date.SECOND, -v.getTimezoneOffset() * 60 - zz);',
'}else if(o){',
'v = v.add(Date.MINUTE, -v.getTimezoneOffset() + (sn == \'+\'? -1 : 1) * (hr * 60 + mn));',
'}',
'}',
'return v;'
].join('\n');
return function(format){
var regexNum=Date.parseRegexes.length,currentGroup=1,calc=[],regex=[],special=false,ch='',i=0,obj,last;
for(;i<format.length;++i){
ch=format.charAt(i);
if(!special&&ch=='\\'){
special=true
}else if(special){
special=false;
regex.push(String.escape(ch))
}else{
obj=$f(ch,currentGroup);
currentGroup+=obj.g;
regex.push(obj.s);
if(obj.g&&obj.c){
if(obj.calcLast){
last=obj.c
}else{
calc.push(obj.c)
}
}
}
}
if(last){
calc.push(last)
}
Date.parseRegexes[regexNum]=new RegExp('^'+regex.join('')+'$','i');
Date.parseFunctions[format]=new Function('input','strict',xf(code,regexNum,calc.join('')))
}
}(),
parseCodes:{
d:{
g:1,
c:'d = parseInt(results[{0}], 10);\n',
s:'(\\d{2})'
},
j:{
g:1,
c:'d = parseInt(results[{0}], 10);\n',
s:'(\\d{1,2})'
},
D:function(){
for(var a=[],i=0;i<7;a.push(Date.getShortDayName(i)),++i);
return{
g:0,
c:null,
s:'(?:'+a.join('|')+')'
}
},
l:function(){
return{
g:0,
c:null,
s:'(?:'+Date.dayNames.join('|')+')'
}
},
N:{
g:0,
c:null,
s:'[1-7]'
},
S:{
g:0,
c:null,
s:'(?:st|nd|rd|th)'
},
w:{
g:0,
c:null,
s:'[0-6]'
},
z:{
g:1,
c:'z = parseInt(results[{0}], 10);\n',
s:'(\\d{1,3})'
},
W:{
g:0,
c:null,
s:'(?:\\d{2})'
},
F:function(){
return{
g:1,
c:'m = parseInt(Date.getMonthNumber(results[{0}]), 10);\n',
s:'('+Date.monthNames.join('|')+')'
}
},
M:function(){
for(var a=[],i=0;i<12;a.push(Date.getShortMonthName(i)),++i);
return Ext.applyIf({s:'('+a.join('|')+')'},$f('F'))
},
m:{
g:1,
c:'m = parseInt(results[{0}], 10) - 1;\n',
s:'(\\d{2})'
},
n:{
g:1,
c:'m = parseInt(results[{0}], 10) - 1;\n',
s:'(\\d{1,2})'
},
t:{
g:0,
c:null,
s:'(?:\\d{2})'
},
L:{
g:0,
c:null,
s:'(?:1|0)'
},
o:function(){
return $f('Y')
},
Y:{
g:1,
c:'y = parseInt(results[{0}], 10);\n',
s:'(\\d{4})'
},
y:{
g:1,
c:'var ty = parseInt(results[{0}], 10);\n'+'y = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n',
s:'(\\d{1,2})'
},
a:function(){
return $f('A')
},
A:{
calcLast:true,
g:1,
c:'if (/(am)/i.test(results[{0}])) {\n'+'if (!h || h == 12) { h = 0; }\n'+'} else { if (!h || h < 12) { h = (h || 0) + 12; }}',
s:'(AM|PM|am|pm)'
},
g:function(){
return $f('G')
},
G:{
g:1,
c:'h = parseInt(results[{0}], 10);\n',
s:'(\\d{1,2})'
},
h:function(){
return $f('H')
},
H:{
g:1,
c:'h = parseInt(results[{0}], 10);\n',
s:'(\\d{2})'
},
i:{
g:1,
c:'i = parseInt(results[{0}], 10);\n',
s:'(\\d{2})'
},
s:{
g:1,
c:'s = parseInt(results[{0}], 10);\n',
s:'(\\d{2})'
},
u:{
g:1,
c:'ms = results[{0}]; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n',
s:'(\\d+)'
},
O:{
g:1,
c:[
'o = results[{0}];',
'var sn = o.substring(0,1),',
'hr = o.substring(1,3)*1 + Math.floor(o.substring(3,5) / 60),',
'mn = o.substring(3,5) % 60;',
'o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + String.leftPad(hr, 2, \'0\') + String.leftPad(mn, 2, \'0\')) : null;\n'
].join('\n'),
s:'([+-]\\d{4})'
},
P:{
g:1,
c:[
'o = results[{0}];',
'var sn = o.substring(0,1),',
'hr = o.substring(1,3)*1 + Math.floor(o.substring(4,6) / 60),',
'mn = o.substring(4,6) % 60;',
'o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + String.leftPad(hr, 2, \'0\') + String.leftPad(mn, 2, \'0\')) : null;\n'
].join('\n'),
s:'([+-]\\d{2}:\\d{2})'
},
T:{
g:0,
c:null,
s:'[A-Z]{1,4}'
},
Z:{
g:1,
c:'zz = results[{0}] * 1;\n'+'zz = (-43200 <= zz && zz <= 50400)? zz : null;\n',
s:'([+-]?\\d{1,5})'
},
c:function(){
var calc=[],arr=[
$f('Y',1),
$f('m',2),
$f('d',3),
$f('h',4),
$f('i',5),
$f('s',6),
{c:'ms = results[7] || \'0\'; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n'},
{
c:[
'if(results[8]) {',
'if(results[8] == \'Z\'){',
'zz = 0;',
'}else if (results[8].indexOf(\':\') > -1){',
$f('P',8).c,
'}else{',
$f('O',8).c,
'}',
'}'
].join('\n')
}
];
for(var i=0,l=arr.length;i<l;++i){
calc.push(arr[i].c)
}
return{
g:1,
c:calc.join(''),
s:[
arr[0].s,
'(?:',
'-',
arr[1].s,
'(?:',
'-',
arr[2].s,
'(?:',
'(?:T| )?',
arr[3].s,
':',
arr[4].s,
'(?::',
arr[5].s,
')?',
'(?:(?:\\.|,)(\\d+))?',
'(Z|(?:[-+]\\d{2}(?::)?\\d{2}))?',
')?',
')?',
')?'
].join('')
}
},
U:{
g:1,
c:'u = parseInt(results[{0}], 10);\n',
s:'(-?\\d+)'
}
}
})
}());
Ext.apply(Date.prototype,{
dateFormat:function(format){
if(Date.formatFunctions[format]==null){
Date.createFormat(format)
}
return Date.formatFunctions[format].call(this)
},
getTimezone:function(){
return this.toString().replace(/^.* (?:\((.*)\)|([A-Z]{1,4})(?:[\-+][0-9]{4})?(?: -?\d+)?)$/,'$1$2').replace(/[^A-Z]/g,'')
},
getGMTOffset:function(colon){
return(this.getTimezoneOffset()>0?'-':'+')+String.leftPad(Math.floor(Math.abs(this.getTimezoneOffset())/60),2,'0')+(colon?':':'')+String.leftPad(Math.abs(this.getTimezoneOffset()%60),2,'0')
},
getDayOfYear:function(){
var num=0,d=this.clone(),m=this.getMonth(),i;
for(i=0,d.setDate(1),d.setMonth(0);i<m;d.setMonth(++i)){
num+=d.getDaysInMonth()
}
return num+this.getDate()-1
},
getWeekOfYear:function(){
var ms1d=86400000,ms7d=7*ms1d;
return function(){
var DC3=Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()+3)/ms1d,AWN=Math.floor(DC3/7),Wyr=new Date(AWN*ms7d).getUTCFullYear();
return AWN-Math.floor(Date.UTC(Wyr,0,7)/ms7d)+1
}
}(),
isLeapYear:function(){
var year=this.getFullYear();
return!!((year&3)==0&&(year%100||year%400==0&&year))
},
getFirstDayOfMonth:function(){
var day=(this.getDay()-(this.getDate()-1))%7;
return day<0?day+7:day
},
getLastDayOfMonth:function(){
return this.getLastDateOfMonth().getDay()
},
getFirstDateOfMonth:function(){
return new Date(this.getFullYear(),this.getMonth(),1)
},
getLastDateOfMonth:function(){
return new Date(this.getFullYear(),this.getMonth(),this.getDaysInMonth())
},
getDaysInMonth:function(){
var daysInMonth=[
31,
28,
31,
30,
31,
30,
31,
31,
30,
31,
30,
31
];
return function(){
var m=this.getMonth();
return m==1&&this.isLeapYear()?29:daysInMonth[m]
}
}(),
getSuffix:function(){
switch(this.getDate()){
case 1:
case 21:
case 31:
return'st';
case 2:
case 22:
return'nd';
case 3:
case 23:
return'rd';
default:
return'th'
}
},
clone:function(){
return new Date(this.getTime())
},
isDST:function(){
return new Date(this.getFullYear(),0,1).getTimezoneOffset()!=this.getTimezoneOffset()
},
clearTime:function(clone){
if(clone){
return this.clone().clearTime()
}
var d=this.getDate();
this.setHours(0);
this.setMinutes(0);
this.setSeconds(0);
this.setMilliseconds(0);
if(this.getDate()!=d){
for(var hr=1,c=this.add(Date.HOUR,hr);c.getDate()!=d;hr++,c=this.add(Date.HOUR,hr));
this.setDate(d);
this.setHours(c.getHours())
}
return this
},
add:function(interval,value){
var d=this.clone();
if(!interval||value===0)
return d;
switch(interval.toLowerCase()){
case Date.MILLI:
d.setMilliseconds(this.getMilliseconds()+value);
break;
case Date.SECOND:
d.setSeconds(this.getSeconds()+value);
break;
case Date.MINUTE:
d.setMinutes(this.getMinutes()+value);
break;
case Date.HOUR:
d.setHours(this.getHours()+value);
break;
case Date.DAY:
d.setDate(this.getDate()+value);
break;
case Date.MONTH:
var day=this.getDate();
if(day>28){
day=Math.min(day,this.getFirstDateOfMonth().add('mo',value).getLastDateOfMonth().getDate())
}
d.setDate(day);
d.setMonth(this.getMonth()+value);
break;
case Date.YEAR:
d.setFullYear(this.getFullYear()+value);
break
}
return d
},
between:function(start,end){
var t=this.getTime();
return start.getTime()<=t&&t<=end.getTime()
}
});
Date.prototype.format=Date.prototype.dateFormat;
if(Ext.isSafari&&(navigator.userAgent.match(/WebKit\/(\d+)/)[1]||NaN)<420){
Ext.apply(Date.prototype,{
_xMonth:Date.prototype.setMonth,
_xDate:Date.prototype.setDate,
setMonth:function(num){
if(num<=-1){
var n=Math.ceil(-num),back_year=Math.ceil(n/12),month=n%12?12-n%12:0;
this.setFullYear(this.getFullYear()-back_year);
return this._xMonth(month)
}else{
return this._xMonth(num)
}
},
setDate:function(d){
return this.setTime(this.getTime()-(this.getDate()-d)*86400000)
}
})
}
Ext.util.MixedCollection=function(allowFunctions,keyFn){
this.items=[];
this.map={};
this.keys=[];
this.length=0;
this.addEvents('clear','add','replace','remove','sort');
this.allowFunctions=allowFunctions===true;
if(keyFn){
this.getKey=keyFn
}
Ext.util.MixedCollection.superclass.constructor.call(this)
};
Ext.extend(Ext.util.MixedCollection,Ext.util.Observable,{
allowFunctions:false,
add:function(key,o){
if(arguments.length==1){
o=arguments[0];
key=this.getKey(o)
}
if(typeof key!='undefined'&&key!==null){
var old=this.map[key];
if(typeof old!='undefined'){
return this.replace(key,o)
}
this.map[key]=o
}
this.length++;
this.items.push(o);
this.keys.push(key);
this.fireEvent('add',this.length-1,o,key);
return o
},
getKey:function(o){
return o.id
},
replace:function(key,o){
if(arguments.length==1){
o=arguments[0];
key=this.getKey(o)
}
var old=this.map[key];
if(typeof key=='undefined'||key===null||typeof old=='undefined'){
return this.add(key,o)
}
var index=this.indexOfKey(key);
this.items[index]=o;
this.map[key]=o;
this.fireEvent('replace',key,old,o);
return o
},
addAll:function(objs){
if(arguments.length>1||Ext.isArray(objs)){
var args=arguments.length>1?arguments:objs;
for(var i=0,len=args.length;i<len;i++){
this.add(args[i])
}
}else{
for(var key in objs){
if(this.allowFunctions||typeof objs[key]!='function'){
this.add(key,objs[key])
}
}
}
},
each:function(fn,scope){
var items=[].concat(this.items);
for(var i=0,len=items.length;i<len;i++){
if(fn.call(scope||items[i],items[i],i,len)===false){
break
}
}
},
eachKey:function(fn,scope){
for(var i=0,len=this.keys.length;i<len;i++){
fn.call(scope||window,this.keys[i],this.items[i],i,len)
}
},
find:function(fn,scope){
for(var i=0,len=this.items.length;i<len;i++){
if(fn.call(scope||window,this.items[i],this.keys[i])){
return this.items[i]
}
}
return null
},
insert:function(index,key,o){
if(arguments.length==2){
o=arguments[1];
key=this.getKey(o)
}
if(this.containsKey(key)){
this.suspendEvents();
this.removeKey(key);
this.resumeEvents()
}
if(index>=this.length){
return this.add(key,o)
}
this.length++;
this.items.splice(index,0,o);
if(typeof key!='undefined'&&key!==null){
this.map[key]=o
}
this.keys.splice(index,0,key);
this.fireEvent('add',index,o,key);
return o
},
remove:function(o){
return this.removeAt(this.indexOf(o))
},
removeAt:function(index){
if(index<this.length&&index>=0){
this.length--;
var o=this.items[index];
this.items.splice(index,1);
var key=this.keys[index];
if(typeof key!='undefined'){
delete this.map[key]
}
this.keys.splice(index,1);
this.fireEvent('remove',o,key);
return o
}
return false
},
removeKey:function(key){
return this.removeAt(this.indexOfKey(key))
},
getCount:function(){
return this.length
},
indexOf:function(o){
return this.items.indexOf(o)
},
indexOfKey:function(key){
return this.keys.indexOf(key)
},
item:function(key){
var mk=this.map[key],item=mk!==undefined?mk:typeof key=='number'?this.items[key]:undefined;
return typeof item!='function'||this.allowFunctions?item:null
},
itemAt:function(index){
return this.items[index]
},
key:function(key){
return this.map[key]
},
contains:function(o){
return this.indexOf(o)!=-1
},
containsKey:function(key){
return typeof this.map[key]!='undefined'
},
clear:function(){
this.length=0;
this.items=[];
this.keys=[];
this.map={};
this.fireEvent('clear')
},
first:function(){
return this.items[0]
},
last:function(){
return this.items[this.length-1]
},
_sort:function(property,dir,fn){
var i,len,dsc=String(dir).toUpperCase()=='DESC'?-1:1,c=[],keys=this.keys,items=this.items;
fn=fn||function(a,b){
return a-b
};
for(i=0,len=items.length;i<len;i++){
c[c.length]={
key:keys[i],
value:items[i],
index:i
}
}
c.sort(function(a,b){
var v=fn(a[property],b[property])*dsc;
if(v===0){
v=a.index<b.index?-1:1
}
return v
});
for(i=0,len=c.length;i<len;i++){
items[i]=c[i].value;
keys[i]=c[i].key
}
this.fireEvent('sort',this)
},
sort:function(dir,fn){
this._sort('value',dir,fn)
},
reorder:function(mapping){
this.suspendEvents();
var items=this.items,index=0,length=items.length,order=[],remaining=[],oldIndex;
for(oldIndex in mapping){
order[mapping[oldIndex]]=items[oldIndex]
}
for(index=0;index<length;index++){
if(mapping[index]==undefined){
remaining.push(items[index])
}
}
for(index=0;index<length;index++){
if(order[index]==undefined){
order[index]=remaining.shift()
}
}
this.clear();
this.addAll(order);
this.resumeEvents();
this.fireEvent('sort',this)
},
keySort:function(dir,fn){
this._sort('key',dir,fn||function(a,b){
var v1=String(a).toUpperCase(),v2=String(b).toUpperCase();
return v1>v2?1:v1<v2?-1:0
})
},
getRange:function(start,end){
var items=this.items;
if(items.length<1){
return[]
}
start=start||0;
end=Math.min(typeof end=='undefined'?this.length-1:end,this.length-1);
var i,r=[];
if(start<=end){
for(i=start;i<=end;i++){
r[r.length]=items[i]
}
}else{
for(i=start;i>=end;i--){
r[r.length]=items[i]
}
}
return r
},
filter:function(property,value,anyMatch,caseSensitive){
if(Ext.isEmpty(value,false)){
return this.clone()
}
value=this.createValueMatcher(value,anyMatch,caseSensitive);
return this.filterBy(function(o){
return o&&value.test(o[property])
})
},
filterBy:function(fn,scope){
var r=new Ext.util.MixedCollection;
r.getKey=this.getKey;
var k=this.keys,it=this.items;
for(var i=0,len=it.length;i<len;i++){
if(fn.call(scope||this,it[i],k[i])){
r.add(k[i],it[i])
}
}
return r
},
findIndex:function(property,value,start,anyMatch,caseSensitive){
if(Ext.isEmpty(value,false)){
return-1
}
value=this.createValueMatcher(value,anyMatch,caseSensitive);
return this.findIndexBy(function(o){
return o&&value.test(o[property])
},null,start)
},
findIndexBy:function(fn,scope,start){
var k=this.keys,it=this.items;
for(var i=start||0,len=it.length;i<len;i++){
if(fn.call(scope||this,it[i],k[i])){
return i
}
}
return-1
},
createValueMatcher:function(value,anyMatch,caseSensitive,exactMatch){
if(!value.exec){
var er=Ext.escapeRe;
value=String(value);
if(anyMatch===true){
value=er(value)
}else{
value='^'+er(value);
if(exactMatch===true){
value+='$'
}
}
value=new RegExp(value,caseSensitive?'':'i')
}
return value
},
clone:function(){
var r=new Ext.util.MixedCollection;
var k=this.keys,it=this.items;
for(var i=0,len=it.length;i<len;i++){
r.add(k[i],it[i])
}
r.getKey=this.getKey;
return r
}
});
Ext.util.MixedCollection.prototype.get=Ext.util.MixedCollection.prototype.item;
Ext.AbstractManager=Ext.extend(Object,{
typeName:'type',
constructor:function(config){
Ext.apply(this,config||{});
this.all=new Ext.util.MixedCollection;
this.types={}
},
get:function(id){
return this.all.get(id)
},
register:function(item){
this.all.add(item)
},
unregister:function(item){
this.all.remove(item)
},
registerType:function(type,cls){
this.types[type]=cls;
cls[this.typeName]=type
},
isRegistered:function(type){
return this.types[type]!==undefined
},
create:function(config,defaultType){
var type=config[this.typeName]||config.type||defaultType,Constructor=this.types[type];
if(Constructor==undefined){
throw new Error(String.format('The \'{0}\' type has not been registered with this manager',type))
}
return new Constructor(config)
},
onAvailable:function(id,fn,scope){
var all=this.all;
all.on('add',function(index,o){
if(o.id==id){
fn.call(scope||o,o);
all.un('add',fn,scope)
}
})
}
});
Ext.util.Format=function(){
var trimRe=/^\s+|\s+$/g,stripTagsRE=/<\/?[^>]+>/gi,stripScriptsRe=/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/gi,nl2brRe=/\r?\n/g;
return{
ellipsis:function(value,len,word){
if(value&&value.length>len){
if(word){
var vs=value.substr(0,len-2),index=Math.max(vs.lastIndexOf(' '),vs.lastIndexOf('.'),vs.lastIndexOf('!'),vs.lastIndexOf('?'));
if(index==-1||index<len-15){
return value.substr(0,len-3)+'...'
}else{
return vs.substr(0,index)+'...'
}
}else{
return value.substr(0,len-3)+'...'
}
}
return value
},
undef:function(value){
return value!==undefined?value:''
},
defaultValue:function(value,defaultValue){
return value!==undefined&&value!==''?value:defaultValue
},
htmlEncode:function(value){
return!value?value:String(value).replace(/&/g,'&amp;').replace(/>/g,'&gt;').replace(/</g,'&lt;').replace(/"/g,'&quot;')
},
htmlDecode:function(value){
return!value?value:String(value).replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&quot;/g,'"').replace(/&amp;/g,'&')
},
trim:function(value){
return String(value).replace(trimRe,'')
},
substr:function(value,start,length){
return String(value).substr(start,length)
},
lowercase:function(value){
return String(value).toLowerCase()
},
uppercase:function(value){
return String(value).toUpperCase()
},
capitalize:function(value){
return!value?value:value.charAt(0).toUpperCase()+value.substr(1).toLowerCase()
},
call:function(value,fn){
if(arguments.length>2){
var args=Array.prototype.slice.call(arguments,2);
args.unshift(value);
return eval(fn).apply(window,args)
}else{
return eval(fn).call(window,value)
}
},
usMoney:function(v){
v=Math.round((v-0)*100)/100;
v=v==Math.floor(v)?v+'.00':v*10==Math.floor(v*10)?v+'0':v;
v=String(v);
var ps=v.split('.'),whole=ps[0],sub=ps[1]?'.'+ps[1]:'.00',r=/(\d+)(\d{3})/;
while(r.test(whole)){
whole=whole.replace(r,'$1'+','+'$2')
}
v=whole+sub;
if(v.charAt(0)=='-'){
return'-$'+v.substr(1)
}
return'$'+v
},
date:function(v,format){
if(!v){
return''
}
if(!Ext.isDate(v)){
v=new Date(Date.parse(v))
}
return v.dateFormat(format||'m/d/Y')
},
dateRenderer:function(format){
return function(v){
return Ext.util.Format.date(v,format)
}
},
stripTags:function(v){
return!v?v:String(v).replace(stripTagsRE,'')
},
stripScripts:function(v){
return!v?v:String(v).replace(stripScriptsRe,'')
},
fileSize:function(size){
if(size<1024){
return size+' bytes'
}else if(size<1048576){
return Math.round(size*10/1024)/10+' KB'
}else{
return Math.round(size*10/1048576)/10+' MB'
}
},
math:function(){
var fns={};
return function(v,a){
if(!fns[a]){
fns[a]=new Function('v','return v '+a+';')
}
return fns[a](v)
}
}(),
round:function(value,precision){
var result=Number(value);
if(typeof precision=='number'){
precision=Math.pow(10,precision);
result=Math.round(value*precision)/precision
}
return result
},
number:function(v,format){
if(!format){
return v
}
v=Ext.num(v,NaN);
if(isNaN(v)){
return''
}
var comma=',',dec='.',i18n=false,neg=v<0;
v=Math.abs(v);
if(format.substr(format.length-2)=='/i'){
format=format.substr(0,format.length-2);
i18n=true;
comma='.';
dec=','
}
var hasComma=format.indexOf(comma)!=-1,psplit=(i18n?format.replace(/[^\d\,]/g,''):format.replace(/[^\d\.]/g,'')).split(dec);
if(1<psplit.length){
v=v.toFixed(psplit[1].length)
}else if(2<psplit.length){
throw'NumberFormatException: invalid format, formats should have no more than 1 period: '+format
}else{
v=v.toFixed(0)
}
var fnum=v.toString();
psplit=fnum.split('.');
if(hasComma){
var cnum=psplit[0],parr=[],j=cnum.length,m=Math.floor(j/3),n=cnum.length%3||3,i;
for(i=0;i<j;i+=n){
if(i!=0){
n=3
}
parr[parr.length]=cnum.substr(i,n);
m-=1
}
fnum=parr.join(comma);
if(psplit[1]){
fnum+=dec+psplit[1]
}
}else{
if(psplit[1]){
fnum=psplit[0]+dec+psplit[1]
}
}
return(neg?'-':'')+format.replace(/[\d,?\.?]+/,fnum)
},
numberRenderer:function(format){
return function(v){
return Ext.util.Format.number(v,format)
}
},
plural:function(v,s,p){
return v+' '+(v==1?s:p?p:s+'s')
},
nl2br:function(v){
return Ext.isEmpty(v)?'':v.replace(nl2brRe,'<br/>')
}
}
}();
Ext.XTemplate=function(){
Ext.XTemplate.superclass.constructor.apply(this,arguments);
var me=this,s=me.html,re=/<tpl\b[^>]*>((?:(?=([^<]+))\2|<(?!tpl\b[^>]*>))*?)<\/tpl>/,nameRe=/^<tpl\b[^>]*?for="(.*?)"/,ifRe=/^<tpl\b[^>]*?if="(.*?)"/,execRe=/^<tpl\b[^>]*?exec="(.*?)"/,m,id=0,tpls=[],VALUES='extVal_ext',PARENT='parent',XINDEX='xindex',XCOUNT='xcount',RETURN='return ',WITHVALUES='with(extVal_ext){ ';
s=[
'<tpl>',
s,
'</tpl>'
].join('');
while(m=s.match(re)){
var m2=m[0].match(nameRe),m3=m[0].match(ifRe),m4=m[0].match(execRe),exp=null,fn=null,exec=null,name=m2&&m2[1]?m2[1]:'';
if(m3){
exp=m3&&m3[1]?m3[1]:null;
if(exp){
fn=new Function(VALUES,PARENT,XINDEX,XCOUNT,WITHVALUES+RETURN+Ext.util.Format.htmlDecode(exp)+'; }')
}
}
if(m4){
exp=m4&&m4[1]?m4[1]:null;
if(exp){
exec=new Function(VALUES,PARENT,XINDEX,XCOUNT,WITHVALUES+Ext.util.Format.htmlDecode(exp)+'; }')
}
}
if(name){
switch(name){
case'.':
name=new Function(VALUES,PARENT,WITHVALUES+RETURN+VALUES+'; }');
break;
case'..':
name=new Function(VALUES,PARENT,WITHVALUES+RETURN+PARENT+'; }');
break;
default:
name=new Function(VALUES,PARENT,WITHVALUES+RETURN+name+'; }')
}
}
tpls.push({
id:id,
target:name,
exec:exec,
test:fn,
body:m[1]||''
});
s=s.replace(m[0],'{xtpl'+id+'}');
++id
}
for(var i=tpls.length-1;i>=0;--i){
me.compileTpl(tpls[i])
}
me.master=tpls[tpls.length-1];
me.tpls=tpls
};
Ext.extend(Ext.XTemplate,Ext.Template,{
re:/\{([\w\-\.\#]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?(\s?[\+\-\*\\]\s?[\d\.\+\-\*\\\(\)]+)?\}/g,
codeRe:/\{\[((?:\\\]|.|\n)*?)\]\}/g,
applySubTemplate:function(id,values,parent,xindex,xcount){
var me=this,len,t=me.tpls[id],_vs,buf=[];
if(t.test&&!t.test.call(me,values,parent,xindex,xcount)||t.exec&&t.exec.call(me,values,parent,xindex,xcount)){
return''
}
_vs=t.target?t.target.call(me,values,parent):values;
len=_vs.length;
parent=t.target?values:parent;
if(t.target&&Ext.isArray(_vs)){
for(var i=0,len=_vs.length;i<len;i++){
buf[buf.length]=t.compiled.call(me,_vs[i],parent,i+1,len)
}
return buf.join('')
}
return t.compiled.call(me,_vs,parent,xindex,xcount)
},
compileTpl:function(tpl){
var fm=Ext.util.Format,useF=this.disableFormats!==true,sep=Ext.isGecko?'+':',',body;
function fn(m,name,format,args,math){
if(name.substr(0,4)=='xtpl'){
return'\''+sep+'this.applySubTemplate('+name.substr(4)+', values, parent, xindex, xcount)'+sep+'\''
}
var v;
if(name==='.'){
v='values'
}else if(name==='#'){
v='xindex'
}else if(name.indexOf('.')!=-1){
v=name
}else{
v='values[\''+name+'\']'
}
if(math){
v='('+v+math+')'
}
if(format&&useF){
args=args?','+args:'';
if(format.substr(0,5)!='this.'){
format='fm.'+format+'('
}else{
format='this.call("'+format.substr(5)+'", ';
args=', values'
}
}else{
args='';
format='('+v+' === undefined ? \'\' : '
}
return'\''+sep+format+v+args+')'+sep+'\''
}
function codeFn(m,code){
return'\''+sep+'('+code.replace(/\\'/g,'\'')+')'+sep+'\''
}
if(Ext.isGecko){
body='tpl.compiled = function(values, parent, xindex, xcount){ return \''+tpl.body.replace(/(\r\n|\n)/g,'\\n').replace(/'/g,'\\\'').replace(this.re,fn).replace(this.codeRe,codeFn)+'\';};'
}else{
body=['tpl.compiled = function(values, parent, xindex, xcount){ return [\''];
body.push(tpl.body.replace(/(\r\n|\n)/g,'\\n').replace(/'/g,'\\\'').replace(this.re,fn).replace(this.codeRe,codeFn));
body.push('\'].join(\'\');};');
body=body.join('')
}
eval(body);
return this
},
applyTemplate:function(values){
return this.master.compiled.call(this,values,{},1,1)
},
compile:function(){
return this
}
});
Ext.XTemplate.prototype.apply=Ext.XTemplate.prototype.applyTemplate;
Ext.XTemplate.from=function(el){
el=Ext.getDom(el);
return new Ext.XTemplate(el.value||el.innerHTML)
};
Ext.util.CSS=function(){
var rules=null;
var doc=document;
var camelRe=/(-[a-z])/gi;
var camelFn=function(m,a){
return a.charAt(1).toUpperCase()
};
return{
createStyleSheet:function(cssText,id){
var ss;
var head=doc.getElementsByTagName('head')[0];
var rules=doc.createElement('style');
rules.setAttribute('type','text/css');
if(id){
rules.setAttribute('id',id)
}
if(Ext.isIE){
head.appendChild(rules);
ss=rules.styleSheet;
ss.cssText=cssText
}else{
try{
rules.appendChild(doc.createTextNode(cssText))
}catch(e){
rules.cssText=cssText
}
head.appendChild(rules);
ss=rules.styleSheet?rules.styleSheet:rules.sheet||doc.styleSheets[doc.styleSheets.length-1]
}
this.cacheStyleSheet(ss);
return ss
},
removeStyleSheet:function(id){
var existing=doc.getElementById(id);
if(existing){
existing.parentNode.removeChild(existing)
}
},
swapStyleSheet:function(id,url){
this.removeStyleSheet(id);
var ss=doc.createElement('link');
ss.setAttribute('rel','stylesheet');
ss.setAttribute('type','text/css');
ss.setAttribute('id',id);
ss.setAttribute('href',url);
doc.getElementsByTagName('head')[0].appendChild(ss)
},
refreshCache:function(){
return this.getRules(true)
},
cacheStyleSheet:function(ss){
if(!rules){
rules={}
}
try{
var ssRules=ss.cssRules||ss.rules;
for(var j=ssRules.length-1;j>=0;--j){
rules[ssRules[j].selectorText.toLowerCase()]=ssRules[j]
}
}catch(e){
}
},
getRules:function(refreshCache){
if(rules===null||refreshCache){
rules={};
var ds=doc.styleSheets;
for(var i=0,len=ds.length;i<len;i++){
try{
this.cacheStyleSheet(ds[i])
}catch(e){
}
}
}
return rules
},
getRule:function(selector,refreshCache){
var rs=this.getRules(refreshCache);
if(!Ext.isArray(selector)){
return rs[selector.toLowerCase()]
}
for(var i=0;i<selector.length;i++){
if(rs[selector[i]]){
return rs[selector[i].toLowerCase()]
}
}
return null
},
updateRule:function(selector,property,value){
if(!Ext.isArray(selector)){
var rule=this.getRule(selector);
if(rule){
rule.style[property.replace(camelRe,camelFn)]=value;
return true
}
}else{
for(var i=0;i<selector.length;i++){
if(this.updateRule(selector[i],property,value)){
return true
}
}
}
return false
}
}
}();
Ext.util.ClickRepeater=Ext.extend(Ext.util.Observable,{
constructor:function(el,config){
this.el=Ext.get(el);
this.el.unselectable();
Ext.apply(this,config);
this.addEvents('mousedown','click','mouseup');
if(!this.disabled){
this.disabled=true;
this.enable()
}
if(this.handler){
this.on('click',this.handler,this.scope||this)
}
Ext.util.ClickRepeater.superclass.constructor.call(this)
},
interval:20,
delay:250,
preventDefault:true,
stopDefault:false,
timer:0,
enable:function(){
if(this.disabled){
this.el.on('mousedown',this.handleMouseDown,this);
if(Ext.isIE){
this.el.on('dblclick',this.handleDblClick,this)
}
if(this.preventDefault||this.stopDefault){
this.el.on('click',this.eventOptions,this)
}
}
this.disabled=false
},
disable:function(force){
if(force||!this.disabled){
clearTimeout(this.timer);
if(this.pressClass){
this.el.removeClass(this.pressClass)
}
Ext.getDoc().un('mouseup',this.handleMouseUp,this);
this.el.removeAllListeners()
}
this.disabled=true
},
setDisabled:function(disabled){
this[disabled?'disable':'enable']()
},
eventOptions:function(e){
if(this.preventDefault){
e.preventDefault()
}
if(this.stopDefault){
e.stopEvent()
}
},
destroy:function(){
this.disable(true);
Ext.destroy(this.el);
this.purgeListeners()
},
handleDblClick:function(e){
clearTimeout(this.timer);
this.el.blur();
this.fireEvent('mousedown',this,e);
this.fireEvent('click',this,e)
},
handleMouseDown:function(e){
clearTimeout(this.timer);
this.el.blur();
if(this.pressClass){
this.el.addClass(this.pressClass)
}
this.mousedownTime=new Date;
Ext.getDoc().on('mouseup',this.handleMouseUp,this);
this.el.on('mouseout',this.handleMouseOut,this);
this.fireEvent('mousedown',this,e);
this.fireEvent('click',this,e);
if(this.accelerate){
this.delay=400
}
this.timer=this.click.defer(this.delay||this.interval,this,[e])
},
click:function(e){
this.fireEvent('click',this,e);
this.timer=this.click.defer(this.accelerate?this.easeOutExpo(this.mousedownTime.getElapsed(),400,-390,12000):this.interval,this,[e])
},
easeOutExpo:function(t,b,c,d){
return t==d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b
},
handleMouseOut:function(){
clearTimeout(this.timer);
if(this.pressClass){
this.el.removeClass(this.pressClass)
}
this.el.on('mouseover',this.handleMouseReturn,this)
},
handleMouseReturn:function(){
this.el.un('mouseover',this.handleMouseReturn,this);
if(this.pressClass){
this.el.addClass(this.pressClass)
}
this.click()
},
handleMouseUp:function(e){
clearTimeout(this.timer);
this.el.un('mouseover',this.handleMouseReturn,this);
this.el.un('mouseout',this.handleMouseOut,this);
Ext.getDoc().un('mouseup',this.handleMouseUp,this);
this.el.removeClass(this.pressClass);
this.fireEvent('mouseup',this,e)
}
});
Ext.KeyNav=function(el,config){
this.el=Ext.get(el);
Ext.apply(this,config);
if(!this.disabled){
this.disabled=true;
this.enable()
}
};
Ext.KeyNav.prototype={
disabled:false,
defaultEventAction:'stopEvent',
forceKeyDown:false,
relay:function(e){
var k=e.getKey(),h=this.keyToHandler[k];
if(h&&this[h]){
if(this.doRelay(e,this[h],h)!==true){
e[this.defaultEventAction]()
}
}
},
doRelay:function(e,h,hname){
return h.call(this.scope||this,e,hname)
},
enter:false,
left:false,
right:false,
up:false,
down:false,
tab:false,
esc:false,
pageUp:false,
pageDown:false,
del:false,
home:false,
end:false,
space:false,
keyToHandler:{
37:'left',
39:'right',
38:'up',
40:'down',
33:'pageUp',
34:'pageDown',
46:'del',
36:'home',
35:'end',
13:'enter',
27:'esc',
9:'tab',
32:'space'
},
stopKeyUp:function(e){
var k=e.getKey();
if(k>=37&&k<=40){
e.stopEvent()
}
},
destroy:function(){
this.disable()
},
enable:function(){
if(this.disabled){
if(Ext.isSafari2){
this.el.on('keyup',this.stopKeyUp,this)
}
this.el.on(this.isKeydown()?'keydown':'keypress',this.relay,this);
this.disabled=false
}
},
disable:function(){
if(!this.disabled){
if(Ext.isSafari2){
this.el.un('keyup',this.stopKeyUp,this)
}
this.el.un(this.isKeydown()?'keydown':'keypress',this.relay,this);
this.disabled=true
}
},
setDisabled:function(disabled){
this[disabled?'disable':'enable']()
},
isKeydown:function(){
return this.forceKeyDown||Ext.EventManager.useKeydown
}
};
Ext.KeyMap=function(el,config,eventName){
this.el=Ext.get(el);
this.eventName=eventName||'keydown';
this.bindings=[];
if(config){
this.addBinding(config)
}
this.enable()
};
Ext.KeyMap.prototype={
stopEvent:false,
addBinding:function(config){
if(Ext.isArray(config)){
Ext.each(config,function(c){
this.addBinding(c)
},this);
return
}
var keyCode=config.key,fn=config.fn||config.handler,scope=config.scope;
if(config.stopEvent){
this.stopEvent=config.stopEvent
}
if(typeof keyCode=='string'){
var ks=[];
var keyString=keyCode.toUpperCase();
for(var j=0,len=keyString.length;j<len;j++){
ks.push(keyString.charCodeAt(j))
}
keyCode=ks
}
var keyArray=Ext.isArray(keyCode);
var handler=function(e){
if(this.checkModifiers(config,e)){
var k=e.getKey();
if(keyArray){
for(var i=0,len=keyCode.length;i<len;i++){
if(keyCode[i]==k){
if(this.stopEvent){
e.stopEvent()
}
fn.call(scope||window,k,e);
return
}
}
}else{
if(k==keyCode){
if(this.stopEvent){
e.stopEvent()
}
fn.call(scope||window,k,e)
}
}
}
};
this.bindings.push(handler)
},
checkModifiers:function(config,e){
var val,key,keys=[
'shift',
'ctrl',
'alt'
];
for(var i=0,len=keys.length;i<len;++i){
key=keys[i];
val=config[key];
if(!(val===undefined||val===e[key+'Key'])){
return false
}
}
return true
},
on:function(key,fn,scope){
var keyCode,shift,ctrl,alt;
if(typeof key=='object'&&!Ext.isArray(key)){
keyCode=key.key;
shift=key.shift;
ctrl=key.ctrl;
alt=key.alt
}else{
keyCode=key
}
this.addBinding({
key:keyCode,
shift:shift,
ctrl:ctrl,
alt:alt,
fn:fn,
scope:scope
})
},
handleKeyDown:function(e){
if(this.enabled){
var b=this.bindings;
for(var i=0,len=b.length;i<len;i++){
b[i].call(this,e)
}
}
},
isEnabled:function(){
return this.enabled
},
enable:function(){
if(!this.enabled){
this.el.on(this.eventName,this.handleKeyDown,this);
this.enabled=true
}
},
disable:function(){
if(this.enabled){
this.el.removeListener(this.eventName,this.handleKeyDown,this);
this.enabled=false
}
},
setDisabled:function(disabled){
this[disabled?'disable':'enable']()
}
};
Ext.util.TextMetrics=function(){
var shared;
return{
measure:function(el,text,fixedWidth){
if(!shared){
shared=Ext.util.TextMetrics.Instance(el,fixedWidth)
}
shared.bind(el);
shared.setFixedWidth(fixedWidth||'auto');
return shared.getSize(text)
},
createInstance:function(el,fixedWidth){
return Ext.util.TextMetrics.Instance(el,fixedWidth)
}
}
}();
Ext.util.TextMetrics.Instance=function(bindTo,fixedWidth){
var ml=new Ext.Element(document.createElement('div'));
document.body.appendChild(ml.dom);
ml.position('absolute');
ml.setLeftTop(-1000,-1000);
ml.hide();
if(fixedWidth){
ml.setWidth(fixedWidth)
}
var instance={
getSize:function(text){
ml.update(text);
var s=ml.getSize();
ml.update('');
return s
},
bind:function(el){
ml.setStyle(Ext.fly(el).getStyles('font-size','font-style','font-weight','font-family','line-height','text-transform','letter-spacing'))
},
setFixedWidth:function(width){
ml.setWidth(width)
},
getWidth:function(text){
ml.dom.style.width='auto';
return this.getSize(text).width
},
getHeight:function(text){
return this.getSize(text).height
}
};
instance.bind(bindTo);
return instance
};
Ext.Element.addMethods({
getTextWidth:function(text,min,max){
return Ext.util.TextMetrics.measure(this.dom,Ext.value(text,this.dom.innerHTML,true)).width.constrain(min||0,max||1000000)
}
});
Ext.util.Cookies={
set:function(name,value){
var argv=arguments;
var argc=arguments.length;
var expires=argc>2?argv[2]:null;
var path=argc>3?argv[3]:'/';
var domain=argc>4?argv[4]:null;
var secure=argc>5?argv[5]:false;
document.cookie=name+'='+escape(value)+(expires===null?'':'; expires='+expires.toGMTString())+(path===null?'':'; path='+path)+(domain===null?'':'; domain='+domain)+(secure===true?'; secure':'')
},
get:function(name){
var arg=name+'=';
var alen=arg.length;
var clen=document.cookie.length;
var i=0;
var j=0;
while(i<clen){
j=i+alen;
if(document.cookie.substring(i,j)==arg){
return Ext.util.Cookies.getCookieVal(j)
}
i=document.cookie.indexOf(' ',i)+1;
if(i===0){
break
}
}
return null
},
clear:function(name){
if(Ext.util.Cookies.get(name)){
document.cookie=name+'='+'; expires=Thu, 01-Jan-70 00:00:01 GMT'
}
},
getCookieVal:function(offset){
var endstr=document.cookie.indexOf(';',offset);
if(endstr==-1){
endstr=document.cookie.length
}
return unescape(document.cookie.substring(offset,endstr))
}
};
Ext.handleError=function(e){
throw e
};
Ext.Error=function(message){
this.message=this.lang[message]?this.lang[message]:message
};
Ext.Error.prototype=new Error;
Ext.apply(Ext.Error.prototype,{
lang:{},
name:'Ext.Error',
getName:function(){
return this.name
},
getMessage:function(){
return this.message
},
toJson:function(){
return Ext.encode(this)
}
});
Ext.ComponentMgr=function(){
var all=new Ext.util.MixedCollection;
var types={};
var ptypes={};
return{
register:function(c){
all.add(c)
},
unregister:function(c){
all.remove(c)
},
get:function(id){
return all.get(id)
},
onAvailable:function(id,fn,scope){
all.on('add',function(index,o){
if(o.id==id){
fn.call(scope||o,o);
all.un('add',fn,scope)
}
})
},
all:all,
types:types,
ptypes:ptypes,
isRegistered:function(xtype){
return types[xtype]!==undefined
},
isPluginRegistered:function(ptype){
return ptypes[ptype]!==undefined
},
registerType:function(xtype,cls){
types[xtype]=cls;
cls.xtype=xtype
},
create:function(config,defaultType){
return config.render?config:new types[config.xtype||defaultType](config)
},
registerPlugin:function(ptype,cls){
ptypes[ptype]=cls;
cls.ptype=ptype
},
createPlugin:function(config,defaultType){
var PluginCls=ptypes[config.ptype||defaultType];
if(PluginCls.init){
return PluginCls
}else{
return new PluginCls(config)
}
}
}
}();
Ext.reg=Ext.ComponentMgr.registerType;
Ext.preg=Ext.ComponentMgr.registerPlugin;
Ext.create=Ext.ComponentMgr.create;
Ext.Component=function(config){
config=config||{};
if(config.initialConfig){
if(config.isAction){
this.baseAction=config
}
config=config.initialConfig
}else if(config.tagName||config.dom||Ext.isString(config)){
config={
applyTo:config,
id:config.id||config
}
}
this.initialConfig=config;
Ext.apply(this,config);
this.addEvents('added','disable','enable','beforeshow','show','beforehide','hide','removed','beforerender','render','afterrender','beforedestroy','destroy','beforestaterestore','staterestore','beforestatesave','statesave');
this.getId();
Ext.ComponentMgr.register(this);
Ext.Component.superclass.constructor.call(this);
if(this.baseAction){
this.baseAction.addComponent(this)
}
this.initComponent();
if(this.plugins){
if(Ext.isArray(this.plugins)){
for(var i=0,len=this.plugins.length;i<len;i++){
this.plugins[i]=this.initPlugin(this.plugins[i])
}
}else{
this.plugins=this.initPlugin(this.plugins)
}
}
if(this.stateful!==false){
this.initState()
}
if(this.applyTo){
this.applyToMarkup(this.applyTo);
delete this.applyTo
}else if(this.renderTo){
this.render(this.renderTo);
delete this.renderTo
}
};
Ext.Component.AUTO_ID=1000;
Ext.extend(Ext.Component,Ext.util.Observable,{
disabled:false,
hidden:false,
autoEl:'div',
disabledClass:'x-item-disabled',
allowDomMove:true,
autoShow:false,
hideMode:'display',
hideParent:false,
rendered:false,
tplWriteMode:'overwrite',
bubbleEvents:[],
ctype:'Ext.Component',
actionMode:'el',
getActionEl:function(){
return this[this.actionMode]
},
initPlugin:function(p){
if(p.ptype&&!Ext.isFunction(p.init)){
p=Ext.ComponentMgr.createPlugin(p)
}else if(Ext.isString(p)){
p=Ext.ComponentMgr.createPlugin({ptype:p})
}
p.init(this);
return p
},
initComponent:function(){
if(this.listeners){
this.on(this.listeners);
delete this.listeners
}
this.enableBubble(this.bubbleEvents)
},
render:function(container,position){
if(!this.rendered&&this.fireEvent('beforerender',this)!==false){
if(!container&&this.el){
this.el=Ext.get(this.el);
container=this.el.dom.parentNode;
this.allowDomMove=false
}
this.container=Ext.get(container);
if(this.ctCls){
this.container.addClass(this.ctCls)
}
this.rendered=true;
if(position!==undefined){
if(Ext.isNumber(position)){
position=this.container.dom.childNodes[position]
}else{
position=Ext.getDom(position)
}
}
this.onRender(this.container,position||null);
if(this.autoShow){
this.el.removeClass([
'x-hidden',
'x-hide-'+this.hideMode
])
}
if(this.cls){
this.el.addClass(this.cls);
delete this.cls
}
if(this.style){
this.el.applyStyles(this.style);
delete this.style
}
if(this.overCls){
this.el.addClassOnOver(this.overCls)
}
this.fireEvent('render',this);
var contentTarget=this.getContentTarget();
if(this.html){
contentTarget.update(Ext.DomHelper.markup(this.html));
delete this.html
}
if(this.contentEl){
var ce=Ext.getDom(this.contentEl);
Ext.fly(ce).removeClass([
'x-hidden',
'x-hide-display'
]);
contentTarget.appendChild(ce)
}
if(this.tpl){
if(!this.tpl.compile){
this.tpl=new Ext.XTemplate(this.tpl)
}
if(this.data){
this.tpl[this.tplWriteMode](contentTarget,this.data);
delete this.data
}
}
this.afterRender(this.container);
if(this.hidden){
this.doHide()
}
if(this.disabled){
this.disable(true)
}
if(this.stateful!==false){
this.initStateEvents()
}
this.fireEvent('afterrender',this)
}
return this
},
update:function(htmlOrData,loadScripts,cb){
var contentTarget=this.getContentTarget();
if(this.tpl&&typeof htmlOrData!=='string'){
this.tpl[this.tplWriteMode](contentTarget,htmlOrData||{})
}else{
var html=Ext.isObject(htmlOrData)?Ext.DomHelper.markup(htmlOrData):htmlOrData;
contentTarget.update(html,loadScripts,cb)
}
},
onAdded:function(container,pos){
this.ownerCt=container;
this.initRef();
this.fireEvent('added',this,container,pos)
},
onRemoved:function(){
this.removeRef();
this.fireEvent('removed',this,this.ownerCt);
delete this.ownerCt
},
initRef:function(){
if(this.ref&&!this.refOwner){
var levels=this.ref.split('/'),last=levels.length,i=0,t=this;
while(t&&i<last){
t=t.ownerCt;
++i
}
if(t){
t[this.refName=levels[--i]]=this;
this.refOwner=t
}
}
},
removeRef:function(){
if(this.refOwner&&this.refName){
delete this.refOwner[this.refName];
delete this.refOwner
}
},
initState:function(){
if(Ext.state.Manager){
var id=this.getStateId();
if(id){
var state=Ext.state.Manager.get(id);
if(state){
if(this.fireEvent('beforestaterestore',this,state)!==false){
this.applyState(Ext.apply({},state));
this.fireEvent('staterestore',this,state)
}
}
}
}
},
getStateId:function(){
return this.stateId||(/^(ext-comp-|ext-gen)/.test(String(this.id))?null:this.id)
},
initStateEvents:function(){
if(this.stateEvents){
for(var i=0,e;e=this.stateEvents[i];i++){
this.on(e,this.saveState,this,{delay:100})
}
}
},
applyState:function(state){
if(state){
Ext.apply(this,state)
}
},
getState:function(){
return null
},
saveState:function(){
if(Ext.state.Manager&&this.stateful!==false){
var id=this.getStateId();
if(id){
var state=this.getState();
if(this.fireEvent('beforestatesave',this,state)!==false){
Ext.state.Manager.set(id,state);
this.fireEvent('statesave',this,state)
}
}
}
},
applyToMarkup:function(el){
this.allowDomMove=false;
this.el=Ext.get(el);
this.render(this.el.dom.parentNode)
},
addClass:function(cls){
if(this.el){
this.el.addClass(cls)
}else{
this.cls=this.cls?this.cls+' '+cls:cls
}
return this
},
removeClass:function(cls){
if(this.el){
this.el.removeClass(cls)
}else if(this.cls){
this.cls=this.cls.split(' ').remove(cls).join(' ')
}
return this
},
onRender:function(ct,position){
if(!this.el&&this.autoEl){
if(Ext.isString(this.autoEl)){
this.el=document.createElement(this.autoEl)
}else{
var div=document.createElement('div');
Ext.DomHelper.overwrite(div,this.autoEl);
this.el=div.firstChild
}
if(!this.el.id){
this.el.id=this.getId()
}
}
if(this.el){
this.el=Ext.get(this.el);
if(this.allowDomMove!==false){
ct.dom.insertBefore(this.el.dom,position);
if(div){
Ext.removeNode(div);
div=null
}
}
if(!this.el.getAttribute('data-xtype')&&this.xtype){
this.el.dom.setAttribute('data-xtype',this.xtype)
}
}
},
getAutoCreate:function(){
var cfg=Ext.isObject(this.autoCreate)?this.autoCreate:Ext.apply({},this.defaultAutoCreate);
if(this.id&&!cfg.id){
cfg.id=this.id
}
return cfg
},
afterRender:Ext.emptyFn,
destroy:function(){
if(!this.isDestroyed){
if(this.fireEvent('beforedestroy',this)!==false){
this.destroying=true;
this.beforeDestroy();
if(this.ownerCt&&this.ownerCt.remove){
this.ownerCt.remove(this,false)
}
if(this.rendered){
this.el.remove();
if(this.actionMode=='container'||this.removeMode=='container'){
this.container.remove()
}
}
if(this.focusTask&&this.focusTask.cancel){
this.focusTask.cancel()
}
this.onDestroy();
Ext.ComponentMgr.unregister(this);
this.fireEvent('destroy',this);
this.purgeListeners();
this.destroying=false;
this.isDestroyed=true
}
}
},
deleteMembers:function(){
var args=arguments;
for(var i=0,len=args.length;i<len;++i){
delete this[args[i]]
}
},
beforeDestroy:Ext.emptyFn,
onDestroy:Ext.emptyFn,
getEl:function(){
return this.el
},
getContentTarget:function(){
return this.el
},
getId:function(){
return this.id||(this.id='ext-comp-'+ ++Ext.Component.AUTO_ID)
},
getItemId:function(){
return this.itemId||this.getId()
},
focus:function(selectText,delay){
if(delay){
this.focusTask=new Ext.util.DelayedTask(this.focus,this,[
selectText,
false
]);
this.focusTask.delay(Ext.isNumber(delay)?delay:10);
return this
}
if(this.rendered&&!this.isDestroyed){
this.el.focus();
if(selectText===true){
this.el.dom.select()
}
}
return this
},
blur:function(){
if(this.rendered){
this.el.blur()
}
return this
},
disable:function(silent){
if(this.rendered){
this.onDisable()
}
this.disabled=true;
if(silent!==true){
this.fireEvent('disable',this)
}
return this
},
onDisable:function(){
this.getActionEl().addClass(this.disabledClass);
this.el.dom.disabled=true
},
enable:function(){
if(this.rendered){
this.onEnable()
}
this.disabled=false;
this.fireEvent('enable',this);
return this
},
onEnable:function(){
this.getActionEl().removeClass(this.disabledClass);
this.el.dom.disabled=false
},
setDisabled:function(disabled){
return this[disabled?'disable':'enable']()
},
show:function(){
if(this.fireEvent('beforeshow',this)!==false){
this.hidden=false;
if(this.autoRender){
this.render(Ext.isBoolean(this.autoRender)?Ext.getBody():this.autoRender)
}
if(this.rendered){
this.onShow()
}
this.fireEvent('show',this)
}
return this
},
onShow:function(){
this.getVisibilityEl().removeClass('x-hide-'+this.hideMode)
},
hide:function(){
if(this.fireEvent('beforehide',this)!==false){
this.doHide();
this.fireEvent('hide',this)
}
return this
},
doHide:function(){
this.hidden=true;
if(this.rendered){
this.onHide()
}
},
onHide:function(){
this.getVisibilityEl().addClass('x-hide-'+this.hideMode)
},
getVisibilityEl:function(){
return this.hideParent?this.container:this.getActionEl()
},
setVisible:function(visible){
return this[visible?'show':'hide']()
},
isVisible:function(){
return this.rendered&&this.getVisibilityEl().isVisible()
},
cloneConfig:function(overrides){
overrides=overrides||{};
var id=overrides.id||Ext.id();
var cfg=Ext.applyIf(overrides,this.initialConfig);
cfg.id=id;
return new this.constructor(cfg)
},
getXType:function(){
return this.constructor.xtype
},
isXType:function(xtype,shallow){
if(Ext.isFunction(xtype)){
xtype=xtype.xtype
}else if(Ext.isObject(xtype)){
xtype=xtype.constructor.xtype
}
return!shallow?('/'+this.getXTypes()+'/').indexOf('/'+xtype+'/')!=-1:this.constructor.xtype==xtype
},
getXTypes:function(){
var tc=this.constructor;
if(!tc.xtypes){
var c=[],sc=this;
while(sc&&sc.constructor.xtype){
c.unshift(sc.constructor.xtype);
sc=sc.constructor.superclass
}
tc.xtypeChain=c;
tc.xtypes=c.join('/')
}
return tc.xtypes
},
findParentBy:function(fn){
for(var p=this.ownerCt;p!=null&&!fn(p,this);p=p.ownerCt);
return p||null
},
findParentByType:function(xtype,shallow){
return this.findParentBy(function(c){
return c.isXType(xtype,shallow)
})
},
bubble:function(fn,scope,args){
var p=this;
while(p){
if(fn.apply(scope||p,args||[p])===false){
break
}
p=p.ownerCt
}
return this
},
getPositionEl:function(){
return this.positionEl||this.el
},
purgeListeners:function(){
Ext.Component.superclass.purgeListeners.call(this);
if(this.mons){
this.on('beforedestroy',this.clearMons,this,{single:true})
}
},
clearMons:function(){
Ext.each(this.mons,function(m){
m.item.un(m.ename,m.fn,m.scope)
},this);
this.mons=[]
},
createMons:function(){
if(!this.mons){
this.mons=[];
this.on('beforedestroy',this.clearMons,this,{single:true})
}
},
mon:function(item,ename,fn,scope,opt){
this.createMons();
if(Ext.isObject(ename)){
var propRe=/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/;
var o=ename;
for(var e in o){
if(propRe.test(e)){
continue
}
if(Ext.isFunction(o[e])){
this.mons.push({
item:item,
ename:e,
fn:o[e],
scope:o.scope
});
item.on(e,o[e],o.scope,o)
}else{
this.mons.push({
item:item,
ename:e,
fn:o[e],
scope:o.scope
});
item.on(e,o[e])
}
}
return
}
this.mons.push({
item:item,
ename:ename,
fn:fn,
scope:scope
});
item.on(ename,fn,scope,opt)
},
mun:function(item,ename,fn,scope){
var found,mon;
this.createMons();
for(var i=0,len=this.mons.length;i<len;++i){
mon=this.mons[i];
if(item===mon.item&&ename==mon.ename&&fn===mon.fn&&scope===mon.scope){
this.mons.splice(i,1);
item.un(ename,fn,scope);
found=true;
break
}
}
return found
},
nextSibling:function(){
if(this.ownerCt){
var index=this.ownerCt.items.indexOf(this);
if(index!=-1&&index+1<this.ownerCt.items.getCount()){
return this.ownerCt.items.itemAt(index+1)
}
}
return null
},
previousSibling:function(){
if(this.ownerCt){
var index=this.ownerCt.items.indexOf(this);
if(index>0){
return this.ownerCt.items.itemAt(index-1)
}
}
return null
},
getBubbleTarget:function(){
return this.ownerCt
}
});
Ext.reg('component',Ext.Component);
Ext.Action=Ext.extend(Object,{
constructor:function(config){
this.initialConfig=config;
this.itemId=config.itemId=config.itemId||config.id||Ext.id();
this.items=[]
},
isAction:true,
setText:function(text){
this.initialConfig.text=text;
this.callEach('setText',[text])
},
getText:function(){
return this.initialConfig.text
},
setIconClass:function(cls){
this.initialConfig.iconCls=cls;
this.callEach('setIconClass',[cls])
},
getIconClass:function(){
return this.initialConfig.iconCls
},
setDisabled:function(v){
this.initialConfig.disabled=v;
this.callEach('setDisabled',[v])
},
enable:function(){
this.setDisabled(false)
},
disable:function(){
this.setDisabled(true)
},
isDisabled:function(){
return this.initialConfig.disabled
},
setHidden:function(v){
this.initialConfig.hidden=v;
this.callEach('setVisible',[!v])
},
show:function(){
this.setHidden(false)
},
hide:function(){
this.setHidden(true)
},
isHidden:function(){
return this.initialConfig.hidden
},
setHandler:function(fn,scope){
this.initialConfig.handler=fn;
this.initialConfig.scope=scope;
this.callEach('setHandler',[
fn,
scope
])
},
each:function(fn,scope){
Ext.each(this.items,fn,scope)
},
callEach:function(fnName,args){
var cs=this.items;
for(var i=0,len=cs.length;i<len;i++){
cs[i][fnName].apply(cs[i],args)
}
},
addComponent:function(comp){
this.items.push(comp);
comp.on('destroy',this.removeComponent,this)
},
removeComponent:function(comp){
this.items.remove(comp)
},
execute:function(){
this.initialConfig.handler.apply(this.initialConfig.scope||window,arguments)
}
});
(function(){
Ext.Layer=function(config,existingEl){
config=config||{};
var dh=Ext.DomHelper,cp=config.parentEl,pel=cp?Ext.getDom(cp):document.body;
if(existingEl){
this.dom=Ext.getDom(existingEl)
}
if(!this.dom){
var o=config.dh||{
tag:'div',
cls:'x-layer'
};
this.dom=dh.append(pel,o)
}
if(config.cls){
this.addClass(config.cls)
}
this.constrain=config.constrain!==false;
this.setVisibilityMode(Ext.Element.VISIBILITY);
if(config.id){
this.id=this.dom.id=config.id
}else{
this.id=Ext.id(this.dom)
}
this.zindex=config.zindex||this.getZIndex();
this.position('absolute',this.zindex);
if(config.shadow){
this.shadowOffset=config.shadowOffset||4;
this.shadow=new Ext.Shadow({
offset:this.shadowOffset,
mode:config.shadow
})
}else{
this.shadowOffset=0
}
this.useDisplay=config.useDisplay;
this.hide()
};
var supr=Ext.Element.prototype;
Ext.extend(Ext.Layer,Ext.Element,{
getZIndex:function(){
return this.zindex||parseInt(this.getStyle('z-index'),10)||11000
},
disableShadow:function(){
if(this.shadow){
this.shadowDisabled=true;
this.shadow.hide();
this.lastShadowOffset=this.shadowOffset;
this.shadowOffset=0
}
},
enableShadow:function(show){
if(this.shadow){
this.shadowDisabled=false;
if(Ext.isDefined(this.lastShadowOffset)){
this.shadowOffset=this.lastShadowOffset;
delete this.lastShadowOffset
}
if(show){
this.sync(true)
}
}
},
sync:function(doShow){
var shadow=this.shadow;
if(!this.updating&&this.isVisible()&&shadow){
var w=this.getWidth(),h=this.getHeight(),l=this.getLeft(true),t=this.getTop(true);
if(shadow&&!this.shadowDisabled){
if(doShow&&!shadow.isVisible()){
shadow.show(this)
}else{
shadow.realign(l,t,w,h)
}
}
}
},
destroy:function(){
if(this.shadow){
this.shadow.hide()
}
this.removeAllListeners();
Ext.removeNode(this.dom);
delete this.dom
},
remove:function(){
this.destroy()
},
beginUpdate:function(){
this.updating=true
},
endUpdate:function(){
this.updating=false;
this.sync(true)
},
hideUnders:function(negOffset){
if(this.shadow){
this.shadow.hide()
}
},
constrainXY:function(){
if(this.constrain){
var vw=Ext.lib.Dom.getViewWidth(),vh=Ext.lib.Dom.getViewHeight();
var s=Ext.getDoc().getScroll();
var xy=this.getXY();
var x=xy[0],y=xy[1];
var so=this.shadowOffset;
var w=this.dom.offsetWidth+so,h=this.dom.offsetHeight+so;
var moved=false;
if(x+w>vw+s.left){
x=vw-w-so;
moved=true
}
if(y+h>vh+s.top){
y=vh-h-so;
moved=true
}
if(x<s.left){
x=s.left;
moved=true
}
if(y<s.top){
y=s.top;
moved=true
}
if(moved){
if(this.avoidY){
var ay=this.avoidY;
if(y<=ay&&y+h>=ay){
y=ay-h-5
}
}
xy=[
x,
y
];
this.storeXY(xy);
supr.setXY.call(this,xy);
this.sync()
}
}
return this
},
getConstrainOffset:function(){
return this.shadowOffset
},
isVisible:function(){
return this.visible
},
showAction:function(){
this.visible=true;
if(this.useDisplay===true){
this.setDisplayed('')
}else if(this.lastXY){
supr.setXY.call(this,this.lastXY)
}else if(this.lastLT){
supr.setLeftTop.call(this,this.lastLT[0],this.lastLT[1])
}
},
hideAction:function(){
this.visible=false;
if(this.useDisplay===true){
this.setDisplayed(false)
}else{
this.setLeftTop(-10000,-10000)
}
},
setVisible:function(v,a,d,c,e){
if(v){
this.showAction()
}
if(a&&v){
var cb=function(){
this.sync(true);
if(c){
c()
}
}.createDelegate(this);
supr.setVisible.call(this,true,true,d,cb,e)
}else{
if(!v){
this.hideUnders(true)
}
var cb=c;
if(a){
cb=function(){
this.hideAction();
if(c){
c()
}
}.createDelegate(this)
}
supr.setVisible.call(this,v,a,d,cb,e);
if(v){
this.sync(true)
}else if(!a){
this.hideAction()
}
}
return this
},
storeXY:function(xy){
delete this.lastLT;
this.lastXY=xy
},
storeLeftTop:function(left,top){
delete this.lastXY;
this.lastLT=[
left,
top
]
},
beforeFx:function(){
this.beforeAction();
return Ext.Layer.superclass.beforeFx.apply(this,arguments)
},
afterFx:function(){
Ext.Layer.superclass.afterFx.apply(this,arguments);
this.sync(this.isVisible())
},
beforeAction:function(){
if(!this.updating&&this.shadow){
this.shadow.hide()
}
},
setLeft:function(left){
this.storeLeftTop(left,this.getTop(true));
supr.setLeft.apply(this,arguments);
this.sync();
return this
},
setTop:function(top){
this.storeLeftTop(this.getLeft(true),top);
supr.setTop.apply(this,arguments);
this.sync();
return this
},
setLeftTop:function(left,top){
this.storeLeftTop(left,top);
supr.setLeftTop.apply(this,arguments);
this.sync();
return this
},
setXY:function(xy,a,d,c,e){
this.fixDisplay();
this.beforeAction();
this.storeXY(xy);
var cb=this.createCB(c);
supr.setXY.call(this,xy,a,d,cb,e);
if(!a){
cb()
}
return this
},
createCB:function(c){
var el=this;
return function(){
el.constrainXY();
el.sync(true);
if(c){
c()
}
}
},
setX:function(x,a,d,c,e){
this.setXY([
x,
this.getY()
],a,d,c,e);
return this
},
setY:function(y,a,d,c,e){
this.setXY([
this.getX(),
y
],a,d,c,e);
return this
},
setSize:function(w,h,a,d,c,e){
this.beforeAction();
var cb=this.createCB(c);
supr.setSize.call(this,w,h,a,d,cb,e);
if(!a){
cb()
}
return this
},
setWidth:function(w,a,d,c,e){
this.beforeAction();
var cb=this.createCB(c);
supr.setWidth.call(this,w,a,d,cb,e);
if(!a){
cb()
}
return this
},
setHeight:function(h,a,d,c,e){
this.beforeAction();
var cb=this.createCB(c);
supr.setHeight.call(this,h,a,d,cb,e);
if(!a){
cb()
}
return this
},
setBounds:function(x,y,w,h,a,d,c,e){
this.beforeAction();
var cb=this.createCB(c);
if(!a){
this.storeXY([
x,
y
]);
supr.setXY.call(this,[
x,
y
]);
supr.setSize.call(this,w,h,a,d,cb,e);
cb()
}else{
supr.setBounds.call(this,x,y,w,h,a,d,cb,e)
}
return this
},
setZIndex:function(zindex){
this.zindex=zindex;
this.setStyle('z-index',zindex+2);
if(this.shadow){
this.shadow.setZIndex(zindex+1)
}
return this
}
})
}());
Ext.Shadow=function(config){
Ext.apply(this,config);
if(typeof this.mode!='string'){
this.mode=this.defaultMode
}
var o=this.offset,a={h:0},rad=Math.floor(this.offset/2);
switch(this.mode.toLowerCase()){
case'drop':
a.w=0;
a.l=a.t=o;
a.t-=1;
if(Ext.isIE){
a.l-=this.offset+rad;
a.t-=this.offset+rad;
a.w-=rad;
a.h-=rad;
a.t+=1
}
break;
case'sides':
a.w=o*2;
a.l=-o;
a.t=o-1;
if(Ext.isIE){
a.l-=this.offset-rad;
a.t-=this.offset+rad;
a.l+=1;
a.w-=(this.offset-rad)*2;
a.w-=rad+1;
a.h-=1
}
break;
case'frame':
a.w=a.h=o*2;
a.l=a.t=-o;
a.t+=1;
a.h-=2;
if(Ext.isIE){
a.l-=this.offset-rad;
a.t-=this.offset-rad;
a.l+=1;
a.w-=this.offset+rad+1;
a.h-=this.offset+rad;
a.h+=1
}
break
}
;
this.adjusts=a
};
Ext.Shadow.prototype={
offset:4,
defaultMode:'drop',
show:function(target){
target=Ext.get(target);
if(!this.el){
this.el=Ext.Shadow.Pool.pull();
if(this.el.dom.nextSibling!=target.dom){
this.el.insertBefore(target)
}
}
this.el.setStyle('z-index',this.zIndex||parseInt(target.getStyle('z-index'),10)-1);
if(Ext.isIE){
this.el.dom.style.filter='progid:DXImageTransform.Microsoft.alpha(opacity=50) progid:DXImageTransform.Microsoft.Blur(pixelradius='+this.offset+')'
}
this.realign(target.getLeft(true),target.getTop(true),target.getWidth(),target.getHeight());
this.el.dom.style.display='block'
},
isVisible:function(){
return this.el?true:false
},
realign:function(l,t,w,h){
if(!this.el){
return
}
var a=this.adjusts,d=this.el.dom,s=d.style,iea=0,sw=w+a.w,sh=h+a.h,sws=sw+'px',shs=sh+'px',cn,sww;
s.left=l+a.l+'px';
s.top=t+a.t+'px';
if(s.width!=sws||s.height!=shs){
s.width=sws;
s.height=shs;
if(!Ext.isIE){
cn=d.childNodes;
sww=Math.max(0,sw-12)+'px';
cn[0].childNodes[1].style.width=sww;
cn[1].childNodes[1].style.width=sww;
cn[2].childNodes[1].style.width=sww;
cn[1].style.height=Math.max(0,sh-12)+'px'
}
}
},
hide:function(){
if(this.el){
this.el.dom.style.display='none';
Ext.Shadow.Pool.push(this.el);
delete this.el
}
},
setZIndex:function(z){
this.zIndex=z;
if(this.el){
this.el.setStyle('z-index',z)
}
}
};
Ext.Shadow.Pool=function(){
var p=[],markup=Ext.isIE?'<div></div>':'<div><div class="xst"><div class="xstl"></div><div class="xstc"></div><div class="xstr"></div></div><div class="xsc"><div class="xsml"></div><div class="xsmc"></div><div class="xsmr"></div></div><div class="xsb"><div class="xsbl"></div><div class="xsbc"></div><div class="xsbr"></div></div></div>';
return{
pull:function(){
var sh=p.shift();
if(!sh){
sh=Ext.get(Ext.DomHelper.insertHtml('beforeBegin',document.body.firstChild,markup));
sh.autoBoxAdjust=false
}
return sh
},
push:function(sh){
p.push(sh)
}
}
}();
Ext.BoxComponent=Ext.extend(Ext.Component,{
initComponent:function(){
Ext.BoxComponent.superclass.initComponent.call(this);
this.addEvents('resize','move')
},
boxReady:false,
deferHeight:false,
setSize:function(w,h){
if(typeof w=='object'){
h=w.height;
w=w.width
}
if(Ext.isDefined(w)&&Ext.isDefined(this.boxMinWidth)&&w<this.boxMinWidth){
w=this.boxMinWidth
}
if(Ext.isDefined(h)&&Ext.isDefined(this.boxMinHeight)&&h<this.boxMinHeight){
h=this.boxMinHeight
}
if(Ext.isDefined(w)&&Ext.isDefined(this.boxMaxWidth)&&w>this.boxMaxWidth){
w=this.boxMaxWidth
}
if(Ext.isDefined(h)&&Ext.isDefined(this.boxMaxHeight)&&h>this.boxMaxHeight){
h=this.boxMaxHeight
}
if(!this.boxReady){
this.width=w;
this.height=h;
return this
}
if(this.cacheSizes!==false&&this.lastSize&&this.lastSize.width==w&&this.lastSize.height==h){
return this
}
this.lastSize={
width:w,
height:h
};
var adj=this.adjustSize(w,h),aw=adj.width,ah=adj.height,rz;
if(aw!==undefined||ah!==undefined){
rz=this.getResizeEl();
if(!this.deferHeight&&aw!==undefined&&ah!==undefined){
rz.setSize(aw,ah)
}else if(!this.deferHeight&&ah!==undefined){
rz.setHeight(ah)
}else if(aw!==undefined){
rz.setWidth(aw)
}
this.onResize(aw,ah,w,h);
this.fireEvent('resize',this,aw,ah,w,h)
}
return this
},
setWidth:function(width){
return this.setSize(width)
},
setHeight:function(height){
return this.setSize(undefined,height)
},
getSize:function(){
return this.getResizeEl().getSize()
},
getWidth:function(){
return this.getResizeEl().getWidth()
},
getHeight:function(){
return this.getResizeEl().getHeight()
},
getOuterSize:function(){
var el=this.getResizeEl();
return{
width:el.getWidth()+el.getMargins('lr'),
height:el.getHeight()+el.getMargins('tb')
}
},
getPosition:function(local){
var el=this.getPositionEl();
if(local===true){
return[
el.getLeft(true),
el.getTop(true)
]
}
return this.xy||el.getXY()
},
getBox:function(local){
var pos=this.getPosition(local);
var s=this.getSize();
s.x=pos[0];
s.y=pos[1];
return s
},
updateBox:function(box){
this.setSize(box.width,box.height);
this.setPagePosition(box.x,box.y);
return this
},
getResizeEl:function(){
return this.resizeEl||this.el
},
setAutoScroll:function(scroll){
if(this.rendered){
this.getContentTarget().setOverflow(scroll?'auto':'')
}
this.autoScroll=scroll;
return this
},
setPosition:function(x,y){
if(x&&typeof x[1]=='number'){
y=x[1];
x=x[0]
}
this.x=x;
this.y=y;
if(!this.boxReady){
return this
}
var adj=this.adjustPosition(x,y);
var ax=adj.x,ay=adj.y;
var el=this.getPositionEl();
if(ax!==undefined||ay!==undefined){
if(ax!==undefined&&ay!==undefined){
el.setLeftTop(ax,ay)
}else if(ax!==undefined){
el.setLeft(ax)
}else if(ay!==undefined){
el.setTop(ay)
}
this.onPosition(ax,ay);
this.fireEvent('move',this,ax,ay)
}
return this
},
setPagePosition:function(x,y){
if(x&&typeof x[1]=='number'){
y=x[1];
x=x[0]
}
this.pageX=x;
this.pageY=y;
if(!this.boxReady){
return
}
if(x===undefined||y===undefined){
return
}
var p=this.getPositionEl().translatePoints(x,y);
this.setPosition(p.left,p.top);
return this
},
afterRender:function(){
Ext.BoxComponent.superclass.afterRender.call(this);
if(this.resizeEl){
this.resizeEl=Ext.get(this.resizeEl)
}
if(this.positionEl){
this.positionEl=Ext.get(this.positionEl)
}
this.boxReady=true;
Ext.isDefined(this.autoScroll)&&this.setAutoScroll(this.autoScroll);
this.setSize(this.width,this.height);
if(this.x||this.y){
this.setPosition(this.x,this.y)
}else if(this.pageX||this.pageY){
this.setPagePosition(this.pageX,this.pageY)
}
},
syncSize:function(){
delete this.lastSize;
this.setSize(this.autoWidth?undefined:this.getResizeEl().getWidth(),this.autoHeight?undefined:this.getResizeEl().getHeight());
return this
},
onResize:function(adjWidth,adjHeight,rawWidth,rawHeight){
},
onPosition:function(x,y){
},
adjustSize:function(w,h){
if(this.autoWidth){
w='auto'
}
if(this.autoHeight){
h='auto'
}
return{
width:w,
height:h
}
},
adjustPosition:function(x,y){
return{
x:x,
y:y
}
}
});
Ext.reg('box',Ext.BoxComponent);
Ext.Spacer=Ext.extend(Ext.BoxComponent,{autoEl:'div'});
Ext.reg('spacer',Ext.Spacer);
Ext.SplitBar=function(dragElement,resizingElement,orientation,placement,existingProxy){
this.el=Ext.get(dragElement,true);
this.el.dom.unselectable='on';
this.resizingEl=Ext.get(resizingElement,true);
this.orientation=orientation||Ext.SplitBar.HORIZONTAL;
this.minSize=0;
this.maxSize=2000;
this.animate=false;
this.useShim=false;
this.shim=null;
if(!existingProxy){
this.proxy=Ext.SplitBar.createProxy(this.orientation)
}else{
this.proxy=Ext.get(existingProxy).dom
}
this.dd=new Ext.dd.DDProxy(this.el.dom.id,'XSplitBars',{dragElId:this.proxy.id});
this.dd.b4StartDrag=this.onStartProxyDrag.createDelegate(this);
this.dd.endDrag=this.onEndProxyDrag.createDelegate(this);
this.dragSpecs={};
this.adapter=new Ext.SplitBar.BasicLayoutAdapter;
this.adapter.init(this);
if(this.orientation==Ext.SplitBar.HORIZONTAL){
this.placement=placement||(this.el.getX()>this.resizingEl.getX()?Ext.SplitBar.LEFT:Ext.SplitBar.RIGHT);
this.el.addClass('x-splitbar-h')
}else{
this.placement=placement||(this.el.getY()>this.resizingEl.getY()?Ext.SplitBar.TOP:Ext.SplitBar.BOTTOM);
this.el.addClass('x-splitbar-v')
}
this.addEvents('resize','moved','beforeresize','beforeapply');
Ext.SplitBar.superclass.constructor.call(this)
};
Ext.extend(Ext.SplitBar,Ext.util.Observable,{
onStartProxyDrag:function(x,y){
this.fireEvent('beforeresize',this);
this.overlay=Ext.DomHelper.append(document.body,{
cls:'x-drag-overlay',
html:'&#160;'
},true);
this.overlay.unselectable();
this.overlay.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true));
this.overlay.show();
Ext.get(this.proxy).setDisplayed('block');
var size=this.adapter.getElementSize(this);
this.activeMinSize=this.getMinimumSize();
this.activeMaxSize=this.getMaximumSize();
var c1=size-this.activeMinSize;
var c2=Math.max(this.activeMaxSize-size,0);
if(this.orientation==Ext.SplitBar.HORIZONTAL){
this.dd.resetConstraints();
this.dd.setXConstraint(this.placement==Ext.SplitBar.LEFT?c1:c2,this.placement==Ext.SplitBar.LEFT?c2:c1,this.tickSize);
this.dd.setYConstraint(0,0)
}else{
this.dd.resetConstraints();
this.dd.setXConstraint(0,0);
this.dd.setYConstraint(this.placement==Ext.SplitBar.TOP?c1:c2,this.placement==Ext.SplitBar.TOP?c2:c1,this.tickSize)
}
this.dragSpecs.startSize=size;
this.dragSpecs.startPoint=[
x,
y
];
Ext.dd.DDProxy.prototype.b4StartDrag.call(this.dd,x,y)
},
onEndProxyDrag:function(e){
Ext.get(this.proxy).setDisplayed(false);
var endPoint=Ext.lib.Event.getXY(e);
if(this.overlay){
Ext.destroy(this.overlay);
delete this.overlay
}
var newSize;
if(this.orientation==Ext.SplitBar.HORIZONTAL){
newSize=this.dragSpecs.startSize+(this.placement==Ext.SplitBar.LEFT?endPoint[0]-this.dragSpecs.startPoint[0]:this.dragSpecs.startPoint[0]-endPoint[0])
}else{
newSize=this.dragSpecs.startSize+(this.placement==Ext.SplitBar.TOP?endPoint[1]-this.dragSpecs.startPoint[1]:this.dragSpecs.startPoint[1]-endPoint[1])
}
newSize=Math.min(Math.max(newSize,this.activeMinSize),this.activeMaxSize);
if(newSize!=this.dragSpecs.startSize){
if(this.fireEvent('beforeapply',this,newSize)!==false){
this.adapter.setElementSize(this,newSize);
this.fireEvent('moved',this,newSize);
this.fireEvent('resize',this,newSize)
}
}
},
getAdapter:function(){
return this.adapter
},
setAdapter:function(adapter){
this.adapter=adapter;
this.adapter.init(this)
},
getMinimumSize:function(){
return this.minSize
},
setMinimumSize:function(minSize){
this.minSize=minSize
},
getMaximumSize:function(){
return this.maxSize
},
setMaximumSize:function(maxSize){
this.maxSize=maxSize
},
setCurrentSize:function(size){
var oldAnimate=this.animate;
this.animate=false;
this.adapter.setElementSize(this,size);
this.animate=oldAnimate
},
destroy:function(removeEl){
Ext.destroy(this.shim,Ext.get(this.proxy));
this.dd.unreg();
if(removeEl){
this.el.remove()
}
this.purgeListeners()
}
});
Ext.SplitBar.createProxy=function(dir){
var proxy=new Ext.Element(document.createElement('div'));
document.body.appendChild(proxy.dom);
proxy.unselectable();
var cls='x-splitbar-proxy';
proxy.addClass(cls+' '+(dir==Ext.SplitBar.HORIZONTAL?cls+'-h':cls+'-v'));
return proxy.dom
};
Ext.SplitBar.BasicLayoutAdapter=function(){
};
Ext.SplitBar.BasicLayoutAdapter.prototype={
init:function(s){
},
getElementSize:function(s){
if(s.orientation==Ext.SplitBar.HORIZONTAL){
return s.resizingEl.getWidth()
}else{
return s.resizingEl.getHeight()
}
},
setElementSize:function(s,newSize,onComplete){
if(s.orientation==Ext.SplitBar.HORIZONTAL){
if(!s.animate){
s.resizingEl.setWidth(newSize);
if(onComplete){
onComplete(s,newSize)
}
}else{
s.resizingEl.setWidth(newSize,true,0.1,onComplete,'easeOut')
}
}else{
if(!s.animate){
s.resizingEl.setHeight(newSize);
if(onComplete){
onComplete(s,newSize)
}
}else{
s.resizingEl.setHeight(newSize,true,0.1,onComplete,'easeOut')
}
}
}
};
Ext.SplitBar.AbsoluteLayoutAdapter=function(container){
this.basic=new Ext.SplitBar.BasicLayoutAdapter;
this.container=Ext.get(container)
};
Ext.SplitBar.AbsoluteLayoutAdapter.prototype={
init:function(s){
this.basic.init(s)
},
getElementSize:function(s){
return this.basic.getElementSize(s)
},
setElementSize:function(s,newSize,onComplete){
this.basic.setElementSize(s,newSize,this.moveSplitter.createDelegate(this,[s]))
},
moveSplitter:function(s){
var yes=Ext.SplitBar;
switch(s.placement){
case yes.LEFT:
s.el.setX(s.resizingEl.getRight());
break;
case yes.RIGHT:
s.el.setStyle('right',this.container.getWidth()-s.resizingEl.getLeft()+'px');
break;
case yes.TOP:
s.el.setY(s.resizingEl.getBottom());
break;
case yes.BOTTOM:
s.el.setY(s.resizingEl.getTop()-s.el.getHeight());
break
}
}
};
Ext.SplitBar.VERTICAL=1;
Ext.SplitBar.HORIZONTAL=2;
Ext.SplitBar.LEFT=1;
Ext.SplitBar.RIGHT=2;
Ext.SplitBar.TOP=3;
Ext.SplitBar.BOTTOM=4;
Ext.Container=Ext.extend(Ext.BoxComponent,{
bufferResize:50,
autoDestroy:true,
forceLayout:false,
defaultType:'panel',
resizeEvent:'resize',
bubbleEvents:[
'add',
'remove'
],
initComponent:function(){
Ext.Container.superclass.initComponent.call(this);
this.addEvents('afterlayout','beforeadd','beforeremove','add','remove');
var items=this.items;
if(items){
delete this.items;
this.add(items)
}
},
initItems:function(){
if(!this.items){
this.items=new Ext.util.MixedCollection(false,this.getComponentId);
this.getLayout()
}
},
setLayout:function(layout){
if(this.layout&&this.layout!=layout){
this.layout.setContainer(null)
}
this.layout=layout;
this.initItems();
layout.setContainer(this)
},
afterRender:function(){
Ext.Container.superclass.afterRender.call(this);
if(!this.layout){
this.layout='auto'
}
if(Ext.isObject(this.layout)&&!this.layout.layout){
this.layoutConfig=this.layout;
this.layout=this.layoutConfig.type
}
if(Ext.isString(this.layout)){
this.layout=new Ext.Container.LAYOUTS[(this.layout.toLowerCase())](this.layoutConfig)
}
this.setLayout(this.layout);
if(this.activeItem!==undefined&&this.layout.setActiveItem){
var item=this.activeItem;
delete this.activeItem;
this.layout.setActiveItem(item)
}
if(!this.ownerCt){
this.doLayout(false,true)
}
if(this.monitorResize===true){
Ext.EventManager.onWindowResize(this.doLayout,this,[false])
}
},
getLayoutTarget:function(){
return this.el
},
getComponentId:function(comp){
return comp.getItemId()
},
add:function(comp){
this.initItems();
var args=arguments.length>1;
if(args||Ext.isArray(comp)){
var result=[];
Ext.each(args?arguments:comp,function(c){
result.push(this.add(c))
},this);
return result
}
var c=this.lookupComponent(this.applyDefaults(comp));
var index=this.items.length;
if(this.fireEvent('beforeadd',this,c,index)!==false&&this.onBeforeAdd(c)!==false){
this.items.add(c);
c.onAdded(this,index);
this.onAdd(c);
this.fireEvent('add',this,c,index)
}
return c
},
onAdd:function(c){
},
onAdded:function(container,pos){
this.ownerCt=container;
this.initRef();
this.cascade(function(c){
c.initRef()
});
this.fireEvent('added',this,container,pos)
},
insert:function(index,comp){
var args=arguments,length=args.length,result=[],i,c;
this.initItems();
if(length>2){
for(i=length-1;i>=1;--i){
result.push(this.insert(index,args[i]))
}
return result
}
c=this.lookupComponent(this.applyDefaults(comp));
index=Math.min(index,this.items.length);
if(this.fireEvent('beforeadd',this,c,index)!==false&&this.onBeforeAdd(c)!==false){
if(c.ownerCt==this){
this.items.remove(c)
}
this.items.insert(index,c);
c.onAdded(this,index);
this.onAdd(c);
this.fireEvent('add',this,c,index)
}
return c
},
applyDefaults:function(c){
var d=this.defaults;
if(d){
if(Ext.isFunction(d)){
d=d.call(this,c)
}
if(Ext.isString(c)){
c=Ext.ComponentMgr.get(c);
Ext.apply(c,d)
}else if(!c.events){
Ext.applyIf(c.isAction?c.initialConfig:c,d)
}else{
Ext.apply(c,d)
}
}
return c
},
onBeforeAdd:function(item){
if(item.ownerCt){
item.ownerCt.remove(item,false)
}
if(this.hideBorders===true){
item.border=item.border===true
}
},
remove:function(comp,autoDestroy){
this.initItems();
var c=this.getComponent(comp);
if(c&&this.fireEvent('beforeremove',this,c)!==false){
this.doRemove(c,autoDestroy);
this.fireEvent('remove',this,c)
}
return c
},
onRemove:function(c){
},
doRemove:function(c,autoDestroy){
var l=this.layout,hasLayout=l&&this.rendered;
if(hasLayout){
l.onRemove(c)
}
this.items.remove(c);
c.onRemoved();
this.onRemove(c);
if(autoDestroy===true||autoDestroy!==false&&this.autoDestroy){
c.destroy()
}
if(hasLayout){
l.afterRemove(c)
}
},
removeAll:function(autoDestroy){
this.initItems();
var item,rem=[],items=[];
this.items.each(function(i){
rem.push(i)
});
for(var i=0,len=rem.length;i<len;++i){
item=rem[i];
this.remove(item,autoDestroy);
if(item.ownerCt!==this){
items.push(item)
}
}
return items
},
getComponent:function(comp){
if(Ext.isObject(comp)){
comp=comp.getItemId()
}
return this.items.get(comp)
},
lookupComponent:function(comp){
if(Ext.isString(comp)){
return Ext.ComponentMgr.get(comp)
}else if(!comp.events){
return this.createComponent(comp)
}
return comp
},
createComponent:function(config,defaultType){
if(config.render){
return config
}
var c=Ext.create(Ext.apply({ownerCt:this},config),defaultType||this.defaultType);
delete c.initialConfig.ownerCt;
delete c.ownerCt;
return c
},
canLayout:function(){
var el=this.getVisibilityEl();
return el&&el.dom&&!el.isStyle('display','none')
},
doLayout:function(shallow,force){
var rendered=this.rendered,forceLayout=force||this.forceLayout;
if(this.collapsed||!this.canLayout()){
this.deferLayout=this.deferLayout||!shallow;
if(!forceLayout){
return
}
shallow=shallow&&!this.deferLayout
}else{
delete this.deferLayout
}
if(rendered&&this.layout){
this.layout.layout()
}
if(shallow!==true&&this.items){
var cs=this.items.items;
for(var i=0,len=cs.length;i<len;i++){
var c=cs[i];
if(c.doLayout){
c.doLayout(false,forceLayout)
}
}
}
if(rendered){
this.onLayout(shallow,forceLayout)
}
this.hasLayout=true;
delete this.forceLayout
},
onLayout:Ext.emptyFn,
shouldBufferLayout:function(){
var hl=this.hasLayout;
if(this.ownerCt){
return hl?!this.hasLayoutPending():false
}
return hl
},
hasLayoutPending:function(){
var pending=false;
this.ownerCt.bubble(function(c){
if(c.layoutPending){
pending=true;
return false
}
});
return pending
},
onShow:function(){
Ext.Container.superclass.onShow.call(this);
if(Ext.isDefined(this.deferLayout)){
delete this.deferLayout;
this.doLayout(true)
}
},
getLayout:function(){
if(!this.layout){
var layout=new Ext.layout.AutoLayout(this.layoutConfig);
this.setLayout(layout)
}
return this.layout
},
beforeDestroy:function(){
var c;
if(this.items){
while(c=this.items.first()){
this.doRemove(c,true)
}
}
if(this.monitorResize){
Ext.EventManager.removeResizeListener(this.doLayout,this)
}
Ext.destroy(this.layout);
Ext.Container.superclass.beforeDestroy.call(this)
},
cascade:function(fn,scope,args){
if(fn.apply(scope||this,args||[this])!==false){
if(this.items){
var cs=this.items.items;
for(var i=0,len=cs.length;i<len;i++){
if(cs[i].cascade){
cs[i].cascade(fn,scope,args)
}else{
fn.apply(scope||cs[i],args||[cs[i]])
}
}
}
}
return this
},
findById:function(id){
var m=null,ct=this;
this.cascade(function(c){
if(ct!=c&&c.id===id){
m=c;
return false
}
});
return m
},
findByType:function(xtype,shallow){
return this.findBy(function(c){
return c.isXType(xtype,shallow)
})
},
find:function(prop,value){
return this.findBy(function(c){
return c[prop]===value
})
},
findBy:function(fn,scope){
var m=[],ct=this;
this.cascade(function(c){
if(ct!=c&&fn.call(scope||c,c,ct)===true){
m.push(c)
}
});
return m
},
get:function(key){
return this.getComponent(key)
}
});
Ext.Container.LAYOUTS={};
Ext.reg('container',Ext.Container);
Ext.layout.ContainerLayout=Ext.extend(Object,{
monitorResize:false,
activeItem:null,
constructor:function(config){
this.id=Ext.id(null,'ext-layout-');
Ext.apply(this,config)
},
type:'container',
IEMeasureHack:function(target,viewFlag){
var tChildren=target.dom.childNodes,tLen=tChildren.length,c,d=[],e,i,ret;
for(i=0;i<tLen;i++){
c=tChildren[i];
e=Ext.get(c);
if(e){
d[i]=e.getStyle('display');
e.setStyle({display:'none'})
}
}
ret=target?target.getViewSize(viewFlag):{};
for(i=0;i<tLen;i++){
c=tChildren[i];
e=Ext.get(c);
if(e){
e.setStyle({display:d[i]})
}
}
return ret
},
getLayoutTargetSize:Ext.EmptyFn,
layout:function(){
var ct=this.container,target=ct.getLayoutTarget();
if(!(this.hasLayout||Ext.isEmpty(this.targetCls))){
target.addClass(this.targetCls)
}
this.onLayout(ct,target);
ct.fireEvent('afterlayout',ct,this)
},
onLayout:function(ct,target){
this.renderAll(ct,target)
},
isValidParent:function(c,target){
return target&&c.getPositionEl().dom.parentNode==(target.dom||target)
},
renderAll:function(ct,target){
var items=ct.items.items,i,c,len=items.length;
for(i=0;i<len;i++){
c=items[i];
if(c&&(!c.rendered||!this.isValidParent(c,target))){
this.renderItem(c,i,target)
}
}
},
renderItem:function(c,position,target){
if(c){
if(!c.rendered){
c.render(target,position);
this.configureItem(c)
}else if(!this.isValidParent(c,target)){
if(Ext.isNumber(position)){
position=target.dom.childNodes[position]
}
target.dom.insertBefore(c.getPositionEl().dom,position||null);
c.container=target;
this.configureItem(c)
}
}
},
getRenderedItems:function(ct){
var t=ct.getLayoutTarget(),cti=ct.items.items,len=cti.length,i,c,items=[];
for(i=0;i<len;i++){
if((c=cti[i]).rendered&&this.isValidParent(c,t)&&c.shouldLayout!==false){
items.push(c)
}
}
;
return items
},
configureItem:function(c){
if(this.extraCls){
var t=c.getPositionEl?c.getPositionEl():c;
t.addClass(this.extraCls)
}
if(c.doLayout&&this.forceLayout){
c.doLayout()
}
if(this.renderHidden&&c!=this.activeItem){
c.hide()
}
},
onRemove:function(c){
if(this.activeItem==c){
delete this.activeItem
}
if(c.rendered&&this.extraCls){
var t=c.getPositionEl?c.getPositionEl():c;
t.removeClass(this.extraCls)
}
},
afterRemove:function(c){
if(c.removeRestore){
c.removeMode='container';
delete c.removeRestore
}
},
onResize:function(){
var ct=this.container,b;
if(ct.collapsed){
return
}
if(b=ct.bufferResize&&ct.shouldBufferLayout()){
if(!this.resizeTask){
this.resizeTask=new Ext.util.DelayedTask(this.runLayout,this);
this.resizeBuffer=Ext.isNumber(b)?b:50
}
ct.layoutPending=true;
this.resizeTask.delay(this.resizeBuffer)
}else{
this.runLayout()
}
},
runLayout:function(){
var ct=this.container;
this.layout();
ct.onLayout();
delete ct.layoutPending
},
setContainer:function(ct){
if(this.monitorResize&&ct!=this.container){
var old=this.container;
if(old){
old.un(old.resizeEvent,this.onResize,this)
}
if(ct){
ct.on(ct.resizeEvent,this.onResize,this)
}
}
this.container=ct
},
parseMargins:function(v){
if(Ext.isNumber(v)){
v=v.toString()
}
var ms=v.split(' '),len=ms.length;
if(len==1){
ms[1]=ms[2]=ms[3]=ms[0]
}else if(len==2){
ms[2]=ms[0];
ms[3]=ms[1]
}else if(len==3){
ms[3]=ms[1]
}
return{
top:parseInt(ms[0],10)||0,
right:parseInt(ms[1],10)||0,
bottom:parseInt(ms[2],10)||0,
left:parseInt(ms[3],10)||0
}
},
fieldTpl:function(){
var t=new Ext.Template('<div class="x-form-item {itemCls}" tabIndex="-1">','<label for="{id}" style="{labelStyle}" class="x-form-item-label">{label}{labelSeparator}</label>','<div class="x-form-element" id="x-form-el-{id}" style="{elementStyle}">','</div><div class="{clearCls}"></div>','</div>');
t.disableFormats=true;
return t.compile()
}(),
destroy:function(){
if(this.resizeTask&&this.resizeTask.cancel){
this.resizeTask.cancel()
}
if(this.container){
this.container.un(this.container.resizeEvent,this.onResize,this)
}
if(!Ext.isEmpty(this.targetCls)){
var target=this.container.getLayoutTarget();
if(target){
target.removeClass(this.targetCls)
}
}
}
});
Ext.layout.AutoLayout=Ext.extend(Ext.layout.ContainerLayout,{
type:'auto',
monitorResize:true,
onLayout:function(ct,target){
Ext.layout.AutoLayout.superclass.onLayout.call(this,ct,target);
var cs=this.getRenderedItems(ct),len=cs.length,i,c;
for(i=0;i<len;i++){
c=cs[i];
if(c.doLayout){
c.doLayout(true)
}
}
}
});
Ext.Container.LAYOUTS['auto']=Ext.layout.AutoLayout;
Ext.layout.FitLayout=Ext.extend(Ext.layout.ContainerLayout,{
monitorResize:true,
type:'fit',
getLayoutTargetSize:function(){
var target=this.container.getLayoutTarget();
if(!target){
return{}
}
return target.getStyleSize()
},
onLayout:function(ct,target){
Ext.layout.FitLayout.superclass.onLayout.call(this,ct,target);
if(!ct.collapsed){
this.setItemSize(this.activeItem||ct.items.itemAt(0),this.getLayoutTargetSize())
}
},
setItemSize:function(item,size){
if(item&&size.height>0){
item.setSize(size)
}
}
});
Ext.Container.LAYOUTS['fit']=Ext.layout.FitLayout;
Ext.layout.CardLayout=Ext.extend(Ext.layout.FitLayout,{
deferredRender:false,
layoutOnCardChange:false,
renderHidden:true,
type:'card',
setActiveItem:function(item){
var ai=this.activeItem,ct=this.container;
item=ct.getComponent(item);
if(item&&ai!=item){
if(ai){
ai.hide();
if(ai.hidden!==true){
return false
}
ai.fireEvent('deactivate',ai)
}
var layout=item.doLayout&&(this.layoutOnCardChange||!item.rendered);
this.activeItem=item;
delete item.deferLayout;
item.show();
this.layout();
if(layout){
item.doLayout()
}
item.fireEvent('activate',item)
}
},
renderAll:function(ct,target){
if(this.deferredRender){
this.renderItem(this.activeItem,undefined,target)
}else{
Ext.layout.CardLayout.superclass.renderAll.call(this,ct,target)
}
}
});
Ext.Container.LAYOUTS['card']=Ext.layout.CardLayout;
Ext.layout.AnchorLayout=Ext.extend(Ext.layout.ContainerLayout,{
monitorResize:true,
type:'anchor',
defaultAnchor:'100%',
parseAnchorRE:/^(r|right|b|bottom)$/i,
getLayoutTargetSize:function(){
var target=this.container.getLayoutTarget(),ret={};
if(target){
ret=target.getViewSize();
if(Ext.isIE&&Ext.isStrict&&ret.width==0){
ret=target.getStyleSize()
}
ret.width-=target.getPadding('lr');
ret.height-=target.getPadding('tb')
}
return ret
},
onLayout:function(container,target){
Ext.layout.AnchorLayout.superclass.onLayout.call(this,container,target);
var size=this.getLayoutTargetSize(),containerWidth=size.width,containerHeight=size.height,overflow=target.getStyle('overflow'),components=this.getRenderedItems(container),len=components.length,boxes=[],box,anchorWidth,anchorHeight,component,anchorSpec,calcWidth,calcHeight,anchorsArray,totalHeight=0,i,el;
if(containerWidth<20&&containerHeight<20){
return
}
if(container.anchorSize){
if(typeof container.anchorSize=='number'){
anchorWidth=container.anchorSize
}else{
anchorWidth=container.anchorSize.width;
anchorHeight=container.anchorSize.height
}
}else{
anchorWidth=container.initialConfig.width;
anchorHeight=container.initialConfig.height
}
for(i=0;i<len;i++){
component=components[i];
el=component.getPositionEl();
if(!component.anchor&&component.items&&!Ext.isNumber(component.width)&&!(Ext.isIE6&&Ext.isStrict)){
component.anchor=this.defaultAnchor
}
if(component.anchor){
anchorSpec=component.anchorSpec;
if(!anchorSpec){
anchorsArray=component.anchor.split(' ');
component.anchorSpec=anchorSpec={
right:this.parseAnchor(anchorsArray[0],component.initialConfig.width,anchorWidth),
bottom:this.parseAnchor(anchorsArray[1],component.initialConfig.height,anchorHeight)
}
}
calcWidth=anchorSpec.right?this.adjustWidthAnchor(anchorSpec.right(containerWidth)-el.getMargins('lr'),component):undefined;
calcHeight=anchorSpec.bottom?this.adjustHeightAnchor(anchorSpec.bottom(containerHeight)-el.getMargins('tb'),component):undefined;
if(calcWidth||calcHeight){
boxes.push({
component:component,
width:calcWidth||undefined,
height:calcHeight||undefined
})
}
}
}
for(i=0,len=boxes.length;i<len;i++){
box=boxes[i];
box.component.setSize(box.width,box.height)
}
if(overflow&&overflow!='hidden'&&!this.adjustmentPass){
var newTargetSize=this.getLayoutTargetSize();
if(newTargetSize.width!=size.width||newTargetSize.height!=size.height){
this.adjustmentPass=true;
this.onLayout(container,target)
}
}
delete this.adjustmentPass
},
parseAnchor:function(a,start,cstart){
if(a&&a!='none'){
var last;
if(this.parseAnchorRE.test(a)){
var diff=cstart-start;
return function(v){
if(v!==last){
last=v;
return v-diff
}
}
}else if(a.indexOf('%')!=-1){
var ratio=parseFloat(a.replace('%',''))*0.01;
return function(v){
if(v!==last){
last=v;
return Math.floor(v*ratio)
}
}
}else{
a=parseInt(a,10);
if(!isNaN(a)){
return function(v){
if(v!==last){
last=v;
return v+a
}
}
}
}
}
return false
},
adjustWidthAnchor:function(value,comp){
return value
},
adjustHeightAnchor:function(value,comp){
return value
}
});
Ext.Container.LAYOUTS['anchor']=Ext.layout.AnchorLayout;
Ext.layout.ColumnLayout=Ext.extend(Ext.layout.ContainerLayout,{
monitorResize:true,
type:'column',
extraCls:'x-column',
scrollOffset:0,
targetCls:'x-column-layout-ct',
isValidParent:function(c,target){
return this.innerCt&&c.getPositionEl().dom.parentNode==this.innerCt.dom
},
getLayoutTargetSize:function(){
var target=this.container.getLayoutTarget(),ret;
if(target){
ret=target.getViewSize();
if(Ext.isIE&&Ext.isStrict&&ret.width==0){
ret=target.getStyleSize()
}
ret.width-=target.getPadding('lr');
ret.height-=target.getPadding('tb')
}
return ret
},
renderAll:function(ct,target){
if(!this.innerCt){
this.innerCt=target.createChild({cls:'x-column-inner'});
this.innerCt.createChild({cls:'x-clear'})
}
Ext.layout.ColumnLayout.superclass.renderAll.call(this,ct,this.innerCt)
},
onLayout:function(ct,target){
var cs=ct.items.items,len=cs.length,c,i,m,margins=[];
this.renderAll(ct,target);
var size=this.getLayoutTargetSize();
if(size.width<1&&size.height<1){
return
}
var w=size.width-this.scrollOffset,h=size.height,pw=w;
this.innerCt.setWidth(w);
for(i=0;i<len;i++){
c=cs[i];
m=c.getPositionEl().getMargins('lr');
margins[i]=m;
if(!c.columnWidth){
pw-=c.getWidth()+m
}
}
pw=pw<0?0:pw;
for(i=0;i<len;i++){
c=cs[i];
m=margins[i];
if(c.columnWidth){
c.setSize(Math.floor(c.columnWidth*pw)-m)
}
}
if(Ext.isIE){
if(i=target.getStyle('overflow')&&i!='hidden'&&!this.adjustmentPass){
var ts=this.getLayoutTargetSize();
if(ts.width!=size.width){
this.adjustmentPass=true;
this.onLayout(ct,target)
}
}
}
delete this.adjustmentPass
}
});
Ext.Container.LAYOUTS['column']=Ext.layout.ColumnLayout;
Ext.layout.BorderLayout=Ext.extend(Ext.layout.ContainerLayout,{
monitorResize:true,
rendered:false,
type:'border',
targetCls:'x-border-layout-ct',
getLayoutTargetSize:function(){
var target=this.container.getLayoutTarget();
return target?target.getViewSize():{}
},
onLayout:function(ct,target){
var collapsed,i,c,pos,items=ct.items.items,len=items.length;
if(!this.rendered){
collapsed=[];
for(i=0;i<len;i++){
c=items[i];
pos=c.region;
if(c.collapsed){
collapsed.push(c)
}
c.collapsed=false;
if(!c.rendered){
c.render(target,i);
c.getPositionEl().addClass('x-border-panel')
}
this[pos]=pos!='center'&&c.split?new Ext.layout.BorderLayout.SplitRegion(this,c.initialConfig,pos):new Ext.layout.BorderLayout.Region(this,c.initialConfig,pos);
this[pos].render(target,c)
}
this.rendered=true
}
var size=this.getLayoutTargetSize();
if(size.width<20||size.height<20){
if(collapsed){
this.restoreCollapsed=collapsed
}
return
}else if(this.restoreCollapsed){
collapsed=this.restoreCollapsed;
delete this.restoreCollapsed
}
var w=size.width,h=size.height,centerW=w,centerH=h,centerY=0,centerX=0,n=this.north,s=this.south,west=this.west,e=this.east,c=this.center,b,m,totalWidth,totalHeight;
if(!c&&Ext.layout.BorderLayout.WARN!==false){
throw'No center region defined in BorderLayout '+ct.id
}
if(n&&n.isVisible()){
b=n.getSize();
m=n.getMargins();
b.width=w-(m.left+m.right);
b.x=m.left;
b.y=m.top;
centerY=b.height+b.y+m.bottom;
centerH-=centerY;
n.applyLayout(b)
}
if(s&&s.isVisible()){
b=s.getSize();
m=s.getMargins();
b.width=w-(m.left+m.right);
b.x=m.left;
totalHeight=b.height+m.top+m.bottom;
b.y=h-totalHeight+m.top;
centerH-=totalHeight;
s.applyLayout(b)
}
if(west&&west.isVisible()){
b=west.getSize();
m=west.getMargins();
b.height=centerH-(m.top+m.bottom);
b.x=m.left;
b.y=centerY+m.top;
totalWidth=b.width+m.left+m.right;
centerX+=totalWidth;
centerW-=totalWidth;
west.applyLayout(b)
}
if(e&&e.isVisible()){
b=e.getSize();
m=e.getMargins();
b.height=centerH-(m.top+m.bottom);
totalWidth=b.width+m.left+m.right;
b.x=w-totalWidth+m.left;
b.y=centerY+m.top;
centerW-=totalWidth;
e.applyLayout(b)
}
if(c){
m=c.getMargins();
var centerBox={
x:centerX+m.left,
y:centerY+m.top,
width:centerW-(m.left+m.right),
height:centerH-(m.top+m.bottom)
};
c.applyLayout(centerBox)
}
if(collapsed){
for(i=0,len=collapsed.length;i<len;i++){
collapsed[i].collapse(false)
}
}
if(Ext.isIE&&Ext.isStrict){
target.repaint()
}
if(i=target.getStyle('overflow')&&i!='hidden'&&!this.adjustmentPass){
var ts=this.getLayoutTargetSize();
if(ts.width!=size.width||ts.height!=size.height){
this.adjustmentPass=true;
this.onLayout(ct,target)
}
}
delete this.adjustmentPass
},
destroy:function(){
var r=[
'north',
'south',
'east',
'west'
],i,region;
for(i=0;i<r.length;i++){
region=this[r[i]];
if(region){
if(region.destroy){
region.destroy()
}else if(region.split){
region.split.destroy(true)
}
}
}
Ext.layout.BorderLayout.superclass.destroy.call(this)
}
});
Ext.layout.BorderLayout.Region=function(layout,config,pos){
Ext.apply(this,config);
this.layout=layout;
this.position=pos;
this.state={};
if(typeof this.margins=='string'){
this.margins=this.layout.parseMargins(this.margins)
}
this.margins=Ext.applyIf(this.margins||{},this.defaultMargins);
if(this.collapsible){
if(typeof this.cmargins=='string'){
this.cmargins=this.layout.parseMargins(this.cmargins)
}
if(this.collapseMode=='mini'&&!this.cmargins){
this.cmargins={
left:0,
top:0,
right:0,
bottom:0
}
}else{
this.cmargins=Ext.applyIf(this.cmargins||{},pos=='north'||pos=='south'?this.defaultNSCMargins:this.defaultEWCMargins)
}
}
};
Ext.layout.BorderLayout.Region.prototype={
collapsible:false,
split:false,
floatable:true,
minWidth:50,
minHeight:50,
defaultMargins:{
left:0,
top:0,
right:0,
bottom:0
},
defaultNSCMargins:{
left:5,
top:5,
right:5,
bottom:5
},
defaultEWCMargins:{
left:5,
top:0,
right:5,
bottom:0
},
floatingZIndex:100,
isCollapsed:false,
render:function(ct,p){
this.panel=p;
p.el.enableDisplayMode();
this.targetEl=ct;
this.el=p.el;
var gs=p.getState,ps=this.position;
p.getState=function(){
return Ext.apply(gs.call(p)||{},this.state)
}.createDelegate(this);
if(ps!='center'){
p.allowQueuedExpand=false;
p.on({
beforecollapse:this.beforeCollapse,
collapse:this.onCollapse,
beforeexpand:this.beforeExpand,
expand:this.onExpand,
hide:this.onHide,
show:this.onShow,
scope:this
});
if(this.collapsible||this.floatable){
p.collapseEl='el';
p.slideAnchor=this.getSlideAnchor()
}
if(p.tools&&p.tools.toggle){
p.tools.toggle.addClass('x-tool-collapse-'+ps);
p.tools.toggle.addClassOnOver('x-tool-collapse-'+ps+'-over')
}
}
},
getCollapsedEl:function(){
if(!this.collapsedEl){
if(!this.toolTemplate){
var tt=new Ext.Template('<div class="x-tool x-tool-{id}">&#160;</div>');
tt.disableFormats=true;
tt.compile();
Ext.layout.BorderLayout.Region.prototype.toolTemplate=tt
}
this.collapsedEl=this.targetEl.createChild({
cls:'x-layout-collapsed x-layout-collapsed-'+this.position,
id:this.panel.id+'-xcollapsed'
});
this.collapsedEl.enableDisplayMode('block');
if(this.collapseMode=='mini'){
this.collapsedEl.addClass('x-layout-cmini-'+this.position);
this.miniCollapsedEl=this.collapsedEl.createChild({
cls:'x-layout-mini x-layout-mini-'+this.position,
html:'&#160;'
});
this.miniCollapsedEl.addClassOnOver('x-layout-mini-over');
this.collapsedEl.addClassOnOver('x-layout-collapsed-over');
this.collapsedEl.on('click',this.onExpandClick,this,{stopEvent:true})
}else{
if(this.collapsible!==false&&!this.hideCollapseTool){
var t=this.expandToolEl=this.toolTemplate.append(this.collapsedEl.dom,{id:'expand-'+this.position},true);
t.addClassOnOver('x-tool-expand-'+this.position+'-over');
t.on('click',this.onExpandClick,this,{stopEvent:true})
}
if(this.floatable!==false||this.titleCollapse){
this.collapsedEl.addClassOnOver('x-layout-collapsed-over');
this.collapsedEl.on('click',this[this.floatable?'collapseClick':'onExpandClick'],this)
}
}
}
return this.collapsedEl
},
onExpandClick:function(e){
if(this.isSlid){
this.panel.expand(false)
}else{
this.panel.expand()
}
},
onCollapseClick:function(e){
this.panel.collapse()
},
beforeCollapse:function(p,animate){
this.lastAnim=animate;
if(this.splitEl){
this.splitEl.hide()
}
this.getCollapsedEl().show();
var el=this.panel.getEl();
this.originalZIndex=el.getStyle('z-index');
el.setStyle('z-index',100);
this.isCollapsed=true;
this.layout.layout()
},
onCollapse:function(animate){
this.panel.el.setStyle('z-index',1);
if(this.lastAnim===false||this.panel.animCollapse===false){
this.getCollapsedEl().dom.style.visibility='visible'
}else{
this.getCollapsedEl().slideIn(this.panel.slideAnchor,{duration:0.2})
}
this.state.collapsed=true;
this.panel.saveState()
},
beforeExpand:function(animate){
if(this.isSlid){
this.afterSlideIn()
}
var c=this.getCollapsedEl();
this.el.show();
if(this.position=='east'||this.position=='west'){
this.panel.setSize(undefined,c.getHeight())
}else{
this.panel.setSize(c.getWidth(),undefined)
}
c.hide();
c.dom.style.visibility='hidden';
this.panel.el.setStyle('z-index',this.floatingZIndex)
},
onExpand:function(){
this.isCollapsed=false;
if(this.splitEl){
this.splitEl.show()
}
this.layout.layout();
this.panel.el.setStyle('z-index',this.originalZIndex);
this.state.collapsed=false;
this.panel.saveState()
},
collapseClick:function(e){
if(this.isSlid){
e.stopPropagation();
this.slideIn()
}else{
e.stopPropagation();
this.slideOut()
}
},
onHide:function(){
if(this.isCollapsed){
this.getCollapsedEl().hide()
}else if(this.splitEl){
this.splitEl.hide()
}
},
onShow:function(){
if(this.isCollapsed){
this.getCollapsedEl().show()
}else if(this.splitEl){
this.splitEl.show()
}
},
isVisible:function(){
return!this.panel.hidden
},
getMargins:function(){
return this.isCollapsed&&this.cmargins?this.cmargins:this.margins
},
getSize:function(){
return this.isCollapsed?this.getCollapsedEl().getSize():this.panel.getSize()
},
setPanel:function(panel){
this.panel=panel
},
getMinWidth:function(){
return this.minWidth
},
getMinHeight:function(){
return this.minHeight
},
applyLayoutCollapsed:function(box){
var ce=this.getCollapsedEl();
ce.setLeftTop(box.x,box.y);
ce.setSize(box.width,box.height)
},
applyLayout:function(box){
if(this.isCollapsed){
this.applyLayoutCollapsed(box)
}else{
this.panel.setPosition(box.x,box.y);
this.panel.setSize(box.width,box.height)
}
},
beforeSlide:function(){
this.panel.beforeEffect()
},
afterSlide:function(){
this.panel.afterEffect()
},
initAutoHide:function(){
if(this.autoHide!==false){
if(!this.autoHideHd){
this.autoHideSlideTask=new Ext.util.DelayedTask(this.slideIn,this);
this.autoHideHd={
'mouseout':function(e){
if(!e.within(this.el,true)){
this.autoHideSlideTask.delay(500)
}
},
'mouseover':function(e){
this.autoHideSlideTask.cancel()
},
scope:this
}
}
this.el.on(this.autoHideHd);
this.collapsedEl.on(this.autoHideHd)
}
},
clearAutoHide:function(){
if(this.autoHide!==false){
this.el.un('mouseout',this.autoHideHd.mouseout);
this.el.un('mouseover',this.autoHideHd.mouseover);
this.collapsedEl.un('mouseout',this.autoHideHd.mouseout);
this.collapsedEl.un('mouseover',this.autoHideHd.mouseover)
}
},
clearMonitor:function(){
Ext.getDoc().un('click',this.slideInIf,this)
},
slideOut:function(){
if(this.isSlid||this.el.hasActiveFx()){
return
}
this.isSlid=true;
var ts=this.panel.tools,dh,pc;
if(ts&&ts.toggle){
ts.toggle.hide()
}
this.el.show();
pc=this.panel.collapsed;
this.panel.collapsed=false;
if(this.position=='east'||this.position=='west'){
dh=this.panel.deferHeight;
this.panel.deferHeight=false;
this.panel.setSize(undefined,this.collapsedEl.getHeight());
this.panel.deferHeight=dh
}else{
this.panel.setSize(this.collapsedEl.getWidth(),undefined)
}
this.panel.collapsed=pc;
this.restoreLT=[
this.el.dom.style.left,
this.el.dom.style.top
];
this.el.alignTo(this.collapsedEl,this.getCollapseAnchor());
this.el.setStyle('z-index',this.floatingZIndex+2);
this.panel.el.replaceClass('x-panel-collapsed','x-panel-floating');
if(this.animFloat!==false){
this.beforeSlide();
this.el.slideIn(this.getSlideAnchor(),{
callback:function(){
this.afterSlide();
this.initAutoHide();
Ext.getDoc().on('click',this.slideInIf,this)
},
scope:this,
block:true
})
}else{
this.initAutoHide();
Ext.getDoc().on('click',this.slideInIf,this)
}
},
afterSlideIn:function(){
this.clearAutoHide();
this.isSlid=false;
this.clearMonitor();
this.el.setStyle('z-index','');
this.panel.el.replaceClass('x-panel-floating','x-panel-collapsed');
this.el.dom.style.left=this.restoreLT[0];
this.el.dom.style.top=this.restoreLT[1];
var ts=this.panel.tools;
if(ts&&ts.toggle){
ts.toggle.show()
}
},
slideIn:function(cb){
if(!this.isSlid||this.el.hasActiveFx()){
Ext.callback(cb);
return
}
this.isSlid=false;
if(this.animFloat!==false){
this.beforeSlide();
this.el.slideOut(this.getSlideAnchor(),{
callback:function(){
this.el.hide();
this.afterSlide();
this.afterSlideIn();
Ext.callback(cb)
},
scope:this,
block:true
})
}else{
this.el.hide();
this.afterSlideIn()
}
},
slideInIf:function(e){
if(!e.within(this.el)){
this.slideIn()
}
},
anchors:{
'west':'left',
'east':'right',
'north':'top',
'south':'bottom'
},
sanchors:{
'west':'l',
'east':'r',
'north':'t',
'south':'b'
},
canchors:{
'west':'tl-tr',
'east':'tr-tl',
'north':'tl-bl',
'south':'bl-tl'
},
getAnchor:function(){
return this.anchors[this.position]
},
getCollapseAnchor:function(){
return this.canchors[this.position]
},
getSlideAnchor:function(){
return this.sanchors[this.position]
},
getAlignAdj:function(){
var cm=this.cmargins;
switch(this.position){
case'west':
return[
0,
0
];
break;
case'east':
return[
0,
0
];
break;
case'north':
return[
0,
0
];
break;
case'south':
return[
0,
0
];
break
}
},
getExpandAdj:function(){
var c=this.collapsedEl,cm=this.cmargins;
switch(this.position){
case'west':
return[
-(cm.right+c.getWidth()+cm.left),
0
];
break;
case'east':
return[
cm.right+c.getWidth()+cm.left,
0
];
break;
case'north':
return[
0,
-(cm.top+cm.bottom+c.getHeight())
];
break;
case'south':
return[
0,
cm.top+cm.bottom+c.getHeight()
];
break
}
},
destroy:function(){
if(this.autoHideSlideTask&&this.autoHideSlideTask.cancel){
this.autoHideSlideTask.cancel()
}
Ext.destroyMembers(this,'miniCollapsedEl','collapsedEl','expandToolEl')
}
};
Ext.layout.BorderLayout.SplitRegion=function(layout,config,pos){
Ext.layout.BorderLayout.SplitRegion.superclass.constructor.call(this,layout,config,pos);
this.applyLayout=this.applyFns[pos]
};
Ext.extend(Ext.layout.BorderLayout.SplitRegion,Ext.layout.BorderLayout.Region,{
splitTip:'Drag to resize.',
collapsibleSplitTip:'Drag to resize. Double click to hide.',
useSplitTips:false,
splitSettings:{
north:{
orientation:Ext.SplitBar.VERTICAL,
placement:Ext.SplitBar.TOP,
maxFn:'getVMaxSize',
minProp:'minHeight',
maxProp:'maxHeight'
},
south:{
orientation:Ext.SplitBar.VERTICAL,
placement:Ext.SplitBar.BOTTOM,
maxFn:'getVMaxSize',
minProp:'minHeight',
maxProp:'maxHeight'
},
east:{
orientation:Ext.SplitBar.HORIZONTAL,
placement:Ext.SplitBar.RIGHT,
maxFn:'getHMaxSize',
minProp:'minWidth',
maxProp:'maxWidth'
},
west:{
orientation:Ext.SplitBar.HORIZONTAL,
placement:Ext.SplitBar.LEFT,
maxFn:'getHMaxSize',
minProp:'minWidth',
maxProp:'maxWidth'
}
},
applyFns:{
west:function(box){
if(this.isCollapsed){
return this.applyLayoutCollapsed(box)
}
var sd=this.splitEl.dom,s=sd.style;
this.panel.setPosition(box.x,box.y);
var sw=sd.offsetWidth;
s.left=box.x+box.width-sw+'px';
s.top=box.y+'px';
s.height=Math.max(0,box.height)+'px';
this.panel.setSize(box.width-sw,box.height)
},
east:function(box){
if(this.isCollapsed){
return this.applyLayoutCollapsed(box)
}
var sd=this.splitEl.dom,s=sd.style;
var sw=sd.offsetWidth;
this.panel.setPosition(box.x+sw,box.y);
s.left=box.x+'px';
s.top=box.y+'px';
s.height=Math.max(0,box.height)+'px';
this.panel.setSize(box.width-sw,box.height)
},
north:function(box){
if(this.isCollapsed){
return this.applyLayoutCollapsed(box)
}
var sd=this.splitEl.dom,s=sd.style;
var sh=sd.offsetHeight;
this.panel.setPosition(box.x,box.y);
s.left=box.x+'px';
s.top=box.y+box.height-sh+'px';
s.width=Math.max(0,box.width)+'px';
this.panel.setSize(box.width,box.height-sh)
},
south:function(box){
if(this.isCollapsed){
return this.applyLayoutCollapsed(box)
}
var sd=this.splitEl.dom,s=sd.style;
var sh=sd.offsetHeight;
this.panel.setPosition(box.x,box.y+sh);
s.left=box.x+'px';
s.top=box.y+'px';
s.width=Math.max(0,box.width)+'px';
this.panel.setSize(box.width,box.height-sh)
}
},
render:function(ct,p){
Ext.layout.BorderLayout.SplitRegion.superclass.render.call(this,ct,p);
var ps=this.position;
this.splitEl=ct.createChild({
cls:'x-layout-split x-layout-split-'+ps,
html:'&#160;',
id:this.panel.id+'-xsplit'
});
if(this.collapseMode=='mini'){
this.miniSplitEl=this.splitEl.createChild({
cls:'x-layout-mini x-layout-mini-'+ps,
html:'&#160;'
});
this.miniSplitEl.addClassOnOver('x-layout-mini-over');
this.miniSplitEl.on('click',this.onCollapseClick,this,{stopEvent:true})
}
var s=this.splitSettings[ps];
this.split=new Ext.SplitBar(this.splitEl.dom,p.el,s.orientation);
this.split.tickSize=this.tickSize;
this.split.placement=s.placement;
this.split.getMaximumSize=this[s.maxFn].createDelegate(this);
this.split.minSize=this.minSize||this[s.minProp];
this.split.on('beforeapply',this.onSplitMove,this);
this.split.useShim=this.useShim===true;
this.maxSize=this.maxSize||this[s.maxProp];
if(p.hidden){
this.splitEl.hide()
}
if(this.useSplitTips){
this.splitEl.dom.title=this.collapsible?this.collapsibleSplitTip:this.splitTip
}
if(this.collapsible){
this.splitEl.on('dblclick',this.onCollapseClick,this)
}
},
getSize:function(){
if(this.isCollapsed){
return this.collapsedEl.getSize()
}
var s=this.panel.getSize();
if(this.position=='north'||this.position=='south'){
s.height+=this.splitEl.dom.offsetHeight
}else{
s.width+=this.splitEl.dom.offsetWidth
}
return s
},
getHMaxSize:function(){
var cmax=this.maxSize||10000;
var center=this.layout.center;
return Math.min(cmax,this.el.getWidth()+center.el.getWidth()-center.getMinWidth())
},
getVMaxSize:function(){
var cmax=this.maxSize||10000;
var center=this.layout.center;
return Math.min(cmax,this.el.getHeight()+center.el.getHeight()-center.getMinHeight())
},
onSplitMove:function(split,newSize){
var s=this.panel.getSize();
this.lastSplitSize=newSize;
if(this.position=='north'||this.position=='south'){
this.panel.setSize(s.width,newSize);
this.state.height=newSize
}else{
this.panel.setSize(newSize,s.height);
this.state.width=newSize
}
this.layout.layout();
this.panel.saveState();
return false
},
getSplitBar:function(){
return this.split
},
destroy:function(){
Ext.destroy(this.miniSplitEl,this.split,this.splitEl);
Ext.layout.BorderLayout.SplitRegion.superclass.destroy.call(this)
}
});
Ext.Container.LAYOUTS['border']=Ext.layout.BorderLayout;
Ext.layout.FormLayout=Ext.extend(Ext.layout.AnchorLayout,{
labelSeparator:':',
trackLabels:true,
type:'form',
onRemove:function(c){
Ext.layout.FormLayout.superclass.onRemove.call(this,c);
if(this.trackLabels){
c.un('show',this.onFieldShow,this);
c.un('hide',this.onFieldHide,this)
}
var el=c.getPositionEl(),ct=c.getItemCt&&c.getItemCt();
if(c.rendered&&ct){
if(el&&el.dom){
el.insertAfter(ct)
}
Ext.destroy(ct);
Ext.destroyMembers(c,'label','itemCt');
if(c.customItemCt){
Ext.destroyMembers(c,'getItemCt','customItemCt')
}
}
},
setContainer:function(ct){
Ext.layout.FormLayout.superclass.setContainer.call(this,ct);
if(ct.labelAlign){
ct.addClass('x-form-label-'+ct.labelAlign)
}
if(ct.hideLabels){
Ext.apply(this,{
labelStyle:'display:none',
elementStyle:'padding-left:0;',
labelAdjust:0
})
}else{
this.labelSeparator=Ext.isDefined(ct.labelSeparator)?ct.labelSeparator:this.labelSeparator;
ct.labelWidth=ct.labelWidth||100;
if(Ext.isNumber(ct.labelWidth)){
var pad=Ext.isNumber(ct.labelPad)?ct.labelPad:5;
Ext.apply(this,{
labelAdjust:ct.labelWidth+pad,
labelStyle:'width:'+ct.labelWidth+'px;',
elementStyle:'padding-left:'+(ct.labelWidth+pad)+'px'
})
}
if(ct.labelAlign=='top'){
Ext.apply(this,{
labelStyle:'width:auto;',
labelAdjust:0,
elementStyle:'padding-left:0;'
})
}
}
},
isHide:function(c){
return c.hideLabel||this.container.hideLabels
},
onFieldShow:function(c){
c.getItemCt().removeClass('x-hide-'+c.hideMode);
if(c.isComposite){
c.doLayout()
}
},
onFieldHide:function(c){
c.getItemCt().addClass('x-hide-'+c.hideMode)
},
getLabelStyle:function(s){
var ls='',items=[
this.labelStyle,
s
];
for(var i=0,len=items.length;i<len;++i){
if(items[i]){
ls+=items[i];
if(ls.substr(-1,1)!=';'){
ls+=';'
}
}
}
return ls
},
renderItem:function(c,position,target){
if(c&&(c.isFormField||c.fieldLabel)&&c.inputType!='hidden'){
var args=this.getTemplateArgs(c);
if(Ext.isNumber(position)){
position=target.dom.childNodes[position]||null
}
if(position){
c.itemCt=this.fieldTpl.insertBefore(position,args,true)
}else{
c.itemCt=this.fieldTpl.append(target,args,true)
}
if(!c.getItemCt){
Ext.apply(c,{
getItemCt:function(){
return c.itemCt
},
customItemCt:true
})
}
c.label=c.getItemCt().child('label.x-form-item-label');
if(!c.rendered){
c.render('x-form-el-'+c.id)
}else if(!this.isValidParent(c,target)){
Ext.fly('x-form-el-'+c.id).appendChild(c.getPositionEl())
}
if(this.trackLabels){
if(c.hidden){
this.onFieldHide(c)
}
c.on({
scope:this,
show:this.onFieldShow,
hide:this.onFieldHide
})
}
this.configureItem(c)
}else{
Ext.layout.FormLayout.superclass.renderItem.apply(this,arguments)
}
},
getTemplateArgs:function(field){
var noLabelSep=!field.fieldLabel||field.hideLabel,itemCls=(field.itemCls||this.container.itemCls||'')+(field.hideLabel?' x-hide-label':'');
if(Ext.isIE9&&Ext.isIEQuirks&&field instanceof Ext.form.TextField){
itemCls+=' x-input-wrapper'
}
return{
id:field.id,
label:field.fieldLabel,
itemCls:itemCls,
clearCls:field.clearCls||'x-form-clear-left',
labelStyle:this.getLabelStyle(field.labelStyle),
elementStyle:this.elementStyle||'',
labelSeparator:noLabelSep?'':Ext.isDefined(field.labelSeparator)?field.labelSeparator:this.labelSeparator
}
},
adjustWidthAnchor:function(value,c){
if(c.label&&!this.isHide(c)&&this.container.labelAlign!='top'){
var adjust=Ext.isIE6||Ext.isIE&&!Ext.isStrict;
return value-this.labelAdjust+(adjust?-3:0)
}
return value
},
adjustHeightAnchor:function(value,c){
if(c.label&&!this.isHide(c)&&this.container.labelAlign=='top'){
return value-c.label.getHeight()
}
return value
},
isValidParent:function(c,target){
return target&&this.container.getEl().contains(c.getPositionEl())
}
});
Ext.Container.LAYOUTS['form']=Ext.layout.FormLayout;
Ext.layout.AccordionLayout=Ext.extend(Ext.layout.FitLayout,{
fill:true,
autoWidth:true,
titleCollapse:true,
hideCollapseTool:false,
collapseFirst:false,
animate:false,
sequence:false,
activeOnTop:false,
type:'accordion',
renderItem:function(c){
if(this.animate===false){
c.animCollapse=false
}
c.collapsible=true;
if(this.autoWidth){
c.autoWidth=true
}
if(this.titleCollapse){
c.titleCollapse=true
}
if(this.hideCollapseTool){
c.hideCollapseTool=true
}
if(this.collapseFirst!==undefined){
c.collapseFirst=this.collapseFirst
}
if(!this.activeItem&&!c.collapsed){
this.setActiveItem(c,true)
}else if(this.activeItem&&this.activeItem!=c){
c.collapsed=true
}
Ext.layout.AccordionLayout.superclass.renderItem.apply(this,arguments);
c.header.addClass('x-accordion-hd');
c.on('beforeexpand',this.beforeExpand,this)
},
onRemove:function(c){
Ext.layout.AccordionLayout.superclass.onRemove.call(this,c);
if(c.rendered){
c.header.removeClass('x-accordion-hd')
}
c.un('beforeexpand',this.beforeExpand,this)
},
beforeExpand:function(p,anim){
var ai=this.activeItem;
if(ai){
if(this.sequence){
delete this.activeItem;
if(!ai.collapsed){
ai.collapse({
callback:function(){
p.expand(anim||true)
},
scope:this
});
return false
}
}else{
ai.collapse(this.animate)
}
}
this.setActive(p);
if(this.activeOnTop){
p.el.dom.parentNode.insertBefore(p.el.dom,p.el.dom.parentNode.firstChild)
}
this.layout()
},
setItemSize:function(item,size){
if(this.fill&&item){
var hh=0,i,ct=this.getRenderedItems(this.container),len=ct.length,p;
for(i=0;i<len;i++){
if((p=ct[i])!=item&&!p.hidden){
hh+=p.header.getHeight()
}
}
;
size.height-=hh;
item.setSize(size)
}
},
setActiveItem:function(item){
this.setActive(item,true)
},
setActive:function(item,expand){
var ai=this.activeItem;
item=this.container.getComponent(item);
if(ai!=item){
if(item.rendered&&item.collapsed&&expand){
item.expand()
}else{
if(ai){
ai.fireEvent('deactivate',ai)
}
this.activeItem=item;
item.fireEvent('activate',item)
}
}
}
});
Ext.Container.LAYOUTS.accordion=Ext.layout.AccordionLayout;
Ext.layout.Accordion=Ext.layout.AccordionLayout;
Ext.layout.TableLayout=Ext.extend(Ext.layout.ContainerLayout,{
monitorResize:false,
type:'table',
targetCls:'x-table-layout-ct',
tableAttrs:null,
setContainer:function(ct){
Ext.layout.TableLayout.superclass.setContainer.call(this,ct);
this.currentRow=0;
this.currentColumn=0;
this.cells=[]
},
onLayout:function(ct,target){
var cs=ct.items.items,len=cs.length,c,i;
if(!this.table){
target.addClass('x-table-layout-ct');
this.table=target.createChild(Ext.apply({
tag:'table',
cls:'x-table-layout',
cellspacing:0,
cn:{tag:'tbody'}
},this.tableAttrs),null,true)
}
this.renderAll(ct,target)
},
getRow:function(index){
var row=this.table.tBodies[0].childNodes[index];
if(!row){
row=document.createElement('tr');
this.table.tBodies[0].appendChild(row)
}
return row
},
getNextCell:function(c){
var cell=this.getNextNonSpan(this.currentColumn,this.currentRow);
var curCol=this.currentColumn=cell[0],curRow=this.currentRow=cell[1];
for(var rowIndex=curRow;rowIndex<curRow+(c.rowspan||1);rowIndex++){
if(!this.cells[rowIndex]){
this.cells[rowIndex]=[]
}
for(var colIndex=curCol;colIndex<curCol+(c.colspan||1);colIndex++){
this.cells[rowIndex][colIndex]=true
}
}
var td=document.createElement('td');
if(c.cellId){
td.id=c.cellId
}
var cls='x-table-layout-cell';
if(c.cellCls){
cls+=' '+c.cellCls
}
td.className=cls;
if(c.colspan){
td.colSpan=c.colspan
}
if(c.rowspan){
td.rowSpan=c.rowspan
}
this.getRow(curRow).appendChild(td);
return td
},
getNextNonSpan:function(colIndex,rowIndex){
var cols=this.columns;
while(cols&&colIndex>=cols||this.cells[rowIndex]&&this.cells[rowIndex][colIndex]){
if(cols&&colIndex>=cols){
rowIndex++;
colIndex=0
}else{
colIndex++
}
}
return[
colIndex,
rowIndex
]
},
renderItem:function(c,position,target){
if(!this.table){
this.table=target.createChild(Ext.apply({
tag:'table',
cls:'x-table-layout',
cellspacing:0,
cn:{tag:'tbody'}
},this.tableAttrs),null,true)
}
if(c&&!c.rendered){
c.render(this.getNextCell(c));
this.configureItem(c)
}else if(c&&!this.isValidParent(c,target)){
var container=this.getNextCell(c);
container.insertBefore(c.getPositionEl().dom,null);
c.container=Ext.get(container);
this.configureItem(c)
}
},
isValidParent:function(c,target){
return c.getPositionEl().up('table',5).dom.parentNode===(target.dom||target)
},
destroy:function(){
delete this.table;
Ext.layout.TableLayout.superclass.destroy.call(this)
}
});
Ext.Container.LAYOUTS['table']=Ext.layout.TableLayout;
Ext.layout.AbsoluteLayout=Ext.extend(Ext.layout.AnchorLayout,{
extraCls:'x-abs-layout-item',
type:'absolute',
onLayout:function(ct,target){
target.position();
this.paddingLeft=target.getPadding('l');
this.paddingTop=target.getPadding('t');
Ext.layout.AbsoluteLayout.superclass.onLayout.call(this,ct,target)
},
adjustWidthAnchor:function(value,comp){
return value?value-comp.getPosition(true)[0]+this.paddingLeft:value
},
adjustHeightAnchor:function(value,comp){
return value?value-comp.getPosition(true)[1]+this.paddingTop:value
}
});
Ext.Container.LAYOUTS['absolute']=Ext.layout.AbsoluteLayout;
Ext.layout.BoxLayout=Ext.extend(Ext.layout.ContainerLayout,{
defaultMargins:{
left:0,
top:0,
right:0,
bottom:0
},
padding:'0',
pack:'start',
monitorResize:true,
type:'box',
scrollOffset:0,
extraCls:'x-box-item',
targetCls:'x-box-layout-ct',
innerCls:'x-box-inner',
constructor:function(config){
Ext.layout.BoxLayout.superclass.constructor.call(this,config);
if(Ext.isString(this.defaultMargins)){
this.defaultMargins=this.parseMargins(this.defaultMargins)
}
var handler=this.overflowHandler;
if(typeof handler=='string'){
handler={type:handler}
}
var handlerType='none';
if(handler&&handler.type!=undefined){
handlerType=handler.type
}
var constructor=Ext.layout.boxOverflow[handlerType];
if(constructor[this.type]){
constructor=constructor[this.type]
}
this.overflowHandler=new constructor(this,handler)
},
onLayout:function(container,target){
Ext.layout.BoxLayout.superclass.onLayout.call(this,container,target);
var tSize=this.getLayoutTargetSize(),items=this.getVisibleItems(container),calcs=this.calculateChildBoxes(items,tSize),boxes=calcs.boxes,meta=calcs.meta;
if(tSize.width>0){
var handler=this.overflowHandler,method=meta.tooNarrow?'handleOverflow':'clearOverflow';
var results=handler[method](calcs,tSize);
if(results){
if(results.targetSize){
tSize=results.targetSize
}
if(results.recalculate){
items=this.getVisibleItems(container);
calcs=this.calculateChildBoxes(items,tSize);
boxes=calcs.boxes
}
}
}
this.layoutTargetLastSize=tSize;
this.childBoxCache=calcs;
this.updateInnerCtSize(tSize,calcs);
this.updateChildBoxes(boxes);
this.handleTargetOverflow(tSize,container,target)
},
updateChildBoxes:function(boxes){
for(var i=0,length=boxes.length;i<length;i++){
var box=boxes[i],comp=box.component;
if(box.dirtySize){
comp.setSize(box.width,box.height)
}
if(isNaN(box.left)||isNaN(box.top)){
continue
}
comp.setPosition(box.left,box.top)
}
},
updateInnerCtSize:function(tSize,calcs){
var align=this.align,padding=this.padding,width=tSize.width,height=tSize.height;
if(this.type=='hbox'){
var innerCtWidth=width,innerCtHeight=calcs.meta.maxHeight+padding.top+padding.bottom;
if(align=='stretch'){
innerCtHeight=height
}else if(align=='middle'){
innerCtHeight=Math.max(height,innerCtHeight)
}
}else{
var innerCtHeight=height,innerCtWidth=calcs.meta.maxWidth+padding.left+padding.right;
if(align=='stretch'){
innerCtWidth=width
}else if(align=='center'){
innerCtWidth=Math.max(width,innerCtWidth)
}
}
this.innerCt.setSize(innerCtWidth||undefined,innerCtHeight||undefined)
},
handleTargetOverflow:function(previousTargetSize,container,target){
var overflow=target.getStyle('overflow');
if(overflow&&overflow!='hidden'&&!this.adjustmentPass){
var newTargetSize=this.getLayoutTargetSize();
if(newTargetSize.width!=previousTargetSize.width||newTargetSize.height!=previousTargetSize.height){
this.adjustmentPass=true;
this.onLayout(container,target)
}
}
delete this.adjustmentPass
},
isValidParent:function(c,target){
return this.innerCt&&c.getPositionEl().dom.parentNode==this.innerCt.dom
},
getVisibleItems:function(ct){
var ct=ct||this.container,t=ct.getLayoutTarget(),cti=ct.items.items,len=cti.length,i,c,items=[];
for(i=0;i<len;i++){
if((c=cti[i]).rendered&&this.isValidParent(c,t)&&c.hidden!==true&&c.collapsed!==true&&c.shouldLayout!==false){
items.push(c)
}
}
return items
},
renderAll:function(ct,target){
if(!this.innerCt){
this.innerCt=target.createChild({cls:this.innerCls});
this.padding=this.parseMargins(this.padding)
}
Ext.layout.BoxLayout.superclass.renderAll.call(this,ct,this.innerCt)
},
getLayoutTargetSize:function(){
var target=this.container.getLayoutTarget(),ret;
if(target){
ret=target.getViewSize();
if(Ext.isIE&&Ext.isStrict&&ret.width==0){
ret=target.getStyleSize()
}
ret.width-=target.getPadding('lr');
ret.height-=target.getPadding('tb')
}
return ret
},
renderItem:function(c){
if(Ext.isString(c.margins)){
c.margins=this.parseMargins(c.margins)
}else if(!c.margins){
c.margins=this.defaultMargins
}
Ext.layout.BoxLayout.superclass.renderItem.apply(this,arguments)
},
destroy:function(){
Ext.destroy(this.overflowHandler);
Ext.layout.BoxLayout.superclass.destroy.apply(this,arguments)
}
});
Ext.layout.boxOverflow.None=Ext.extend(Object,{
constructor:function(layout,config){
this.layout=layout;
Ext.apply(this,config||{})
},
handleOverflow:Ext.emptyFn,
clearOverflow:Ext.emptyFn
});
Ext.layout.boxOverflow.none=Ext.layout.boxOverflow.None;
Ext.layout.boxOverflow.Menu=Ext.extend(Ext.layout.boxOverflow.None,{
afterCls:'x-strip-right',
noItemsMenuText:'<div class="x-toolbar-no-items">(None)</div>',
constructor:function(layout){
Ext.layout.boxOverflow.Menu.superclass.constructor.apply(this,arguments);
this.menuItems=[]
},
createInnerElements:function(){
if(!this.afterCt){
this.afterCt=this.layout.innerCt.insertSibling({cls:this.afterCls},'before')
}
},
clearOverflow:function(calculations,targetSize){
var newWidth=targetSize.width+(this.afterCt?this.afterCt.getWidth():0),items=this.menuItems;
this.hideTrigger();
for(var index=0,length=items.length;index<length;index++){
items.pop().component.show()
}
return{
targetSize:{
height:targetSize.height,
width:newWidth
}
}
},
showTrigger:function(){
this.createMenu();
this.menuTrigger.show()
},
hideTrigger:function(){
if(this.menuTrigger!=undefined){
this.menuTrigger.hide()
}
},
beforeMenuShow:function(menu){
var items=this.menuItems,len=items.length,item,prev;
var needsSep=function(group,item){
return group.isXType('buttongroup')&&!(item instanceof Ext.Toolbar.Separator)
};
this.clearMenu();
menu.removeAll();
for(var i=0;i<len;i++){
item=items[i].component;
if(prev&&(needsSep(item,prev)||needsSep(prev,item))){
menu.add('-')
}
this.addComponentToMenu(menu,item);
prev=item
}
if(menu.items.length<1){
menu.add(this.noItemsMenuText)
}
},
createMenuConfig:function(component,hideOnClick){
var config=Ext.apply({},component.initialConfig),group=component.toggleGroup;
Ext.copyTo(config,component,[
'iconCls',
'icon',
'itemId',
'disabled',
'handler',
'scope',
'menu'
]);
Ext.apply(config,{
text:component.overflowText||component.text,
hideOnClick:hideOnClick
});
if(group||component.enableToggle){
Ext.apply(config,{
group:group,
checked:component.pressed,
listeners:{
checkchange:function(item,checked){
component.toggle(checked)
}
}
})
}
delete config.ownerCt;
delete config.xtype;
delete config.id;
return config
},
addComponentToMenu:function(menu,component){
if(component instanceof Ext.Toolbar.Separator){
menu.add('-')
}else if(Ext.isFunction(component.isXType)){
if(component.isXType('splitbutton')){
menu.add(this.createMenuConfig(component,true))
}else if(component.isXType('button')){
menu.add(this.createMenuConfig(component,!component.menu))
}else if(component.isXType('buttongroup')){
component.items.each(function(item){
this.addComponentToMenu(menu,item)
},this)
}
}
},
clearMenu:function(){
var menu=this.moreMenu;
if(menu&&menu.items){
menu.items.each(function(item){
delete item.menu
})
}
},
createMenu:function(){
if(!this.menuTrigger){
this.createInnerElements();
this.menu=new Ext.menu.Menu({
ownerCt:this.layout.container,
listeners:{
scope:this,
beforeshow:this.beforeMenuShow
}
});
this.menuTrigger=new Ext.Button({
iconCls:'x-toolbar-more-icon',
cls:'x-toolbar-more',
menu:this.menu,
renderTo:this.afterCt
})
}
},
destroy:function(){
Ext.destroy(this.menu,this.menuTrigger)
}
});
Ext.layout.boxOverflow.menu=Ext.layout.boxOverflow.Menu;
Ext.layout.boxOverflow.HorizontalMenu=Ext.extend(Ext.layout.boxOverflow.Menu,{
constructor:function(){
Ext.layout.boxOverflow.HorizontalMenu.superclass.constructor.apply(this,arguments);
var me=this,layout=me.layout,origFunction=layout.calculateChildBoxes;
layout.calculateChildBoxes=function(visibleItems,targetSize){
var calcs=origFunction.apply(layout,arguments),meta=calcs.meta,items=me.menuItems;
var hiddenWidth=0;
for(var index=0,length=items.length;index<length;index++){
hiddenWidth+=items[index].width
}
meta.minimumWidth+=hiddenWidth;
meta.tooNarrow=meta.minimumWidth>targetSize.width;
return calcs
}
},
handleOverflow:function(calculations,targetSize){
this.showTrigger();
var newWidth=targetSize.width-this.afterCt.getWidth(),boxes=calculations.boxes,usedWidth=0,recalculate=false;
for(var index=0,length=boxes.length;index<length;index++){
usedWidth+=boxes[index].width
}
var spareWidth=newWidth-usedWidth,showCount=0;
for(var index=0,length=this.menuItems.length;index<length;index++){
var hidden=this.menuItems[index],comp=hidden.component,width=hidden.width;
if(width<spareWidth){
comp.show();
spareWidth-=width;
showCount++;
recalculate=true
}else{
break
}
}
if(recalculate){
this.menuItems=this.menuItems.slice(showCount)
}else{
for(var i=boxes.length-1;i>=0;i--){
var item=boxes[i].component,right=boxes[i].left+boxes[i].width;
if(right>=newWidth){
this.menuItems.unshift({
component:item,
width:boxes[i].width
});
item.hide()
}else{
break
}
}
}
if(this.menuItems.length==0){
this.hideTrigger()
}
return{
targetSize:{
height:targetSize.height,
width:newWidth
},
recalculate:recalculate
}
}
});
Ext.layout.boxOverflow.menu.hbox=Ext.layout.boxOverflow.HorizontalMenu;
Ext.layout.boxOverflow.Scroller=Ext.extend(Ext.layout.boxOverflow.None,{
animateScroll:true,
scrollIncrement:100,
wheelIncrement:3,
scrollRepeatInterval:400,
scrollDuration:0.4,
beforeCls:'x-strip-left',
afterCls:'x-strip-right',
scrollerCls:'x-strip-scroller',
beforeScrollerCls:'x-strip-scroller-left',
afterScrollerCls:'x-strip-scroller-right',
createWheelListener:function(){
this.layout.innerCt.on({
scope:this,
mousewheel:function(e){
e.stopEvent();
this.scrollBy(e.getWheelDelta()*this.wheelIncrement*-1,false)
}
})
},
handleOverflow:function(calculations,targetSize){
this.createInnerElements();
this.showScrollers()
},
clearOverflow:function(){
this.hideScrollers()
},
showScrollers:function(){
this.createScrollers();
this.beforeScroller.show();
this.afterScroller.show();
this.updateScrollButtons()
},
hideScrollers:function(){
if(this.beforeScroller!=undefined){
this.beforeScroller.hide();
this.afterScroller.hide()
}
},
createScrollers:function(){
if(!this.beforeScroller&&!this.afterScroller){
var before=this.beforeCt.createChild({cls:String.format('{0} {1} ',this.scrollerCls,this.beforeScrollerCls)});
var after=this.afterCt.createChild({cls:String.format('{0} {1}',this.scrollerCls,this.afterScrollerCls)});
before.addClassOnOver(this.beforeScrollerCls+'-hover');
after.addClassOnOver(this.afterScrollerCls+'-hover');
before.setVisibilityMode(Ext.Element.DISPLAY);
after.setVisibilityMode(Ext.Element.DISPLAY);
this.beforeRepeater=new Ext.util.ClickRepeater(before,{
interval:this.scrollRepeatInterval,
handler:this.scrollLeft,
scope:this
});
this.afterRepeater=new Ext.util.ClickRepeater(after,{
interval:this.scrollRepeatInterval,
handler:this.scrollRight,
scope:this
});
this.beforeScroller=before;
this.afterScroller=after
}
},
destroy:function(){
Ext.destroy(this.beforeScroller,this.afterScroller,this.beforeRepeater,this.afterRepeater,this.beforeCt,this.afterCt)
},
scrollBy:function(delta,animate){
this.scrollTo(this.getScrollPosition()+delta,animate)
},
getItem:function(item){
if(Ext.isString(item)){
item=Ext.getCmp(item)
}else if(Ext.isNumber(item)){
item=this.items[item]
}
return item
},
getScrollAnim:function(){
return{
duration:this.scrollDuration,
callback:this.updateScrollButtons,
scope:this
}
},
updateScrollButtons:function(){
if(this.beforeScroller==undefined||this.afterScroller==undefined){
return
}
var beforeMeth=this.atExtremeBefore()?'addClass':'removeClass',afterMeth=this.atExtremeAfter()?'addClass':'removeClass',beforeCls=this.beforeScrollerCls+'-disabled',afterCls=this.afterScrollerCls+'-disabled';
this.beforeScroller[beforeMeth](beforeCls);
this.afterScroller[afterMeth](afterCls);
this.scrolling=false
},
atExtremeBefore:function(){
return this.getScrollPosition()===0
},
scrollLeft:function(animate){
this.scrollBy(-this.scrollIncrement,animate)
},
scrollRight:function(animate){
this.scrollBy(this.scrollIncrement,animate)
},
scrollToItem:function(item,animate){
item=this.getItem(item);
if(item!=undefined){
var visibility=this.getItemVisibility(item);
if(!visibility.fullyVisible){
var box=item.getBox(true,true),newX=box.x;
if(visibility.hiddenRight){
newX-=this.layout.innerCt.getWidth()-box.width
}
this.scrollTo(newX,animate)
}
}
},
getItemVisibility:function(item){
var box=this.getItem(item).getBox(true,true),itemLeft=box.x,itemRight=box.x+box.width,scrollLeft=this.getScrollPosition(),scrollRight=this.layout.innerCt.getWidth()+scrollLeft;
return{
hiddenLeft:itemLeft<scrollLeft,
hiddenRight:itemRight>scrollRight,
fullyVisible:itemLeft>scrollLeft&&itemRight<scrollRight
}
}
});
Ext.layout.boxOverflow.scroller=Ext.layout.boxOverflow.Scroller;
Ext.layout.boxOverflow.VerticalScroller=Ext.extend(Ext.layout.boxOverflow.Scroller,{
scrollIncrement:75,
wheelIncrement:2,
handleOverflow:function(calculations,targetSize){
Ext.layout.boxOverflow.VerticalScroller.superclass.handleOverflow.apply(this,arguments);
return{
targetSize:{
height:targetSize.height-(this.beforeCt.getHeight()+this.afterCt.getHeight()),
width:targetSize.width
}
}
},
createInnerElements:function(){
var target=this.layout.innerCt;
if(!this.beforeCt){
this.beforeCt=target.insertSibling({cls:this.beforeCls},'before');
this.afterCt=target.insertSibling({cls:this.afterCls},'after');
this.createWheelListener()
}
},
scrollTo:function(position,animate){
var oldPosition=this.getScrollPosition(),newPosition=position.constrain(0,this.getMaxScrollBottom());
if(newPosition!=oldPosition&&!this.scrolling){
if(animate==undefined){
animate=this.animateScroll
}
this.layout.innerCt.scrollTo('top',newPosition,animate?this.getScrollAnim():false);
if(animate){
this.scrolling=true
}else{
this.scrolling=false;
this.updateScrollButtons()
}
}
},
getScrollPosition:function(){
return parseInt(this.layout.innerCt.dom.scrollTop,10)||0
},
getMaxScrollBottom:function(){
return this.layout.innerCt.dom.scrollHeight-this.layout.innerCt.getHeight()
},
atExtremeAfter:function(){
return this.getScrollPosition()>=this.getMaxScrollBottom()
}
});
Ext.layout.boxOverflow.scroller.vbox=Ext.layout.boxOverflow.VerticalScroller;
Ext.layout.boxOverflow.HorizontalScroller=Ext.extend(Ext.layout.boxOverflow.Scroller,{
handleOverflow:function(calculations,targetSize){
Ext.layout.boxOverflow.HorizontalScroller.superclass.handleOverflow.apply(this,arguments);
return{
targetSize:{
height:targetSize.height,
width:targetSize.width-(this.beforeCt.getWidth()+this.afterCt.getWidth())
}
}
},
createInnerElements:function(){
var target=this.layout.innerCt;
if(!this.beforeCt){
this.afterCt=target.insertSibling({cls:this.afterCls},'before');
this.beforeCt=target.insertSibling({cls:this.beforeCls},'before');
this.createWheelListener()
}
},
scrollTo:function(position,animate){
var oldPosition=this.getScrollPosition(),newPosition=position.constrain(0,this.getMaxScrollRight());
if(newPosition!=oldPosition&&!this.scrolling){
if(animate==undefined){
animate=this.animateScroll
}
this.layout.innerCt.scrollTo('left',newPosition,animate?this.getScrollAnim():false);
if(animate){
this.scrolling=true
}else{
this.scrolling=false;
this.updateScrollButtons()
}
}
},
getScrollPosition:function(){
return parseInt(this.layout.innerCt.dom.scrollLeft,10)||0
},
getMaxScrollRight:function(){
return this.layout.innerCt.dom.scrollWidth-this.layout.innerCt.getWidth()
},
atExtremeAfter:function(){
return this.getScrollPosition()>=this.getMaxScrollRight()
}
});
Ext.layout.boxOverflow.scroller.hbox=Ext.layout.boxOverflow.HorizontalScroller;
Ext.layout.HBoxLayout=Ext.extend(Ext.layout.BoxLayout,{
align:'top',
type:'hbox',
calculateChildBoxes:function(visibleItems,targetSize){
var visibleCount=visibleItems.length,padding=this.padding,topOffset=padding.top,leftOffset=padding.left,paddingVert=topOffset+padding.bottom,paddingHoriz=leftOffset+padding.right,width=targetSize.width-this.scrollOffset,height=targetSize.height,availHeight=Math.max(0,height-paddingVert),isStart=this.pack=='start',isCenter=this.pack=='center',isEnd=this.pack=='end',nonFlexWidth=0,maxHeight=0,totalFlex=0,desiredWidth=0,minimumWidth=0,boxes=[],child,childWidth,childHeight,childSize,childMargins,canLayout,i,calcs,flexedWidth,horizMargins,vertMargins,stretchHeight;
for(i=0;i<visibleCount;i++){
child=visibleItems[i];
childHeight=child.height;
childWidth=child.width;
canLayout=!child.hasLayout&&typeof child.doLayout=='function';
if(typeof childWidth!='number'){
if(child.flex&&!childWidth){
totalFlex+=child.flex
}else{
if(!childWidth&&canLayout){
child.doLayout()
}
childSize=child.getSize();
childWidth=childSize.width;
childHeight=childSize.height
}
}
childMargins=child.margins;
horizMargins=childMargins.left+childMargins.right;
nonFlexWidth+=horizMargins+(childWidth||0);
desiredWidth+=horizMargins+(child.flex?child.minWidth||0:childWidth);
minimumWidth+=horizMargins+(child.minWidth||childWidth||0);
if(typeof childHeight!='number'){
if(canLayout){
child.doLayout()
}
childHeight=child.getHeight()
}
maxHeight=Math.max(maxHeight,childHeight+childMargins.top+childMargins.bottom);
boxes.push({
component:child,
height:childHeight||undefined,
width:childWidth||undefined
})
}
var shortfall=desiredWidth-width,tooNarrow=minimumWidth>width;
var availableWidth=Math.max(0,width-nonFlexWidth-paddingHoriz);
if(tooNarrow){
for(i=0;i<visibleCount;i++){
boxes[i].width=visibleItems[i].minWidth||visibleItems[i].width||boxes[i].width
}
}else{
if(shortfall>0){
var minWidths=[];
for(var index=0,length=visibleCount;index<length;index++){
var item=visibleItems[index],minWidth=item.minWidth||0;
if(item.flex){
boxes[index].width=minWidth
}else{
minWidths.push({
minWidth:minWidth,
available:boxes[index].width-minWidth,
index:index
})
}
}
minWidths.sort(function(a,b){
return a.available>b.available?1:-1
});
for(var i=0,length=minWidths.length;i<length;i++){
var itemIndex=minWidths[i].index;
if(itemIndex==undefined){
continue
}
var item=visibleItems[itemIndex],box=boxes[itemIndex],oldWidth=box.width,minWidth=item.minWidth,newWidth=Math.max(minWidth,oldWidth-Math.ceil(shortfall/(length-i))),reduction=oldWidth-newWidth;
boxes[itemIndex].width=newWidth;
shortfall-=reduction
}
}else{
var remainingWidth=availableWidth,remainingFlex=totalFlex;
for(i=0;i<visibleCount;i++){
child=visibleItems[i];
calcs=boxes[i];
childMargins=child.margins;
vertMargins=childMargins.top+childMargins.bottom;
if(isStart&&child.flex&&!child.width){
flexedWidth=Math.ceil(child.flex/remainingFlex*remainingWidth);
remainingWidth-=flexedWidth;
remainingFlex-=child.flex;
calcs.width=flexedWidth;
calcs.dirtySize=true
}
}
}
}
if(isCenter){
leftOffset+=availableWidth/2
}else if(isEnd){
leftOffset+=availableWidth
}
for(i=0;i<visibleCount;i++){
child=visibleItems[i];
calcs=boxes[i];
childMargins=child.margins;
leftOffset+=childMargins.left;
vertMargins=childMargins.top+childMargins.bottom;
calcs.left=leftOffset;
calcs.top=topOffset+childMargins.top;
switch(this.align){
case'stretch':
stretchHeight=availHeight-vertMargins;
calcs.height=stretchHeight.constrain(child.minHeight||0,child.maxHeight||1000000);
calcs.dirtySize=true;
break;
case'stretchmax':
stretchHeight=maxHeight-vertMargins;
calcs.height=stretchHeight.constrain(child.minHeight||0,child.maxHeight||1000000);
calcs.dirtySize=true;
break;
case'middle':
var diff=availHeight-calcs.height-vertMargins;
if(diff>0){
calcs.top=topOffset+vertMargins+diff/2
}
}
leftOffset+=calcs.width+childMargins.right
}
return{
boxes:boxes,
meta:{
maxHeight:maxHeight,
nonFlexWidth:nonFlexWidth,
desiredWidth:desiredWidth,
minimumWidth:minimumWidth,
shortfall:desiredWidth-width,
tooNarrow:tooNarrow
}
}
}
});
Ext.Container.LAYOUTS.hbox=Ext.layout.HBoxLayout;
Ext.layout.VBoxLayout=Ext.extend(Ext.layout.BoxLayout,{
align:'left',
type:'vbox',
calculateChildBoxes:function(visibleItems,targetSize){
var visibleCount=visibleItems.length,padding=this.padding,topOffset=padding.top,leftOffset=padding.left,paddingVert=topOffset+padding.bottom,paddingHoriz=leftOffset+padding.right,width=targetSize.width-this.scrollOffset,height=targetSize.height,availWidth=Math.max(0,width-paddingHoriz),isStart=this.pack=='start',isCenter=this.pack=='center',isEnd=this.pack=='end',nonFlexHeight=0,maxWidth=0,totalFlex=0,desiredHeight=0,minimumHeight=0,boxes=[],child,childWidth,childHeight,childSize,childMargins,canLayout,i,calcs,flexedHeight,horizMargins,vertMargins,stretchWidth,length;
for(i=0;i<visibleCount;i++){
child=visibleItems[i];
childHeight=child.height;
childWidth=child.width;
canLayout=!child.hasLayout&&typeof child.doLayout=='function';
if(typeof childHeight!='number'){
if(child.flex&&!childHeight){
totalFlex+=child.flex
}else{
if(!childHeight&&canLayout){
child.doLayout()
}
childSize=child.getSize();
childWidth=childSize.width;
childHeight=childSize.height
}
}
childMargins=child.margins;
vertMargins=childMargins.top+childMargins.bottom;
nonFlexHeight+=vertMargins+(childHeight||0);
desiredHeight+=vertMargins+(child.flex?child.minHeight||0:childHeight);
minimumHeight+=vertMargins+(child.minHeight||childHeight||0);
if(typeof childWidth!='number'){
if(canLayout){
child.doLayout()
}
childWidth=child.getWidth()
}
maxWidth=Math.max(maxWidth,childWidth+childMargins.left+childMargins.right);
boxes.push({
component:child,
height:childHeight||undefined,
width:childWidth||undefined
})
}
var shortfall=desiredHeight-height,tooNarrow=minimumHeight>height;
var availableHeight=Math.max(0,height-nonFlexHeight-paddingVert);
if(tooNarrow){
for(i=0,length=visibleCount;i<length;i++){
boxes[i].height=visibleItems[i].minHeight||visibleItems[i].height||boxes[i].height
}
}else{
if(shortfall>0){
var minHeights=[];
for(var index=0,length=visibleCount;index<length;index++){
var item=visibleItems[index],minHeight=item.minHeight||0;
if(item.flex){
boxes[index].height=minHeight
}else{
minHeights.push({
minHeight:minHeight,
available:boxes[index].height-minHeight,
index:index
})
}
}
minHeights.sort(function(a,b){
return a.available>b.available?1:-1
});
for(var i=0,length=minHeights.length;i<length;i++){
var itemIndex=minHeights[i].index;
if(itemIndex==undefined){
continue
}
var item=visibleItems[itemIndex],box=boxes[itemIndex],oldHeight=box.height,minHeight=item.minHeight,newHeight=Math.max(minHeight,oldHeight-Math.ceil(shortfall/(length-i))),reduction=oldHeight-newHeight;
boxes[itemIndex].height=newHeight;
shortfall-=reduction
}
}else{
var remainingHeight=availableHeight,remainingFlex=totalFlex;
for(i=0;i<visibleCount;i++){
child=visibleItems[i];
calcs=boxes[i];
childMargins=child.margins;
horizMargins=childMargins.left+childMargins.right;
if(isStart&&child.flex&&!child.height){
flexedHeight=Math.ceil(child.flex/remainingFlex*remainingHeight);
remainingHeight-=flexedHeight;
remainingFlex-=child.flex;
calcs.height=flexedHeight;
calcs.dirtySize=true
}
}
}
}
if(isCenter){
topOffset+=availableHeight/2
}else if(isEnd){
topOffset+=availableHeight
}
for(i=0;i<visibleCount;i++){
child=visibleItems[i];
calcs=boxes[i];
childMargins=child.margins;
topOffset+=childMargins.top;
horizMargins=childMargins.left+childMargins.right;
calcs.left=leftOffset+childMargins.left;
calcs.top=topOffset;
switch(this.align){
case'stretch':
stretchWidth=availWidth-horizMargins;
calcs.width=stretchWidth.constrain(child.minWidth||0,child.maxWidth||1000000);
calcs.dirtySize=true;
break;
case'stretchmax':
stretchWidth=maxWidth-horizMargins;
calcs.width=stretchWidth.constrain(child.minWidth||0,child.maxWidth||1000000);
calcs.dirtySize=true;
break;
case'center':
var diff=availWidth-calcs.width-horizMargins;
if(diff>0){
calcs.left=leftOffset+horizMargins+diff/2
}
}
topOffset+=calcs.height+childMargins.bottom
}
return{
boxes:boxes,
meta:{
maxWidth:maxWidth,
nonFlexHeight:nonFlexHeight,
desiredHeight:desiredHeight,
minimumHeight:minimumHeight,
shortfall:desiredHeight-height,
tooNarrow:tooNarrow
}
}
}
});
Ext.Container.LAYOUTS.vbox=Ext.layout.VBoxLayout;
Ext.layout.ToolbarLayout=Ext.extend(Ext.layout.ContainerLayout,{
monitorResize:true,
type:'toolbar',
triggerWidth:18,
noItemsMenuText:'<div class="x-toolbar-no-items">(None)</div>',
lastOverflow:false,
layoutHTML:[
'<div class="x-toolbar-left x-toolbar-left-row hbox main-{0}"></div>',
'<div class="flex"></div>',
'<div class="x-toolbar-right x-toolbar-right-row hbox main-right"></div>',
'<div class="x-toolbar-extras-row"></div>'
].join(''),
onLayout:function(ct,target){
if(!this.leftTr){
var align=ct.buttonAlign=='center'?'center':'start';
target.addClass('x-toolbar-layout-ct hbox cross-center');
target.insertHtml('beforeEnd',String.format(this.layoutHTML,align));
this.leftTr=target.child('.x-toolbar-left-row',true);
this.rightTr=target.child('.x-toolbar-right-row',true);
this.extrasTr=target.child('.x-toolbar-extras-row',true);
if(this.hiddenItem==undefined){
this.hiddenItems=[]
}
}
var side=ct.buttonAlign=='right'?this.rightTr:this.leftTr,items=ct.items.items,position=0;
for(var i=0,len=items.length,c;i<len;i++,position++){
c=items[i];
if(c.isFill){
side=this.rightTr;
position=-1
}else if(!c.rendered){
c.render(side,position);
this.configureItem(c)
}else{
if(!c.xtbHidden&&!this.isValidParent(c,side.childNodes[position])){
side.insertBefore(c.getPositionEl().dom,side.childNodes[position]);
c.container=Ext.get(side)
}
}
if(document.contains&&!document.contains(side)){
target.dom.insertBefore(side,target.dom.childNodes[side.childIndex])
}else if(document.body.contains&&!document.body.contains(side)){
target.dom.insertBefore(side,target.dom.childNodes[side.childIndex])
}
}
if(this.container.enableOverflow===false){
this.cleanup(this.leftTr);
this.cleanup(this.rightTr);
this.cleanup(this.extrasTr)
}
this.fitToSize(target)
},
cleanup:function(el){
if(el&&!el.firstChild&&el.parentNode){
el.childIndex=Array.prototype.slice.call(el.parentNode.childNodes).indexOf(el);
el.parentNode.removeChild(el)
}
},
hideItem:function(item){
this.hiddenItems.push(item);
item.xtbHidden=true;
item.xtbWidth=item.getPositionEl().dom.parentNode.offsetWidth;
item.hide()
},
unhideItem:function(item){
item.show();
item.xtbHidden=false;
this.hiddenItems.remove(item)
},
getItemWidth:function(c){
return c.hidden?c.xtbWidth||0:c.getPositionEl().dom.parentNode.offsetWidth
},
fitToSize:function(target){
if(this.container.enableOverflow===false){
return
}
var width=target.dom.clientWidth,tableWidth=target.dom.firstChild.offsetWidth,clipWidth=width-this.triggerWidth,lastWidth=this.lastWidth||0,hiddenItems=this.hiddenItems,hasHiddens=hiddenItems.length!=0,isLarger=width>=lastWidth;
this.lastWidth=width;
if(tableWidth>width||hasHiddens&&isLarger){
var items=this.container.items.items,len=items.length,loopWidth=0,item;
for(var i=0;i<len;i++){
item=items[i];
if(!item.isFill){
loopWidth+=this.getItemWidth(item);
if(loopWidth>clipWidth){
if(!(item.hidden||item.xtbHidden)){
this.hideItem(item)
}
}else if(item.xtbHidden){
this.unhideItem(item)
}
}
}
}
hasHiddens=hiddenItems.length!=0;
if(hasHiddens){
this.initMore();
if(!this.lastOverflow){
this.container.fireEvent('overflowchange',this.container,true);
this.lastOverflow=true
}
}else if(this.more){
this.clearMenu();
this.more.destroy();
delete this.more;
if(this.lastOverflow){
this.container.fireEvent('overflowchange',this.container,false);
this.lastOverflow=false
}
}
},
createMenuConfig:function(component,hideOnClick){
var config=Ext.apply({},component.initialConfig),group=component.toggleGroup;
Ext.copyTo(config,component,[
'iconCls',
'icon',
'itemId',
'disabled',
'handler',
'scope',
'menu'
]);
Ext.apply(config,{
text:component.overflowText||component.text,
hideOnClick:hideOnClick
});
if(group||component.enableToggle){
Ext.apply(config,{
group:group,
checked:component.pressed,
listeners:{
checkchange:function(item,checked){
component.toggle(checked)
}
}
})
}
delete config.ownerCt;
delete config.xtype;
delete config.id;
return config
},
addComponentToMenu:function(menu,component){
if(component instanceof Ext.Toolbar.Separator){
menu.add('-')
}else if(Ext.isFunction(component.isXType)){
if(component.isXType('splitbutton')){
menu.add(this.createMenuConfig(component,true))
}else if(component.isXType('button')){
menu.add(this.createMenuConfig(component,!component.menu))
}else if(component.isXType('buttongroup')){
component.items.each(function(item){
this.addComponentToMenu(menu,item)
},this)
}
}
},
clearMenu:function(){
var menu=this.moreMenu;
if(menu&&menu.items){
menu.items.each(function(item){
delete item.menu
})
}
},
beforeMoreShow:function(menu){
var items=this.container.items.items,len=items.length,item,prev;
var needsSep=function(group,item){
return group.isXType('buttongroup')&&!(item instanceof Ext.Toolbar.Separator)
};
this.clearMenu();
menu.removeAll();
for(var i=0;i<len;i++){
item=items[i];
if(item.xtbHidden){
if(prev&&(needsSep(item,prev)||needsSep(prev,item))){
menu.add('-')
}
this.addComponentToMenu(menu,item);
prev=item
}
}
if(menu.items.length<1){
menu.add(this.noItemsMenuText)
}
},
initMore:function(){
if(!this.more){
this.moreMenu=new Ext.menu.Menu({
ownerCt:this.container,
listeners:{
beforeshow:this.beforeMoreShow,
scope:this
}
});
this.more=new Ext.Button({
iconCls:'x-toolbar-more-icon',
cls:'x-toolbar-more',
menu:this.moreMenu,
ownerCt:this.container
});
this.more.render(this.extrasTr,100)
}
},
destroy:function(){
Ext.destroy(this.more,this.moreMenu);
delete this.leftTr;
delete this.rightTr;
delete this.extrasTr;
Ext.layout.ToolbarLayout.superclass.destroy.call(this)
}
});
Ext.Container.LAYOUTS.toolbar=Ext.layout.ToolbarLayout;
Ext.layout.MenuLayout=Ext.extend(Ext.layout.ContainerLayout,{
monitorResize:true,
type:'menu',
setContainer:function(ct){
this.monitorResize=!ct.floating;
ct.on('autosize',this.doAutoSize,this);
Ext.layout.MenuLayout.superclass.setContainer.call(this,ct)
},
renderItem:function(c,position,target){
if(!this.itemTpl){
this.itemTpl=Ext.layout.MenuLayout.prototype.itemTpl=new Ext.XTemplate('<li id="{itemId}" class="{itemCls}">','<tpl if="needsIcon">','<img alt="{altText}" src="{icon}" class="{iconCls}"/>','</tpl>','</li>')
}
if(c&&!c.rendered){
if(Ext.isNumber(position)){
position=target.dom.childNodes[position]
}
var a=this.getItemArgs(c);
c.render(c.positionEl=position?this.itemTpl.insertBefore(position,a,true):this.itemTpl.append(target,a,true));
c.positionEl.menuItemId=c.getItemId();
if(!a.isMenuItem&&a.needsIcon){
c.positionEl.addClass('x-menu-list-item-indent')
}
this.configureItem(c)
}else if(c&&!this.isValidParent(c,target)){
if(Ext.isNumber(position)){
position=target.dom.childNodes[position]
}
target.dom.insertBefore(c.getActionEl().dom,position||null)
}
},
getItemArgs:function(c){
var isMenuItem=c instanceof Ext.menu.Item,canHaveIcon=!(isMenuItem||c instanceof Ext.menu.Separator);
return{
isMenuItem:isMenuItem,
needsIcon:canHaveIcon&&(c.icon||c.iconCls),
icon:c.icon||Ext.BLANK_IMAGE_URL,
iconCls:'x-menu-item-icon '+(c.iconCls||''),
itemId:'x-menu-el-'+c.id,
itemCls:'x-menu-list-item ',
altText:c.altText||''
}
},
isValidParent:function(c,target){
return c.el.up('li.x-menu-list-item',5).dom.parentNode===(target.dom||target)
},
onLayout:function(ct,target){
Ext.layout.MenuLayout.superclass.onLayout.call(this,ct,target);
this.doAutoSize()
},
doAutoSize:function(){
var ct=this.container,w=ct.width;
if(ct.floating){
if(w){
ct.setWidth(w)
}else if(Ext.isIE){
ct.setWidth(Ext.isStrict?'auto':ct.minWidth);
var el=ct.getEl(),t=el.dom.offsetWidth;
ct.setWidth(ct.getLayoutTarget().getWidth()+el.getFrameWidth('lr'))
}
}
}
});
Ext.Container.LAYOUTS['menu']=Ext.layout.MenuLayout;
Ext.Viewport=Ext.extend(Ext.Container,{
initComponent:function(){
Ext.Viewport.superclass.initComponent.call(this);
document.getElementsByTagName('html')[0].className+=' x-viewport';
this.el=Ext.getBody();
this.el.setHeight=Ext.emptyFn;
this.el.setWidth=Ext.emptyFn;
this.el.setSize=Ext.emptyFn;
this.el.dom.scroll='no';
this.allowDomMove=false;
this.autoWidth=true;
this.autoHeight=true;
Ext.EventManager.onWindowResize(this.fireResize,this);
this.renderTo=this.el
},
fireResize:function(w,h){
this.fireEvent('resize',this,w,h,w,h)
}
});
Ext.reg('viewport',Ext.Viewport);
Ext.Panel=Ext.extend(Ext.Container,{
baseCls:'x-panel',
collapsedCls:'x-panel-collapsed',
maskDisabled:true,
animCollapse:Ext.enableFx,
headerAsText:true,
buttonAlign:'right',
collapsed:false,
collapseFirst:true,
minButtonWidth:75,
elements:'body',
preventBodyReset:false,
padding:undefined,
resizeEvent:'bodyresize',
toolTarget:'header',
collapseEl:'bwrap',
slideAnchor:'t',
disabledClass:'',
deferHeight:true,
expandDefaults:{duration:0.25},
collapseDefaults:{duration:0.25},
initComponent:function(){
Ext.Panel.superclass.initComponent.call(this);
this.addEvents('bodyresize','titlechange','iconchange','collapse','expand','beforecollapse','beforeexpand','beforeclose','close','activate','deactivate');
if(this.unstyled){
this.baseCls='x-plain'
}
this.toolbars=[];
if(this.tbar){
this.elements+=',tbar';
this.topToolbar=this.createToolbar(this.tbar);
this.tbar=null
}
if(this.bbar){
this.elements+=',bbar';
this.bottomToolbar=this.createToolbar(this.bbar);
this.bbar=null
}
if(this.header===true){
this.elements+=',header';
this.header=null
}else if(this.headerCfg||this.title&&this.header!==false){
this.elements+=',header'
}
if(this.footerCfg||this.footer===true){
this.elements+=',footer';
this.footer=null
}
if(this.buttons){
this.fbar=this.buttons;
this.buttons=null
}
if(this.fbar){
this.createFbar(this.fbar)
}
if(this.autoLoad){
this.on('render',this.doAutoLoad,this,{delay:10})
}
},
createFbar:function(fbar){
var min=this.minButtonWidth;
this.elements+=',footer';
this.fbar=this.createToolbar(fbar,{
buttonAlign:this.buttonAlign,
toolbarCls:'x-panel-fbar',
enableOverflow:false,
defaults:function(c){
return{minWidth:c.minWidth||min}
}
});
this.fbar.items.each(function(c){
c.minWidth=c.minWidth||this.minButtonWidth
},this);
this.buttons=this.fbar.items.items
},
createToolbar:function(tb,options){
var result;
if(Ext.isArray(tb)){
tb={items:tb}
}
result=tb.events?Ext.apply(tb,options):this.createComponent(Ext.apply({},tb,options),'toolbar');
this.toolbars.push(result);
return result
},
createElement:function(name,pnode){
if(this[name]){
pnode.appendChild(this[name].dom);
return
}
if(name==='bwrap'||this.elements.indexOf(name)!=-1){
if(this[name+'Cfg']){
this[name]=Ext.fly(pnode).createChild(this[name+'Cfg'])
}else{
var el=document.createElement('div');
el.className=this[name+'Cls'];
this[name]=Ext.get(pnode.appendChild(el))
}
if(this[name+'CssClass']){
this[name].addClass(this[name+'CssClass'])
}
if(this[name+'Style']){
this[name].applyStyles(this[name+'Style'])
}
}
},
onRender:function(ct,position){
Ext.Panel.superclass.onRender.call(this,ct,position);
this.createClasses();
var el=this.el,d=el.dom,bw,ts;
if(this.collapsible&&!this.hideCollapseTool){
this.tools=this.tools?this.tools.slice(0):[];
this.tools[this.collapseFirst?'unshift':'push']({
id:'toggle',
handler:this.toggleCollapse,
scope:this
})
}
if(this.tools){
ts=this.tools;
this.elements+=this.header!==false?',header':''
}
this.tools={};
el.addClass(this.baseCls);
if(d.firstChild){
this.header=el.down('.'+this.headerCls);
this.bwrap=el.down('.'+this.bwrapCls);
var cp=this.bwrap?this.bwrap:el;
this.tbar=cp.down('.'+this.tbarCls);
this.body=cp.down('.'+this.bodyCls);
this.bbar=cp.down('.'+this.bbarCls);
this.footer=cp.down('.'+this.footerCls);
this.fromMarkup=true
}
if(this.preventBodyReset===true){
el.addClass('x-panel-reset')
}
if(this.cls){
el.addClass(this.cls)
}
if(this.buttons){
this.elements+=',footer'
}
if(this.frame){
this.createElement('header',d);
if(this.header){
Ext.fly(this.header).addClass(String.format('{0}-tc',this.baseCls))
}
this.createElement('bwrap',d);
el.insertHtml('afterBegin',String.format([
'<div class="{0}-mc"></div>',
'<div class="{0}-bc"></div>'
].join(''),this.baseCls));
bw=this.bwrap.dom;
var ml=d.children[0],bl=d.children[1];
bw.appendChild(ml);
bw.appendChild(bl);
var mc=bw.firstChild;
this.createElement('tbar',mc);
this.createElement('body',mc);
this.createElement('bbar',mc);
this.createElement('footer',bw.lastChild);
if(!this.footer){
this.bwrap.dom.lastChild.className+=' x-panel-nofooter'
}
this.ft=Ext.get(this.bwrap.dom.lastChild);
this.mc=Ext.get(mc)
}else{
this.createElement('header',d);
this.createElement('bwrap',d);
bw=this.bwrap.dom;
this.createElement('tbar',bw);
this.createElement('body',bw);
this.createElement('bbar',bw);
this.createElement('footer',bw);
if(!this.header){
this.body.addClass(this.bodyCls+'-noheader');
if(this.tbar){
this.tbar.addClass(this.tbarCls+'-noheader')
}
}
}
if(Ext.isDefined(this.padding)){
this.body.setStyle('padding',this.body.addUnits(this.padding))
}
if(this.border===false){
this.el.addClass(this.baseCls+'-noborder');
this.body.addClass(this.bodyCls+'-noborder');
if(this.header){
this.header.addClass(this.headerCls+'-noborder')
}
if(this.footer){
this.footer.addClass(this.footerCls+'-noborder')
}
if(this.tbar){
this.tbar.addClass(this.tbarCls+'-noborder')
}
if(this.bbar){
this.bbar.addClass(this.bbarCls+'-noborder')
}
}
if(this.bodyBorder===false){
this.body.addClass(this.bodyCls+'-noborder')
}
this.bwrap.enableDisplayMode('block');
if(this.header){
this.header.unselectable();
if(this.headerAsText){
this.header.dom.innerHTML='<span class="'+this.headerTextCls+'">'+this.header.dom.innerHTML+'</span>';
if(this.iconCls){
this.setIconClass(this.iconCls)
}
}
}
if(this.floating){
this.makeFloating(this.floating)
}
if(this.collapsible&&this.titleCollapse&&this.header){
this.mon(this.header,'click',this.toggleCollapse,this);
this.header.setStyle('cursor','pointer')
}
if(ts){
this.addTool.apply(this,ts)
}
if(this.fbar){
this.footer.addClass('x-panel-btns');
this.fbar.ownerCt=this;
this.fbar.render(this.footer);
this.footer.createChild({cls:'x-clear'})
}
if(this.tbar&&this.topToolbar){
this.topToolbar.ownerCt=this;
this.topToolbar.render(this.tbar)
}
if(this.bbar&&this.bottomToolbar){
this.bottomToolbar.ownerCt=this;
this.bottomToolbar.render(this.bbar)
}
},
setIconClass:function(cls){
var old=this.iconCls;
this.iconCls=cls;
if(this.rendered&&this.header){
var hd=this.header,img=hd.child('img.x-panel-inline-icon');
if(img){
if(cls===''){
Ext.fly(img).remove()
}else{
Ext.fly(img).replaceClass(old,this.iconCls)
}
}else if(cls){
var hdspan=hd.child('span.'+this.headerTextCls);
if(hdspan){
Ext.DomHelper.insertBefore(hdspan.dom,{
tag:'img',
src:Ext.BLANK_IMAGE_URL,
cls:'x-panel-inline-icon '+this.iconCls
})
}
}
}
this.fireEvent('iconchange',this,cls,old)
},
makeFloating:function(cfg){
this.floating=true;
this.el=new Ext.Layer(Ext.apply({},cfg,{
shadow:Ext.isDefined(this.shadow)?this.shadow:'sides',
shadowOffset:this.shadowOffset,
constrain:false,
shim:this.shim===false?false:undefined
}),this.el)
},
getTopToolbar:function(){
return this.topToolbar
},
getBottomToolbar:function(){
return this.bottomToolbar
},
getFooterToolbar:function(){
return this.fbar
},
addButton:function(config,handler,scope){
if(!this.fbar){
this.createFbar([])
}
if(handler){
if(Ext.isString(config)){
config={text:config}
}
config=Ext.apply({
handler:handler,
scope:scope
},config)
}
return this.fbar.add(config)
},
addTool:function(){
if(!this.rendered){
if(!this.tools){
this.tools=[]
}
Ext.each(arguments,function(arg){
this.tools.push(arg)
},this);
return
}
if(!this[this.toolTarget]){
return
}
if(!this.toolTemplate){
var tt=new Ext.Template('<div class="x-tool x-tool-{id}">&#160;</div>');
tt.disableFormats=true;
tt.compile();
Ext.Panel.prototype.toolTemplate=tt
}
for(var i=0,a=arguments,len=a.length;i<len;i++){
var tc=a[i];
if(!this.tools[tc.id]){
var overCls='x-tool-'+tc.id+'-over';
var t=this.toolTemplate.insertFirst(this[this.toolTarget],tc,true);
this.tools[tc.id]=t;
t.enableDisplayMode('block');
this.mon(t,'click',this.createToolHandler(t,tc,overCls,this));
if(tc.on){
this.mon(t,tc.on)
}
if(tc.hidden){
t.hide()
}
if(tc.qtip){
if(Ext.isObject(tc.qtip)){
Ext.QuickTips.register(Ext.apply({target:t.id},tc.qtip))
}else{
t.dom.qtip=tc.qtip
}
}
t.addClassOnOver(overCls)
}
}
},
onLayout:function(shallow,force){
Ext.Panel.superclass.onLayout.apply(this,arguments);
if(this.hasLayout&&this.toolbars.length>0){
Ext.each(this.toolbars,function(tb){
tb.doLayout(undefined,force)
});
this.syncHeight()
}
},
syncHeight:function(){
var h=this.toolbarHeight,bd=this.body,lsh=this.lastSize.height,sz;
if(this.autoHeight||!Ext.isDefined(lsh)||lsh=='auto'){
return
}
if(h!=this.getToolbarHeight()){
h=Math.max(0,lsh-this.getFrameHeight());
bd.setHeight(h);
sz=bd.getSize();
this.toolbarHeight=this.getToolbarHeight();
this.onBodyResize(sz.width,sz.height)
}
},
onShow:function(){
if(this.floating){
return this.el.show()
}
Ext.Panel.superclass.onShow.call(this)
},
onHide:function(){
if(this.floating){
return this.el.hide()
}
Ext.Panel.superclass.onHide.call(this)
},
createToolHandler:function(t,tc,overCls,panel){
return function(e){
t.removeClass(overCls);
if(tc.stopEvent!==false){
e.stopEvent()
}
if(tc.handler){
tc.handler.call(tc.scope||t,e,t,panel,tc)
}
}
},
afterRender:function(){
if(this.floating&&!this.hidden){
this.el.show()
}
if(this.title){
this.setTitle(this.title)
}
Ext.Panel.superclass.afterRender.call(this);
if(this.collapsed){
this.collapsed=false;
this.collapse(false)
}
this.initEvents()
},
getKeyMap:function(){
if(!this.keyMap){
this.keyMap=new Ext.KeyMap(this.el,this.keys)
}
return this.keyMap
},
initEvents:function(){
if(this.keys){
this.getKeyMap()
}
if(this.draggable){
this.initDraggable()
}
if(this.toolbars.length>0){
Ext.each(this.toolbars,function(tb){
tb.doLayout();
tb.on({
scope:this,
afterlayout:this.syncHeight,
remove:this.syncHeight
})
},this);
this.syncHeight()
}
},
initDraggable:function(){
this.dd=new Ext.Panel.DD(this,Ext.isBoolean(this.draggable)?null:this.draggable)
},
beforeEffect:function(anim){
if(this.floating){
this.el.beforeAction()
}
if(anim!==false){
this.el.addClass('x-panel-animated')
}
},
afterEffect:function(anim){
this.syncShadow();
this.el.removeClass('x-panel-animated')
},
createEffect:function(a,cb,scope){
var o={
scope:scope,
block:true
};
if(a===true){
o.callback=cb;
return o
}else if(!a.callback){
o.callback=cb
}else{
o.callback=function(){
cb.call(scope);
Ext.callback(a.callback,a.scope)
}
}
return Ext.applyIf(o,a)
},
collapse:function(animate){
if(this.collapsed||this.el.hasFxBlock()||this.fireEvent('beforecollapse',this,animate)===false){
return
}
var doAnim=animate===true||animate!==false&&this.animCollapse;
this.beforeEffect(doAnim);
this.onCollapse(doAnim,animate);
return this
},
onCollapse:function(doAnim,animArg){
if(doAnim){
this[this.collapseEl].slideOut(this.slideAnchor,Ext.apply(this.createEffect(animArg||true,this.afterCollapse,this),this.collapseDefaults))
}else{
this[this.collapseEl].hide(this.hideMode);
this.afterCollapse(false)
}
},
afterCollapse:function(anim){
this.collapsed=true;
this.el.addClass(this.collapsedCls);
if(anim!==false){
this[this.collapseEl].hide(this.hideMode)
}
this.afterEffect(anim);
this.cascade(function(c){
if(c.lastSize){
c.lastSize={
width:undefined,
height:undefined
}
}
});
this.fireEvent('collapse',this)
},
expand:function(animate){
if(!this.collapsed||this.el.hasFxBlock()||this.fireEvent('beforeexpand',this,animate)===false){
return
}
var doAnim=animate===true||animate!==false&&this.animCollapse;
this.el.removeClass(this.collapsedCls);
this.beforeEffect(doAnim);
this.onExpand(doAnim,animate);
return this
},
onExpand:function(doAnim,animArg){
if(doAnim){
this[this.collapseEl].slideIn(this.slideAnchor,Ext.apply(this.createEffect(animArg||true,this.afterExpand,this),this.expandDefaults))
}else{
this[this.collapseEl].show(this.hideMode);
this.afterExpand(false)
}
},
afterExpand:function(anim){
this.collapsed=false;
if(anim!==false){
this[this.collapseEl].show(this.hideMode)
}
this.afterEffect(anim);
if(this.deferLayout){
delete this.deferLayout;
this.doLayout(true)
}
this.fireEvent('expand',this)
},
toggleCollapse:function(animate){
this[this.collapsed?'expand':'collapse'](animate);
return this
},
onDisable:function(){
if(this.rendered&&this.maskDisabled){
this.el.mask()
}
Ext.Panel.superclass.onDisable.call(this)
},
onEnable:function(){
if(this.rendered&&this.maskDisabled){
this.el.unmask()
}
Ext.Panel.superclass.onEnable.call(this)
},
onResize:function(adjWidth,adjHeight,rawWidth,rawHeight){
var w=adjWidth,h=adjHeight;
if(Ext.isDefined(w)||Ext.isDefined(h)){
if(!this.collapsed){
if(Ext.isNumber(w)){
this.body.setWidth(w=this.adjustBodyWidth(w-this.getFrameWidth()))
}else if(w=='auto'){
w=this.body.setWidth('auto').dom.offsetWidth
}else{
w=this.body.dom.offsetWidth
}
if(this.tbar){
this.tbar.setWidth(w);
if(this.topToolbar){
this.topToolbar.setSize(w)
}
}
if(this.bbar){
this.bbar.setWidth(w);
if(this.bottomToolbar){
this.bottomToolbar.setSize(w);
if(Ext.isIE){
this.bbar.setStyle('position','static');
this.bbar.setStyle('position','')
}
}
}
if(this.footer){
this.footer.setWidth(w);
if(this.fbar){
this.fbar.setSize(Ext.isIE?w-this.footer.getFrameWidth('lr'):'auto')
}
}
if(Ext.isNumber(h)){
h=Math.max(0,h-this.getFrameHeight());
this.body.setHeight(h)
}else if(h=='auto'){
this.body.setHeight(h)
}
if(this.disabled&&this.el._mask){
this.el._mask.setSize(this.el.dom.clientWidth,this.el.getHeight())
}
}else{
this.queuedBodySize={
width:w,
height:h
};
if(!this.queuedExpand&&this.allowQueuedExpand!==false){
this.queuedExpand=true;
this.on('expand',function(){
delete this.queuedExpand;
this.onResize(this.queuedBodySize.width,this.queuedBodySize.height)
},this,{single:true})
}
}
this.onBodyResize(w,h)
}
this.syncShadow();
Ext.Panel.superclass.onResize.call(this,adjWidth,adjHeight,rawWidth,rawHeight)
},
onBodyResize:function(w,h){
this.fireEvent('bodyresize',this,w,h)
},
getToolbarHeight:function(){
var h=0;
if(this.rendered){
Ext.each(this.toolbars,function(tb){
h+=tb.getHeight()
},this)
}
return h
},
adjustBodyHeight:function(h){
return h
},
adjustBodyWidth:function(w){
return w
},
onPosition:function(){
this.syncShadow()
},
getFrameWidth:function(){
var w=this.el.getFrameWidth('lr')+this.bwrap.getFrameWidth('lr');
if(this.frame){
w+=this.mc.getFrameWidth('lr')
}
return w
},
getFrameHeight:function(){
var h=this.el.getFrameWidth('tb')+this.bwrap.getFrameWidth('tb');
h+=(this.tbar?this.tbar.getHeight():0)+(this.bbar?this.bbar.getHeight():0);
if(this.frame){
h+=this.el.dom.firstChild.offsetHeight+this.ft.dom.offsetHeight+this.mc.getFrameWidth('tb')
}else{
h+=(this.header?this.header.getHeight():0)+(this.footer?this.footer.getHeight():0)
}
return h
},
getInnerWidth:function(){
return this.getSize().width-this.getFrameWidth()
},
getInnerHeight:function(){
return this.body.getHeight()
},
syncShadow:function(){
if(this.floating){
this.el.sync(true)
}
},
getLayoutTarget:function(){
return this.body
},
getContentTarget:function(){
return this.body
},
setTitle:function(title,iconCls){
this.title=title;
if(this.header&&this.headerAsText){
this.header.child('span').update(title)
}
if(Ext.isDefined(iconCls)){
this.setIconClass(iconCls)
}
this.fireEvent('titlechange',this,title);
return this
},
getUpdater:function(){
return this.body.getUpdater()
},
load:function(){
var um=this.body.getUpdater();
um.update.apply(um,arguments);
return this
},
beforeDestroy:function(){
Ext.Panel.superclass.beforeDestroy.call(this);
if(this.header){
this.header.removeAllListeners()
}
if(this.tools){
for(var k in this.tools){
Ext.destroy(this.tools[k])
}
}
if(this.toolbars.length>0){
Ext.each(this.toolbars,function(tb){
tb.un('afterlayout',this.syncHeight,this);
tb.un('remove',this.syncHeight,this)
},this)
}
if(Ext.isArray(this.buttons)){
while(this.buttons.length){
Ext.destroy(this.buttons[0])
}
}
if(this.rendered){
Ext.destroy(this.ft,this.header,this.footer,this.tbar,this.bbar,this.body,this.mc,this.bwrap,this.dd);
if(this.fbar){
Ext.destroy(this.fbar,this.fbar.el)
}
}
Ext.destroy(this.toolbars)
},
createClasses:function(){
this.headerCls=this.baseCls+'-header';
this.headerTextCls=this.baseCls+'-header-text';
this.bwrapCls=this.baseCls+'-bwrap';
this.tbarCls=this.baseCls+'-tbar';
this.bodyCls=this.baseCls+'-body';
this.bbarCls=this.baseCls+'-bbar';
this.footerCls=this.baseCls+'-footer'
},
createGhost:function(cls,useShim,appendTo){
var el=document.createElement('div');
el.className='x-panel-ghost '+(cls?cls:'');
if(this.header){
el.appendChild(this.el.dom.firstChild.cloneNode(true))
}
Ext.fly(el.appendChild(document.createElement('ul'))).setHeight(this.bwrap.getHeight());
el.style.width=this.el.dom.offsetWidth+'px';
;
if(!appendTo){
this.container.dom.appendChild(el)
}else{
Ext.getDom(appendTo).appendChild(el)
}
if(useShim!==false&&this.el.useShim!==false){
var layer=new Ext.Layer({
shadow:false,
useDisplay:true,
constrain:false
},el);
layer.show();
return layer
}else{
return new Ext.Element(el)
}
},
doAutoLoad:function(){
var u=this.body.getUpdater();
if(this.renderer){
u.setRenderer(this.renderer)
}
u.update(Ext.isObject(this.autoLoad)?this.autoLoad:{url:this.autoLoad})
},
getTool:function(id){
return this.tools[id]
}
});
Ext.reg('panel',Ext.Panel);
Ext.Editor=function(field,config){
if(field.field){
this.field=Ext.create(field.field,'textfield');
config=Ext.apply({},field);
delete config.field
}else{
this.field=field
}
Ext.Editor.superclass.constructor.call(this,config)
};
Ext.extend(Ext.Editor,Ext.Component,{
allowBlur:true,
value:'',
alignment:'c-c?',
offsets:[
0,
0
],
shadow:'frame',
constrain:false,
swallowKeys:true,
completeOnEnter:true,
cancelOnEsc:true,
updateEl:false,
initComponent:function(){
Ext.Editor.superclass.initComponent.call(this);
this.addEvents('beforestartedit','startedit','beforecomplete','complete','canceledit','specialkey')
},
onRender:function(ct,position){
this.el=new Ext.Layer({
shadow:this.shadow,
cls:'x-editor',
parentEl:ct,
shim:this.shim,
shadowOffset:this.shadowOffset||4,
id:this.id,
constrain:this.constrain
});
if(this.zIndex){
this.el.setZIndex(this.zIndex)
}
this.el.setStyle('overflow',Ext.isGecko?'auto':'hidden');
if(this.field.msgTarget!='title'){
this.field.msgTarget='qtip'
}
this.field.inEditor=true;
this.mon(this.field,{
scope:this,
blur:this.onBlur,
specialkey:this.onSpecialKey
});
if(this.field.grow){
this.mon(this.field,'autosize',this.el.sync,this.el,{delay:1})
}
this.field.render(this.el).show();
this.field.getEl().dom.name='';
if(this.swallowKeys){
this.field.el.swallowEvent([
'keypress',
'keydown'
])
}
},
onSpecialKey:function(field,e){
var key=e.getKey(),complete=this.completeOnEnter&&key==e.ENTER,cancel=this.cancelOnEsc&&key==e.ESC;
if(complete||cancel){
e.stopEvent();
if(complete){
this.completeEdit()
}else{
this.cancelEdit()
}
if(field.triggerBlur){
field.triggerBlur()
}
}
this.fireEvent('specialkey',field,e)
},
startEdit:function(el,value){
if(this.editing){
this.completeEdit()
}
this.boundEl=Ext.get(el);
var v=value!==undefined?value:this.boundEl.dom.innerHTML;
if(!this.rendered){
this.render(this.parentEl||document.body)
}
if(this.fireEvent('beforestartedit',this,this.boundEl,v)!==false){
this.startValue=v;
this.field.reset();
this.field.setValue(v);
this.realign(true);
this.editing=true;
this.show()
}
},
doAutoSize:function(){
if(this.autoSize){
var sz=this.boundEl.getSize(),fs=this.field.getSize();
switch(this.autoSize){
case'width':
this.setSize(sz.width,fs.height);
break;
case'height':
this.setSize(fs.width,sz.height);
break;
case'none':
this.setSize(fs.width,fs.height);
break;
default:
this.setSize(sz.width,sz.height)
}
}
},
setSize:function(w,h){
delete this.field.lastSize;
this.field.setSize(w,h);
if(this.el){
if(Ext.isGecko2||Ext.isOpera||Ext.isIE7&&Ext.isStrict){
this.el.setSize(w,h)
}
this.el.sync()
}
},
realign:function(autoSize){
if(autoSize===true){
this.doAutoSize()
}
this.el.alignTo(this.boundEl,this.alignment,this.offsets)
},
completeEdit:function(remainVisible){
if(!this.editing){
return
}
if(this.field.assertValue){
this.field.assertValue()
}
var v=this.getValue();
if(!this.field.isValid()){
if(this.revertInvalid!==false){
this.cancelEdit(remainVisible)
}
return
}
if(String(v)===String(this.startValue)&&this.ignoreNoChange){
this.hideEdit(remainVisible);
return
}
if(this.fireEvent('beforecomplete',this,v,this.startValue)!==false){
v=this.getValue();
if(this.updateEl&&this.boundEl){
this.boundEl.update(v)
}
this.hideEdit(remainVisible);
this.fireEvent('complete',this,v,this.startValue)
}
},
onShow:function(){
this.el.show();
if(this.hideEl!==false){
this.boundEl.hide()
}
this.field.show().focus(false,true);
this.fireEvent('startedit',this.boundEl,this.startValue)
},
cancelEdit:function(remainVisible){
if(this.editing){
var v=this.getValue();
this.setValue(this.startValue);
this.hideEdit(remainVisible);
this.fireEvent('canceledit',this,v,this.startValue)
}
},
hideEdit:function(remainVisible){
if(remainVisible!==true){
this.editing=false;
this.hide()
}
},
onBlur:function(){
if(this.allowBlur===true&&this.editing&&this.selectSameEditor!==true){
this.completeEdit()
}
},
onHide:function(){
if(this.editing){
this.completeEdit();
return
}
this.field.blur();
if(this.field.collapse){
this.field.collapse()
}
this.el.hide();
if(this.hideEl!==false){
this.boundEl.show()
}
},
setValue:function(v){
this.field.setValue(v)
},
getValue:function(){
return this.field.getValue()
},
beforeDestroy:function(){
Ext.destroyMembers(this,'field');
delete this.parentEl;
delete this.boundEl
}
});
Ext.reg('editor',Ext.Editor);
Ext.ColorPalette=Ext.extend(Ext.Component,{
itemCls:'x-color-palette',
value:null,
clickEvent:'click',
ctype:'Ext.ColorPalette',
allowReselect:false,
colors:[
'000000',
'993300',
'333300',
'003300',
'003366',
'000080',
'333399',
'333333',
'800000',
'FF6600',
'808000',
'008000',
'008080',
'0000FF',
'666699',
'808080',
'FF0000',
'FF9900',
'99CC00',
'339966',
'33CCCC',
'3366FF',
'800080',
'969696',
'FF00FF',
'FFCC00',
'FFFF00',
'00FF00',
'00FFFF',
'00CCFF',
'993366',
'C0C0C0',
'FF99CC',
'FFCC99',
'FFFF99',
'CCFFCC',
'CCFFFF',
'99CCFF',
'CC99FF',
'FFFFFF'
],
initComponent:function(){
Ext.ColorPalette.superclass.initComponent.call(this);
this.addEvents('select');
if(this.handler){
this.on('select',this.handler,this.scope,true)
}
},
onRender:function(container,position){
this.autoEl={
tag:'div',
cls:this.itemCls
};
Ext.ColorPalette.superclass.onRender.call(this,container,position);
var t=this.tpl||new Ext.XTemplate('<tpl for="."><a href="#" class="color-{.}" hidefocus="on"><em><span style="background:#{.}" unselectable="on">&#160;</span></em></a></tpl>');
t.overwrite(this.el,this.colors);
this.mon(this.el,this.clickEvent,this.handleClick,this,{delegate:'a'});
if(this.clickEvent!='click'){
this.mon(this.el,'click',Ext.emptyFn,this,{
delegate:'a',
preventDefault:true
})
}
},
afterRender:function(){
Ext.ColorPalette.superclass.afterRender.call(this);
if(this.value){
var s=this.value;
this.value=null;
this.select(s,true)
}
},
handleClick:function(e,t){
e.preventDefault();
if(!this.disabled){
var c=t.className.match(/(?:^|\s)color-(.{6})(?:\s|$)/)[1];
this.select(c.toUpperCase())
}
},
select:function(color,suppressEvent){
color=color.replace('#','');
if(color!=this.value||this.allowReselect){
var el=this.el;
if(this.value){
el.child('a.color-'+this.value).removeClass('x-color-palette-sel')
}
el.child('a.color-'+color).addClass('x-color-palette-sel');
this.value=color;
if(suppressEvent!==true){
this.fireEvent('select',this,color)
}
}
}
});
Ext.reg('colorpalette',Ext.ColorPalette);
Ext.DatePicker=Ext.extend(Ext.BoxComponent,{
todayText:'Today',
okText:'&#160;OK&#160;',
cancelText:'Cancel',
todayTip:'{0} (Spacebar)',
minText:'This date is before the minimum date',
maxText:'This date is after the maximum date',
format:'m/d/y',
disabledDaysText:'Disabled',
disabledDatesText:'Disabled',
monthNames:Date.monthNames,
dayNames:Date.dayNames,
nextText:'Next Month (Control+Right)',
prevText:'Previous Month (Control+Left)',
monthYearText:'Choose a month (Control+Up/Down to move years)',
startDay:0,
showToday:true,
focusOnSelect:true,
initHour:12,
initComponent:function(){
Ext.DatePicker.superclass.initComponent.call(this);
this.value=this.value?this.value.clearTime(true):new Date().clearTime();
this.addEvents('select');
if(this.handler){
this.on('select',this.handler,this.scope||this)
}
this.initDisabledDays()
},
initDisabledDays:function(){
if(!this.disabledDatesRE&&this.disabledDates){
var dd=this.disabledDates,len=dd.length-1,re='(?:';
Ext.each(dd,function(d,i){
re+=Ext.isDate(d)?'^'+Ext.escapeRe(d.dateFormat(this.format))+'$':dd[i];
if(i!=len){
re+='|'
}
},this);
this.disabledDatesRE=new RegExp(re+')')
}
},
setDisabledDates:function(dd){
if(Ext.isArray(dd)){
this.disabledDates=dd;
this.disabledDatesRE=null
}else{
this.disabledDatesRE=dd
}
this.initDisabledDays();
this.update(this.value,true)
},
setDisabledDays:function(dd){
this.disabledDays=dd;
this.update(this.value,true)
},
setMinDate:function(dt){
this.minDate=dt;
this.update(this.value,true)
},
setMaxDate:function(dt){
this.maxDate=dt;
this.update(this.value,true)
},
setValue:function(value){
this.value=value.clearTime(true);
this.update(this.value)
},
getValue:function(){
return this.value
},
focus:function(){
this.update(this.activeDate)
},
onEnable:function(initial){
Ext.DatePicker.superclass.onEnable.call(this);
this.doDisabled(false);
this.update(initial?this.value:this.activeDate);
if(Ext.isIE){
this.el.repaint()
}
},
onDisable:function(){
Ext.DatePicker.superclass.onDisable.call(this);
this.doDisabled(true);
if(Ext.isIE&&!Ext.isIE8){
Ext.each([].concat(this.textNodes,this.el.query('th span')),function(el){
Ext.fly(el).repaint()
})
}
},
doDisabled:function(disabled){
this.keyNav.setDisabled(disabled);
this.prevRepeater.setDisabled(disabled);
this.nextRepeater.setDisabled(disabled);
if(this.showToday){
this.todayKeyListener.setDisabled(disabled);
this.todayBtn.setDisabled(disabled)
}
},
onRender:function(container,position){
var m=[
'<table cellspacing="0">',
'<tr><td class="x-date-left"><a href="#" title="',
this.prevText,
'">&#160;</a></td><td class="x-date-middle" align="center"></td><td class="x-date-right"><a href="#" title="',
this.nextText,
'">&#160;</a></td></tr>',
'<tr><td colspan="3"><table class="x-date-inner" cellspacing="0"><thead><tr>'
],dn=this.dayNames,i;
for(i=0;i<7;i++){
var d=this.startDay+i;
if(d>6){
d=d-7
}
m.push('<th><span>',dn[d].substr(0,1),'</span></th>')
}
m[m.length]='</tr></thead><tbody><tr>';
for(i=0;i<42;i++){
if(i%7===0&&i!==0){
m[m.length]='</tr><tr>'
}
m[m.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span></span></em></a></td>'
}
m.push('</tr></tbody></table></td></tr>',this.showToday?'<tr><td colspan="3" class="x-date-bottom" align="center"></td></tr>':'','</table><div class="x-date-mp"></div>');
var el=document.createElement('div');
el.className='x-date-picker';
el.innerHTML=m.join('');
container.dom.insertBefore(el,position);
this.el=Ext.get(el);
this.eventEl=Ext.get(el.firstChild);
this.prevRepeater=new Ext.util.ClickRepeater(this.el.child('td.x-date-left a'),{
handler:this.showPrevMonth,
scope:this,
preventDefault:true,
stopDefault:true
});
this.nextRepeater=new Ext.util.ClickRepeater(this.el.child('td.x-date-right a'),{
handler:this.showNextMonth,
scope:this,
preventDefault:true,
stopDefault:true
});
this.monthPicker=this.el.down('div.x-date-mp');
this.monthPicker.enableDisplayMode('block');
this.keyNav=new Ext.KeyNav(this.eventEl,{
'left':function(e){
if(e.ctrlKey){
this.showPrevMonth()
}else{
this.update(this.activeDate.add('d',-1))
}
},
'right':function(e){
if(e.ctrlKey){
this.showNextMonth()
}else{
this.update(this.activeDate.add('d',1))
}
},
'up':function(e){
if(e.ctrlKey){
this.showNextYear()
}else{
this.update(this.activeDate.add('d',-7))
}
},
'down':function(e){
if(e.ctrlKey){
this.showPrevYear()
}else{
this.update(this.activeDate.add('d',7))
}
},
'pageUp':function(e){
this.showNextMonth()
},
'pageDown':function(e){
this.showPrevMonth()
},
'enter':function(e){
e.stopPropagation();
return true
},
scope:this
});
this.el.unselectable();
this.cells=this.el.select('table.x-date-inner tbody td');
this.textNodes=this.el.query('table.x-date-inner tbody span');
this.mbtn=new Ext.Button({
text:'&#160;',
tooltip:this.monthYearText,
renderTo:this.el.child('td.x-date-middle',true)
});
this.mbtn.el.child('em').addClass('x-btn-arrow');
if(this.showToday){
this.todayKeyListener=this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.selectToday,this);
var today=new Date().dateFormat(this.format);
this.todayBtn=new Ext.Button({
renderTo:this.el.child('td.x-date-bottom',true),
text:String.format(this.todayText,today),
tooltip:String.format(this.todayTip,today),
handler:this.selectToday,
scope:this
})
}
this.mon(this.eventEl,'mousewheel',this.handleMouseWheel,this);
this.mon(this.eventEl,'click',this.handleDateClick,this,{delegate:'a.x-date-date'});
this.mon(this.mbtn,'click',this.showMonthPicker,this);
this.onEnable(true)
},
createMonthPicker:function(){
if(!this.monthPicker.dom.firstChild){
var buf=['<table border="0" cellspacing="0">'];
for(var i=0;i<6;i++){
buf.push('<tr><td class="x-date-mp-month"><a href="#">',Date.getShortMonthName(i),'</a></td>','<td class="x-date-mp-month x-date-mp-sep"><a href="#">',Date.getShortMonthName(i+6),'</a></td>',i===0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"></a></td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next"></a></td></tr>':'<td class="x-date-mp-year"><a href="#"></a></td><td class="x-date-mp-year"><a href="#"></a></td></tr>')
}
buf.push('<tr class="x-date-mp-btns"><td colspan="4"><button type="button" class="x-date-mp-ok">',this.okText,'</button><button type="button" class="x-date-mp-cancel">',this.cancelText,'</button></td></tr>','</table>');
this.monthPicker.update(buf.join(''));
this.mon(this.monthPicker,'click',this.onMonthClick,this);
this.mon(this.monthPicker,'dblclick',this.onMonthDblClick,this);
this.mpMonths=this.monthPicker.select('td.x-date-mp-month');
this.mpYears=this.monthPicker.select('td.x-date-mp-year');
this.mpMonths.each(function(m,a,i){
i+=1;
if(i%2===0){
m.dom.xmonth=5+Math.round(i*0.5)
}else{
m.dom.xmonth=Math.round((i-1)*0.5)
}
})
}
},
showMonthPicker:function(){
if(!this.disabled){
this.createMonthPicker();
var size=this.el.getSize();
this.monthPicker.setSize(size);
this.monthPicker.child('table').setSize(size);
this.mpSelMonth=(this.activeDate||this.value).getMonth();
this.updateMPMonth(this.mpSelMonth);
this.mpSelYear=(this.activeDate||this.value).getFullYear();
this.updateMPYear(this.mpSelYear);
this.monthPicker.slideIn('t',{duration:0.2})
}
},
updateMPYear:function(y){
this.mpyear=y;
var ys=this.mpYears.elements;
for(var i=1;i<=10;i++){
var td=ys[i-1],y2;
if(i%2===0){
y2=y+Math.round(i*0.5);
td.firstChild.innerHTML=y2;
td.xyear=y2
}else{
y2=y-(5-Math.round(i*0.5));
td.firstChild.innerHTML=y2;
td.xyear=y2
}
this.mpYears.item(i-1)[y2==this.mpSelYear?'addClass':'removeClass']('x-date-mp-sel')
}
},
updateMPMonth:function(sm){
this.mpMonths.each(function(m,a,i){
m[m.dom.xmonth==sm?'addClass':'removeClass']('x-date-mp-sel')
})
},
selectMPMonth:function(m){
},
onMonthClick:function(e,t){
e.stopEvent();
var el=new Ext.Element(t),pn;
if(el.is('button.x-date-mp-cancel')){
this.hideMonthPicker()
}else if(el.is('button.x-date-mp-ok')){
var d=new Date(this.mpSelYear,this.mpSelMonth,(this.activeDate||this.value).getDate());
if(d.getMonth()!=this.mpSelMonth){
d=new Date(this.mpSelYear,this.mpSelMonth,1).getLastDateOfMonth()
}
this.update(d);
this.hideMonthPicker()
}else if(pn=el.up('td.x-date-mp-month',2)){
this.mpMonths.removeClass('x-date-mp-sel');
pn.addClass('x-date-mp-sel');
this.mpSelMonth=pn.dom.xmonth
}else if(pn=el.up('td.x-date-mp-year',2)){
this.mpYears.removeClass('x-date-mp-sel');
pn.addClass('x-date-mp-sel');
this.mpSelYear=pn.dom.xyear
}else if(el.is('a.x-date-mp-prev')){
this.updateMPYear(this.mpyear-10)
}else if(el.is('a.x-date-mp-next')){
this.updateMPYear(this.mpyear+10)
}
},
onMonthDblClick:function(e,t){
e.stopEvent();
var el=new Ext.Element(t),pn;
if(pn=el.up('td.x-date-mp-month',2)){
this.update(new Date(this.mpSelYear,pn.dom.xmonth,(this.activeDate||this.value).getDate()));
this.hideMonthPicker()
}else if(pn=el.up('td.x-date-mp-year',2)){
this.update(new Date(pn.dom.xyear,this.mpSelMonth,(this.activeDate||this.value).getDate()));
this.hideMonthPicker()
}
},
hideMonthPicker:function(disableAnim){
if(this.monthPicker){
if(disableAnim===true){
this.monthPicker.hide()
}else{
this.monthPicker.slideOut('t',{duration:0.2})
}
}
},
showPrevMonth:function(e){
this.update(this.activeDate.add('mo',-1))
},
showNextMonth:function(e){
this.update(this.activeDate.add('mo',1))
},
showPrevYear:function(){
this.update(this.activeDate.add('y',-1))
},
showNextYear:function(){
this.update(this.activeDate.add('y',1))
},
handleMouseWheel:function(e){
e.stopEvent();
if(!this.disabled){
var delta=e.getWheelDelta();
if(delta>0){
this.showPrevMonth()
}else if(delta<0){
this.showNextMonth()
}
}
},
handleDateClick:function(e,t){
e.stopEvent();
if(!this.disabled&&t.dateValue&&!Ext.fly(t.parentNode).hasClass('x-date-disabled')){
this.cancelFocus=this.focusOnSelect===false;
this.setValue(new Date(t.dateValue));
delete this.cancelFocus;
this.fireEvent('select',this,this.value)
}
},
selectToday:function(){
if(this.todayBtn&&!this.todayBtn.disabled){
this.setValue(new Date().clearTime());
this.fireEvent('select',this,this.value)
}
},
update:function(date,forceRefresh){
if(this.rendered){
var vd=this.activeDate,vis=this.isVisible();
this.activeDate=date;
if(!forceRefresh&&vd&&this.el){
var t=date.getTime();
if(vd.getMonth()==date.getMonth()&&vd.getFullYear()==date.getFullYear()){
this.cells.removeClass('x-date-selected');
this.cells.each(function(c){
if(c.dom.firstChild.dateValue==t){
c.addClass('x-date-selected');
if(vis&&!this.cancelFocus){
Ext.fly(c.dom.firstChild).focus(50)
}
return false
}
},this);
return
}
}
var days=date.getDaysInMonth(),firstOfMonth=date.getFirstDateOfMonth(),startingPos=firstOfMonth.getDay()-this.startDay;
if(startingPos<0){
startingPos+=7
}
days+=startingPos;
var pm=date.add('mo',-1),prevStart=pm.getDaysInMonth()-startingPos,cells=this.cells.elements,textEls=this.textNodes,d=new Date(pm.getFullYear(),pm.getMonth(),prevStart,this.initHour),today=new Date().clearTime().getTime(),sel=date.clearTime(true).getTime(),min=this.minDate?this.minDate.clearTime(true):Number.NEGATIVE_INFINITY,max=this.maxDate?this.maxDate.clearTime(true):Number.POSITIVE_INFINITY,ddMatch=this.disabledDatesRE,ddText=this.disabledDatesText,ddays=this.disabledDays?this.disabledDays.join(''):false,ddaysText=this.disabledDaysText,format=this.format;
if(this.showToday){
var td=new Date().clearTime(),disable=td<min||td>max||ddMatch&&format&&ddMatch.test(td.dateFormat(format))||ddays&&ddays.indexOf(td.getDay())!=-1;
if(!this.disabled){
this.todayBtn.setDisabled(disable);
this.todayKeyListener[disable?'disable':'enable']()
}
}
var setCellClass=function(cal,cell){
cell.title='';
var t=d.clearTime(true).getTime();
cell.firstChild.dateValue=t;
if(t==today){
cell.className+=' x-date-today';
cell.title=cal.todayText
}
if(t==sel){
cell.className+=' x-date-selected';
if(vis){
Ext.fly(cell.firstChild).focus(50)
}
}
if(t<min){
cell.className=' x-date-disabled';
cell.title=cal.minText;
return
}
if(t>max){
cell.className=' x-date-disabled';
cell.title=cal.maxText;
return
}
if(ddays){
if(ddays.indexOf(d.getDay())!=-1){
cell.title=ddaysText;
cell.className=' x-date-disabled'
}
}
if(ddMatch&&format){
var fvalue=d.dateFormat(format);
if(ddMatch.test(fvalue)){
cell.title=ddText.replace('%0',fvalue);
cell.className=' x-date-disabled'
}
}
};
var i=0;
for(;i<startingPos;i++){
textEls[i].innerHTML=++prevStart;
d.setDate(d.getDate()+1);
cells[i].className='x-date-prevday';
setCellClass(this,cells[i])
}
for(;i<days;i++){
var intDay=i-startingPos+1;
textEls[i].innerHTML=intDay;
d.setDate(d.getDate()+1);
cells[i].className='x-date-active';
setCellClass(this,cells[i])
}
var extraDays=0;
for(;i<42;i++){
textEls[i].innerHTML=++extraDays;
d.setDate(d.getDate()+1);
cells[i].className='x-date-nextday';
setCellClass(this,cells[i])
}
this.mbtn.setText(this.monthNames[date.getMonth()]+' '+date.getFullYear());
if(!this.internalRender){
var main=this.el.dom.firstChild,w=main.offsetWidth;
this.el.setWidth(w+this.el.getBorderWidth('lr'));
Ext.fly(main).setWidth(w);
this.internalRender=true;
if(Ext.isOpera&&!this.secondPass){
main.rows[0].cells[1].style.width=w-(main.rows[0].cells[0].offsetWidth+main.rows[0].cells[2].offsetWidth)+'px';
this.secondPass=true;
this.update.defer(10,this,[date])
}
}
}
},
beforeDestroy:function(){
if(this.rendered){
Ext.destroy(this.keyNav,this.monthPicker,this.eventEl,this.mbtn,this.nextRepeater,this.prevRepeater,this.cells.el,this.todayBtn);
delete this.textNodes;
delete this.cells.elements
}
}
});
Ext.reg('datepicker',Ext.DatePicker);
Ext.LoadMask=function(el,config){
this.el=Ext.get(el);
Ext.apply(this,config);
if(this.store){
this.store.on({
scope:this,
beforeload:this.onBeforeLoad,
load:this.onLoad,
exception:this.onLoad
});
this.removeMask=Ext.value(this.removeMask,false)
}else{
var um=this.el.getUpdater();
um.showLoadIndicator=false;
um.on({
scope:this,
beforeupdate:this.onBeforeLoad,
update:this.onLoad,
failure:this.onLoad
});
this.removeMask=Ext.value(this.removeMask,true)
}
};
Ext.LoadMask.prototype={
msg:'Loading...',
msgCls:'x-mask-loading',
disabled:false,
disable:function(){
this.disabled=true
},
enable:function(){
this.disabled=false
},
onLoad:function(){
this.el.unmask(this.removeMask)
},
onBeforeLoad:function(){
if(!this.disabled){
this.el.mask('','animated-loading-dots',true,true)
}
},
show:function(){
this.onBeforeLoad()
},
hide:function(){
this.onLoad()
},
destroy:function(){
if(this.store){
this.store.un('beforeload',this.onBeforeLoad,this);
this.store.un('load',this.onLoad,this);
this.store.un('exception',this.onLoad,this)
}else{
var um=this.el.getUpdater();
um.un('beforeupdate',this.onBeforeLoad,this);
um.un('update',this.onLoad,this);
um.un('failure',this.onLoad,this)
}
}
};
Ext.slider.Thumb=Ext.extend(Object,{
dragging:false,
constructor:function(config){
Ext.apply(this,config||{},{
cls:'x-slider-thumb',
constrain:false
});
Ext.slider.Thumb.superclass.constructor.call(this,config);
if(this.slider.vertical){
Ext.apply(this,Ext.slider.Thumb.Vertical)
}
},
render:function(){
this.el=this.slider.innerEl.insertFirst({cls:this.cls});
this.initEvents()
},
enable:function(){
this.disabled=false;
this.el.removeClass(this.slider.disabledClass)
},
disable:function(){
this.disabled=true;
this.el.addClass(this.slider.disabledClass)
},
initEvents:function(){
var el=this.el;
el.addClassOnOver('x-slider-thumb-over');
this.tracker=new Ext.dd.DragTracker({
onBeforeStart:this.onBeforeDragStart.createDelegate(this),
onStart:this.onDragStart.createDelegate(this),
onDrag:this.onDrag.createDelegate(this),
onEnd:this.onDragEnd.createDelegate(this),
tolerance:3,
autoStart:300
});
this.tracker.initEl(el)
},
onBeforeDragStart:function(e){
if(this.disabled){
return false
}else{
this.slider.promoteThumb(this);
return true
}
},
onDragStart:function(e){
this.el.addClass('x-slider-thumb-drag');
this.dragging=true;
this.dragStartValue=this.value;
this.slider.fireEvent('dragstart',this.slider,e,this)
},
onDrag:function(e){
var slider=this.slider,index=this.index,newValue=this.getNewValue();
if(this.constrain){
var above=slider.thumbs[index+1],below=slider.thumbs[index-1];
if(below!=undefined&&newValue<=below.value)
newValue=below.value;
if(above!=undefined&&newValue>=above.value)
newValue=above.value
}
slider.setValue(index,newValue,false);
slider.fireEvent('drag',slider,e,this)
},
getNewValue:function(){
var slider=this.slider,pos=slider.innerEl.translatePoints(this.tracker.getXY());
return Ext.util.Format.round(slider.reverseValue(pos.left),slider.decimalPrecision)
},
onDragEnd:function(e){
var slider=this.slider,value=this.value;
this.el.removeClass('x-slider-thumb-drag');
this.dragging=false;
slider.fireEvent('dragend',slider,e);
if(this.dragStartValue!=value){
slider.fireEvent('changecomplete',slider,value,this)
}
},
destroy:function(){
Ext.destroyMembers(this,'tracker','el')
}
});
Ext.slider.MultiSlider=Ext.extend(Ext.BoxComponent,{
vertical:false,
minValue:0,
maxValue:100,
decimalPrecision:0,
keyIncrement:1,
increment:0,
clickRange:[
5,
15
],
clickToChange:true,
animate:true,
constrainThumbs:true,
topThumbZIndex:10000,
initComponent:function(){
if(!Ext.isDefined(this.value)){
this.value=this.minValue
}
this.thumbs=[];
Ext.slider.MultiSlider.superclass.initComponent.call(this);
this.keyIncrement=Math.max(this.increment,this.keyIncrement);
this.addEvents('beforechange','change','changecomplete','dragstart','drag','dragend');
if(this.values==undefined||Ext.isEmpty(this.values))
this.values=[0];
var values=this.values;
for(var i=0;i<values.length;i++){
this.addThumb(values[i])
}
if(this.vertical){
Ext.apply(this,Ext.slider.Vertical)
}
},
addThumb:function(value){
var thumb=new Ext.slider.Thumb({
value:value,
slider:this,
index:this.thumbs.length,
constrain:this.constrainThumbs
});
this.thumbs.push(thumb);
if(this.rendered)
thumb.render()
},
promoteThumb:function(topThumb){
var thumbs=this.thumbs,zIndex,thumb;
for(var i=0,j=thumbs.length;i<j;i++){
thumb=thumbs[i];
if(thumb==topThumb){
zIndex=this.topThumbZIndex
}else{
zIndex=''
}
thumb.el.setStyle('zIndex',zIndex)
}
},
onRender:function(){
this.autoEl={
cls:'x-slider '+(this.vertical?'x-slider-vert':'x-slider-horz'),
cn:{
cls:'x-slider-end',
cn:{
cls:'x-slider-inner',
cn:[{
tag:'a',
cls:'x-slider-focus',
href:'#',
tabIndex:'-1',
hidefocus:'on'
}]
}
}
};
Ext.slider.MultiSlider.superclass.onRender.apply(this,arguments);
this.endEl=this.el.first();
this.innerEl=this.endEl.first();
this.focusEl=this.innerEl.child('.x-slider-focus');
for(var i=0;i<this.thumbs.length;i++){
this.thumbs[i].render()
}
var thumb=this.innerEl.child('.x-slider-thumb');
this.halfThumb=(this.vertical?thumb.getHeight():thumb.getWidth())/2;
this.initEvents()
},
initEvents:function(){
this.mon(this.el,{
scope:this,
mousedown:this.onMouseDown,
keydown:this.onKeyDown
});
this.focusEl.swallowEvent('click',true)
},
onMouseDown:function(e){
if(this.disabled){
return
}
var thumbClicked=false;
for(var i=0;i<this.thumbs.length;i++){
thumbClicked=thumbClicked||e.target==this.thumbs[i].el.dom
}
if(this.clickToChange&&!thumbClicked){
var local=this.innerEl.translatePoints(e.getXY());
this.onClickChange(local)
}
this.focus()
},
onClickChange:function(local){
if(local.top>this.clickRange[0]&&local.top<this.clickRange[1]){
var thumb=this.getNearest(local,'left'),index=thumb.index;
this.setValue(index,Ext.util.Format.round(this.reverseValue(local.left),this.decimalPrecision),undefined,true)
}
},
getNearest:function(local,prop){
var localValue=prop=='top'?this.innerEl.getHeight()-local[prop]:local[prop],clickValue=this.reverseValue(localValue),nearestDistance=this.maxValue-this.minValue+5,index=0,nearest=null;
for(var i=0;i<this.thumbs.length;i++){
var thumb=this.thumbs[i],value=thumb.value,dist=Math.abs(value-clickValue);
if(Math.abs(dist<=nearestDistance)){
nearest=thumb;
index=i;
nearestDistance=dist
}
}
return nearest
},
onKeyDown:function(e){
if(this.disabled||this.thumbs.length!==1){
e.preventDefault();
return
}
var k=e.getKey(),val;
switch(k){
case e.UP:
case e.RIGHT:
e.stopEvent();
val=e.ctrlKey?this.maxValue:this.getValue(0)+this.keyIncrement;
this.setValue(0,val,undefined,true);
break;
case e.DOWN:
case e.LEFT:
e.stopEvent();
val=e.ctrlKey?this.minValue:this.getValue(0)-this.keyIncrement;
this.setValue(0,val,undefined,true);
break;
default:
e.preventDefault()
}
},
doSnap:function(value){
if(!(this.increment&&value)){
return value
}
var newValue=value,inc=this.increment,m=value%inc;
if(m!=0){
newValue-=m;
if(m*2>=inc){
newValue+=inc
}else if(m*2<-inc){
newValue-=inc
}
}
return newValue.constrain(this.minValue,this.maxValue)
},
afterRender:function(){
Ext.slider.MultiSlider.superclass.afterRender.apply(this,arguments);
for(var i=0;i<this.thumbs.length;i++){
var thumb=this.thumbs[i];
if(thumb.value!==undefined){
var v=this.normalizeValue(thumb.value);
if(v!==thumb.value){
this.setValue(i,v,false)
}else{
this.moveThumb(i,this.translateValue(v),false)
}
}
}
;
},
getRatio:function(){
var w=this.innerEl.getWidth(),v=this.maxValue-this.minValue;
return v==0?w:w/v
},
normalizeValue:function(v){
v=this.doSnap(v);
v=Ext.util.Format.round(v,this.decimalPrecision);
v=v.constrain(this.minValue,this.maxValue);
return v
},
setMinValue:function(val){
this.minValue=val;
var i=0,thumbs=this.thumbs,len=thumbs.length,t;
for(;i<len;++i){
t=thumbs[i];
t.value=t.value<val?val:t.value
}
this.syncThumb()
},
setMaxValue:function(val){
this.maxValue=val;
var i=0,thumbs=this.thumbs,len=thumbs.length,t;
for(;i<len;++i){
t=thumbs[i];
t.value=t.value>val?val:t.value
}
this.syncThumb()
},
setValue:function(index,v,animate,changeComplete){
var thumb=this.thumbs[index],el=thumb.el;
v=this.normalizeValue(v);
if(v!==thumb.value&&this.fireEvent('beforechange',this,v,thumb.value,thumb)!==false){
thumb.value=v;
if(this.rendered){
this.moveThumb(index,this.translateValue(v),animate!==false);
this.fireEvent('change',this,v,thumb);
if(changeComplete){
this.fireEvent('changecomplete',this,v,thumb)
}
}
}
},
translateValue:function(v){
var ratio=this.getRatio();
return v*ratio-this.minValue*ratio-this.halfThumb
},
reverseValue:function(pos){
var ratio=this.getRatio();
return(pos+this.minValue*ratio)/ratio
},
moveThumb:function(index,v,animate){
var thumb=this.thumbs[index].el;
if(!animate||this.animate===false){
if(this.halfThumb){
thumb.setLeft(v)
}else{
this.halfThumb=(this.vertical?thumb.getHeight():thumb.getWidth())/2;
thumb.setLeft(v-this.halfThumb)
}
}else{
thumb.shift({
left:v,
stopFx:true,
duration:0.35
})
}
},
focus:function(){
this.focusEl.focus(10)
},
onResize:function(w,h){
var thumbs=this.thumbs,len=thumbs.length,i=0;
for(;i<len;++i){
thumbs[i].el.stopFx()
}
if(Ext.isNumber(w)){
this.innerEl.setWidth(w-(this.el.getPadding('l')+this.endEl.getPadding('r')))
}
this.syncThumb();
Ext.slider.MultiSlider.superclass.onResize.apply(this,arguments)
},
onDisable:function(){
Ext.slider.MultiSlider.superclass.onDisable.call(this);
for(var i=0;i<this.thumbs.length;i++){
var thumb=this.thumbs[i],el=thumb.el;
thumb.disable();
if(Ext.isIE){
var xy=el.getXY();
el.hide();
this.innerEl.addClass(this.disabledClass).dom.disabled=true;
if(!this.thumbHolder){
this.thumbHolder=this.endEl.createChild({cls:'x-slider-thumb '+this.disabledClass})
}
this.thumbHolder.show().setXY(xy)
}
}
},
onEnable:function(){
Ext.slider.MultiSlider.superclass.onEnable.call(this);
for(var i=0;i<this.thumbs.length;i++){
var thumb=this.thumbs[i],el=thumb.el;
thumb.enable();
if(Ext.isIE){
this.innerEl.removeClass(this.disabledClass).dom.disabled=false;
if(this.thumbHolder)
this.thumbHolder.hide();
el.show();
this.syncThumb()
}
}
},
syncThumb:function(){
if(this.rendered){
for(var i=0;i<this.thumbs.length;i++){
this.moveThumb(i,this.translateValue(this.thumbs[i].value))
}
}
},
getValue:function(index){
return this.thumbs[index].value
},
getValues:function(){
var values=[];
for(var i=0;i<this.thumbs.length;i++){
values.push(this.thumbs[i].value)
}
return values
},
beforeDestroy:function(){
var thumbs=this.thumbs;
for(var i=0,len=thumbs.length;i<len;++i){
thumbs[i].destroy();
thumbs[i]=null
}
Ext.destroyMembers(this,'endEl','innerEl','focusEl','thumbHolder');
Ext.slider.MultiSlider.superclass.beforeDestroy.call(this)
}
});
Ext.reg('multislider',Ext.slider.MultiSlider);
Ext.slider.SingleSlider=Ext.extend(Ext.slider.MultiSlider,{
constructor:function(config){
config=config||{};
Ext.applyIf(config,{values:[config.value||0]});
Ext.slider.SingleSlider.superclass.constructor.call(this,config)
},
getValue:function(){
return Ext.slider.SingleSlider.superclass.getValue.call(this,0)
},
setValue:function(value,animate){
var args=Ext.toArray(arguments),len=args.length;
if(len==1||len<=3&&typeof arguments[1]!='number'){
args.unshift(0)
}
return Ext.slider.SingleSlider.superclass.setValue.apply(this,args)
},
syncThumb:function(){
return Ext.slider.SingleSlider.superclass.syncThumb.apply(this,[0].concat(arguments))
},
getNearest:function(){
return this.thumbs[0]
}
});
Ext.Slider=Ext.slider.SingleSlider;
Ext.reg('slider',Ext.slider.SingleSlider);
Ext.slider.Vertical={
onResize:function(w,h){
this.innerEl.setHeight(h-(this.el.getPadding('t')+this.endEl.getPadding('b')));
this.syncThumb()
},
getRatio:function(){
var h=this.innerEl.getHeight(),v=this.maxValue-this.minValue;
return h/v
},
moveThumb:function(index,v,animate){
var thumb=this.thumbs[index],el=thumb.el;
if(!animate||this.animate===false){
el.setBottom(v)
}else{
el.shift({
bottom:v,
stopFx:true,
duration:0.35
})
}
},
onClickChange:function(local){
if(local.left>this.clickRange[0]&&local.left<this.clickRange[1]){
var thumb=this.getNearest(local,'top'),index=thumb.index,value=this.minValue+this.reverseValue(this.innerEl.getHeight()-local.top);
this.setValue(index,Ext.util.Format.round(value,this.decimalPrecision),undefined,true)
}
}
};
Ext.slider.Thumb.Vertical={
getNewValue:function(){
var slider=this.slider,innerEl=slider.innerEl,pos=innerEl.translatePoints(this.tracker.getXY()),bottom=innerEl.getHeight()-pos.top;
return slider.minValue+Ext.util.Format.round(bottom/slider.getRatio(),slider.decimalPrecision)
}
};
Ext.ProgressBar=Ext.extend(Ext.BoxComponent,{
baseCls:'x-progress',
animate:false,
waitTimer:null,
initComponent:function(){
Ext.ProgressBar.superclass.initComponent.call(this);
this.addEvents('update')
},
onRender:function(ct,position){
var tpl=new Ext.Template('<div class="{cls}-wrap">','<div class="{cls}-inner">','<div class="{cls}-bar">','<div class="{cls}-text">','<div>&#160;</div>','</div>','</div>','<div class="{cls}-text {cls}-text-back">','<div>&#160;</div>','</div>','</div>','</div>');
this.el=position?tpl.insertBefore(position,{cls:this.baseCls},true):tpl.append(ct,{cls:this.baseCls},true);
if(this.id){
this.el.dom.id=this.id
}
var inner=this.el.dom.firstChild;
this.progressBar=Ext.get(inner.firstChild);
if(this.textEl){
this.textEl=Ext.get(this.textEl);
delete this.textTopEl
}else{
this.textTopEl=Ext.get(this.progressBar.dom.firstChild);
var textBackEl=Ext.get(inner.childNodes[1]);
this.textTopEl.setStyle('z-index',99).addClass('x-hidden');
this.textEl=new Ext.CompositeElement([
this.textTopEl.dom.firstChild,
textBackEl.dom.firstChild
]);
this.textEl.setWidth(inner.offsetWidth)
}
this.progressBar.setHeight(inner.offsetHeight)
},
afterRender:function(){
Ext.ProgressBar.superclass.afterRender.call(this);
if(this.value){
this.updateProgress(this.value,this.text)
}else{
this.updateText(this.text)
}
},
updateProgress:function(value,text,animate){
this.value=value||0;
if(text){
this.updateText(text)
}
if(this.rendered&&!this.isDestroyed){
var w=Math.floor(value*this.el.dom.firstChild.offsetWidth);
this.progressBar.setWidth(w,animate===true||animate!==false&&this.animate);
if(this.textTopEl){
this.textTopEl.removeClass('x-hidden').setWidth(w)
}
}
this.fireEvent('update',this,value,text);
return this
},
wait:function(o){
if(!this.waitTimer){
var scope=this;
o=o||{};
this.updateText(o.text);
this.waitTimer=Ext.TaskMgr.start({
run:function(i){
var inc=o.increment||10;
i-=1;
this.updateProgress(((i+inc)%inc+1)*(100/ inc)*0.01,null,o.animate)
},
interval:o.interval||1000,
duration:o.duration,
onStop:function(){
if(o.fn){
o.fn.apply(o.scope||this)
}
this.reset()
},
scope:scope
})
}
return this
},
isWaiting:function(){
return this.waitTimer!==null
},
updateText:function(text){
this.text=text||'&#160;';
if(this.rendered){
this.textEl.update(this.text)
}
return this
},
syncProgressBar:function(){
if(this.value){
this.updateProgress(this.value,this.text)
}
return this
},
setSize:function(w,h){
Ext.ProgressBar.superclass.setSize.call(this,w,h);
if(this.textTopEl){
var inner=this.el.dom.firstChild;
this.textEl.setSize(inner.offsetWidth,inner.offsetHeight)
}
this.syncProgressBar();
return this
},
reset:function(hide){
this.updateProgress(0);
if(this.textTopEl){
this.textTopEl.addClass('x-hidden')
}
this.clearTimer();
if(hide===true){
this.hide()
}
return this
},
clearTimer:function(){
if(this.waitTimer){
this.waitTimer.onStop=null;
Ext.TaskMgr.stop(this.waitTimer);
this.waitTimer=null
}
},
onDestroy:function(){
this.clearTimer();
if(this.rendered){
if(this.textEl.isComposite){
this.textEl.clear()
}
Ext.destroyMembers(this,'textEl','progressBar','textTopEl')
}
Ext.ProgressBar.superclass.onDestroy.call(this)
}
});
Ext.reg('progress',Ext.ProgressBar);
Ext.data.Api=function(){
var validActions={};
return{
actions:{
create:'create',
read:'read',
update:'update',
destroy:'destroy'
},
restActions:{
create:'POST',
read:'GET',
update:'PUT',
destroy:'DELETE'
},
isAction:function(action){
return Ext.data.Api.actions[action]?true:false
},
getVerb:function(name){
if(validActions[name]){
return validActions[name]
}
for(var verb in this.actions){
if(this.actions[verb]===name){
validActions[name]=verb;
break
}
}
return validActions[name]!==undefined?validActions[name]:null
},
isValid:function(api){
var invalid=[];
var crud=this.actions;
for(var action in api){
if(!(action in crud)){
invalid.push(action)
}
}
return!invalid.length?true:invalid
},
hasUniqueUrl:function(proxy,verb){
var url=proxy.api[verb]?proxy.api[verb].url:null;
var unique=true;
for(var action in proxy.api){
if((unique=action===verb?true:proxy.api[action].url!=url?true:false)===false){
break
}
}
return unique
},
prepare:function(proxy){
if(!proxy.api){
proxy.api={}
}
for(var verb in this.actions){
var action=this.actions[verb];
proxy.api[action]=proxy.api[action]||proxy.url||proxy.directFn;
if(typeof proxy.api[action]=='string'){
proxy.api[action]={
url:proxy.api[action],
method:proxy.restful===true?Ext.data.Api.restActions[action]:undefined
}
}
}
},
restify:function(proxy){
proxy.restful=true;
for(var verb in this.restActions){
proxy.api[this.actions[verb]].method||(proxy.api[this.actions[verb]].method=this.restActions[verb])
}
proxy.onWrite=proxy.onWrite.createInterceptor(function(action,o,response,rs){
var reader=o.reader;
var res=new Ext.data.Response({
action:action,
raw:response
});
switch(response.status){
case 200:
return true;
break;
case 201:
if(Ext.isEmpty(res.raw.responseText)){
res.success=true
}else{
return true
}
break;
case 204:
res.success=true;
res.data=null;
break;
default:
return true;
break
}
if(res.success===true){
this.fireEvent('write',this,action,res.data,res,rs,o.request.arg)
}else{
this.fireEvent('exception',this,'remote',action,o,res,rs)
}
o.request.callback.call(o.request.scope,res.data,res,res.success);
return false
},proxy)
}
}
}();
Ext.data.Response=function(params,response){
Ext.apply(this,params,{raw:response})
};
Ext.data.Response.prototype={
message:null,
success:false,
status:null,
root:null,
raw:null,
getMessage:function(){
return this.message
},
getSuccess:function(){
return this.success
},
getStatus:function(){
return this.status
},
getRoot:function(){
return this.root
},
getRawResponse:function(){
return this.raw
}
};
Ext.data.Api.Error=Ext.extend(Ext.Error,{
constructor:function(message,arg){
this.arg=arg;
Ext.Error.call(this,message)
},
name:'Ext.data.Api'
});
Ext.apply(Ext.data.Api.Error.prototype,{
lang:{
'action-url-undefined':'No fallback url defined for this action.  When defining a DataProxy api, please be sure to define an url for each CRUD action in Ext.data.Api.actions or define a default url in addition to your api-configuration.',
'invalid':'received an invalid API-configuration.  Please ensure your proxy API-configuration contains only the actions defined in Ext.data.Api.actions',
'invalid-url':'Invalid url.  Please review your proxy configuration.',
'execute':'Attempted to execute an unknown action.  Valid API actions are defined in Ext.data.Api.actions"'
}
});
Ext.data.SortTypes={
none:function(s){
return s
},
stripTagsRE:/<\/?[^>]+>/gi,
asText:function(s){
return String(s).replace(this.stripTagsRE,'')
},
asUCText:function(s){
return String(s).toUpperCase().replace(this.stripTagsRE,'')
},
asUCString:function(s){
return String(s).toUpperCase()
},
asDate:function(s){
if(!s){
return 0
}
if(Ext.isDate(s)){
return s.getTime()
}
return Date.parse(String(s))
},
asFloat:function(s){
var val=parseFloat(String(s).replace(/,/g,''));
return isNaN(val)?0:val
},
asInt:function(s){
var val=parseInt(String(s).replace(/,/g,''),10);
return isNaN(val)?0:val
}
};
Ext.data.Record=function(data,id){
this.id=id||id===0?id:Ext.data.Record.id(this);
this.data=data||{}
};
Ext.data.Record.create=function(o){
var f=Ext.extend(Ext.data.Record,{});
var p=f.prototype;
p.fields=new Ext.util.MixedCollection(false,function(field){
return field.name
});
for(var i=0,len=o.length;i<len;i++){
p.fields.add(new Ext.data.Field(o[i]))
}
f.getField=function(name){
return p.fields.get(name)
};
return f
};
Ext.data.Record.PREFIX='ext-record';
Ext.data.Record.AUTO_ID=1;
Ext.data.Record.EDIT='edit';
Ext.data.Record.REJECT='reject';
Ext.data.Record.COMMIT='commit';
Ext.data.Record.id=function(rec){
rec.phantom=true;
return[
Ext.data.Record.PREFIX,
'-',
Ext.data.Record.AUTO_ID++
].join('')
};
Ext.data.Record.prototype={
dirty:false,
editing:false,
error:null,
modified:null,
phantom:false,
join:function(store){
this.store=store
},
set:function(name,value){
var encode=Ext.isPrimitive(value)?String:Ext.encode;
if(encode(this.data[name])==encode(value)){
return
}
this.dirty=true;
if(!this.modified){
this.modified={}
}
if(this.modified[name]===undefined){
this.modified[name]=this.data[name]
}
this.data[name]=value;
if(!this.editing){
this.afterEdit()
}
},
afterEdit:function(){
if(this.store!=undefined&&typeof this.store.afterEdit=='function'){
this.store.afterEdit(this)
}
},
afterReject:function(){
if(this.store){
this.store.afterReject(this)
}
},
afterCommit:function(){
if(this.store){
this.store.afterCommit(this)
}
},
get:function(name){
return this.data[name]
},
beginEdit:function(){
this.editing=true;
this.modified=this.modified||{}
},
cancelEdit:function(){
this.editing=false;
delete this.modified
},
endEdit:function(){
this.editing=false;
if(this.dirty){
this.afterEdit()
}
},
reject:function(silent){
var m=this.modified;
for(var n in m){
if(typeof m[n]!='function'){
this.data[n]=m[n]
}
}
this.dirty=false;
delete this.modified;
this.editing=false;
if(silent!==true){
this.afterReject()
}
},
commit:function(silent){
this.dirty=false;
delete this.modified;
this.editing=false;
if(silent!==true){
this.afterCommit()
}
},
getChanges:function(){
var m=this.modified,cs={};
for(var n in m){
if(m.hasOwnProperty(n)){
cs[n]=this.data[n]
}
}
return cs
},
hasError:function(){
return this.error!==null
},
clearError:function(){
this.error=null
},
copy:function(newId){
return new this.constructor(Ext.apply({},this.data),newId||this.id)
},
isModified:function(fieldName){
return!!(this.modified&&this.modified.hasOwnProperty(fieldName))
},
isValid:function(){
return this.fields.find(function(f){
return f.allowBlank===false&&Ext.isEmpty(this.data[f.name])?true:false
},this)?false:true
},
markDirty:function(){
this.dirty=true;
if(!this.modified){
this.modified={}
}
this.fields.each(function(f){
this.modified[f.name]=this.data[f.name]
},this)
}
};
Ext.StoreMgr=Ext.apply(new Ext.util.MixedCollection,{
register:function(){
for(var i=0,s;s=arguments[i];i++){
this.add(s)
}
},
unregister:function(){
for(var i=0,s;s=arguments[i];i++){
this.remove(this.lookup(s))
}
},
lookup:function(id){
if(Ext.isArray(id)){
var fields=['field1'],expand=!Ext.isArray(id[0]);
if(!expand){
for(var i=2,len=id[0].length;i<=len;++i){
fields.push('field'+i)
}
}
return new Ext.data.ArrayStore({
fields:fields,
data:id,
expandData:expand,
autoDestroy:true,
autoCreated:true
})
}
return Ext.isObject(id)?id.events?id:Ext.create(id,'store'):this.get(id)
},
getKey:function(o){
return o.storeId
}
});
Ext.data.Store=Ext.extend(Ext.util.Observable,{
writer:undefined,
remoteSort:false,
autoDestroy:false,
pruneModifiedRecords:false,
lastOptions:null,
autoSave:true,
batch:true,
restful:false,
paramNames:undefined,
defaultParamNames:{
start:'start',
limit:'limit',
sort:'sort',
dir:'dir'
},
isDestroyed:false,
hasMultiSort:false,
batchKey:'_ext_batch_',
constructor:function(config){
this.data=new Ext.util.MixedCollection(false);
this.data.getKey=function(o){
return o.id
};
this.removed=[];
if(config&&config.data){
this.inlineData=config.data;
delete config.data
}
Ext.apply(this,config);
this.baseParams=Ext.isObject(this.baseParams)?this.baseParams:{};
this.paramNames=Ext.applyIf(this.paramNames||{},this.defaultParamNames);
if((this.url||this.api)&&!this.proxy){
this.proxy=new Ext.data.HttpProxy({
url:this.url,
api:this.api
})
}
if(this.restful===true&&this.proxy){
this.batch=false;
Ext.data.Api.restify(this.proxy)
}
if(this.reader){
if(!this.recordType){
this.recordType=this.reader.recordType
}
if(this.reader.onMetaChange){
this.reader.onMetaChange=this.reader.onMetaChange.createSequence(this.onMetaChange,this)
}
if(this.writer){
if(this.writer instanceof Ext.data.DataWriter===false){
this.writer=this.buildWriter(this.writer)
}
this.writer.meta=this.reader.meta;
this.pruneModifiedRecords=true
}
}
if(this.recordType){
this.fields=this.recordType.prototype.fields
}
this.modified=[];
this.addEvents('datachanged','metachange','add','remove','update','clear','exception','beforeload','load','loadexception','beforewrite','write','beforesave','save');
if(this.proxy){
this.relayEvents(this.proxy,[
'loadexception',
'exception'
])
}
if(this.writer){
this.on({
scope:this,
add:this.createRecords,
remove:this.destroyRecord,
update:this.updateRecord,
clear:this.onClear
})
}
this.sortToggle={};
if(this.sortField){
this.setDefaultSort(this.sortField,this.sortDir)
}else if(this.sortInfo){
this.setDefaultSort(this.sortInfo.field,this.sortInfo.direction)
}
Ext.data.Store.superclass.constructor.call(this);
if(this.id){
this.storeId=this.id;
delete this.id
}
if(this.storeId){
Ext.StoreMgr.register(this)
}
if(this.inlineData){
this.loadData(this.inlineData);
delete this.inlineData
}else if(this.autoLoad){
this.load.defer(10,this,[typeof this.autoLoad=='object'?this.autoLoad:undefined])
}
this.batchCounter=0;
this.batches={}
},
buildWriter:function(config){
var klass=undefined,type=(config.format||'json').toLowerCase();
switch(type){
case'json':
klass=Ext.data.JsonWriter;
break;
case'xml':
klass=Ext.data.XmlWriter;
break;
default:
klass=Ext.data.JsonWriter
}
return new klass(config)
},
destroy:function(){
if(!this.isDestroyed){
if(this.storeId){
Ext.StoreMgr.unregister(this)
}
this.clearData();
this.data=null;
Ext.destroy(this.proxy);
this.reader=this.writer=null;
this.purgeListeners();
this.isDestroyed=true
}
},
add:function(records){
var i,len,record,index;
records=[].concat(records);
if(records.length<1){
return
}
for(i=0,len=records.length;i<len;i++){
record=records[i];
record.join(this);
if(record.dirty||record.phantom){
this.modified.push(record)
}
}
index=this.data.length;
this.data.addAll(records);
if(this.snapshot){
this.snapshot.addAll(records)
}
this.fireEvent('add',this,records,index)
},
addSorted:function(record){
var index=this.findInsertIndex(record);
this.insert(index,record)
},
doUpdate:function(rec){
var id=rec.id;
this.getById(id).join(null);
this.data.replace(id,rec);
if(this.snapshot){
this.snapshot.replace(id,rec)
}
rec.join(this);
this.fireEvent('update',this,rec,Ext.data.Record.COMMIT)
},
remove:function(record){
if(Ext.isArray(record)){
Ext.each(record,function(r){
this.remove(r)
},this);
return
}
var index=this.data.indexOf(record);
if(index>-1){
record.join(null);
this.data.removeAt(index)
}
if(this.pruneModifiedRecords){
this.modified.remove(record)
}
if(this.snapshot){
this.snapshot.remove(record)
}
if(index>-1){
this.fireEvent('remove',this,record,index)
}
},
removeAt:function(index){
this.remove(this.getAt(index))
},
removeAll:function(silent){
var items=[];
this.each(function(rec){
items.push(rec)
});
this.clearData();
if(this.snapshot){
this.snapshot.clear()
}
if(this.pruneModifiedRecords){
this.modified=[]
}
if(silent!==true){
this.fireEvent('clear',this,items)
}
},
onClear:function(store,records){
Ext.each(records,function(rec,index){
this.destroyRecord(this,rec,index)
},this)
},
insert:function(index,records){
var i,len,record;
records=[].concat(records);
for(i=0,len=records.length;i<len;i++){
record=records[i];
this.data.insert(index+i,record);
record.join(this);
if(record.dirty||record.phantom){
this.modified.push(record)
}
}
if(this.snapshot){
this.snapshot.addAll(records)
}
this.fireEvent('add',this,records,index)
},
indexOf:function(record){
return this.data.indexOf(record)
},
indexOfId:function(id){
return this.data.indexOfKey(id)
},
getById:function(id){
return(this.snapshot||this.data).key(id)
},
getAt:function(index){
return this.data.itemAt(index)
},
getRange:function(start,end){
return this.data.getRange(start,end)
},
storeOptions:function(o){
o=Ext.apply({},o);
delete o.callback;
delete o.scope;
this.lastOptions=o
},
clearData:function(){
this.data.each(function(rec){
rec.join(null)
});
this.data.clear()
},
load:function(options){
options=Ext.apply({},options);
this.storeOptions(options);
if(this.sortInfo&&this.remoteSort){
var pn=this.paramNames;
options.params=Ext.apply({},options.params);
options.params[pn.sort]=this.sortInfo.field;
options.params[pn.dir]=this.sortInfo.direction
}
try{
return this.execute('read',null,options)
}catch(e){
this.handleException(e);
return false
}
},
updateRecord:function(store,record,action){
if(action==Ext.data.Record.EDIT&&this.autoSave===true&&(!record.phantom||record.phantom&&record.isValid())){
this.save()
}
},
createRecords:function(store,records,index){
var modified=this.modified,length=records.length,record,i;
for(i=0;i<length;i++){
record=records[i];
if(record.phantom&&record.isValid()){
record.markDirty();
if(modified.indexOf(record)==-1){
modified.push(record)
}
}
}
if(this.autoSave===true){
this.save()
}
},
destroyRecord:function(store,record,index){
if(this.modified.indexOf(record)!=-1){
this.modified.remove(record)
}
if(!record.phantom){
this.removed.push(record);
record.lastIndex=index;
if(this.autoSave===true){
this.save()
}
}
},
execute:function(action,rs,options,batch){
if(!Ext.data.Api.isAction(action)){
throw new Ext.data.Api.Error('execute',action)
}
options=Ext.applyIf(options||{},{params:{}});
if(batch!==undefined){
this.addToBatch(batch)
}
var doRequest=true;
if(action==='read'){
doRequest=this.fireEvent('beforeload',this,options);
Ext.applyIf(options.params,this.baseParams)
}else{
if(this.writer.listful===true&&this.restful!==true){
rs=Ext.isArray(rs)?rs:[rs]
}else if(Ext.isArray(rs)&&rs.length==1){
rs=rs.shift()
}
if((doRequest=this.fireEvent('beforewrite',this,action,rs,options))!==false){
this.writer.apply(options.params,this.baseParams,action,rs)
}
}
if(doRequest!==false){
if(this.writer&&this.proxy.url&&!this.proxy.restful&&!Ext.data.Api.hasUniqueUrl(this.proxy,action)){
options.params.xaction=action
}
this.proxy.request(Ext.data.Api.actions[action],rs,options.params,this.reader,this.createCallback(action,rs,batch),this,options)
}
return doRequest
},
save:function(){
if(!this.writer){
throw new Ext.data.Store.Error('writer-undefined')
}
var queue=[],len,trans,batch,data={},i;
if(this.removed.length){
queue.push([
'destroy',
this.removed
])
}
var rs=[].concat(this.getModifiedRecords());
if(rs.length){
var phantoms=[];
for(i=rs.length-1;i>=0;i--){
if(rs[i].phantom===true){
var rec=rs.splice(i,1).shift();
if(rec.isValid()){
phantoms.push(rec)
}
}else if(!rs[i].isValid()){
rs.splice(i,1)
}
}
if(phantoms.length){
queue.push([
'create',
phantoms
])
}
if(rs.length){
queue.push([
'update',
rs
])
}
}
len=queue.length;
if(len){
batch=++this.batchCounter;
for(i=0;i<len;++i){
trans=queue[i];
data[trans[0]]=trans[1]
}
if(this.fireEvent('beforesave',this,data)!==false){
for(i=0;i<len;++i){
trans=queue[i];
this.doTransaction(trans[0],trans[1],batch)
}
return batch
}
}
return-1
},
doTransaction:function(action,rs,batch){
function transaction(records){
try{
this.execute(action,records,undefined,batch)
}catch(e){
this.handleException(e)
}
}
if(this.batch===false){
for(var i=0,len=rs.length;i<len;i++){
transaction.call(this,rs[i])
}
}else{
transaction.call(this,rs)
}
},
addToBatch:function(batch){
var b=this.batches,key=this.batchKey+batch,o=b[key];
if(!o){
b[key]=o={
id:batch,
count:0,
data:{}
}
}
++o.count
},
removeFromBatch:function(batch,action,data){
var b=this.batches,key=this.batchKey+batch,o=b[key],arr;
if(o){
arr=o.data[action]||[];
o.data[action]=arr.concat(data);
if(o.count===1){
data=o.data;
delete b[key];
this.fireEvent('save',this,batch,data)
}else{
--o.count
}
}
},
createCallback:function(action,rs,batch){
var actions=Ext.data.Api.actions;
return action=='read'?this.loadRecords:function(data,response,success){
this['on'+Ext.util.Format.capitalize(action)+'Records'](success,rs,[].concat(data));
if(success===true){
this.fireEvent('write',this,action,data,response,rs)
}
this.removeFromBatch(batch,action,data)
}
},
clearModified:function(rs){
if(Ext.isArray(rs)){
for(var n=rs.length-1;n>=0;n--){
this.modified.splice(this.modified.indexOf(rs[n]),1)
}
}else{
this.modified.splice(this.modified.indexOf(rs),1)
}
},
reMap:function(record){
if(Ext.isArray(record)){
for(var i=0,len=record.length;i<len;i++){
this.reMap(record[i])
}
}else{
delete this.data.map[record._phid];
this.data.map[record.id]=record;
var index=this.data.keys.indexOf(record._phid);
this.data.keys.splice(index,1,record.id);
delete record._phid
}
},
onCreateRecords:function(success,rs,data){
if(success===true){
try{
this.reader.realize(rs,data)
}catch(e){
this.handleException(e);
if(Ext.isArray(rs)){
this.onCreateRecords(success,rs,data)
}
}
}
},
onUpdateRecords:function(success,rs,data){
if(success===true){
try{
this.reader.update(rs,data)
}catch(e){
this.handleException(e);
if(Ext.isArray(rs)){
this.onUpdateRecords(success,rs,data)
}
}
}
},
onDestroyRecords:function(success,rs,data){
rs=rs instanceof Ext.data.Record?[rs]:[].concat(rs);
for(var i=0,len=rs.length;i<len;i++){
this.removed.splice(this.removed.indexOf(rs[i]),1)
}
if(success===false){
for(i=rs.length-1;i>=0;i--){
this.insert(rs[i].lastIndex,rs[i])
}
}
},
handleException:function(e){
Ext.handleError(e)
},
reload:function(options){
this.load(Ext.applyIf(options||{},this.lastOptions))
},
loadRecords:function(o,options,success){
var i,len;
if(this.isDestroyed===true){
return
}
if(!o||success===false){
if(success!==false){
this.fireEvent('load',this,[],options)
}
if(options.callback){
options.callback.call(options.scope||this,[],options,false,o)
}
return
}
var r=o.records,t=o.totalRecords||r.length;
if(!options||options.add!==true){
if(this.pruneModifiedRecords){
this.modified=[]
}
for(i=0,len=r.length;i<len;i++){
r[i].join(this)
}
if(this.snapshot){
this.data=this.snapshot;
delete this.snapshot
}
this.clearData();
this.data.addAll(r);
this.totalLength=t;
this.applySort();
this.fireEvent('datachanged',this)
}else{
var toAdd=[],rec,cnt=0;
for(i=0,len=r.length;i<len;++i){
rec=r[i];
if(this.indexOfId(rec.id)>-1){
this.doUpdate(rec)
}else{
toAdd.push(rec);
++cnt
}
}
this.totalLength=Math.max(t,this.data.length+cnt);
this.add(toAdd)
}
this.fireEvent('load',this,r,options);
if(options.callback){
options.callback.call(options.scope||this,r,options,true)
}
},
loadData:function(o,append){
var r=this.reader.readRecords(o);
this.loadRecords(r,{add:append},true)
},
getCount:function(){
return this.data.length||0
},
getTotalCount:function(){
return this.totalLength||0
},
getSortState:function(){
return this.sortInfo
},
applySort:function(){
if((this.sortInfo||this.multiSortInfo)&&!this.remoteSort){
this.sortData()
}
},
sortData:function(){
var sortInfo=this.hasMultiSort?this.multiSortInfo:this.sortInfo,direction=sortInfo.direction||'ASC',sorters=sortInfo.sorters,sortFns=[];
if(!this.hasMultiSort){
sorters=[{
direction:direction,
field:sortInfo.field
}]
}
for(var i=0,j=sorters.length;i<j;i++){
sortFns.push(this.createSortFunction(sorters[i].field,sorters[i].direction))
}
if(sortFns.length==0){
return
}
var directionModifier=direction.toUpperCase()=='DESC'?-1:1;
var fn=function(r1,r2){
var result=sortFns[0].call(this,r1,r2);
if(sortFns.length>1){
for(var i=1,j=sortFns.length;i<j;i++){
result=result||sortFns[i].call(this,r1,r2)
}
}
return directionModifier*result
};
this.data.sort(direction,fn);
if(this.snapshot&&this.snapshot!=this.data){
this.snapshot.sort(direction,fn)
}
},
createSortFunction:function(field,direction){
direction=direction||'ASC';
var directionModifier=direction.toUpperCase()=='DESC'?-1:1;
var sortType=this.fields.get(field).sortType;
return function(r1,r2){
var v1=sortType(r1.data[field]),v2=sortType(r2.data[field]);
return directionModifier*(v1>v2?1:v1<v2?-1:0)
}
},
setDefaultSort:function(field,dir){
dir=dir?dir.toUpperCase():'ASC';
this.sortInfo={
field:field,
direction:dir
};
this.sortToggle[field]=dir
},
sort:function(fieldName,dir){
if(Ext.isArray(arguments[0])){
return this.multiSort.call(this,fieldName,dir)
}else{
return this.singleSort(fieldName,dir)
}
},
singleSort:function(fieldName,dir){
var field=this.fields.get(fieldName);
if(!field){
return false
}
var name=field.name,sortInfo=this.sortInfo||null,sortToggle=this.sortToggle?this.sortToggle[name]:null;
if(!dir){
if(sortInfo&&sortInfo.field==name){
dir=(this.sortToggle[name]||'ASC').toggle('ASC','DESC')
}else{
dir=field.sortDir
}
}
this.sortToggle[name]=dir;
this.sortInfo={
field:name,
direction:dir
};
this.hasMultiSort=false;
if(this.remoteSort){
if(!this.load(this.lastOptions)){
if(sortToggle){
this.sortToggle[name]=sortToggle
}
if(sortInfo){
this.sortInfo=sortInfo
}
}
}else{
this.applySort();
this.fireEvent('datachanged',this)
}
return true
},
multiSort:function(sorters,direction){
this.hasMultiSort=true;
direction=direction||'ASC';
if(this.multiSortInfo&&direction==this.multiSortInfo.direction){
direction=direction.toggle('ASC','DESC')
}
this.multiSortInfo={
sorters:sorters,
direction:direction
};
if(this.remoteSort){
this.singleSort(sorters[0].field,sorters[0].direction)
}else{
this.applySort();
this.fireEvent('datachanged',this)
}
},
each:function(fn,scope){
this.data.each(fn,scope)
},
getModifiedRecords:function(){
return this.modified
},
sum:function(property,start,end){
var rs=this.data.items,v=0;
start=start||0;
end=end||end===0?end:rs.length-1;
for(var i=start;i<=end;i++){
v+=rs[i].data[property]||0
}
return v
},
createFilterFn:function(property,value,anyMatch,caseSensitive,exactMatch){
if(Ext.isEmpty(value,false)){
return false
}
value=this.data.createValueMatcher(value,anyMatch,caseSensitive,exactMatch);
return function(r){
return value.test(r.data[property])
}
},
createMultipleFilterFn:function(filters){
return function(record){
var isMatch=true;
for(var i=0,j=filters.length;i<j;i++){
var filter=filters[i],fn=filter.fn,scope=filter.scope;
isMatch=isMatch&&fn.call(scope,record)
}
return isMatch
}
},
filter:function(property,value,anyMatch,caseSensitive,exactMatch){
var fn;
if(Ext.isObject(property)){
property=[property]
}
if(Ext.isArray(property)){
var filters=[];
for(var i=0,j=property.length;i<j;i++){
var filter=property[i],func=filter.fn,scope=filter.scope||this;
if(!Ext.isFunction(func)){
func=this.createFilterFn(filter.property,filter.value,filter.anyMatch,filter.caseSensitive,filter.exactMatch)
}
filters.push({
fn:func,
scope:scope
})
}
fn=this.createMultipleFilterFn(filters)
}else{
fn=this.createFilterFn(property,value,anyMatch,caseSensitive,exactMatch)
}
return fn?this.filterBy(fn):this.clearFilter()
},
filterBy:function(fn,scope){
this.snapshot=this.snapshot||this.data;
this.data=this.queryBy(fn,scope||this);
this.fireEvent('datachanged',this)
},
clearFilter:function(suppressEvent){
if(this.isFiltered()){
this.data=this.snapshot;
delete this.snapshot;
if(suppressEvent!==true){
this.fireEvent('datachanged',this)
}
}
},
isFiltered:function(){
return!!this.snapshot&&this.snapshot!=this.data
},
query:function(property,value,anyMatch,caseSensitive){
var fn=this.createFilterFn(property,value,anyMatch,caseSensitive);
return fn?this.queryBy(fn):this.data.clone()
},
queryBy:function(fn,scope){
var data=this.snapshot||this.data;
return data.filterBy(fn,scope||this)
},
find:function(property,value,start,anyMatch,caseSensitive){
var fn=this.createFilterFn(property,value,anyMatch,caseSensitive);
return fn?this.data.findIndexBy(fn,null,start):-1
},
findExact:function(property,value,start){
return this.data.findIndexBy(function(rec){
return rec.get(property)===value
},this,start)
},
findBy:function(fn,scope,start){
return this.data.findIndexBy(fn,scope,start)
},
collect:function(dataIndex,allowNull,bypassFilter){
var d=bypassFilter===true&&this.snapshot?this.snapshot.items:this.data.items;
var v,sv,r=[],l={};
for(var i=0,len=d.length;i<len;i++){
v=d[i].data[dataIndex];
sv=String(v);
if((allowNull||!Ext.isEmpty(v))&&!l[sv]){
l[sv]=true;
r[r.length]=v
}
}
return r
},
afterEdit:function(record){
if(this.modified.indexOf(record)==-1){
this.modified.push(record)
}
this.fireEvent('update',this,record,Ext.data.Record.EDIT)
},
afterReject:function(record){
this.modified.remove(record);
this.fireEvent('update',this,record,Ext.data.Record.REJECT)
},
afterCommit:function(record){
this.modified.remove(record);
this.fireEvent('update',this,record,Ext.data.Record.COMMIT)
},
commitChanges:function(){
var modified=this.modified.slice(0),length=modified.length,i;
for(i=0;i<length;i++){
modified[i].commit()
}
this.modified=[];
this.removed=[]
},
rejectChanges:function(){
var modified=this.modified.slice(0),removed=this.removed.slice(0).reverse(),mLength=modified.length,rLength=removed.length,i;
for(i=0;i<mLength;i++){
modified[i].reject()
}
for(i=0;i<rLength;i++){
this.insert(removed[i].lastIndex||0,removed[i]);
removed[i].reject()
}
this.modified=[];
this.removed=[]
},
onMetaChange:function(meta){
this.recordType=this.reader.recordType;
this.fields=this.recordType.prototype.fields;
delete this.snapshot;
if(this.reader.meta.sortInfo){
this.sortInfo=this.reader.meta.sortInfo
}else if(this.sortInfo&&!this.fields.get(this.sortInfo.field)){
delete this.sortInfo
}
if(this.writer){
this.writer.meta=this.reader.meta
}
this.modified=[];
this.fireEvent('metachange',this,this.reader.meta)
},
findInsertIndex:function(record){
this.suspendEvents();
var data=this.data.clone();
this.data.add(record);
this.applySort();
var index=this.data.indexOf(record);
this.data=data;
this.resumeEvents();
return index
},
setBaseParam:function(name,value){
this.baseParams=this.baseParams||{};
this.baseParams[name]=value
}
});
Ext.reg('store',Ext.data.Store);
Ext.data.Store.Error=Ext.extend(Ext.Error,{name:'Ext.data.Store'});
Ext.apply(Ext.data.Store.Error.prototype,{lang:{'writer-undefined':'Attempted to execute a write-action without a DataWriter installed.'}});
Ext.data.Field=Ext.extend(Object,{
constructor:function(config){
if(Ext.isString(config)){
config={name:config}
}
Ext.apply(this,config);
var types=Ext.data.Types,st=this.sortType,t;
if(this.type){
if(Ext.isString(this.type)){
this.type=Ext.data.Types[this.type.toUpperCase()]||types.AUTO
}
}else{
this.type=types.AUTO
}
if(Ext.isString(st)){
this.sortType=Ext.data.SortTypes[st]
}else if(Ext.isEmpty(st)){
this.sortType=this.type.sortType
}
if(!this.convert){
this.convert=this.type.convert
}
},
dateFormat:null,
useNull:false,
defaultValue:'',
mapping:null,
sortType:null,
sortDir:'ASC',
allowBlank:true
});
Ext.data.DataReader=function(meta,recordType){
this.meta=meta;
this.recordType=Ext.isArray(recordType)?Ext.data.Record.create(recordType):recordType;
if(this.recordType){
this.buildExtractors()
}
};
Ext.data.DataReader.prototype={
getTotal:Ext.emptyFn,
getRoot:Ext.emptyFn,
getMessage:Ext.emptyFn,
getSuccess:Ext.emptyFn,
getId:Ext.emptyFn,
buildExtractors:Ext.emptyFn,
extractValues:Ext.emptyFn,
realize:function(rs,data){
if(Ext.isArray(rs)){
for(var i=rs.length-1;i>=0;i--){
if(Ext.isArray(data)){
this.realize(rs.splice(i,1).shift(),data.splice(i,1).shift())
}else{
this.realize(rs.splice(i,1).shift(),data)
}
}
}else{
if(Ext.isArray(data)&&data.length==1){
data=data.shift()
}
if(!this.isData(data)){
throw new Ext.data.DataReader.Error('realize',rs)
}
rs.phantom=false;
rs._phid=rs.id;
rs.id=this.getId(data);
rs.data=data;
rs.commit();
rs.store.reMap(rs)
}
},
update:function(rs,data){
if(Ext.isArray(rs)){
for(var i=rs.length-1;i>=0;i--){
if(Ext.isArray(data)){
this.update(rs.splice(i,1).shift(),data.splice(i,1).shift())
}else{
this.update(rs.splice(i,1).shift(),data)
}
}
}else{
if(Ext.isArray(data)&&data.length==1){
data=data.shift()
}
if(this.isData(data)){
rs.data=Ext.apply(rs.data,data)
}
rs.commit()
}
},
extractData:function(root,returnRecords){
var rawName=this instanceof Ext.data.JsonReader?'json':'node';
var rs=[];
if(this.isData(root)&&!(this instanceof Ext.data.XmlReader)){
root=[root]
}
var f=this.recordType.prototype.fields,fi=f.items,fl=f.length,rs=[];
if(returnRecords===true){
var Record=this.recordType;
for(var i=0;i<root.length;i++){
var n=root[i];
var record=new Record(this.extractValues(n,fi,fl),this.getId(n));
record[rawName]=n;
rs.push(record)
}
}else{
for(var i=0;i<root.length;i++){
var data=this.extractValues(root[i],fi,fl);
data[this.meta.idProperty]=this.getId(root[i]);
rs.push(data)
}
}
return rs
},
isData:function(data){
return data&&Ext.isObject(data)&&!Ext.isEmpty(this.getId(data))?true:false
},
onMetaChange:function(meta){
delete this.ef;
this.meta=meta;
this.recordType=Ext.data.Record.create(meta.fields);
this.buildExtractors()
}
};
Ext.data.DataReader.Error=Ext.extend(Ext.Error,{
constructor:function(message,arg){
this.arg=arg;
Ext.Error.call(this,message)
},
name:'Ext.data.DataReader'
});
Ext.apply(Ext.data.DataReader.Error.prototype,{
lang:{
'update':'#update received invalid data from server.  Please see docs for DataReader#update and review your DataReader configuration.',
'realize':'#realize was called with invalid remote-data.  Please see the docs for DataReader#realize and review your DataReader configuration.',
'invalid-response':'#readResponse received an invalid response from the server.'
}
});
Ext.data.DataWriter=function(config){
Ext.apply(this,config)
};
Ext.data.DataWriter.prototype={
writeAllFields:false,
listful:false,
apply:function(params,baseParams,action,rs){
var data=[],renderer=action+'Record';
if(Ext.isArray(rs)){
Ext.each(rs,function(rec){
data.push(this[renderer](rec))
},this)
}else if(rs instanceof Ext.data.Record){
data=this[renderer](rs)
}
this.render(params,baseParams,data)
},
render:Ext.emptyFn,
updateRecord:Ext.emptyFn,
createRecord:Ext.emptyFn,
destroyRecord:Ext.emptyFn,
toHash:function(rec,config){
var map=rec.fields.map,data={},raw=this.writeAllFields===false&&rec.phantom===false?rec.getChanges():rec.data,m;
Ext.iterate(raw,function(prop,value){
if(m=map[prop]){
data[m.mapping?m.mapping:m.name]=value
}
});
if(rec.phantom){
if(rec.fields.containsKey(this.meta.idProperty)&&Ext.isEmpty(rec.data[this.meta.idProperty])){
delete data[this.meta.idProperty]
}
}else{
data[this.meta.idProperty]=rec.id
}
return data
},
toArray:function(data){
var fields=[];
Ext.iterate(data,function(k,v){
fields.push({
name:k,
value:v
})
},this);
return fields
}
};
Ext.data.DataProxy=function(conn){
conn=conn||{};
this.api=conn.api;
this.url=conn.url;
this.restful=conn.restful;
this.listeners=conn.listeners;
this.prettyUrls=conn.prettyUrls;
this.addEvents('exception','beforeload','load','loadexception','beforewrite','write');
Ext.data.DataProxy.superclass.constructor.call(this);
try{
Ext.data.Api.prepare(this)
}catch(e){
if(e instanceof Ext.data.Api.Error){
e.toConsole()
}
}
Ext.data.DataProxy.relayEvents(this,[
'beforewrite',
'write',
'exception'
])
};
Ext.extend(Ext.data.DataProxy,Ext.util.Observable,{
restful:false,
setApi:function(){
if(arguments.length==1){
var valid=Ext.data.Api.isValid(arguments[0]);
if(valid===true){
this.api=arguments[0]
}else{
throw new Ext.data.Api.Error('invalid',valid)
}
}else if(arguments.length==2){
if(!Ext.data.Api.isAction(arguments[0])){
throw new Ext.data.Api.Error('invalid',arguments[0])
}
this.api[arguments[0]]=arguments[1]
}
Ext.data.Api.prepare(this)
},
isApiAction:function(action){
return this.api[action]?true:false
},
request:function(action,rs,params,reader,callback,scope,options){
if(!this.api[action]&&!this.load){
throw new Ext.data.DataProxy.Error('action-undefined',action)
}
params=params||{};
if(action===Ext.data.Api.actions.read?this.fireEvent('beforeload',this,params):this.fireEvent('beforewrite',this,action,rs,params)!==false){
this.doRequest.apply(this,arguments)
}else{
callback.call(scope||this,null,options,false)
}
},
load:null,
doRequest:function(action,rs,params,reader,callback,scope,options){
this.load(params,reader,callback,scope,options)
},
onRead:Ext.emptyFn,
onWrite:Ext.emptyFn,
buildUrl:function(action,record){
record=record||null;
var url=this.conn&&this.conn.url?this.conn.url:this.api[action]?this.api[action].url:this.url;
if(!url){
throw new Ext.data.Api.Error('invalid-url',action)
}
var provides=null;
var m=url.match(/(.*)(\.json|\.xml|\.html)$/);
if(m){
provides=m[2];
url=m[1]
}
if((this.restful===true||this.prettyUrls===true)&&record instanceof Ext.data.Record&&!record.phantom){
url+='/'+record.id
}
return provides===null?url:url+provides
},
destroy:function(){
this.purgeListeners()
}
});
Ext.apply(Ext.data.DataProxy,Ext.util.Observable.prototype);
Ext.util.Observable.call(Ext.data.DataProxy);
Ext.data.DataProxy.Error=Ext.extend(Ext.Error,{
constructor:function(message,arg){
this.arg=arg;
Ext.Error.call(this,message)
},
name:'Ext.data.DataProxy'
});
Ext.apply(Ext.data.DataProxy.Error.prototype,{
lang:{
'action-undefined':'DataProxy attempted to execute an API-action but found an undefined url / function.  Please review your Proxy url/api-configuration.',
'api-invalid':'Recieved an invalid API-configuration.  Please ensure your proxy API-configuration contains only the actions from Ext.data.Api.actions.'
}
});
Ext.data.Request=function(params){
Ext.apply(this,params)
};
Ext.data.Request.prototype={
action:undefined,
rs:undefined,
params:undefined,
callback:Ext.emptyFn,
scope:undefined,
reader:undefined
};
Ext.data.Response=function(params){
Ext.apply(this,params)
};
Ext.data.Response.prototype={
action:undefined,
success:undefined,
message:undefined,
data:undefined,
raw:undefined,
records:undefined
};
Ext.data.ScriptTagProxy=function(config){
Ext.apply(this,config);
Ext.data.ScriptTagProxy.superclass.constructor.call(this,config);
this.head=document.getElementsByTagName('head')[0]
};
Ext.data.ScriptTagProxy.TRANS_ID=1000;
Ext.extend(Ext.data.ScriptTagProxy,Ext.data.DataProxy,{
timeout:30000,
callbackParam:'callback',
nocache:true,
doRequest:function(action,rs,params,reader,callback,scope,arg){
var p=Ext.urlEncode(Ext.apply(params,this.extraParams));
var url=this.buildUrl(action,rs);
if(!url){
throw new Ext.data.Api.Error('invalid-url',url)
}
url=Ext.urlAppend(url,p);
if(this.nocache){
url=Ext.urlAppend(url,'_dc='+new Date().getTime())
}
var transId=++Ext.data.ScriptTagProxy.TRANS_ID;
var trans={
id:transId,
action:action,
cb:'stcCallback'+transId,
scriptId:'stcScript'+transId,
params:params,
arg:arg,
url:url,
callback:callback,
scope:scope,
reader:reader
};
window[trans.cb]=this.createCallback(action,rs,trans);
url+=String.format('&{0}={1}',this.callbackParam,trans.cb);
if(this.autoAbort!==false){
this.abort()
}
trans.timeoutId=this.handleFailure.defer(this.timeout,this,[trans]);
var script=document.createElement('script');
script.setAttribute('src',url);
script.setAttribute('type','text/javascript');
script.setAttribute('id',trans.scriptId);
this.head.appendChild(script);
this.trans=trans
},
createCallback:function(action,rs,trans){
var self=this;
return function(res){
self.trans=false;
self.destroyTrans(trans,true);
if(action===Ext.data.Api.actions.read){
self.onRead.call(self,action,trans,res)
}else{
self.onWrite.call(self,action,trans,res,rs)
}
}
},
onRead:function(action,trans,res){
var result;
try{
result=trans.reader.readRecords(res)
}catch(e){
this.fireEvent('loadexception',this,trans,res,e);
this.fireEvent('exception',this,'response',action,trans,res,e);
trans.callback.call(trans.scope||window,null,trans.arg,false);
return
}
if(result.success===false){
this.fireEvent('loadexception',this,trans,res);
this.fireEvent('exception',this,'remote',action,trans,res,null)
}else{
this.fireEvent('load',this,res,trans.arg)
}
trans.callback.call(trans.scope||window,result,trans.arg,result.success)
},
onWrite:function(action,trans,response,rs){
var reader=trans.reader;
try{
var res=reader.readResponse(action,response)
}catch(e){
this.fireEvent('exception',this,'response',action,trans,res,e);
trans.callback.call(trans.scope||window,null,res,false);
return
}
if(!res.success===true){
this.fireEvent('exception',this,'remote',action,trans,res,rs);
trans.callback.call(trans.scope||window,null,res,false);
return
}
this.fireEvent('write',this,action,res.data,res,rs,trans.arg);
trans.callback.call(trans.scope||window,res.data,res,true)
},
isLoading:function(){
return this.trans?true:false
},
abort:function(){
if(this.isLoading()){
this.destroyTrans(this.trans)
}
},
destroyTrans:function(trans,isLoaded){
this.head.removeChild(document.getElementById(trans.scriptId));
clearTimeout(trans.timeoutId);
if(isLoaded){
window[trans.cb]=undefined;
try{
delete window[trans.cb]
}catch(e){
}
}else{
window[trans.cb]=function(){
window[trans.cb]=undefined;
try{
delete window[trans.cb]
}catch(e){
}
}
}
},
handleFailure:function(trans){
this.trans=false;
this.destroyTrans(trans,false);
if(trans.action===Ext.data.Api.actions.read){
this.fireEvent('loadexception',this,null,trans.arg)
}
this.fireEvent('exception',this,'response',trans.action,{
response:null,
options:trans.arg
});
trans.callback.call(trans.scope||window,null,trans.arg,false)
},
destroy:function(){
this.abort();
Ext.data.ScriptTagProxy.superclass.destroy.call(this)
}
});
Ext.data.HttpProxy=function(conn){
Ext.data.HttpProxy.superclass.constructor.call(this,conn);
this.conn=conn;
this.conn.url=null;
this.useAjax=!conn||!conn.events;
var actions=Ext.data.Api.actions;
this.activeRequest={};
for(var verb in actions){
this.activeRequest[actions[verb]]=undefined
}
};
Ext.extend(Ext.data.HttpProxy,Ext.data.DataProxy,{
getConnection:function(){
return this.useAjax?Ext.Ajax:this.conn
},
setUrl:function(url,makePermanent){
this.conn.url=url;
if(makePermanent===true){
this.url=url;
this.api=null;
Ext.data.Api.prepare(this)
}
},
doRequest:function(action,rs,params,reader,cb,scope,arg){
var o={
method:this.api[action]?this.api[action]['method']:undefined,
request:{
callback:cb,
scope:scope,
arg:arg
},
reader:reader,
callback:this.createCallback(action,rs),
scope:this
};
if(params.jsonData){
o.jsonData=params.jsonData
}else if(params.xmlData){
o.xmlData=params.xmlData
}else{
o.params=params||{}
}
this.conn.url=this.buildUrl(action,rs);
if(this.useAjax){
Ext.applyIf(o,this.conn);
if(this.activeRequest[action]){
}
this.activeRequest[action]=Ext.Ajax.request(o)
}else{
this.conn.request(o)
}
this.conn.url=null
},
createCallback:function(action,rs){
return function(o,success,response){
this.activeRequest[action]=undefined;
if(!success){
if(action===Ext.data.Api.actions.read){
this.fireEvent('loadexception',this,o,response)
}
this.fireEvent('exception',this,'response',action,o,response);
o.request.callback.call(o.request.scope,null,o.request.arg,false);
return
}
if(action===Ext.data.Api.actions.read){
this.onRead(action,o,response)
}else{
this.onWrite(action,o,response,rs)
}
}
},
onRead:function(action,o,response){
var result;
try{
result=o.reader.read(response)
}catch(e){
this.fireEvent('loadexception',this,o,response,e);
this.fireEvent('exception',this,'response',action,o,response,e);
o.request.callback.call(o.request.scope,null,o.request.arg,false);
return
}
if(result.success===false){
this.fireEvent('loadexception',this,o,response);
var res=o.reader.readResponse(action,response);
this.fireEvent('exception',this,'remote',action,o,res,null)
}else{
this.fireEvent('load',this,o,o.request.arg)
}
o.request.callback.call(o.request.scope,result,o.request.arg,result.success)
},
onWrite:function(action,o,response,rs){
var reader=o.reader;
var res;
try{
res=reader.readResponse(action,response)
}catch(e){
this.fireEvent('exception',this,'response',action,o,response,e);
o.request.callback.call(o.request.scope,null,o.request.arg,false);
return
}
if(res.success===true){
this.fireEvent('write',this,action,res.data,res,rs,o.request.arg)
}else{
this.fireEvent('exception',this,'remote',action,o,res,rs)
}
o.request.callback.call(o.request.scope,res.data,res,res.success)
},
destroy:function(){
if(!this.useAjax){
this.conn.abort()
}else if(this.activeRequest){
var actions=Ext.data.Api.actions;
for(var verb in actions){
if(this.activeRequest[actions[verb]]){
Ext.Ajax.abort(this.activeRequest[actions[verb]])
}
}
}
Ext.data.HttpProxy.superclass.destroy.call(this)
}
});
Ext.data.MemoryProxy=function(data){
var api={};
api[Ext.data.Api.actions.read]=true;
Ext.data.MemoryProxy.superclass.constructor.call(this,{api:api});
this.data=data
};
Ext.extend(Ext.data.MemoryProxy,Ext.data.DataProxy,{
doRequest:function(action,rs,params,reader,callback,scope,arg){
params=params||{};
var result;
try{
result=reader.readRecords(this.data)
}catch(e){
this.fireEvent('loadexception',this,null,arg,e);
this.fireEvent('exception',this,'response',action,arg,null,e);
callback.call(scope,null,arg,false);
return
}
callback.call(scope,result,arg,true)
}
});
Ext.data.Types=new function(){
var st=Ext.data.SortTypes;
Ext.apply(this,{
stripRe:/[\$,%]/g,
AUTO:{
convert:function(v){
return v
},
sortType:st.none,
type:'auto'
},
STRING:{
convert:function(v){
return v===undefined||v===null?'':String(v)
},
sortType:st.asUCString,
type:'string'
},
INT:{
convert:function(v){
return v!==undefined&&v!==null&&v!==''?parseInt(String(v).replace(Ext.data.Types.stripRe,''),10):this.useNull?null:0
},
sortType:st.none,
type:'int'
},
FLOAT:{
convert:function(v){
return v!==undefined&&v!==null&&v!==''?parseFloat(String(v).replace(Ext.data.Types.stripRe,''),10):this.useNull?null:0
},
sortType:st.none,
type:'float'
},
BOOL:{
convert:function(v){
return v===true||v==='true'||v==1
},
sortType:st.none,
type:'bool'
},
DATE:{
convert:function(v){
var df=this.dateFormat;
if(!v){
return null
}
if(Ext.isDate(v)){
return v
}
if(df){
if(df=='timestamp'){
return new Date(v*1000)
}
if(df=='time'){
return new Date(parseInt(v,10))
}
return Date.parseDate(v,df)
}
var parsed=Date.parse(v);
return parsed?new Date(parsed):null
},
sortType:st.asDate,
type:'date'
}
});
Ext.apply(this,{
BOOLEAN:this.BOOL,
INTEGER:this.INT,
NUMBER:this.FLOAT
})
};
(function(){
var Event=Ext.EventManager;
var Dom=Ext.lib.Dom;
Ext.dd.DragDrop=function(id,sGroup,config){
if(id){
this.init(id,sGroup,config)
}
};
Ext.dd.DragDrop.prototype={
id:null,
config:null,
dragElId:null,
handleElId:null,
invalidHandleTypes:null,
invalidHandleIds:null,
invalidHandleClasses:null,
startPageX:0,
startPageY:0,
groups:null,
locked:false,
lock:function(){
this.locked=true
},
moveOnly:false,
unlock:function(){
this.locked=false
},
isTarget:true,
padding:null,
_domRef:null,
__ygDragDrop:true,
constrainX:false,
constrainY:false,
minX:0,
maxX:0,
minY:0,
maxY:0,
maintainOffset:false,
xTicks:null,
yTicks:null,
primaryButtonOnly:true,
available:false,
hasOuterHandles:false,
b4StartDrag:function(x,y){
},
startDrag:function(x,y){
},
b4Drag:function(e){
},
onDrag:function(e){
},
onDragEnter:function(e,id){
},
b4DragOver:function(e){
},
onDragOver:function(e,id){
},
b4DragOut:function(e){
},
onDragOut:function(e,id){
},
b4DragDrop:function(e){
},
onDragDrop:function(e,id){
},
onInvalidDrop:function(e){
},
b4EndDrag:function(e){
},
endDrag:function(e){
},
b4MouseDown:function(e){
},
onMouseDown:function(e){
},
onMouseUp:function(e){
},
onAvailable:function(){
},
defaultPadding:{
left:0,
right:0,
top:0,
bottom:0
},
constrainTo:function(constrainTo,pad,inContent){
if(Ext.isNumber(pad)){
pad={
left:pad,
right:pad,
top:pad,
bottom:pad
}
}
pad=pad||this.defaultPadding;
var b=Ext.get(this.getEl()).getBox(),ce=Ext.get(constrainTo),s=ce.getScroll(),c,cd=ce.dom;
if(cd==document.body){
c={
x:s.left,
y:s.top,
width:Ext.lib.Dom.getViewWidth(),
height:Ext.lib.Dom.getViewHeight()
}
}else{
var xy=ce.getXY();
c={
x:xy[0],
y:xy[1],
width:cd.clientWidth,
height:cd.clientHeight
}
}
var topSpace=b.y-c.y,leftSpace=b.x-c.x;
this.resetConstraints();
this.setXConstraint(leftSpace-(pad.left||0),c.width-leftSpace-b.width-(pad.right||0),this.xTickSize);
this.setYConstraint(topSpace-(pad.top||0),c.height-topSpace-b.height-(pad.bottom||0),this.yTickSize)
},
getEl:function(){
if(!this._domRef){
this._domRef=Ext.getDom(this.id)
}
return this._domRef
},
getDragEl:function(){
return Ext.getDom(this.dragElId)
},
init:function(id,sGroup,config){
this.initTarget(id,sGroup,config);
Event.on(this.id,'mousedown',this.handleMouseDown,this)
},
initTarget:function(id,sGroup,config){
this.config=config||{};
this.DDM=Ext.dd.DDM;
this.groups={};
if(typeof id!=='string'){
id=Ext.id(id)
}
this.id=id;
this.addToGroup(sGroup?sGroup:'default');
this.handleElId=id;
this.setDragElId(id);
this.invalidHandleTypes={A:'A'};
this.invalidHandleIds={};
this.invalidHandleClasses=[];
this.applyConfig();
this.handleOnAvailable()
},
applyConfig:function(){
this.padding=this.config.padding||[
0,
0,
0,
0
];
this.isTarget=this.config.isTarget!==false;
this.maintainOffset=this.config.maintainOffset;
this.primaryButtonOnly=this.config.primaryButtonOnly!==false
},
handleOnAvailable:function(){
this.available=true;
this.resetConstraints();
this.onAvailable()
},
setPadding:function(iTop,iRight,iBot,iLeft){
if(!iRight&&0!==iRight){
this.padding=[
iTop,
iTop,
iTop,
iTop
]
}else if(!iBot&&0!==iBot){
this.padding=[
iTop,
iRight,
iTop,
iRight
]
}else{
this.padding=[
iTop,
iRight,
iBot,
iLeft
]
}
},
setInitPosition:function(diffX,diffY){
var el=this.getEl();
if(!this.DDM.verifyEl(el)){
return
}
var dx=diffX||0;
var dy=diffY||0;
var p=Dom.getXY(el);
this.initPageX=p[0]-dx;
this.initPageY=p[1]-dy;
this.lastPageX=p[0];
this.lastPageY=p[1];
this.setStartPosition(p)
},
setStartPosition:function(pos){
var p=pos||Dom.getXY(this.getEl());
this.deltaSetXY=null;
this.startPageX=p[0];
this.startPageY=p[1]
},
addToGroup:function(sGroup){
this.groups[sGroup]=true;
this.DDM.regDragDrop(this,sGroup)
},
removeFromGroup:function(sGroup){
if(this.groups[sGroup]){
delete this.groups[sGroup]
}
this.DDM.removeDDFromGroup(this,sGroup)
},
setDragElId:function(id){
this.dragElId=id
},
setHandleElId:function(id){
if(typeof id!=='string'){
id=Ext.id(id)
}
this.handleElId=id;
this.DDM.regHandle(this.id,id)
},
setOuterHandleElId:function(id){
if(typeof id!=='string'){
id=Ext.id(id)
}
Event.on(id,'mousedown',this.handleMouseDown,this);
this.setHandleElId(id);
this.hasOuterHandles=true
},
unreg:function(){
Event.un(this.id,'mousedown',this.handleMouseDown);
this._domRef=null;
this.DDM._remove(this)
},
destroy:function(){
this.unreg()
},
isLocked:function(){
return this.DDM.isLocked()||this.locked
},
handleMouseDown:function(e,oDD){
if(this.primaryButtonOnly&&e.button!=0){
return
}
if(this.isLocked()){
return
}
this.DDM.refreshCache(this.groups);
var pt=new Ext.lib.Point(Ext.lib.Event.getPageX(e),Ext.lib.Event.getPageY(e));
if(!this.hasOuterHandles&&!this.DDM.isOverTarget(pt,this)){
}else{
if(this.clickValidator(e)){
this.setStartPosition();
this.b4MouseDown(e);
this.onMouseDown(e);
this.DDM.handleMouseDown(e,this);
this.DDM.stopEvent(e)
}else{
}
}
},
clickValidator:function(e){
var target=e.getTarget();
return this.isValidHandleChild(target)&&(this.id==this.handleElId||this.DDM.handleWasClicked(target,this.id))
},
addInvalidHandleType:function(tagName){
var type=tagName.toUpperCase();
this.invalidHandleTypes[type]=type
},
addInvalidHandleId:function(id){
if(typeof id!=='string'){
id=Ext.id(id)
}
this.invalidHandleIds[id]=id
},
addInvalidHandleClass:function(cssClass){
this.invalidHandleClasses.push(cssClass)
},
removeInvalidHandleType:function(tagName){
var type=tagName.toUpperCase();
delete this.invalidHandleTypes[type]
},
removeInvalidHandleId:function(id){
if(typeof id!=='string'){
id=Ext.id(id)
}
delete this.invalidHandleIds[id]
},
removeInvalidHandleClass:function(cssClass){
for(var i=0,len=this.invalidHandleClasses.length;i<len;++i){
if(this.invalidHandleClasses[i]==cssClass){
delete this.invalidHandleClasses[i]
}
}
},
isValidHandleChild:function(node){
var valid=true;
var nodeName;
try{
nodeName=node.nodeName.toUpperCase()
}catch(e){
nodeName=node.nodeName
}
valid=valid&&!this.invalidHandleTypes[nodeName];
valid=valid&&!this.invalidHandleIds[node.id];
for(var i=0,len=this.invalidHandleClasses.length;valid&&i<len;++i){
valid=!Ext.fly(node).hasClass(this.invalidHandleClasses[i])
}
return valid
},
setXTicks:function(iStartX,iTickSize){
this.xTicks=[];
this.xTickSize=iTickSize;
var tickMap={};
for(var i=this.initPageX;i>=this.minX;i=i-iTickSize){
if(!tickMap[i]){
this.xTicks[this.xTicks.length]=i;
tickMap[i]=true
}
}
for(i=this.initPageX;i<=this.maxX;i=i+iTickSize){
if(!tickMap[i]){
this.xTicks[this.xTicks.length]=i;
tickMap[i]=true
}
}
this.xTicks.sort(this.DDM.numericSort)
},
setYTicks:function(iStartY,iTickSize){
this.yTicks=[];
this.yTickSize=iTickSize;
var tickMap={};
for(var i=this.initPageY;i>=this.minY;i=i-iTickSize){
if(!tickMap[i]){
this.yTicks[this.yTicks.length]=i;
tickMap[i]=true
}
}
for(i=this.initPageY;i<=this.maxY;i=i+iTickSize){
if(!tickMap[i]){
this.yTicks[this.yTicks.length]=i;
tickMap[i]=true
}
}
this.yTicks.sort(this.DDM.numericSort)
},
setXConstraint:function(iLeft,iRight,iTickSize){
this.leftConstraint=iLeft;
this.rightConstraint=iRight;
this.minX=this.initPageX-iLeft;
this.maxX=this.initPageX+iRight;
if(iTickSize){
this.setXTicks(this.initPageX,iTickSize)
}
this.constrainX=true
},
clearConstraints:function(){
this.constrainX=false;
this.constrainY=false;
this.clearTicks()
},
clearTicks:function(){
this.xTicks=null;
this.yTicks=null;
this.xTickSize=0;
this.yTickSize=0
},
setYConstraint:function(iUp,iDown,iTickSize){
this.topConstraint=iUp;
this.bottomConstraint=iDown;
this.minY=this.initPageY-iUp;
this.maxY=this.initPageY+iDown;
if(iTickSize){
this.setYTicks(this.initPageY,iTickSize)
}
this.constrainY=true
},
resetConstraints:function(){
if(this.initPageX||this.initPageX===0){
var dx=this.maintainOffset?this.lastPageX-this.initPageX:0;
var dy=this.maintainOffset?this.lastPageY-this.initPageY:0;
this.setInitPosition(dx,dy)
}else{
this.setInitPosition()
}
if(this.constrainX){
this.setXConstraint(this.leftConstraint,this.rightConstraint,this.xTickSize)
}
if(this.constrainY){
this.setYConstraint(this.topConstraint,this.bottomConstraint,this.yTickSize)
}
},
getTick:function(val,tickArray){
if(!tickArray){
return val
}else if(tickArray[0]>=val){
return tickArray[0]
}else{
for(var i=0,len=tickArray.length;i<len;++i){
var next=i+1;
if(tickArray[next]&&tickArray[next]>=val){
var diff1=val-tickArray[i];
var diff2=tickArray[next]-val;
return diff2>diff1?tickArray[i]:tickArray[next]
}
}
return tickArray[tickArray.length-1]
}
},
toString:function(){
return'DragDrop '+this.id
}
}
}());
if(!Ext.dd.DragDropMgr){
Ext.dd.DragDropMgr=function(){
var Event=Ext.EventManager;
return{
ids:{},
handleIds:{},
dragCurrent:null,
dragOvers:{},
deltaX:0,
deltaY:0,
preventDefault:true,
stopPropagation:true,
initialized:false,
locked:false,
init:function(){
this.initialized=true
},
POINT:0,
INTERSECT:1,
mode:0,
_execOnAll:function(sMethod,args){
for(var i in this.ids){
for(var j in this.ids[i]){
var oDD=this.ids[i][j];
if(!this.isTypeOfDD(oDD)){
continue
}
oDD[sMethod].apply(oDD,args)
}
}
},
_onLoad:function(){
this.init();
Event.on(document,'mouseup',this.handleMouseUp,this,true);
Event.on(document,'mousemove',this.handleMouseMove,this,true);
Event.on(window,'unload',this._onUnload,this,true);
Event.on(window,'resize',this._onResize,this,true)
},
_onResize:function(e){
this._execOnAll('resetConstraints',[])
},
lock:function(){
this.locked=true
},
unlock:function(){
this.locked=false
},
isLocked:function(){
return this.locked
},
locationCache:{},
useCache:true,
clickPixelThresh:3,
clickTimeThresh:350,
dragThreshMet:false,
clickTimeout:null,
startX:0,
startY:0,
regDragDrop:function(oDD,sGroup){
if(!this.initialized){
this.init()
}
if(!this.ids[sGroup]){
this.ids[sGroup]={}
}
this.ids[sGroup][oDD.id]=oDD
},
removeDDFromGroup:function(oDD,sGroup){
if(!this.ids[sGroup]){
this.ids[sGroup]={}
}
var obj=this.ids[sGroup];
if(obj&&obj[oDD.id]){
delete obj[oDD.id]
}
},
_remove:function(oDD){
for(var g in oDD.groups){
if(g&&this.ids[g]&&this.ids[g][oDD.id]){
delete this.ids[g][oDD.id]
}
}
delete this.handleIds[oDD.id]
},
regHandle:function(sDDId,sHandleId){
if(!this.handleIds[sDDId]){
this.handleIds[sDDId]={}
}
this.handleIds[sDDId][sHandleId]=sHandleId
},
isDragDrop:function(id){
return this.getDDById(id)?true:false
},
getRelated:function(p_oDD,bTargetsOnly){
var oDDs=[];
for(var i in p_oDD.groups){
for(var j in this.ids[i]){
var dd=this.ids[i][j];
if(!this.isTypeOfDD(dd)){
continue
}
if(!bTargetsOnly||dd.isTarget){
oDDs[oDDs.length]=dd
}
}
}
return oDDs
},
isLegalTarget:function(oDD,oTargetDD){
var targets=this.getRelated(oDD,true);
for(var i=0,len=targets.length;i<len;++i){
if(targets[i].id==oTargetDD.id){
return true
}
}
return false
},
isTypeOfDD:function(oDD){
return oDD&&oDD.__ygDragDrop
},
isHandle:function(sDDId,sHandleId){
return this.handleIds[sDDId]&&this.handleIds[sDDId][sHandleId]
},
getDDById:function(id){
for(var i in this.ids){
if(this.ids[i][id]){
return this.ids[i][id]
}
}
return null
},
handleMouseDown:function(e,oDD){
if(Ext.QuickTips){
Ext.QuickTips.ddDisable()
}
if(this.dragCurrent){
this.handleMouseUp(e)
}
this.currentTarget=e.getTarget();
this.dragCurrent=oDD;
var el=oDD.getEl();
this.startX=e.getPageX();
this.startY=e.getPageY();
this.deltaX=this.startX-el.offsetLeft;
this.deltaY=this.startY-el.offsetTop;
this.dragThreshMet=false;
this.clickTimeout=setTimeout(function(){
var DDM=Ext.dd.DDM;
DDM.startDrag(DDM.startX,DDM.startY)
},this.clickTimeThresh)
},
startDrag:function(x,y){
clearTimeout(this.clickTimeout);
if(this.dragCurrent){
this.dragCurrent.b4StartDrag(x,y);
this.dragCurrent.startDrag(x,y)
}
this.dragThreshMet=true
},
handleMouseUp:function(e){
if(Ext.QuickTips){
Ext.QuickTips.ddEnable()
}
if(!this.dragCurrent){
return
}
clearTimeout(this.clickTimeout);
if(this.dragThreshMet){
this.fireEvents(e,true)
}else{
}
this.stopDrag(e);
this.stopEvent(e)
},
stopEvent:function(e){
if(this.stopPropagation){
e.stopPropagation()
}
if(this.preventDefault){
e.preventDefault()
}
},
stopDrag:function(e){
if(this.dragCurrent){
if(this.dragThreshMet){
this.dragCurrent.b4EndDrag(e);
this.dragCurrent.endDrag(e)
}
this.dragCurrent.onMouseUp(e)
}
this.dragCurrent=null;
this.dragOvers={}
},
handleMouseMove:function(e){
if(!this.dragCurrent){
return true
}
if(Ext.isIE&&(e.button!==0&&e.button!==1&&e.button!==2)){
this.stopEvent(e);
return this.handleMouseUp(e)
}
if(!this.dragThreshMet){
var diffX=Math.abs(this.startX-e.getPageX());
var diffY=Math.abs(this.startY-e.getPageY());
if(diffX>this.clickPixelThresh||diffY>this.clickPixelThresh){
this.startDrag(this.startX,this.startY)
}
}
if(this.dragThreshMet){
this.dragCurrent.b4Drag(e);
this.dragCurrent.onDrag(e);
if(!this.dragCurrent.moveOnly){
this.fireEvents(e,false)
}
}
this.stopEvent(e);
return true
},
fireEvents:function(e,isDrop){
var dc=this.dragCurrent;
if(!dc||dc.isLocked()){
return
}
var pt=e.getPoint();
var oldOvers=[];
var outEvts=[];
var overEvts=[];
var dropEvts=[];
var enterEvts=[];
for(var i in this.dragOvers){
var ddo=this.dragOvers[i];
if(!this.isTypeOfDD(ddo)){
continue
}
if(!this.isOverTarget(pt,ddo,this.mode)){
outEvts.push(ddo)
}
oldOvers[i]=true;
delete this.dragOvers[i]
}
for(var sGroup in dc.groups){
if('string'!=typeof sGroup){
continue
}
for(i in this.ids[sGroup]){
var oDD=this.ids[sGroup][i];
if(!this.isTypeOfDD(oDD)){
continue
}
if(oDD.isTarget&&!oDD.isLocked()&&(oDD!=dc||dc.ignoreSelf===false)){
if(this.isOverTarget(pt,oDD,this.mode)){
if(isDrop){
dropEvts.push(oDD)
}else{
if(!oldOvers[oDD.id]){
enterEvts.push(oDD)
}else{
overEvts.push(oDD)
}
this.dragOvers[oDD.id]=oDD
}
}
}
}
}
if(this.mode){
if(outEvts.length){
dc.b4DragOut(e,outEvts);
dc.onDragOut(e,outEvts)
}
if(enterEvts.length){
dc.onDragEnter(e,enterEvts)
}
if(overEvts.length){
dc.b4DragOver(e,overEvts);
dc.onDragOver(e,overEvts)
}
if(dropEvts.length){
dc.b4DragDrop(e,dropEvts);
dc.onDragDrop(e,dropEvts)
}
}else{
var len=0;
for(i=0,len=outEvts.length;i<len;++i){
dc.b4DragOut(e,outEvts[i].id);
dc.onDragOut(e,outEvts[i].id)
}
for(i=0,len=enterEvts.length;i<len;++i){
dc.onDragEnter(e,enterEvts[i].id)
}
for(i=0,len=overEvts.length;i<len;++i){
dc.b4DragOver(e,overEvts[i].id);
dc.onDragOver(e,overEvts[i].id)
}
for(i=0,len=dropEvts.length;i<len;++i){
dc.b4DragDrop(e,dropEvts[i].id);
dc.onDragDrop(e,dropEvts[i].id)
}
}
if(isDrop&&!dropEvts.length){
dc.onInvalidDrop(e)
}
},
getBestMatch:function(dds){
var winner=null;
var len=dds.length;
if(len==1){
winner=dds[0]
}else{
for(var i=0;i<len;++i){
var dd=dds[i];
if(dd.cursorIsOver){
winner=dd;
break
}else{
if(!winner||winner.overlap.getArea()<dd.overlap.getArea()){
winner=dd
}
}
}
}
return winner
},
refreshCache:function(groups){
for(var sGroup in groups){
if('string'!=typeof sGroup){
continue
}
for(var i in this.ids[sGroup]){
var oDD=this.ids[sGroup][i];
if(this.isTypeOfDD(oDD)){
var loc=this.getLocation(oDD);
if(loc){
this.locationCache[oDD.id]=loc
}else{
delete this.locationCache[oDD.id]
}
}
}
}
},
verifyEl:function(el){
if(el){
var parent;
if(Ext.isIE){
try{
parent=el.offsetParent
}catch(e){
}
}else{
parent=el.offsetParent
}
if(parent){
return true
}
}
return false
},
getLocation:function(oDD){
if(!this.isTypeOfDD(oDD)){
return null
}
var el=oDD.getEl(),pos,x1,x2,y1,y2,t,r,b,l,region;
try{
pos=Ext.lib.Dom.getXY(el)
}catch(e){
}
if(!pos){
return null
}
x1=pos[0];
x2=x1+el.offsetWidth;
y1=pos[1];
y2=y1+el.offsetHeight;
t=y1-oDD.padding[0];
r=x2+oDD.padding[1];
b=y2+oDD.padding[2];
l=x1-oDD.padding[3];
region=new Ext.lib.Region(t,r,b,l);
el=Ext.get(el.parentNode);
while(el&&region){
if(el.isScrollable()){
region=region.intersect(el.getRegion())
}
el=el.parent()
}
return region
},
isOverTarget:function(pt,oTarget,intersect){
var loc=this.locationCache[oTarget.id];
if(!loc||!this.useCache){
loc=this.getLocation(oTarget);
this.locationCache[oTarget.id]=loc
}
if(!loc){
return false
}
oTarget.cursorIsOver=loc.contains(pt);
var dc=this.dragCurrent;
if(!dc||!dc.getTargetCoord||!intersect&&!dc.constrainX&&!dc.constrainY){
return oTarget.cursorIsOver
}
oTarget.overlap=null;
var pos=dc.getTargetCoord(pt.x,pt.y);
var el=dc.getDragEl();
var curRegion=new Ext.lib.Region(pos.y,pos.x+el.offsetWidth,pos.y+el.offsetHeight,pos.x);
var overlap=curRegion.intersect(loc);
if(overlap){
oTarget.overlap=overlap;
return intersect?true:oTarget.cursorIsOver
}else{
return false
}
},
_onUnload:function(e,me){
Event.removeListener(document,'mouseup',this.handleMouseUp,this);
Event.removeListener(document,'mousemove',this.handleMouseMove,this);
Event.removeListener(window,'resize',this._onResize,this);
Ext.dd.DragDropMgr.unregAll()
},
unregAll:function(){
if(this.dragCurrent){
this.stopDrag();
this.dragCurrent=null
}
this._execOnAll('unreg',[]);
for(var i in this.elementCache){
delete this.elementCache[i]
}
this.elementCache={};
this.ids={}
},
elementCache:{},
getElWrapper:function(id){
var oWrapper=this.elementCache[id];
if(!oWrapper||!oWrapper.el){
oWrapper=this.elementCache[id]=new this.ElementWrapper(Ext.getDom(id))
}
return oWrapper
},
getElement:function(id){
return Ext.getDom(id)
},
getCss:function(id){
var el=Ext.getDom(id);
return el?el.style:null
},
ElementWrapper:function(el){
this.el=el||null;
this.id=this.el&&el.id;
this.css=this.el&&el.style
},
getPosX:function(el){
return Ext.lib.Dom.getX(el)
},
getPosY:function(el){
return Ext.lib.Dom.getY(el)
},
swapNode:function(n1,n2){
if(n1.swapNode){
n1.swapNode(n2)
}else{
var p=n2.parentNode;
var s=n2.nextSibling;
if(s==n1){
p.insertBefore(n1,n2)
}else if(n2==n1.nextSibling){
p.insertBefore(n2,n1)
}else{
n1.parentNode.replaceChild(n2,n1);
p.insertBefore(n1,s)
}
}
},
getScroll:function(){
var t,l,dde=document.documentElement,db=document.body;
if(dde&&(dde.scrollTop||dde.scrollLeft)){
t=dde.scrollTop;
l=dde.scrollLeft
}else if(db){
t=db.scrollTop;
l=db.scrollLeft
}else{
}
return{
top:t,
left:l
}
},
getStyle:function(el,styleProp){
return Ext.fly(el).getStyle(styleProp)
},
getScrollTop:function(){
return this.getScroll().top
},
getScrollLeft:function(){
return this.getScroll().left
},
moveToEl:function(moveEl,targetEl){
var aCoord=Ext.lib.Dom.getXY(targetEl);
Ext.lib.Dom.setXY(moveEl,aCoord)
},
numericSort:function(a,b){
return a-b
},
_timeoutCount:0,
_addListeners:function(){
var DDM=Ext.dd.DDM;
if(Ext.lib.Event&&document){
DDM._onLoad()
}else{
if(DDM._timeoutCount>2000){
}else{
setTimeout(DDM._addListeners,10);
if(document&&document.body){
DDM._timeoutCount+=1
}
}
}
},
handleWasClicked:function(node,id){
if(this.isHandle(id,node.id)){
return true
}else{
var p=node.parentNode;
while(p){
if(this.isHandle(id,p.id)){
return true
}else{
p=p.parentNode
}
}
}
return false
}
}
}();
Ext.dd.DDM=Ext.dd.DragDropMgr;
Ext.dd.DDM._addListeners()
}
Ext.dd.DD=function(id,sGroup,config){
if(id){
this.init(id,sGroup,config)
}
};
Ext.extend(Ext.dd.DD,Ext.dd.DragDrop,{
scroll:true,
autoOffset:function(iPageX,iPageY){
var x=iPageX-this.startPageX;
var y=iPageY-this.startPageY;
this.setDelta(x,y)
},
setDelta:function(iDeltaX,iDeltaY){
this.deltaX=iDeltaX;
this.deltaY=iDeltaY
},
setDragElPos:function(iPageX,iPageY){
var el=this.getDragEl();
this.alignElWithMouse(el,iPageX,iPageY)
},
alignElWithMouse:function(el,iPageX,iPageY){
var oCoord=this.getTargetCoord(iPageX,iPageY);
var fly=el.dom?el:Ext.fly(el,'_dd');
if(!this.deltaSetXY){
var aCoord=[
oCoord.x,
oCoord.y
];
fly.setXY(aCoord);
var newLeft=fly.getLeft(true);
var newTop=fly.getTop(true);
this.deltaSetXY=[
newLeft-oCoord.x,
newTop-oCoord.y
]
}else{
fly.setLeftTop(oCoord.x+this.deltaSetXY[0],oCoord.y+this.deltaSetXY[1])
}
this.cachePosition(oCoord.x,oCoord.y);
this.autoScroll(oCoord.x,oCoord.y,el.offsetHeight,el.offsetWidth);
return oCoord
},
cachePosition:function(iPageX,iPageY){
if(iPageX){
this.lastPageX=iPageX;
this.lastPageY=iPageY
}else{
var aCoord=Ext.lib.Dom.getXY(this.getEl());
this.lastPageX=aCoord[0];
this.lastPageY=aCoord[1]
}
},
autoScroll:function(x,y,h,w){
if(this.scroll){
var clientH=Ext.lib.Dom.getViewHeight();
var clientW=Ext.lib.Dom.getViewWidth();
var st=this.DDM.getScrollTop();
var sl=this.DDM.getScrollLeft();
var bot=h+y;
var right=w+x;
var toBot=clientH+st-y-this.deltaY;
var toRight=clientW+sl-x-this.deltaX;
var thresh=40;
var scrAmt=document.all?80:30;
if(bot>clientH&&toBot<thresh){
window.scrollTo(sl,st+scrAmt)
}
if(y<st&&st>0&&y-st<thresh){
window.scrollTo(sl,st-scrAmt)
}
if(right>clientW&&toRight<thresh){
window.scrollTo(sl+scrAmt,st)
}
if(x<sl&&sl>0&&x-sl<thresh){
window.scrollTo(sl-scrAmt,st)
}
}
},
getTargetCoord:function(iPageX,iPageY){
var x=iPageX-this.deltaX;
var y=iPageY-this.deltaY;
if(this.constrainX){
if(x<this.minX){
x=this.minX
}
if(x>this.maxX){
x=this.maxX
}
}
if(this.constrainY){
if(y<this.minY){
y=this.minY
}
if(y>this.maxY){
y=this.maxY
}
}
x=this.getTick(x,this.xTicks);
y=this.getTick(y,this.yTicks);
return{
x:x,
y:y
}
},
applyConfig:function(){
Ext.dd.DD.superclass.applyConfig.call(this);
this.scroll=this.config.scroll!==false
},
b4MouseDown:function(e){
this.autoOffset(e.getPageX(),e.getPageY())
},
b4Drag:function(e){
this.setDragElPos(e.getPageX(),e.getPageY())
},
toString:function(){
return'DD '+this.id
}
});
Ext.dd.DDProxy=function(id,sGroup,config){
if(id){
this.init(id,sGroup,config);
this.initFrame()
}
};
Ext.dd.DDProxy.dragElId='ygddfdiv';
Ext.extend(Ext.dd.DDProxy,Ext.dd.DD,{
resizeFrame:true,
centerFrame:false,
createFrame:function(){
var self=this;
var body=document.body;
if(!body||!body.firstChild){
setTimeout(function(){
self.createFrame()
},50);
return
}
var div=this.getDragEl();
if(!div){
div=document.createElement('div');
div.id=this.dragElId;
var s=div.style;
s.position='absolute';
s.visibility='hidden';
s.cursor='move';
s.border='2px solid #aaa';
s.zIndex=999;
body.insertBefore(div,body.firstChild)
}
},
initFrame:function(){
this.createFrame()
},
applyConfig:function(){
Ext.dd.DDProxy.superclass.applyConfig.call(this);
this.resizeFrame=this.config.resizeFrame!==false;
this.centerFrame=this.config.centerFrame;
this.setDragElId(this.config.dragElId||Ext.dd.DDProxy.dragElId)
},
showFrame:function(iPageX,iPageY){
var el=this.getEl();
var dragEl=this.getDragEl();
var s=dragEl.style;
this._resizeProxy();
if(this.centerFrame){
this.setDelta(Math.round(parseInt(s.width,10)/2),Math.round(parseInt(s.height,10)/2))
}
this.setDragElPos(iPageX,iPageY);
Ext.fly(dragEl).show()
},
_resizeProxy:function(){
if(this.resizeFrame){
var el=this.getEl();
Ext.fly(this.getDragEl()).setSize(el.offsetWidth,el.offsetHeight)
}
},
b4MouseDown:function(e){
var x=e.getPageX();
var y=e.getPageY();
this.autoOffset(x,y);
this.setDragElPos(x,y)
},
b4StartDrag:function(x,y){
this.showFrame(x,y)
},
b4EndDrag:function(e){
Ext.fly(this.getDragEl()).hide()
},
endDrag:function(e){
var lel=this.getEl();
var del=this.getDragEl();
del.style.visibility='';
this.beforeMove();
lel.style.visibility='hidden';
Ext.dd.DDM.moveToEl(lel,del);
del.style.visibility='hidden';
lel.style.visibility='';
this.afterDrag()
},
beforeMove:function(){
},
afterDrag:function(){
},
toString:function(){
return'DDProxy '+this.id
}
});
Ext.dd.DDTarget=function(id,sGroup,config){
if(id){
this.initTarget(id,sGroup,config)
}
};
Ext.extend(Ext.dd.DDTarget,Ext.dd.DragDrop,{
getDragEl:Ext.emptyFn,
isValidHandleChild:Ext.emptyFn,
startDrag:Ext.emptyFn,
endDrag:Ext.emptyFn,
onDrag:Ext.emptyFn,
onDragDrop:Ext.emptyFn,
onDragEnter:Ext.emptyFn,
onDragOut:Ext.emptyFn,
onDragOver:Ext.emptyFn,
onInvalidDrop:Ext.emptyFn,
onMouseDown:Ext.emptyFn,
onMouseUp:Ext.emptyFn,
setXConstraint:Ext.emptyFn,
setYConstraint:Ext.emptyFn,
resetConstraints:Ext.emptyFn,
clearConstraints:Ext.emptyFn,
clearTicks:Ext.emptyFn,
setInitPosition:Ext.emptyFn,
setDragElId:Ext.emptyFn,
setHandleElId:Ext.emptyFn,
setOuterHandleElId:Ext.emptyFn,
addInvalidHandleClass:Ext.emptyFn,
addInvalidHandleId:Ext.emptyFn,
addInvalidHandleType:Ext.emptyFn,
removeInvalidHandleClass:Ext.emptyFn,
removeInvalidHandleId:Ext.emptyFn,
removeInvalidHandleType:Ext.emptyFn,
toString:function(){
return'DDTarget '+this.id
}
});
Ext.dd.DragTracker=Ext.extend(Ext.util.Observable,{
active:false,
tolerance:5,
autoStart:false,
constructor:function(config){
Ext.apply(this,config);
this.addEvents('mousedown','mouseup','mousemove','dragstart','dragend','drag');
this.dragRegion=new Ext.lib.Region(0,0,0,0);
if(this.el){
this.initEl(this.el)
}
Ext.dd.DragTracker.superclass.constructor.call(this,config)
},
initEl:function(el){
this.el=Ext.get(el);
el.on('mousedown',this.onMouseDown,this,this.delegate?{delegate:this.delegate}:undefined)
},
destroy:function(){
this.el.un('mousedown',this.onMouseDown,this);
delete this.el
},
onMouseDown:function(e,target){
if(this.fireEvent('mousedown',this,e)!==false&&this.onBeforeStart(e)!==false){
this.startXY=this.lastXY=e.getXY();
this.dragTarget=this.delegate?target:this.el.dom;
if(this.preventDefault!==false){
e.preventDefault()
}
Ext.getDoc().on({
scope:this,
mouseup:this.onMouseUp,
mousemove:this.onMouseMove,
selectstart:this.stopSelect
});
if(this.autoStart){
this.timer=this.triggerStart.defer(this.autoStart===true?1000:this.autoStart,this,[e])
}
}
},
onMouseMove:function(e,target){
if(this.active&&(Ext.isIE6||Ext.isIE7||Ext.isIE8)&&!e.browserEvent.button){
e.preventDefault();
this.onMouseUp(e);
return
}
e.preventDefault();
var xy=e.getXY(),s=this.startXY;
this.lastXY=xy;
if(!this.active){
if(Math.abs(s[0]-xy[0])>this.tolerance||Math.abs(s[1]-xy[1])>this.tolerance){
this.triggerStart(e)
}else{
return
}
}
this.fireEvent('mousemove',this,e);
this.onDrag(e);
this.fireEvent('drag',this,e)
},
onMouseUp:function(e){
var doc=Ext.getDoc(),wasActive=this.active;
doc.un('mousemove',this.onMouseMove,this);
doc.un('mouseup',this.onMouseUp,this);
doc.un('selectstart',this.stopSelect,this);
e.preventDefault();
this.clearStart();
this.active=false;
delete this.elRegion;
this.fireEvent('mouseup',this,e);
if(wasActive){
this.onEnd(e);
this.fireEvent('dragend',this,e)
}
},
triggerStart:function(e){
this.clearStart();
this.active=true;
this.onStart(e);
this.fireEvent('dragstart',this,e)
},
clearStart:function(){
if(this.timer){
clearTimeout(this.timer);
delete this.timer
}
},
stopSelect:function(e){
e.stopEvent();
return false
},
onBeforeStart:function(e){
},
onStart:function(xy){
},
onDrag:function(e){
},
onEnd:function(e){
},
getDragTarget:function(){
return this.dragTarget
},
getDragCt:function(){
return this.el
},
getXY:function(constrain){
return constrain?this.constrainModes[constrain].call(this,this.lastXY):this.lastXY
},
getOffset:function(constrain){
var xy=this.getXY(constrain),s=this.startXY;
return[
s[0]-xy[0],
s[1]-xy[1]
]
},
constrainModes:{
'point':function(xy){
if(!this.elRegion){
this.elRegion=this.getDragCt().getRegion()
}
var dr=this.dragRegion;
dr.left=xy[0];
dr.top=xy[1];
dr.right=xy[0];
dr.bottom=xy[1];
dr.constrainTo(this.elRegion);
return[
dr.left,
dr.top
]
}
}
});
Ext.dd.ScrollManager=function(){
var ddm=Ext.dd.DragDropMgr;
var els={};
var dragEl=null;
var proc={};
var onStop=function(e){
dragEl=null;
clearProc()
};
var triggerRefresh=function(){
if(ddm.dragCurrent){
ddm.refreshCache(ddm.dragCurrent.groups)
}
};
var doScroll=function(){
if(ddm.dragCurrent){
var dds=Ext.dd.ScrollManager;
var inc=proc.el.ddScrollConfig?proc.el.ddScrollConfig.increment:dds.increment;
if(!dds.animate){
if(proc.el.scroll(proc.dir,inc)){
triggerRefresh()
}
}else{
proc.el.scroll(proc.dir,inc,true,dds.animDuration,triggerRefresh)
}
}
};
var clearProc=function(){
if(proc.id){
clearInterval(proc.id)
}
proc.id=0;
proc.el=null;
proc.dir=''
};
var startProc=function(el,dir){
clearProc();
proc.el=el;
proc.dir=dir;
var group=el.ddScrollConfig?el.ddScrollConfig.ddGroup:undefined,freq=el.ddScrollConfig&&el.ddScrollConfig.frequency?el.ddScrollConfig.frequency:Ext.dd.ScrollManager.frequency;
if(group===undefined||ddm.dragCurrent.ddGroup==group){
proc.id=setInterval(doScroll,freq)
}
};
var onFire=function(e,isDrop){
if(isDrop||!ddm.dragCurrent){
return
}
var dds=Ext.dd.ScrollManager;
if(!dragEl||dragEl!=ddm.dragCurrent){
dragEl=ddm.dragCurrent;
dds.refreshCache()
}
var xy=Ext.lib.Event.getXY(e);
var pt=new Ext.lib.Point(xy[0],xy[1]);
for(var id in els){
var el=els[id],r=el._region;
var c=el.ddScrollConfig?el.ddScrollConfig:dds;
if(r&&r.contains(pt)&&el.isScrollable()){
if(r.bottom-pt.y<=c.vthresh){
if(proc.el!=el){
startProc(el,'down')
}
return
}else if(r.right-pt.x<=c.hthresh){
if(proc.el!=el){
startProc(el,'left')
}
return
}else if(pt.y-r.top<=c.vthresh){
if(proc.el!=el){
startProc(el,'up')
}
return
}else if(pt.x-r.left<=c.hthresh){
if(proc.el!=el){
startProc(el,'right')
}
return
}
}
}
clearProc()
};
ddm.fireEvents=ddm.fireEvents.createSequence(onFire,ddm);
ddm.stopDrag=ddm.stopDrag.createSequence(onStop,ddm);
return{
register:function(el){
if(Ext.isArray(el)){
for(var i=0,len=el.length;i<len;i++){
this.register(el[i])
}
}else{
el=Ext.get(el);
els[el.id]=el
}
},
unregister:function(el){
if(Ext.isArray(el)){
for(var i=0,len=el.length;i<len;i++){
this.unregister(el[i])
}
}else{
el=Ext.get(el);
delete els[el.id]
}
},
vthresh:25,
hthresh:25,
increment:100,
frequency:500,
animate:true,
animDuration:0.4,
ddGroup:undefined,
refreshCache:function(){
for(var id in els){
if(typeof els[id]=='object'){
els[id]._region=els[id].getRegion()
}
}
}
}
}();
Ext.dd.Registry=function(){
var elements={};
var handles={};
var autoIdSeed=0;
var getId=function(el,autogen){
if(typeof el=='string'){
return el
}
var id=el.id;
if(!id&&autogen!==false){
id='extdd-'+ ++autoIdSeed;
el.id=id
}
return id
};
return{
register:function(el,data){
data=data||{};
if(typeof el=='string'){
el=document.getElementById(el)
}
data.ddel=el;
elements[getId(el)]=data;
if(data.isHandle!==false){
handles[data.ddel.id]=data
}
if(data.handles){
var hs=data.handles;
for(var i=0,len=hs.length;i<len;i++){
handles[getId(hs[i])]=data
}
}
},
unregister:function(el){
var id=getId(el,false);
var data=elements[id];
if(data){
delete elements[id];
if(data.handles){
var hs=data.handles;
for(var i=0,len=hs.length;i<len;i++){
delete handles[getId(hs[i],false)]
}
}
}
},
getHandle:function(id){
if(typeof id!='string'){
id=id.id
}
return handles[id]
},
getHandleFromEvent:function(e){
var t=Ext.lib.Event.getTarget(e);
return t?handles[t.id]:null
},
getTarget:function(id){
if(typeof id!='string'){
id=id.id
}
return elements[id]
},
getTargetFromEvent:function(e){
var t=Ext.lib.Event.getTarget(e);
return t?elements[t.id]||handles[t.id]:null
}
}
}();
Ext.dd.StatusProxy=function(config){
Ext.apply(this,config);
this.id=this.id||Ext.id();
this.el=new Ext.Layer({
dh:{
id:this.id,
tag:'div',
cls:'x-dd-drag-proxy '+this.dropNotAllowed,
children:[
{
tag:'div',
cls:'x-dd-drop-icon'
},
{
tag:'div',
cls:'x-dd-drag-ghost'
}
]
},
shadow:!config||config.shadow!==false
});
this.ghost=Ext.get(this.el.dom.childNodes[1]);
this.dropStatus=this.dropNotAllowed
};
Ext.dd.StatusProxy.prototype={
dropAllowed:'x-dd-drop-ok',
dropNotAllowed:'x-dd-drop-nodrop',
setStatus:function(cssClass){
cssClass=cssClass||this.dropNotAllowed;
if(this.dropStatus!=cssClass){
this.el.replaceClass(this.dropStatus,cssClass);
this.dropStatus=cssClass
}
},
reset:function(clearGhost){
this.el.dom.className='x-dd-drag-proxy '+this.dropNotAllowed;
this.dropStatus=this.dropNotAllowed;
if(clearGhost){
this.ghost.update('')
}
},
update:function(html){
if(typeof html=='string'){
this.ghost.update(html)
}else{
this.ghost.update('');
html.style.margin='0';
this.ghost.dom.appendChild(html)
}
var el=this.ghost.dom.firstChild;
if(el){
Ext.fly(el).setStyle('float','none')
}
},
getEl:function(){
return this.el
},
getGhost:function(){
return this.ghost
},
hide:function(clear){
this.el.hide();
if(clear){
this.reset(true)
}
},
stop:function(){
if(this.anim&&this.anim.isAnimated&&this.anim.isAnimated()){
this.anim.stop()
}
},
show:function(){
this.el.show()
},
sync:function(){
this.el.sync()
},
repair:function(xy,callback,scope){
this.callback=callback;
this.scope=scope;
if(xy&&this.animRepair!==false){
this.el.addClass('x-dd-drag-repair');
this.el.hideUnders(true);
this.anim=this.el.shift({
duration:this.repairDuration||0.5,
easing:'easeOut',
xy:xy,
stopFx:true,
callback:this.afterRepair,
scope:this
})
}else{
this.afterRepair()
}
},
afterRepair:function(){
this.hide(true);
if(typeof this.callback=='function'){
this.callback.call(this.scope||this)
}
this.callback=null;
this.scope=null
},
destroy:function(){
Ext.destroy(this.ghost,this.el)
}
};
Ext.dd.DragSource=function(el,config){
this.el=Ext.get(el);
if(!this.dragData){
this.dragData={}
}
Ext.apply(this,config);
if(!this.proxy){
this.proxy=new Ext.dd.StatusProxy
}
Ext.dd.DragSource.superclass.constructor.call(this,this.el.dom,this.ddGroup||this.group,{
dragElId:this.proxy.id,
resizeFrame:false,
isTarget:false,
scroll:this.scroll===true
});
this.dragging=false
};
Ext.extend(Ext.dd.DragSource,Ext.dd.DDProxy,{
dropAllowed:'x-dd-drop-ok',
dropNotAllowed:'x-dd-drop-nodrop',
getDragData:function(e){
return this.dragData
},
onDragEnter:function(e,id){
var target=Ext.dd.DragDropMgr.getDDById(id);
this.cachedTarget=target;
if(this.beforeDragEnter(target,e,id)!==false){
if(target.isNotifyTarget){
var status=target.notifyEnter(this,e,this.dragData);
this.proxy.setStatus(status)
}else{
this.proxy.setStatus(this.dropAllowed)
}
if(this.afterDragEnter){
this.afterDragEnter(target,e,id)
}
}
},
beforeDragEnter:function(target,e,id){
return true
},
alignElWithMouse:function(){
Ext.dd.DragSource.superclass.alignElWithMouse.apply(this,arguments);
this.proxy.sync()
},
onDragOver:function(e,id){
var target=this.cachedTarget||Ext.dd.DragDropMgr.getDDById(id);
if(this.beforeDragOver(target,e,id)!==false){
if(target.isNotifyTarget){
var status=target.notifyOver(this,e,this.dragData);
this.proxy.setStatus(status)
}
if(this.afterDragOver){
this.afterDragOver(target,e,id)
}
}
},
beforeDragOver:function(target,e,id){
return true
},
onDragOut:function(e,id){
var target=this.cachedTarget||Ext.dd.DragDropMgr.getDDById(id);
if(this.beforeDragOut(target,e,id)!==false){
if(target.isNotifyTarget){
target.notifyOut(this,e,this.dragData)
}
this.proxy.reset();
if(this.afterDragOut){
this.afterDragOut(target,e,id)
}
}
this.cachedTarget=null
},
beforeDragOut:function(target,e,id){
return true
},
onDragDrop:function(e,id){
var target=this.cachedTarget||Ext.dd.DragDropMgr.getDDById(id);
if(this.beforeDragDrop(target,e,id)!==false){
if(target.isNotifyTarget){
if(target.notifyDrop(this,e,this.dragData)){
this.onValidDrop(target,e,id)
}else{
this.onInvalidDrop(target,e,id)
}
}else{
this.onValidDrop(target,e,id)
}
if(this.afterDragDrop){
this.afterDragDrop(target,e,id)
}
}
delete this.cachedTarget
},
beforeDragDrop:function(target,e,id){
return true
},
onValidDrop:function(target,e,id){
this.hideProxy();
if(this.afterValidDrop){
this.afterValidDrop(target,e,id)
}
},
getRepairXY:function(e,data){
return this.el.getXY()
},
onInvalidDrop:function(target,e,id){
this.beforeInvalidDrop(target,e,id);
if(this.cachedTarget){
if(this.cachedTarget.isNotifyTarget){
this.cachedTarget.notifyOut(this,e,this.dragData)
}
this.cacheTarget=null
}
this.proxy.repair(this.getRepairXY(e,this.dragData),this.afterRepair,this);
if(this.afterInvalidDrop){
this.afterInvalidDrop(e,id)
}
},
afterRepair:function(){
if(Ext.enableFx){
this.el.highlight(this.hlColor||'c3daf9')
}
this.dragging=false
},
beforeInvalidDrop:function(target,e,id){
return true
},
handleMouseDown:function(e){
if(this.dragging){
return
}
var data=this.getDragData(e);
if(data&&this.onBeforeDrag(data,e)!==false){
this.dragData=data;
this.proxy.stop();
Ext.dd.DragSource.superclass.handleMouseDown.apply(this,arguments)
}
},
onBeforeDrag:function(data,e){
return true
},
onStartDrag:Ext.emptyFn,
startDrag:function(x,y){
this.proxy.reset();
this.dragging=true;
this.proxy.update('');
this.onInitDrag(x,y);
this.proxy.show()
},
onInitDrag:function(x,y){
var clone=this.el.dom.cloneNode(true);
clone.id=Ext.id();
this.proxy.update(clone);
this.onStartDrag(x,y);
return true
},
getProxy:function(){
return this.proxy
},
hideProxy:function(){
this.proxy.hide();
this.proxy.reset(true);
this.dragging=false
},
triggerCacheRefresh:function(){
Ext.dd.DDM.refreshCache(this.groups)
},
b4EndDrag:function(e){
},
endDrag:function(e){
this.onEndDrag(this.dragData,e)
},
onEndDrag:function(data,e){
},
autoOffset:function(x,y){
this.setDelta(-12,-20)
},
destroy:function(){
Ext.dd.DragSource.superclass.destroy.call(this);
Ext.destroy(this.proxy)
}
});
Ext.dd.DropTarget=Ext.extend(Ext.dd.DDTarget,{
constructor:function(el,config){
this.el=Ext.get(el);
Ext.apply(this,config);
if(this.containerScroll){
Ext.dd.ScrollManager.register(this.el)
}
Ext.dd.DropTarget.superclass.constructor.call(this,this.el.dom,this.ddGroup||this.group,{isTarget:true})
},
dropAllowed:'x-dd-drop-ok',
dropNotAllowed:'x-dd-drop-nodrop',
isTarget:true,
isNotifyTarget:true,
notifyEnter:function(dd,e,data){
if(this.overClass){
this.el.addClass(this.overClass)
}
return this.dropAllowed
},
notifyOver:function(dd,e,data){
return this.dropAllowed
},
notifyOut:function(dd,e,data){
if(this.overClass){
this.el.removeClass(this.overClass)
}
},
notifyDrop:function(dd,e,data){
return false
},
destroy:function(){
Ext.dd.DropTarget.superclass.destroy.call(this);
if(this.containerScroll){
Ext.dd.ScrollManager.unregister(this.el)
}
}
});
Ext.dd.DragZone=Ext.extend(Ext.dd.DragSource,{
constructor:function(el,config){
Ext.dd.DragZone.superclass.constructor.call(this,el,config);
if(this.containerScroll){
Ext.dd.ScrollManager.register(this.el)
}
},
getDragData:function(e){
return Ext.dd.Registry.getHandleFromEvent(e)
},
onInitDrag:function(x,y){
this.proxy.update(this.dragData.ddel.cloneNode(true));
this.onStartDrag(x,y);
return true
},
afterRepair:function(){
if(Ext.enableFx){
Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||'c3daf9')
}
this.dragging=false
},
getRepairXY:function(e){
return Ext.Element.fly(this.dragData.ddel).getXY()
},
destroy:function(){
Ext.dd.DragZone.superclass.destroy.call(this);
if(this.containerScroll){
Ext.dd.ScrollManager.unregister(this.el)
}
}
});
Ext.dd.DropZone=function(el,config){
Ext.dd.DropZone.superclass.constructor.call(this,el,config)
};
Ext.extend(Ext.dd.DropZone,Ext.dd.DropTarget,{
getTargetFromEvent:function(e){
return Ext.dd.Registry.getTargetFromEvent(e)
},
onNodeEnter:function(n,dd,e,data){
},
onNodeOver:function(n,dd,e,data){
return this.dropAllowed
},
onNodeOut:function(n,dd,e,data){
},
onNodeDrop:function(n,dd,e,data){
return false
},
onContainerOver:function(dd,e,data){
return this.dropNotAllowed
},
onContainerDrop:function(dd,e,data){
return false
},
notifyEnter:function(dd,e,data){
return this.dropNotAllowed
},
notifyOver:function(dd,e,data){
var n=this.getTargetFromEvent(e);
if(!n){
if(this.lastOverNode){
this.onNodeOut(this.lastOverNode,dd,e,data);
this.lastOverNode=null
}
return this.onContainerOver(dd,e,data)
}
if(this.lastOverNode!=n){
if(this.lastOverNode){
this.onNodeOut(this.lastOverNode,dd,e,data)
}
this.onNodeEnter(n,dd,e,data);
this.lastOverNode=n
}
return this.onNodeOver(n,dd,e,data)
},
notifyOut:function(dd,e,data){
if(this.lastOverNode){
this.onNodeOut(this.lastOverNode,dd,e,data);
this.lastOverNode=null
}
},
notifyDrop:function(dd,e,data){
if(this.lastOverNode){
this.onNodeOut(this.lastOverNode,dd,e,data);
this.lastOverNode=null
}
var n=this.getTargetFromEvent(e);
return n?this.onNodeDrop(n,dd,e,data):this.onContainerDrop(dd,e,data)
},
triggerCacheRefresh:function(){
Ext.dd.DDM.refreshCache(this.groups)
}
});
Ext.Element.addMethods({
initDD:function(group,config,overrides){
var dd=new Ext.dd.DD(Ext.id(this.dom),group,config);
return Ext.apply(dd,overrides)
},
initDDProxy:function(group,config,overrides){
var dd=new Ext.dd.DDProxy(Ext.id(this.dom),group,config);
return Ext.apply(dd,overrides)
},
initDDTarget:function(group,config,overrides){
var dd=new Ext.dd.DDTarget(Ext.id(this.dom),group,config);
return Ext.apply(dd,overrides)
}
});
Ext.data.JsonWriter=Ext.extend(Ext.data.DataWriter,{
encode:true,
encodeDelete:false,
constructor:function(config){
Ext.data.JsonWriter.superclass.constructor.call(this,config)
},
render:function(params,baseParams,data){
if(this.encode===true){
Ext.apply(params,baseParams);
params[this.meta.root]=Ext.encode(data)
}else{
var jdata=Ext.apply({},baseParams);
jdata[this.meta.root]=data;
params.jsonData=jdata
}
},
createRecord:function(rec){
return this.toHash(rec)
},
updateRecord:function(rec){
return this.toHash(rec)
},
destroyRecord:function(rec){
if(this.encodeDelete){
var data={};
data[this.meta.idProperty]=rec.id;
return data
}else{
return rec.id
}
}
});
Ext.data.JsonReader=function(meta,recordType){
meta=meta||{};
Ext.applyIf(meta,{
idProperty:'id',
successProperty:'success',
totalProperty:'total'
});
Ext.data.JsonReader.superclass.constructor.call(this,meta,recordType||meta.fields)
};
Ext.extend(Ext.data.JsonReader,Ext.data.DataReader,{
read:function(response){
var json=response.responseText;
var o=Ext.decode(json);
if(!o){
throw{message:'JsonReader.read: Json object not found'}
}
return this.readRecords(o)
},
readResponse:function(action,response){
var o=response.responseText!==undefined?Ext.decode(response.responseText):response;
if(!o){
throw new Ext.data.JsonReader.Error('response')
}
var root=this.getRoot(o),success=this.getSuccess(o);
if(success&&action===Ext.data.Api.actions.create){
var def=Ext.isDefined(root);
if(def&&Ext.isEmpty(root)){
throw new Ext.data.JsonReader.Error('root-empty',this.meta.root)
}else if(!def){
throw new Ext.data.JsonReader.Error('root-undefined-response',this.meta.root)
}
}
var res=new Ext.data.Response({
action:action,
success:success,
data:root?this.extractData(root,false):[],
message:this.getMessage(o),
raw:o
});
if(Ext.isEmpty(res.success)){
throw new Ext.data.JsonReader.Error('successProperty-response',this.meta.successProperty)
}
return res
},
readRecords:function(o){
this.jsonData=o;
if(o.metaData){
this.onMetaChange(o.metaData)
}
var s=this.meta,Record=this.recordType,f=Record.prototype.fields,fi=f.items,fl=f.length,v;
var root=this.getRoot(o),c=root.length,totalRecords=c,success=true;
if(s.totalProperty){
v=parseInt(this.getTotal(o),10);
if(!isNaN(v)){
totalRecords=v
}
}
if(s.successProperty){
v=this.getSuccess(o);
if(v===false||v==='false'){
success=false
}
}
return{
success:success,
records:this.extractData(root,true),
totalRecords:totalRecords
}
},
buildExtractors:function(){
if(this.ef){
return
}
var s=this.meta,Record=this.recordType,f=Record.prototype.fields,fi=f.items,fl=f.length;
if(s.totalProperty){
this.getTotal=this.createAccessor(s.totalProperty)
}
if(s.successProperty){
this.getSuccess=this.createAccessor(s.successProperty)
}
if(s.messageProperty){
this.getMessage=this.createAccessor(s.messageProperty)
}
this.getRoot=s.root?this.createAccessor(s.root):function(p){
return p
};
if(s.id||s.idProperty){
var g=this.createAccessor(s.id||s.idProperty);
this.getId=function(rec){
var r=g(rec);
return r===undefined||r===''?null:r
}
}else{
this.getId=function(){
return null
}
}
var ef=[];
for(var i=0;i<fl;i++){
f=fi[i];
var map=f.mapping!==undefined&&f.mapping!==null?f.mapping:f.name;
ef.push(this.createAccessor(map))
}
this.ef=ef
},
simpleAccess:function(obj,subsc){
return obj[subsc]
},
createAccessor:function(){
var re=/[\[\.]/;
return function(expr){
if(Ext.isEmpty(expr)){
return Ext.emptyFn
}
if(Ext.isFunction(expr)){
return expr
}
var i=String(expr).search(re);
if(i>=0){
return new Function('obj','return obj'+(i>0?'.':'')+expr)
}
return function(obj){
return obj[expr]
}
}
}(),
extractValues:function(data,items,len){
var f,values={};
for(var j=0;j<len;j++){
f=items[j];
var v=this.ef[j](data);
values[f.name]=f.convert(v!==undefined?v:f.defaultValue,data)
}
return values
}
});
Ext.data.JsonReader.Error=Ext.extend(Ext.Error,{
constructor:function(message,arg){
this.arg=arg;
Ext.Error.call(this,message)
},
name:'Ext.data.JsonReader'
});
Ext.apply(Ext.data.JsonReader.Error.prototype,{
lang:{
'response':'An error occurred while json-decoding your server response',
'successProperty-response':'Could not locate your "successProperty" in your server response.  Please review your JsonReader config to ensure the config-property "successProperty" matches the property in your server-response.  See the JsonReader docs.',
'root-undefined-config':'Your JsonReader was configured without a "root" property.  Please review your JsonReader config and make sure to define the root property.  See the JsonReader docs.',
'idProperty-undefined':'Your JsonReader was configured without an "idProperty"  Please review your JsonReader configuration and ensure the "idProperty" is set (e.g.: "id").  See the JsonReader docs.',
'root-empty':'Data was expected to be returned by the server in the "root" property of the response.  Please review your JsonReader configuration to ensure the "root" property matches that returned in the server-response.  See JsonReader docs.'
}
});
Ext.data.ArrayReader=Ext.extend(Ext.data.JsonReader,{
readRecords:function(o){
this.arrayData=o;
var s=this.meta,sid=s?Ext.num(s.idIndex,s.id):null,recordType=this.recordType,fields=recordType.prototype.fields,records=[],success=true,v;
var root=this.getRoot(o);
for(var i=0,len=root.length;i<len;i++){
var n=root[i],values={},id=(sid||sid===0)&&n[sid]!==undefined&&n[sid]!==''?n[sid]:null;
for(var j=0,jlen=fields.length;j<jlen;j++){
var f=fields.items[j],k=f.mapping!==undefined&&f.mapping!==null?f.mapping:j;
v=n[k]!==undefined?n[k]:f.defaultValue;
v=f.convert(v,n);
values[f.name]=v
}
var record=new recordType(values,id);
record.json=n;
records[records.length]=record
}
var totalRecords=records.length;
if(s.totalProperty){
v=parseInt(this.getTotal(o),10);
if(!isNaN(v)){
totalRecords=v
}
}
if(s.successProperty){
v=this.getSuccess(o);
if(v===false||v==='false'){
success=false
}
}
return{
success:success,
records:records,
totalRecords:totalRecords
}
}
});
Ext.data.ArrayStore=Ext.extend(Ext.data.Store,{
constructor:function(config){
Ext.data.ArrayStore.superclass.constructor.call(this,Ext.apply(config,{reader:new Ext.data.ArrayReader(config)}))
},
loadData:function(data,append){
if(this.expandData===true){
var r=[];
for(var i=0,len=data.length;i<len;i++){
r[r.length]=[data[i]]
}
data=r
}
Ext.data.ArrayStore.superclass.loadData.call(this,data,append)
}
});
Ext.reg('arraystore',Ext.data.ArrayStore);
Ext.data.SimpleStore=Ext.data.ArrayStore;
Ext.reg('simplestore',Ext.data.SimpleStore);
Ext.data.JsonStore=Ext.extend(Ext.data.Store,{
constructor:function(config){
Ext.data.JsonStore.superclass.constructor.call(this,Ext.apply(config,{reader:new Ext.data.JsonReader(config)}))
}
});
Ext.reg('jsonstore',Ext.data.JsonStore);
Ext.data.GroupingStore=Ext.extend(Ext.data.Store,{
constructor:function(config){
config=config||{};
this.hasMultiSort=true;
this.multiSortInfo=this.multiSortInfo||{sorters:[]};
var sorters=this.multiSortInfo.sorters,groupField=config.groupField||this.groupField,sortInfo=config.sortInfo||this.sortInfo,groupDir=config.groupDir||this.groupDir;
if(groupField){
sorters.push({
field:groupField,
direction:groupDir
})
}
if(sortInfo){
sorters.push(sortInfo)
}
Ext.data.GroupingStore.superclass.constructor.call(this,config);
this.addEvents('groupchange');
this.applyGroupField()
},
remoteGroup:false,
groupOnSort:false,
groupDir:'ASC',
clearGrouping:function(){
this.groupField=false;
if(this.remoteGroup){
if(this.baseParams){
delete this.baseParams.groupBy;
delete this.baseParams.groupDir
}
var lo=this.lastOptions;
if(lo&&lo.params){
delete lo.params.groupBy;
delete lo.params.groupDir
}
this.reload()
}else{
this.sort();
this.fireEvent('datachanged',this)
}
},
groupBy:function(field,forceRegroup,direction){
direction=direction?String(direction).toUpperCase()=='DESC'?'DESC':'ASC':this.groupDir;
if(this.groupField==field&&this.groupDir==direction&&!forceRegroup){
return
}
var sorters=this.multiSortInfo.sorters;
if(sorters.length>0&&sorters[0].field==this.groupField){
sorters.shift()
}
this.groupField=field;
this.groupDir=direction;
this.applyGroupField();
var fireGroupEvent=function(){
this.fireEvent('groupchange',this,this.getGroupState())
};
if(this.groupOnSort){
this.sort(field,direction);
fireGroupEvent.call(this);
return
}
if(this.remoteGroup){
this.on('load',fireGroupEvent,this,{single:true});
this.reload()
}else{
this.sort(sorters);
fireGroupEvent.call(this)
}
},
sort:function(fieldName,dir){
if(this.remoteSort){
return Ext.data.GroupingStore.superclass.sort.call(this,fieldName,dir)
}
var sorters=[];
if(Ext.isArray(arguments[0])){
sorters=arguments[0]
}else if(fieldName==undefined){
sorters=this.sortInfo?[this.sortInfo]:[]
}else{
var field=this.fields.get(fieldName);
if(!field)
return false;
var name=field.name,sortInfo=this.sortInfo||null,sortToggle=this.sortToggle?this.sortToggle[name]:null;
if(!dir){
if(sortInfo&&sortInfo.field==name){
dir=(this.sortToggle[name]||'ASC').toggle('ASC','DESC')
}else{
dir=field.sortDir
}
}
this.sortToggle[name]=dir;
this.sortInfo={
field:name,
direction:dir
};
sorters=[this.sortInfo]
}
if(this.groupField){
sorters.unshift({
direction:this.groupDir,
field:this.groupField
})
}
return this.multiSort.call(this,sorters,dir)
},
applyGroupField:function(){
if(this.remoteGroup){
if(!this.baseParams){
this.baseParams={}
}
Ext.apply(this.baseParams,{
groupBy:this.groupField,
groupDir:this.groupDir
});
var lo=this.lastOptions;
if(lo&&lo.params){
lo.params.groupDir=this.groupDir;
delete lo.params.groupBy
}
}
},
applyGrouping:function(alwaysFireChange){
if(this.groupField!==false){
this.groupBy(this.groupField,true,this.groupDir);
return true
}else{
if(alwaysFireChange===true){
this.fireEvent('datachanged',this)
}
return false
}
},
getGroupState:function(){
return this.groupOnSort&&this.groupField!==false?this.sortInfo?this.sortInfo.field:undefined:this.groupField
}
});
Ext.reg('groupingstore',Ext.data.GroupingStore);
Ext.Resizable=Ext.extend(Ext.util.Observable,{
constructor:function(el,config){
this.el=Ext.get(el);
if(config&&config.wrap){
config.resizeChild=this.el;
this.el=this.el.wrap(typeof config.wrap=='object'?config.wrap:{cls:'xresizable-wrap'});
this.el.id=this.el.dom.id=config.resizeChild.id+'-rzwrap';
this.el.setStyle('overflow','hidden');
this.el.setPositioning(config.resizeChild.getPositioning());
config.resizeChild.clearPositioning();
if(!config.width||!config.height){
var csize=config.resizeChild.getSize();
this.el.setSize(csize.width,csize.height)
}
if(config.pinned&&!config.adjustments){
config.adjustments='auto'
}
}
this.proxy=this.el.createProxy({
tag:'div',
cls:'x-resizable-proxy',
id:this.el.id+'-rzproxy'
},Ext.getBody());
this.proxy.unselectable();
this.proxy.enableDisplayMode('block');
Ext.apply(this,config);
if(this.pinned){
this.disableTrackOver=true;
this.el.addClass('x-resizable-pinned')
}
var position=this.el.getStyle('position');
if(position!='absolute'&&position!='fixed'){
this.el.setStyle('position','relative')
}
if(!this.handles){
this.handles='s,e,se';
if(this.multiDirectional){
this.handles+=',n,w'
}
}
if(this.handles=='all'){
this.handles='n s e w ne nw se sw'
}
var hs=this.handles.split(/\s*?[,;]\s*?| /);
var ps=Ext.Resizable.positions;
for(var i=0,len=hs.length;i<len;i++){
if(hs[i]&&ps[hs[i]]){
var pos=ps[hs[i]];
this[pos]=new Ext.Resizable.Handle(this,pos,this.disableTrackOver,this.transparent,this.handleCls)
}
}
this.corner=this.southeast;
if(this.handles.indexOf('n')!=-1||this.handles.indexOf('w')!=-1){
this.updateBox=true
}
this.activeHandle=null;
if(this.resizeChild){
if(typeof this.resizeChild=='boolean'){
this.resizeChild=Ext.get(this.el.dom.firstChild,true)
}else{
this.resizeChild=Ext.get(this.resizeChild,true)
}
}
if(this.adjustments=='auto'){
var rc=this.resizeChild;
var hw=this.west,he=this.east,hn=this.north,hs=this.south;
if(rc&&(hw||hn)){
rc.position('relative');
rc.setLeft(hw?hw.el.getWidth():0);
rc.setTop(hn?hn.el.getHeight():0)
}
this.adjustments=[
(he?-he.el.getWidth():0)+(hw?-hw.el.getWidth():0),
(hn?-hn.el.getHeight():0)+(hs?-hs.el.getHeight():0)-1
]
}
if(this.draggable){
this.dd=this.dynamic?this.el.initDD(null):this.el.initDDProxy(null,{dragElId:this.proxy.id});
this.dd.setHandleElId(this.resizeChild?this.resizeChild.id:this.el.id);
if(this.constrainTo){
this.dd.constrainTo(this.constrainTo)
}
}
this.addEvents('beforeresize','resize');
if(this.width!==null&&this.height!==null){
this.resizeTo(this.width,this.height)
}else{
this.updateChildSize()
}
if(Ext.isIE){
this.el.dom.style.zoom=1
}
Ext.Resizable.superclass.constructor.call(this)
},
adjustments:[
0,
0
],
animate:false,
disableTrackOver:false,
draggable:false,
duration:0.35,
dynamic:false,
easing:'easeOutStrong',
enabled:true,
handles:false,
multiDirectional:false,
height:null,
width:null,
heightIncrement:0,
widthIncrement:0,
minHeight:5,
minWidth:5,
maxHeight:10000,
maxWidth:10000,
minX:0,
minY:0,
pinned:false,
preserveRatio:false,
resizeChild:false,
transparent:false,
resizeTo:function(width,height){
this.el.setSize(width,height);
this.updateChildSize();
this.fireEvent('resize',this,width,height,null)
},
startSizing:function(e,handle){
this.fireEvent('beforeresize',this,e);
if(this.enabled){
if(!this.overlay){
this.overlay=this.el.createProxy({
tag:'div',
cls:'x-resizable-overlay',
html:'&#160;'
},Ext.getBody());
this.overlay.unselectable();
this.overlay.enableDisplayMode('block');
this.overlay.on({
scope:this,
mousemove:this.onMouseMove,
mouseup:this.onMouseUp
})
}
this.overlay.setStyle('cursor',handle.el.getStyle('cursor'));
this.resizing=true;
this.startBox=this.el.getBox();
this.startPoint=e.getXY();
this.offsets=[
this.startBox.x+this.startBox.width-this.startPoint[0],
this.startBox.y+this.startBox.height-this.startPoint[1]
];
this.overlay.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true));
this.overlay.show();
if(this.constrainTo){
var ct=Ext.get(this.constrainTo);
this.resizeRegion=ct.getRegion().adjust(ct.getFrameWidth('t'),ct.getFrameWidth('l'),-ct.getFrameWidth('b'),-ct.getFrameWidth('r'))
}
this.proxy.setStyle('visibility','hidden');
this.proxy.show();
this.proxy.setBox(this.startBox);
if(!this.dynamic){
this.proxy.setStyle('visibility','visible')
}
}
},
onMouseDown:function(handle,e){
if(this.enabled){
e.stopEvent();
this.activeHandle=handle;
this.startSizing(e,handle)
}
},
onMouseUp:function(e){
this.activeHandle=null;
var size=this.resizeElement();
this.resizing=false;
this.handleOut();
this.overlay.hide();
this.proxy.hide();
this.fireEvent('resize',this,size.width,size.height,e)
},
updateChildSize:function(){
if(this.resizeChild){
var el=this.el;
var child=this.resizeChild;
var adj=this.adjustments;
if(el.dom.offsetWidth){
var b=el.getSize(true);
child.setSize(b.width+adj[0],b.height+adj[1])
}
if(Ext.isIE){
setTimeout(function(){
if(el.dom.offsetWidth){
var b=el.getSize(true);
child.setSize(b.width+adj[0],b.height+adj[1])
}
},10)
}
}
},
snap:function(value,inc,min){
if(!inc||!value){
return value
}
var newValue=value;
var m=value%inc;
if(m>0){
if(m>inc/2){
newValue=value+(inc-m)
}else{
newValue=value-m
}
}
return Math.max(min,newValue)
},
resizeElement:function(){
var box=this.proxy.getBox();
if(this.updateBox){
this.el.setBox(box,false,this.animate,this.duration,null,this.easing)
}else{
this.el.setSize(box.width,box.height,this.animate,this.duration,null,this.easing)
}
this.updateChildSize();
if(!this.dynamic){
this.proxy.hide()
}
if(this.draggable&&this.constrainTo){
this.dd.resetConstraints();
this.dd.constrainTo(this.constrainTo)
}
return box
},
constrain:function(v,diff,m,mx){
if(v-diff<m){
diff=v-m
}else if(v-diff>mx){
diff=v-mx
}
return diff
},
onMouseMove:function(e){
if(this.enabled&&this.activeHandle){
try{
if(this.resizeRegion&&!this.resizeRegion.contains(e.getPoint())){
return
}
var curSize=this.curSize||this.startBox,x=this.startBox.x,y=this.startBox.y,ox=x,oy=y,w=curSize.width,h=curSize.height,ow=w,oh=h,mw=this.minWidth,mh=this.minHeight,mxw=this.maxWidth,mxh=this.maxHeight,wi=this.widthIncrement,hi=this.heightIncrement,eventXY=e.getXY(),diffX=-(this.startPoint[0]-Math.max(this.minX,eventXY[0])),diffY=-(this.startPoint[1]-Math.max(this.minY,eventXY[1])),pos=this.activeHandle.position,tw,th;
switch(pos){
case'east':
w+=diffX;
w=Math.min(Math.max(mw,w),mxw);
break;
case'south':
h+=diffY;
h=Math.min(Math.max(mh,h),mxh);
break;
case'southeast':
w+=diffX;
h+=diffY;
w=Math.min(Math.max(mw,w),mxw);
h=Math.min(Math.max(mh,h),mxh);
break;
case'north':
diffY=this.constrain(h,diffY,mh,mxh);
y+=diffY;
h-=diffY;
break;
case'west':
diffX=this.constrain(w,diffX,mw,mxw);
x+=diffX;
w-=diffX;
break;
case'northeast':
w+=diffX;
w=Math.min(Math.max(mw,w),mxw);
diffY=this.constrain(h,diffY,mh,mxh);
y+=diffY;
h-=diffY;
break;
case'northwest':
diffX=this.constrain(w,diffX,mw,mxw);
diffY=this.constrain(h,diffY,mh,mxh);
y+=diffY;
h-=diffY;
x+=diffX;
w-=diffX;
break;
case'southwest':
diffX=this.constrain(w,diffX,mw,mxw);
h+=diffY;
h=Math.min(Math.max(mh,h),mxh);
x+=diffX;
w-=diffX;
break
}
var sw=this.snap(w,wi,mw);
var sh=this.snap(h,hi,mh);
if(sw!=w||sh!=h){
switch(pos){
case'northeast':
y-=sh-h;
break;
case'north':
y-=sh-h;
break;
case'southwest':
x-=sw-w;
break;
case'west':
x-=sw-w;
break;
case'northwest':
x-=sw-w;
y-=sh-h;
break
}
w=sw;
h=sh
}
if(this.preserveRatio){
switch(pos){
case'southeast':
case'east':
h=oh*(w/ow);
h=Math.min(Math.max(mh,h),mxh);
w=ow*(h/oh);
break;
case'south':
w=ow*(h/oh);
w=Math.min(Math.max(mw,w),mxw);
h=oh*(w/ow);
break;
case'northeast':
w=ow*(h/oh);
w=Math.min(Math.max(mw,w),mxw);
h=oh*(w/ow);
break;
case'north':
tw=w;
w=ow*(h/oh);
w=Math.min(Math.max(mw,w),mxw);
h=oh*(w/ow);
x+=(tw-w)/2;
break;
case'southwest':
h=oh*(w/ow);
h=Math.min(Math.max(mh,h),mxh);
tw=w;
w=ow*(h/oh);
x+=tw-w;
break;
case'west':
th=h;
h=oh*(w/ow);
h=Math.min(Math.max(mh,h),mxh);
y+=(th-h)/2;
tw=w;
w=ow*(h/oh);
x+=tw-w;
break;
case'northwest':
tw=w;
th=h;
h=oh*(w/ow);
h=Math.min(Math.max(mh,h),mxh);
w=ow*(h/oh);
y+=th-h;
x+=tw-w;
break
}
}
this.proxy.setBounds(x,y,w,h);
if(this.dynamic){
this.resizeElement()
}
}catch(ex){
}
}
},
handleOver:function(){
if(this.enabled){
this.el.addClass('x-resizable-over')
}
},
handleOut:function(){
if(!this.resizing){
this.el.removeClass('x-resizable-over')
}
},
getEl:function(){
return this.el
},
getResizeChild:function(){
return this.resizeChild
},
destroy:function(removeEl){
Ext.destroy(this.dd,this.overlay,this.proxy);
this.overlay=null;
this.proxy=null;
var ps=Ext.Resizable.positions;
for(var k in ps){
if(typeof ps[k]!='function'&&this[ps[k]]){
this[ps[k]].destroy()
}
}
if(removeEl){
this.el.update('');
Ext.destroy(this.el);
this.el=null
}
this.purgeListeners()
},
syncHandleHeight:function(){
var h=this.el.getHeight(true);
if(this.west){
this.west.el.setHeight(h)
}
if(this.east){
this.east.el.setHeight(h)
}
}
});
Ext.Resizable.positions={
n:'north',
s:'south',
e:'east',
w:'west',
se:'southeast',
sw:'southwest',
nw:'northwest',
ne:'northeast'
};
Ext.Resizable.Handle=Ext.extend(Object,{
constructor:function(rz,pos,disableTrackOver,transparent,cls){
if(!this.tpl){
var tpl=Ext.DomHelper.createTemplate({
tag:'div',
cls:'x-resizable-handle x-resizable-handle-{0}'
});
tpl.compile();
Ext.Resizable.Handle.prototype.tpl=tpl
}
this.position=pos;
this.rz=rz;
this.el=this.tpl.append(rz.el.dom,[this.position],true);
this.el.unselectable();
if(transparent){
this.el.setOpacity(0)
}
if(!Ext.isEmpty(cls)){
this.el.addClass(cls)
}
this.el.on('mousedown',this.onMouseDown,this);
if(!disableTrackOver){
this.el.on({
scope:this,
mouseover:this.onMouseOver,
mouseout:this.onMouseOut
})
}
},
afterResize:function(rz){
},
onMouseDown:function(e){
this.rz.onMouseDown(this,e)
},
onMouseOver:function(e){
this.rz.handleOver(this,e)
},
onMouseOut:function(e){
this.rz.handleOut(this,e)
},
destroy:function(){
Ext.destroy(this.el);
this.el=null
}
});
Ext.Window=Ext.extend(Ext.Panel,{
baseCls:'x-window',
resizable:true,
draggable:true,
closable:true,
closeAction:'close',
constrain:false,
constrainHeader:false,
plain:false,
minimizable:false,
maximizable:false,
minHeight:320,
minWidth:480,
expandOnShow:true,
showAnimDuration:0.25,
hideAnimDuration:0.25,
collapsible:false,
initHidden:undefined,
hidden:true,
elements:'header,body',
frame:true,
floating:true,
initComponent:function(){
this.initTools();
Ext.Window.superclass.initComponent.call(this);
this.addEvents('resize','maximize','minimize','restore');
if(Ext.isDefined(this.initHidden)){
this.hidden=this.initHidden
}
if(this.hidden===false){
this.hidden=true;
this.show()
}
},
getState:function(){
return Ext.apply(Ext.Window.superclass.getState.call(this)||{},this.getBox(true))
},
onRender:function(ct,position){
Ext.Window.superclass.onRender.call(this,ct,position);
if(this.plain){
this.el.addClass('x-window-plain')
}
this.focusEl=this.el.createChild({
tag:'a',
href:'#',
cls:'x-dlg-focus',
tabIndex:'-1',
html:'&#160;'
});
this.focusEl.swallowEvent('click',true);
this.proxy=this.el.createProxy('x-window-proxy');
this.proxy.enableDisplayMode('block');
if(this.modal){
this.mask=this.container.createChild({cls:'ext-el-mask'},this.el.dom);
this.mask.enableDisplayMode('block');
this.mask.hide();
this.mon(this.mask,'click',this.focus,this)
}
if(this.maximizable){
this.mon(this.header,'dblclick',this.toggleMaximize,this)
}
},
initEvents:function(){
Ext.Window.superclass.initEvents.call(this);
if(this.animateTarget){
this.setAnimateTarget(this.animateTarget)
}
if(this.resizable){
this.resizer=new Ext.Resizable(this.el,{
minWidth:this.minWidth,
minHeight:this.minHeight,
handles:this.resizeHandles||'all',
pinned:true,
resizeElement:this.resizerAction,
handleCls:'x-window-handle'
});
this.resizer.window=this;
this.mon(this.resizer,'beforeresize',this.beforeResize,this)
}
if(this.draggable){
this.header.addClass('x-window-draggable')
}
this.mon(this.el,'mousedown',this.toFront,this);
this.manager=this.manager||Ext.WindowMgr;
this.manager.register(this);
if(this.maximized){
this.maximized=false;
this.maximize()
}
if(this.closable){
var km=this.getKeyMap();
km.on(27,this.onEsc,this);
km.disable()
}
},
initDraggable:function(){
this.dd=new Ext.Window.DD(this)
},
onEsc:function(k,e){
if(this.activeGhost){
this.unghost()
}
e.stopEvent();
this[this.closeAction]()
},
beforeDestroy:function(){
if(this.rendered){
this.hide();
this.clearAnchor();
Ext.destroy(this.focusEl,this.resizer,this.dd,this.proxy,this.mask)
}
Ext.Window.superclass.beforeDestroy.call(this)
},
onDestroy:function(){
if(this.manager){
this.manager.unregister(this)
}
Ext.Window.superclass.onDestroy.call(this)
},
initTools:function(){
if(this.minimizable){
this.addTool({
id:'minimize',
handler:this.minimize.createDelegate(this,[])
})
}
if(this.maximizable){
this.addTool({
id:'maximize',
handler:this.maximize.createDelegate(this,[])
});
this.addTool({
id:'restore',
handler:this.restore.createDelegate(this,[]),
hidden:true
})
}
if(this.closable){
this.addTool({
id:'close',
handler:this[this.closeAction].createDelegate(this,[])
})
}
},
resizerAction:function(){
var box=this.proxy.getBox();
this.proxy.hide();
this.window.handleResize(box);
return box
},
beforeResize:function(){
this.resizer.minHeight=Math.max(this.minHeight,this.getFrameHeight()+40);
this.resizer.minWidth=Math.max(this.minWidth,this.getFrameWidth()+40);
this.resizeBox=this.el.getBox()
},
updateHandles:function(){
if(Ext.isIE&&this.resizer){
this.resizer.syncHandleHeight();
this.el.repaint()
}
},
handleResize:function(box){
var rz=this.resizeBox;
if(rz.x!=box.x||rz.y!=box.y){
this.updateBox(box)
}else{
this.setSize(box);
if(Ext.isIE6&&Ext.isStrict){
this.doLayout()
}
}
this.focus();
this.updateHandles();
this.saveState()
},
focus:function(){
var f=this.focusEl,db=this.defaultButton,t=typeof db,el,ct;
if(Ext.isDefined(db)){
if(Ext.isNumber(db)&&this.fbar){
f=this.fbar.items.get(db)
}else if(Ext.isString(db)){
f=Ext.getCmp(db)
}else{
f=db
}
el=f.getEl();
ct=Ext.getDom(this.container);
if(el&&ct){
if(ct!=document.body&&!Ext.lib.Region.getRegion(ct).contains(Ext.lib.Region.getRegion(el.dom))){
return
}
}
}
f=f||this.focusEl;
f.focus.defer(10,f)
},
setAnimateTarget:function(el){
el=Ext.get(el);
this.animateTarget=el
},
beforeShow:function(){
delete this.el.lastXY;
delete this.el.lastLT;
if(this.x===undefined||this.y===undefined){
var xy=this.el.getAlignToXY(this.container,'c-c');
var pos=this.el.translatePoints(xy[0],xy[1]);
this.x=this.x===undefined?pos.left:this.x;
this.y=this.y===undefined?pos.top:this.y
}
this.el.setLeftTop(this.x,this.y);
if(this.expandOnShow){
this.expand(false)
}
if(this.modal){
Ext.getBody().addClass('x-body-masked');
this.mask.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true));
this.mask.show()
}
},
show:function(animateTarget,cb,scope){
if(!this.rendered){
this.render(Ext.getBody())
}
if(this.hidden===false){
this.toFront();
return this
}
if(this.fireEvent('beforeshow',this)===false){
return this
}
if(cb){
this.on('show',cb,scope,{single:true})
}
this.hidden=false;
if(Ext.isDefined(animateTarget)){
this.setAnimateTarget(animateTarget)
}
this.beforeShow();
if(this.animateTarget){
this.animShow()
}else{
this.afterShow()
}
return this
},
afterShow:function(isAnim){
if(this.isDestroyed){
return false
}
this.proxy.hide();
this.el.show();
if(this.maximized){
this.fitContainer()
}
if(Ext.isMac&&Ext.isGecko2){
this.cascade(this.setAutoScroll)
}
if(this.monitorResize||this.modal||this.constrain||this.constrainHeader){
Ext.EventManager.onWindowResize(this.onWindowResize,this)
}
this.doConstrain();
this.doLayout();
if(this.keyMap){
this.keyMap.enable()
}
this.toFront();
this.fitToContent();
this.updateHandles();
if(isAnim&&(Ext.isIE||Ext.isWebKit)){
var sz=this.getSize();
this.onResize(sz.width,sz.height)
}
this.onShow();
this.fireEvent('show',this)
},
animShow:function(){
this.proxy.show();
this.proxy.setBox(this.animateTarget.getBox());
this.proxy.setOpacity(0);
var b=this.getBox();
this.el.setStyle('display','none');
this.proxy.shift(Ext.apply(b,{
callback:this.afterShow.createDelegate(this,[true],false),
scope:this,
easing:'easeNone',
duration:this.showAnimDuration,
opacity:0.5
}))
},
hide:function(animateTarget,cb,scope){
if(this.hidden||this.fireEvent('beforehide',this)===false){
return this
}
if(cb){
this.on('hide',cb,scope,{single:true})
}
this.hidden=true;
if(animateTarget!==undefined){
this.setAnimateTarget(animateTarget)
}
if(this.modal){
this.mask.hide();
Ext.getBody().removeClass('x-body-masked')
}
if(this.animateTarget){
this.animHide()
}else{
this.el.hide();
this.afterHide()
}
return this
},
afterHide:function(){
this.proxy.hide();
if(this.monitorResize||this.modal||this.constrain||this.constrainHeader){
Ext.EventManager.removeResizeListener(this.onWindowResize,this)
}
if(this.keyMap){
this.keyMap.disable()
}
this.onHide();
this.fireEvent('hide',this)
},
animHide:function(){
this.proxy.setOpacity(0.5);
this.proxy.show();
var tb=this.getBox(false);
this.proxy.setBox(tb);
this.el.hide();
this.proxy.shift(Ext.apply(this.animateTarget.getBox(),{
callback:this.afterHide,
scope:this,
duration:this.hideAnimDuration,
easing:'easeNone',
opacity:0
}))
},
onShow:Ext.emptyFn,
onHide:Ext.emptyFn,
onWindowResize:function(){
if(this.maximized){
this.fitContainer()
}
if(this.modal){
this.mask.setSize('100%','100%');
var force=this.mask.dom.offsetHeight;
this.mask.setSize(Ext.lib.Dom.getViewWidth(true),Ext.lib.Dom.getViewHeight(true))
}
this.doConstrain()
},
doConstrain:function(){
if(this.constrain||this.constrainHeader){
var offsets;
if(this.constrain){
offsets={
right:this.el.shadowOffset,
left:this.el.shadowOffset,
bottom:this.el.shadowOffset
}
}else{
var s=this.getSize();
offsets={
right:-(s.width-100),
bottom:-(s.height-25+this.el.getConstrainOffset())
}
}
var xy=this.el.getConstrainToXY(this.container,true,offsets);
if(xy){
this.setPosition(xy[0],xy[1])
}
}
},
ghost:function(cls){
var ghost=this.createGhost(cls);
var box=this.getBox(true);
ghost.setLeftTop(box.x,box.y);
ghost.setWidth(box.width);
this.el.hide();
this.activeGhost=ghost;
return ghost
},
unghost:function(show,matchPosition){
if(!this.activeGhost){
return
}
if(show!==false){
this.el.show();
this.focus.defer(10,this);
if(Ext.isMac&&Ext.isGecko2){
this.cascade(this.setAutoScroll)
}
}
if(matchPosition!==false){
this.setPosition(this.activeGhost.getLeft(true),this.activeGhost.getTop(true))
}
this.activeGhost.hide();
this.activeGhost.remove();
delete this.activeGhost
},
minimize:function(){
this.fireEvent('minimize',this);
return this
},
close:function(){
if(this.fireEvent('beforeclose',this)!==false){
if(this.hidden){
this.doClose()
}else{
this.hide(null,this.doClose,this)
}
}
},
doClose:function(){
this.fireEvent('close',this);
this.destroy()
},
maximize:function(){
if(!this.maximized){
this.expand(false);
this.restoreSize=this.getSize();
this.restorePos=this.getPosition(true);
if(this.maximizable){
this.tools.maximize.hide();
this.tools.restore.show()
}
this.maximized=true;
this.el.disableShadow();
if(this.dd){
this.dd.lock()
}
if(this.collapsible){
this.tools.toggle.hide()
}
this.el.addClass('x-window-maximized');
this.container.addClass('x-window-maximized-ct');
this.setPosition(0,0);
this.fitContainer();
this.fireEvent('maximize',this)
}
return this
},
restore:function(){
if(this.maximized){
var t=this.tools;
this.el.removeClass('x-window-maximized');
if(t.restore){
t.restore.hide()
}
if(t.maximize){
t.maximize.show()
}
this.setPosition(this.restorePos[0],this.restorePos[1]);
this.setSize(this.restoreSize.width,this.restoreSize.height);
delete this.restorePos;
delete this.restoreSize;
this.maximized=false;
this.el.enableShadow(true);
if(this.dd){
this.dd.unlock()
}
if(this.collapsible&&t.toggle){
t.toggle.show()
}
this.container.removeClass('x-window-maximized-ct');
this.doConstrain();
this.fireEvent('restore',this)
}
return this
},
toggleMaximize:function(){
return this[this.maximized?'restore':'maximize']()
},
fitContainer:function(){
var vs=this.container.getViewSize(false);
this.setSize(vs.width,vs.height)
},
setZIndex:function(index){
if(this.modal){
this.mask.setStyle('z-index',index)
}
this.el.setZIndex(++index);
index+=5;
if(this.resizer){
this.resizer.proxy.setStyle('z-index',++index)
}
this.lastZIndex=index
},
alignTo:function(element,position,offsets){
var xy=this.el.getAlignToXY(element,position,offsets);
this.setPagePosition(xy[0],xy[1]);
return this
},
anchorTo:function(el,alignment,offsets,monitorScroll){
this.clearAnchor();
this.anchorTarget={
el:el,
alignment:alignment,
offsets:offsets
};
Ext.EventManager.onWindowResize(this.doAnchor,this);
var tm=typeof monitorScroll;
if(tm!='undefined'){
Ext.EventManager.on(window,'scroll',this.doAnchor,this,{buffer:tm=='number'?monitorScroll:50})
}
return this.doAnchor()
},
doAnchor:function(){
var o=this.anchorTarget;
this.alignTo(o.el,o.alignment,o.offsets);
return this
},
clearAnchor:function(){
if(this.anchorTarget){
Ext.EventManager.removeResizeListener(this.doAnchor,this);
Ext.EventManager.un(window,'scroll',this.doAnchor,this);
delete this.anchorTarget
}
return this
},
toFront:function(e){
if(this.manager.bringToFront(this)){
if(!e||!e.getTarget().focus){
this.focus()
}
}
return this
},
setActive:function(active){
if(active){
if(!this.maximized){
this.el.enableShadow(true)
}
this.fireEvent('activate',this)
}else{
this.el.disableShadow();
this.fireEvent('deactivate',this)
}
},
toBack:function(){
this.manager.sendToBack(this);
return this
},
center:function(){
var xy=this.el.getAlignToXY(this.container,'c-c');
this.setPagePosition(xy[0],xy[1]);
return this
},
fitToContent:function(){
var d=this,dom=d.getEl().dom,minWidth=dom.style.minWidth,width=dom.style.width;
dom.style.minWidth=width;
dom.style.removeProperty('width');
var headerWidth=Math.max(dom.scrollWidth,parseInt(width,10)||0,parseInt(minWidth,10)||0);
dom.style.minWidth=minWidth;
dom.style.width=width;
width=d.getWidth();
var scrollWidth=Math.max(headerWidth,d.body.dom.scrollWidth,d.fbar&&d.fbar.getEl().dom.scrollWidth+d.footer.getPadding('lr')||0);
if(width!==scrollWidth){
var isAlreadyAtCenter=d.el.getAlignToXY(d.container,'c-c')[0]===d.getPosition()[0];
d.setSize(scrollWidth);
if(isAlreadyAtCenter){
d.center()
}
}
}
});
Ext.reg('window',Ext.Window);
Ext.Window.DD=Ext.extend(Ext.dd.DD,{
constructor:function(win){
this.win=win;
Ext.Window.DD.superclass.constructor.call(this,win.el.id,'WindowDD-'+win.id);
this.setHandleElId(win.header.id);
this.scroll=false
},
moveOnly:true,
headerOffsets:[
100,
25
],
startDrag:function(){
var w=this.win;
this.proxy=w.ghost(w.initialConfig.cls);
if(w.constrain!==false){
var so=w.el.shadowOffset;
this.constrainTo(w.container,{
right:so,
left:so,
bottom:so
})
}else if(w.constrainHeader!==false){
var s=this.proxy.getSize();
this.constrainTo(w.container,{
right:-(s.width-this.headerOffsets[0]),
bottom:-(s.height-this.headerOffsets[1])
})
}
},
b4Drag:Ext.emptyFn,
onDrag:function(e){
this.alignElWithMouse(this.proxy,e.getPageX(),e.getPageY())
},
endDrag:function(e){
this.win.unghost();
this.win.saveState()
}
});
Ext.WindowGroup=function(){
var list={};
var accessList=[];
var front=null;
var sortWindows=function(d1,d2){
return!d1._lastAccess||d1._lastAccess<d2._lastAccess?-1:1
};
var orderWindows=function(){
var a=accessList,len=a.length;
if(len>0){
a.sort(sortWindows);
var seed=a[0].manager.zseed;
for(var i=0;i<len;i++){
var win=a[i];
if(win&&!win.hidden){
win.setZIndex(seed+i*10)
}
}
}
activateLast()
};
var setActiveWin=function(win){
if(win!=front){
if(front){
front.setActive(false)
}
front=win;
if(win){
win.setActive(true)
}
}
};
var activateLast=function(){
for(var i=accessList.length-1;i>=0;--i){
if(!accessList[i].hidden){
setActiveWin(accessList[i]);
return
}
}
setActiveWin(null)
};
return{
zseed:9000,
register:function(win){
if(win.manager){
win.manager.unregister(win)
}
win.manager=this;
list[win.id]=win;
accessList.push(win);
win.on('hide',activateLast)
},
unregister:function(win){
delete win.manager;
delete list[win.id];
win.un('hide',activateLast);
accessList.remove(win)
},
get:function(id){
return typeof id=='object'?id:list[id]
},
bringToFront:function(win){
win=this.get(win);
if(win!=front){
win._lastAccess=new Date().getTime();
orderWindows();
return true
}
return false
},
sendToBack:function(win){
win=this.get(win);
win._lastAccess=-new Date().getTime();
orderWindows();
return win
},
hideAll:function(){
for(var id in list){
if(list[id]&&typeof list[id]!='function'&&list[id].isVisible()){
list[id].hide()
}
}
},
getActive:function(){
return front
},
getBy:function(fn,scope){
var r=[];
for(var i=accessList.length-1;i>=0;--i){
var win=accessList[i];
if(fn.call(scope||win,win)!==false){
r.push(win)
}
}
return r
},
each:function(fn,scope){
for(var id in list){
if(list[id]&&typeof list[id]!='function'){
if(fn.call(scope||list[id],list[id])===false){
return
}
}
}
}
}
};
Ext.WindowMgr=new Ext.WindowGroup;
Ext.MessageBox=function(){
var dlg,opt,mask,waitTimer,bodyEl,msgEl,textboxEl,textareaEl,progressBar,pp,iconEl,spacerEl,buttons,activeTextEl,bwidth,bufferIcon='',iconCls='',buttonNames=[
'cancel',
'no',
'ok',
'yes'
];
var handleButton=function(button){
buttons[button].blur();
if(dlg.isVisible()){
dlg.hide();
handleHide();
Ext.callback(opt.fn,opt.scope||window,[
button,
activeTextEl.dom.value,
opt
],1)
}
};
var handleHide=function(){
if(opt&&opt.cls){
dlg.el.removeClass(opt.cls)
}
progressBar.reset()
};
var handleEsc=function(d,k,e){
if(opt&&opt.closable!==false){
dlg.hide();
handleHide()
}
if(e){
e.stopEvent()
}
};
var updateButtons=function(b){
var width=0,cfg;
if(!b){
Ext.each(buttonNames,function(name){
buttons[name].hide()
});
return width
}
dlg.footer.dom.style.display='';
var visibleButtons=[];
Ext.iterate(buttons,function(name,btn){
cfg=b[name];
if(cfg){
btn.show();
btn.setText(Ext.isString(cfg)?cfg:Ext.MessageBox.buttonText[name]);
width+=btn.getEl().getWidth()+15;
visibleButtons.push(btn)
}else{
btn.hide()
}
});
var length=visibleButtons.length;
if(length){
addBtnStyle(visibleButtons[length-1],'primary');
if(length>1){
addBtnStyle(visibleButtons[0],'secondary')
}
if(length>2){
addBtnStyle(visibleButtons[1],'tertiary')
}
}
return width
};
function addBtnStyle(btn,styleType){
[
'primary',
'secondary',
'tertiary'
].forEach(function(cls){
if(cls===styleType){
btn.addClass('x-btn-'+cls)
}else{
btn.removeClass('x-btn-'+cls)
}
})
}
return{
getDialog:function(titleText){
if(!dlg){
var btns=[];
buttons={};
Ext.each(buttonNames,function(name){
btns.push(buttons[name]=new Ext.Button({
text:this.buttonText[name],
handler:handleButton.createCallback(name)
}))
},this);
dlg=new Ext.Window({
autoCreate:true,
title:titleText,
resizable:false,
constrain:true,
constrainHeader:true,
minimizable:false,
maximizable:false,
stateful:false,
modal:true,
shim:true,
buttonAlign:'right',
width:this.width,
height:this.height,
plain:true,
footer:true,
closable:true,
close:function(){
if(opt&&opt.buttons&&opt.buttons.no&&!opt.buttons.cancel){
handleButton('no')
}else{
handleButton('cancel')
}
},
fbar:new Ext.Toolbar({
items:btns,
enableOverflow:false
})
});
dlg.render(document.body);
dlg.getEl().addClass('x-window-dlg');
mask=dlg.mask;
bodyEl=dlg.body.createChild({html:'<div class="ext-mb-icon"></div><div class="ext-mb-content"><span class="ext-mb-text"></span><br /><div class="ext-mb-fix-cursor"><input type="text" class="ext-mb-input" /><textarea class="ext-mb-textarea"></textarea></div></div>'});
iconEl=Ext.get(bodyEl.dom.firstChild);
var contentEl=bodyEl.dom.childNodes[1];
msgEl=Ext.get(contentEl.firstChild);
textboxEl=Ext.get(contentEl.childNodes[2].firstChild);
textboxEl.enableDisplayMode();
textboxEl.addKeyListener([
10,
13
],function(){
if(dlg.isVisible()&&opt&&opt.buttons){
if(opt.buttons.ok){
handleButton('ok')
}else if(opt.buttons.yes){
handleButton('yes')
}
}
});
textareaEl=Ext.get(contentEl.childNodes[2].childNodes[1]);
textareaEl.enableDisplayMode();
progressBar=new Ext.ProgressBar({renderTo:bodyEl});
bodyEl.createChild({cls:'x-clear'})
}
return dlg
},
updateText:function(text){
var w=Math.max(Math.min(opt.width||this.width,opt.maxWidth||this.maxWidth),opt.minWidth||this.minWidth,bwidth||0);
msgEl.update(text||'&#160;');
dlg.setSize(w).center();
return this
},
updateProgress:function(value,progressText,msg){
progressBar.updateProgress(value,progressText);
if(msg){
this.updateText(msg)
}
return this
},
isVisible:function(){
return dlg&&dlg.isVisible()
},
hide:function(){
var proxy=dlg?dlg.activeGhost:null;
if(this.isVisible()||proxy){
dlg.hide();
handleHide();
if(proxy){
dlg.unghost(false,false)
}
}
return this
},
show:function(options){
if(this.isVisible()){
this.hide()
}
opt=options;
var d=this.getDialog(opt.title||'&#160;');
d.setTitle(opt.title||'&#160;');
var allowClose=opt.closable!==false&&opt.progress!==true&&opt.wait!==true;
d.tools.close.setDisplayed(allowClose);
activeTextEl=textboxEl;
opt.prompt=opt.prompt||(opt.multiline?true:false);
if(opt.prompt){
if(opt.multiline){
textboxEl.hide();
textareaEl.show();
textareaEl.setHeight(Ext.isNumber(opt.multiline)?opt.multiline:this.defaultTextHeight);
activeTextEl=textareaEl
}else{
textboxEl.show();
textareaEl.hide()
}
}else{
textboxEl.hide();
textareaEl.hide()
}
activeTextEl.dom.value=opt.value||'';
if(opt.prompt){
d.focusEl=activeTextEl
}else{
var bs=opt.buttons;
var db=null;
if(bs&&bs.ok){
db=buttons['ok']
}else if(bs&&bs.yes){
db=buttons['yes']
}
if(db){
d.focusEl=db
}
}
d.setIconClass(opt.iconCls||'');
this.setIcon(Ext.isDefined(opt.icon)?opt.icon:bufferIcon);
bwidth=updateButtons(opt.buttons);
progressBar.setVisible(opt.progress===true||opt.wait===true);
this.updateProgress(0,opt.progressText);
this.updateText(opt.msg);
if(opt.cls){
d.el.addClass(opt.cls)
}
d.proxyDrag=opt.proxyDrag===true;
d.modal=opt.modal!==false;
d.mask=opt.modal!==false?mask:false;
if(!d.isVisible()){
document.body.appendChild(dlg.el.dom);
d.setAnimateTarget(opt.animEl);
d.on('show',function(){
if(allowClose===true){
d.keyMap.enable()
}else{
d.keyMap.disable()
}
},this,{single:true});
d.show(opt.animEl)
}
if(opt.wait===true){
progressBar.wait(opt.waitConfig)
}
return this
},
setIcon:function(icon){
if(!dlg){
bufferIcon=icon;
return
}
bufferIcon=undefined;
if(icon&&icon!=''){
iconEl.removeClass('x-hidden');
iconEl.replaceClass(iconCls,icon);
bodyEl.addClass('x-dlg-icon');
iconCls=icon
}else{
iconEl.replaceClass(iconCls,'x-hidden');
bodyEl.removeClass('x-dlg-icon');
iconCls=''
}
return this
},
progress:function(title,msg,progressText){
this.show({
title:title,
msg:msg,
buttons:false,
progress:true,
closable:false,
minWidth:this.minProgressWidth,
progressText:progressText
});
return this
},
wait:function(msg,title,config){
this.show({
title:title,
msg:msg,
buttons:false,
closable:false,
wait:true,
modal:true,
minWidth:this.minProgressWidth,
waitConfig:config
});
return this
},
alert:function(title,msg,fn,scope){
this.show({
title:title,
msg:msg,
buttons:this.OK,
fn:fn,
scope:scope,
minWidth:this.minWidth
});
return this
},
confirm:function(title,msg,fn,scope){
this.show({
title:title,
msg:msg,
buttons:this.YESNO,
fn:fn,
scope:scope,
icon:this.QUESTION,
minWidth:this.minWidth
});
return this
},
prompt:function(title,msg,fn,scope,multiline,value){
this.show({
title:title,
msg:msg,
buttons:this.OKCANCEL,
fn:fn,
minWidth:this.minPromptWidth,
scope:scope,
prompt:true,
multiline:multiline,
value:value
});
return this
},
OK:{ok:true},
CANCEL:{cancel:true},
OKCANCEL:{
ok:true,
cancel:true
},
YESNO:{
yes:true,
no:true
},
YESNOCANCEL:{
yes:true,
no:true,
cancel:true
},
INFO:'ext-mb-info',
WARNING:'ext-mb-warning',
QUESTION:'ext-mb-question',
ERROR:'ext-mb-error',
defaultTextHeight:75,
maxWidth:600,
minWidth:100,
width:480,
height:320,
minProgressWidth:250,
minPromptWidth:250,
buttonText:{
ok:'OK',
cancel:'Cancel',
yes:'Yes',
no:'No'
}
}
}();
Ext.Msg=Ext.MessageBox;
Ext.dd.PanelProxy=Ext.extend(Object,{
constructor:function(panel,config){
this.panel=panel;
this.id=this.panel.id+'-ddproxy';
Ext.apply(this,config)
},
insertProxy:true,
setStatus:Ext.emptyFn,
reset:Ext.emptyFn,
update:Ext.emptyFn,
stop:Ext.emptyFn,
sync:Ext.emptyFn,
getEl:function(){
return this.ghost
},
getGhost:function(){
return this.ghost
},
getProxy:function(){
return this.proxy
},
hide:function(){
if(this.ghost){
if(this.proxy){
this.proxy.remove();
delete this.proxy
}
this.panel.el.dom.style.display='';
this.ghost.remove();
delete this.ghost
}
},
show:function(){
if(!this.ghost){
this.ghost=this.panel.createGhost(this.panel.initialConfig.cls,undefined,Ext.getBody());
this.ghost.setXY(this.panel.el.getXY());
if(this.insertProxy){
this.proxy=this.panel.el.insertSibling({cls:'x-panel-dd-spacer'});
this.proxy.setSize(this.panel.getSize())
}
this.panel.el.dom.style.display='none'
}
},
repair:function(xy,callback,scope){
this.hide();
if(typeof callback=='function'){
callback.call(scope||this)
}
},
moveProxy:function(parentNode,before){
if(this.proxy){
parentNode.insertBefore(this.proxy.dom,before)
}
}
});
Ext.Panel.DD=Ext.extend(Ext.dd.DragSource,{
constructor:function(panel,cfg){
this.panel=panel;
this.dragData={panel:panel};
this.proxy=new Ext.dd.PanelProxy(panel,cfg);
Ext.Panel.DD.superclass.constructor.call(this,panel.el,cfg);
var h=panel.header,el=panel.body;
if(h){
this.setHandleElId(h.id);
el=panel.header
}
el.setStyle('cursor','move');
this.scroll=false
},
showFrame:Ext.emptyFn,
startDrag:Ext.emptyFn,
b4StartDrag:function(x,y){
this.proxy.show()
},
b4MouseDown:function(e){
var x=e.getPageX(),y=e.getPageY();
this.autoOffset(x,y)
},
onInitDrag:function(x,y){
this.onStartDrag(x,y);
return true
},
createFrame:Ext.emptyFn,
getDragEl:function(e){
return this.proxy.ghost.dom
},
endDrag:function(e){
this.proxy.hide();
this.panel.saveState()
},
autoOffset:function(x,y){
x-=this.startPageX;
y-=this.startPageY;
this.setDelta(x,y)
}
});
Ext.state.Provider=Ext.extend(Ext.util.Observable,{
constructor:function(){
this.addEvents('statechange');
this.state={};
Ext.state.Provider.superclass.constructor.call(this)
},
get:function(name,defaultValue){
return typeof this.state[name]=='undefined'?defaultValue:this.state[name]
},
clear:function(name){
delete this.state[name];
this.fireEvent('statechange',this,name,null)
},
set:function(name,value){
this.state[name]=value;
this.fireEvent('statechange',this,name,value)
},
decodeValue:function(cookie){
var re=/^(a|n|d|b|s|o|e)\:(.*)$/,matches=re.exec(unescape(cookie)),all,type,v,kv;
if(!matches||!matches[1]){
return
}
type=matches[1];
v=matches[2];
switch(type){
case'e':
return null;
case'n':
return parseFloat(v);
case'd':
return new Date(Date.parse(v));
case'b':
return v=='1';
case'a':
all=[];
if(v!=''){
Ext.each(v.split('^'),function(val){
all.push(this.decodeValue(val))
},this)
}
return all;
case'o':
all={};
if(v!=''){
Ext.each(v.split('^'),function(val){
kv=val.split('=');
all[kv[0]]=this.decodeValue(kv[1])
},this)
}
return all;
default:
return v
}
},
encodeValue:function(v){
var enc,flat='',i=0,len,key;
if(v==null){
return'e:1'
}else if(typeof v=='number'){
enc='n:'+v
}else if(typeof v=='boolean'){
enc='b:'+(v?'1':'0')
}else if(Ext.isDate(v)){
enc='d:'+v.toGMTString()
}else if(Ext.isArray(v)){
for(len=v.length;i<len;i++){
flat+=this.encodeValue(v[i]);
if(i!=len-1){
flat+='^'
}
}
enc='a:'+flat
}else if(typeof v=='object'){
for(key in v){
if(typeof v[key]!='function'&&v[key]!==undefined){
flat+=key+'='+this.encodeValue(v[key])+'^'
}
}
enc='o:'+flat.substring(0,flat.length-1)
}else{
enc='s:'+v
}
return escape(enc)
}
});
Ext.state.Manager=function(){
var provider=new Ext.state.Provider;
return{
setProvider:function(stateProvider){
provider=stateProvider
},
get:function(key,defaultValue){
return provider.get(key,defaultValue)
},
set:function(key,value){
provider.set(key,value)
},
clear:function(key){
provider.clear(key)
},
getProvider:function(){
return provider
}
}
}();
Ext.state.CookieProvider=Ext.extend(Ext.state.Provider,{
constructor:function(config){
Ext.state.CookieProvider.superclass.constructor.call(this);
this.path='/';
this.expires=new Date(new Date().getTime()+1000*60*60*24*7);
this.domain=null;
this.secure=false;
Ext.apply(this,config);
this.state=this.readCookies()
},
set:function(name,value){
if(typeof value=='undefined'||value===null){
this.clear(name);
return
}
this.setCookie(name,value);
Ext.state.CookieProvider.superclass.set.call(this,name,value)
},
clear:function(name){
this.clearCookie(name);
Ext.state.CookieProvider.superclass.clear.call(this,name)
},
readCookies:function(){
var cookies={},c=document.cookie+';',re=/\s?(.*?)=(.*?);/g,matches,name,value;
while((matches=re.exec(c))!=null){
name=matches[1];
value=matches[2];
if(name&&name.substring(0,3)=='ys-'){
cookies[name.substr(3)]=this.decodeValue(value)
}
}
return cookies
},
setCookie:function(name,value){
document.cookie='ys-'+name+'='+this.encodeValue(value)+(this.expires==null?'':'; expires='+this.expires.toGMTString())+(this.path==null?'':'; path='+this.path)+(this.domain==null?'':'; domain='+this.domain)+(this.secure==true?'; secure':'')
},
clearCookie:function(name){
document.cookie='ys-'+name+'=null; expires=Thu, 01-Jan-70 00:00:01 GMT'+(this.path==null?'':'; path='+this.path)+(this.domain==null?'':'; domain='+this.domain)+(this.secure==true?'; secure':'')
}
});
Ext.DataView=Ext.extend(Ext.BoxComponent,{
selectedClass:'x-view-selected',
emptyText:'',
deferEmptyText:true,
trackOver:false,
blockRefresh:false,
last:false,
initComponent:function(){
Ext.DataView.superclass.initComponent.call(this);
if(Ext.isString(this.tpl)||Ext.isArray(this.tpl)){
this.tpl=new Ext.XTemplate(this.tpl)
}
this.addEvents('beforeclick','click','mouseenter','mouseleave','containerclick','dblclick','contextmenu','containercontextmenu','selectionchange','beforeselect');
this.store=Ext.StoreMgr.lookup(this.store);
this.all=new Ext.CompositeElementLite;
this.selected=new Ext.CompositeElementLite
},
afterRender:function(){
Ext.DataView.superclass.afterRender.call(this);
this.mon(this.getTemplateTarget(),{
'click':this.onClick,
'dblclick':this.onDblClick,
'contextmenu':this.onContextMenu,
scope:this
});
if(this.overClass||this.trackOver){
this.mon(this.getTemplateTarget(),{
'mouseover':this.onMouseOver,
'mouseout':this.onMouseOut,
scope:this
})
}
if(this.store){
this.bindStore(this.store,true)
}
},
refresh:function(){
this.clearSelections(false,true);
var el=this.getTemplateTarget(),records=this.store.getRange();
el.update('');
if(records.length<1){
if(!this.deferEmptyText||this.hasSkippedEmptyText){
el.update(this.emptyText)
}
this.all.clear()
}else{
this.tpl.overwrite(el,this.collectData(records,0));
this.all.fill(Ext.query(this.itemSelector,el.dom));
this.updateIndexes(0)
}
this.hasSkippedEmptyText=true
},
getTemplateTarget:function(){
return this.el
},
prepareData:function(data){
return data
},
collectData:function(records,startIndex){
var r=[],i=0,len=records.length;
for(;i<len;i++){
r[r.length]=this.prepareData(records[i].data,startIndex+i,records[i])
}
return r
},
bufferRender:function(records,index){
var div=document.createElement('div');
this.tpl.overwrite(div,this.collectData(records,index));
return Ext.query(this.itemSelector,div)
},
onUpdate:function(ds,record){
var index=this.store.indexOf(record);
if(index>-1){
var sel=this.isSelected(index),original=this.all.elements[index],node=this.bufferRender([record],index)[0];
this.all.replaceElement(index,node,true);
if(sel){
this.selected.replaceElement(original,node);
this.all.item(index).addClass(this.selectedClass)
}
this.updateIndexes(index,index)
}
},
onAdd:function(ds,records,index){
if(this.all.getCount()===0){
this.refresh();
return
}
var nodes=this.bufferRender(records,index),n,a=this.all.elements;
if(index<this.all.getCount()){
n=this.all.item(index).insertSibling(nodes,'before',true);
a.splice.apply(a,[
index,
0
].concat(nodes))
}else{
n=this.all.last().insertSibling(nodes,'after',true);
a.push.apply(a,nodes)
}
this.updateIndexes(index)
},
onRemove:function(ds,record,index){
this.deselect(index);
this.all.removeElement(index,true);
this.updateIndexes(index);
if(this.store.getCount()===0){
this.refresh()
}
},
refreshNode:function(index){
this.onUpdate(this.store,this.store.getAt(index))
},
updateIndexes:function(startIndex,endIndex){
var ns=this.all.elements;
startIndex=startIndex||0;
endIndex=endIndex||(endIndex===0?0:ns.length-1);
for(var i=startIndex;i<=endIndex;i++){
ns[i].viewIndex=i
}
},
getStore:function(){
return this.store
},
bindStore:function(store,initial){
if(!initial&&this.store){
if(store!==this.store&&this.store.autoDestroy){
this.store.destroy()
}else{
this.store.un('beforeload',this.onBeforeLoad,this);
this.store.un('datachanged',this.onDataChanged,this);
this.store.un('add',this.onAdd,this);
this.store.un('remove',this.onRemove,this);
this.store.un('update',this.onUpdate,this);
this.store.un('clear',this.refresh,this)
}
if(!store){
this.store=null
}
}
if(store){
store=Ext.StoreMgr.lookup(store);
store.on({
scope:this,
beforeload:this.onBeforeLoad,
datachanged:this.onDataChanged,
add:this.onAdd,
remove:this.onRemove,
update:this.onUpdate,
clear:this.refresh
})
}
this.store=store;
if(store){
this.refresh()
}
},
onDataChanged:function(){
if(this.blockRefresh!==true){
this.refresh.apply(this,arguments)
}
},
findItemFromChild:function(node){
return Ext.fly(node).findParent(this.itemSelector,this.getTemplateTarget())
},
onClick:function(e){
var item=e.getTarget(this.itemSelector,this.getTemplateTarget()),index;
if(item){
index=this.indexOf(item);
if(this.onItemClick(item,index,e)!==false){
this.fireEvent('click',this,index,item,e)
}
}else{
if(this.fireEvent('containerclick',this,e)!==false){
this.onContainerClick(e)
}
}
},
onContainerClick:function(e){
this.clearSelections()
},
onContextMenu:function(e){
var item=e.getTarget(this.itemSelector,this.getTemplateTarget());
if(item){
this.fireEvent('contextmenu',this,this.indexOf(item),item,e)
}else{
this.fireEvent('containercontextmenu',this,e)
}
},
onDblClick:function(e){
var item=e.getTarget(this.itemSelector,this.getTemplateTarget());
if(item){
this.fireEvent('dblclick',this,this.indexOf(item),item,e)
}
},
onMouseOver:function(e){
var item=e.getTarget(this.itemSelector,this.getTemplateTarget());
if(item&&item!==this.lastItem){
this.lastItem=item;
Ext.fly(item).addClass(this.overClass);
this.fireEvent('mouseenter',this,this.indexOf(item),item,e)
}
},
onMouseOut:function(e){
if(this.lastItem){
if(!e.within(this.lastItem,true,true)){
Ext.fly(this.lastItem).removeClass(this.overClass);
this.fireEvent('mouseleave',this,this.indexOf(this.lastItem),this.lastItem,e);
delete this.lastItem
}
}
},
onItemClick:function(item,index,e){
if(this.fireEvent('beforeclick',this,index,item,e)===false){
return false
}
if(this.multiSelect){
this.doMultiSelection(item,index,e);
e.preventDefault()
}else if(this.singleSelect){
this.doSingleSelection(item,index,e);
e.preventDefault()
}
return true
},
doSingleSelection:function(item,index,e){
if(e.ctrlKey&&this.isSelected(index)){
this.deselect(index)
}else{
this.select(index,false)
}
},
doMultiSelection:function(item,index,e){
if(e.shiftKey&&this.last!==false){
var last=this.last;
this.selectRange(last,index,e.ctrlKey);
this.last=last
}else{
if((e.ctrlKey||this.simpleSelect)&&this.isSelected(index)){
this.deselect(index)
}else{
this.select(index,e.ctrlKey||e.shiftKey||this.simpleSelect)
}
}
},
getSelectionCount:function(){
return this.selected.getCount()
},
getSelectedNodes:function(){
return this.selected.elements
},
getSelectedIndexes:function(){
var indexes=[],selected=this.selected.elements,i=0,len=selected.length;
for(;i<len;i++){
indexes.push(selected[i].viewIndex)
}
return indexes
},
getSelectedRecords:function(){
return this.getRecords(this.selected.elements)
},
getRecords:function(nodes){
var records=[],i=0,len=nodes.length;
for(;i<len;i++){
records[records.length]=this.store.getAt(nodes[i].viewIndex)
}
return records
},
getRecord:function(node){
return this.store.getAt(node.viewIndex)
},
clearSelections:function(suppressEvent,skipUpdate){
if((this.multiSelect||this.singleSelect)&&this.selected.getCount()>0){
if(!skipUpdate){
this.selected.removeClass(this.selectedClass)
}
this.selected.clear();
this.last=false;
if(!suppressEvent){
this.fireEvent('selectionchange',this,this.selected.elements)
}
}
},
isSelected:function(node){
return this.selected.contains(this.getNode(node))
},
deselect:function(node){
if(this.isSelected(node)){
node=this.getNode(node);
this.selected.removeElement(node);
if(this.last==node.viewIndex){
this.last=false
}
Ext.fly(node).removeClass(this.selectedClass);
this.fireEvent('selectionchange',this,this.selected.elements)
}
},
select:function(nodeInfo,keepExisting,suppressEvent){
if(Ext.isArray(nodeInfo)){
if(!keepExisting){
this.clearSelections(true)
}
for(var i=0,len=nodeInfo.length;i<len;i++){
this.select(nodeInfo[i],true,true)
}
if(!suppressEvent){
this.fireEvent('selectionchange',this,this.selected.elements)
}
}else{
var node=this.getNode(nodeInfo);
if(!keepExisting){
this.clearSelections(true)
}
if(node&&!this.isSelected(node)){
if(this.fireEvent('beforeselect',this,node,this.selected.elements)!==false){
Ext.fly(node).addClass(this.selectedClass);
this.selected.add(node);
this.last=node.viewIndex;
if(!suppressEvent){
this.fireEvent('selectionchange',this,this.selected.elements)
}
}
}
}
},
selectRange:function(start,end,keepExisting){
if(!keepExisting){
this.clearSelections(true)
}
this.select(this.getNodes(start,end),true)
},
getNode:function(nodeInfo){
if(Ext.isString(nodeInfo)){
return document.getElementById(nodeInfo)
}else if(Ext.isNumber(nodeInfo)){
return this.all.elements[nodeInfo]
}else if(nodeInfo instanceof Ext.data.Record){
var idx=this.store.indexOf(nodeInfo);
return this.all.elements[idx]
}
return nodeInfo
},
getNodes:function(start,end){
var ns=this.all.elements,nodes=[],i;
start=start||0;
end=!Ext.isDefined(end)?Math.max(ns.length-1,0):end;
if(start<=end){
for(i=start;i<=end&&ns[i];i++){
nodes.push(ns[i])
}
}else{
for(i=start;i>=end&&ns[i];i--){
nodes.push(ns[i])
}
}
return nodes
},
indexOf:function(node){
node=this.getNode(node);
if(Ext.isNumber(node.viewIndex)){
return node.viewIndex
}
return this.all.indexOf(node)
},
onBeforeLoad:function(){
if(this.loadingText){
this.clearSelections(false,true);
this.getTemplateTarget().update('<div class="loading-indicator">'+this.loadingText+'</div>');
this.all.clear()
}
},
onDestroy:function(){
this.all.clear();
this.selected.clear();
Ext.DataView.superclass.onDestroy.call(this);
this.bindStore(null)
}
});
Ext.DataView.prototype.setStore=Ext.DataView.prototype.bindStore;
Ext.reg('dataview',Ext.DataView);
Ext.list.ListView=Ext.extend(Ext.DataView,{
itemSelector:'dl',
selectedClass:'x-list-selected',
overClass:'x-list-over',
scrollOffset:undefined,
columnResize:true,
columnSort:true,
maxColumnWidth:Ext.isIE?99:100,
initComponent:function(){
if(this.columnResize){
this.colResizer=new Ext.list.ColumnResizer(this.colResizer);
this.colResizer.init(this)
}
if(this.columnSort){
this.colSorter=new Ext.list.Sorter(this.columnSort);
this.colSorter.init(this)
}
if(!this.internalTpl){
this.internalTpl=new Ext.XTemplate('<div class="x-list-header"><div class="x-list-header-inner">','<tpl for="columns">','<div style="width:{[values.width*100]}%;text-align:{align};"><em unselectable="on" id="',this.id,'-xlhd-{#}">','{header}','</em></div>','</tpl>','<div class="x-clear"></div>','</div></div>','<div class="x-list-body"><div class="x-list-body-inner">','</div></div>')
}
if(!this.tpl){
this.tpl=new Ext.XTemplate('<tpl for="rows">','<dl>','<tpl for="parent.columns">','<dt style="width:{[values.width*100]}%;text-align:{align};">','<em unselectable="on"<tpl if="cls"> class="{cls}</tpl>">','{[values.tpl.apply(parent)]}','</em></dt>','</tpl>','<div class="x-clear"></div>','</dl>','</tpl>')
}
;
var cs=this.columns,allocatedWidth=0,colsWithWidth=0,len=cs.length,columns=[];
for(var i=0;i<len;i++){
var c=cs[i];
if(!c.isColumn){
c.xtype=c.xtype?/^lv/.test(c.xtype)?c.xtype:'lv'+c.xtype:'lvcolumn';
c=Ext.create(c)
}
if(c.width){
allocatedWidth+=c.width*100;
if(allocatedWidth>this.maxColumnWidth){
c.width-=(allocatedWidth-this.maxColumnWidth)/100
}
colsWithWidth++
}
columns.push(c)
}
cs=this.columns=columns;
if(colsWithWidth<len){
var remaining=len-colsWithWidth;
if(allocatedWidth<this.maxColumnWidth){
var perCol=(this.maxColumnWidth-allocatedWidth)/remaining/100;
for(var j=0;j<len;j++){
var c=cs[j];
if(!c.width){
c.width=perCol
}
}
}
}
Ext.list.ListView.superclass.initComponent.call(this)
},
onRender:function(){
this.autoEl={cls:'x-list-wrap'};
Ext.list.ListView.superclass.onRender.apply(this,arguments);
this.internalTpl.overwrite(this.el,{columns:this.columns});
this.innerBody=Ext.get(this.el.dom.childNodes[1].firstChild);
this.innerHd=Ext.get(this.el.dom.firstChild.firstChild);
if(this.hideHeaders){
this.el.dom.firstChild.style.display='none'
}
},
getTemplateTarget:function(){
return this.innerBody
},
collectData:function(){
var rs=Ext.list.ListView.superclass.collectData.apply(this,arguments);
return{
columns:this.columns,
rows:rs
}
},
verifyInternalSize:function(){
if(this.lastSize){
this.onResize(this.lastSize.width,this.lastSize.height)
}
},
onResize:function(w,h){
var body=this.innerBody.dom,header=this.innerHd.dom,scrollWidth=w-Ext.num(this.scrollOffset,Ext.getScrollBarWidth())+'px',parentNode;
if(!body){
return
}
parentNode=body.parentNode;
if(Ext.isNumber(w)){
if(this.reserveScrollOffset||parentNode.offsetWidth-parentNode.clientWidth>10){
body.style.width=scrollWidth;
header.style.width=scrollWidth
}else{
body.style.width=w+'px';
header.style.width=w+'px';
setTimeout(function(){
if(parentNode.offsetWidth-parentNode.clientWidth>10){
body.style.width=scrollWidth;
header.style.width=scrollWidth
}
},10)
}
}
if(Ext.isNumber(h)){
parentNode.style.height=Math.max(0,h-header.parentNode.offsetHeight)+'px'
}
},
updateIndexes:function(){
Ext.list.ListView.superclass.updateIndexes.apply(this,arguments);
this.verifyInternalSize()
},
findHeaderIndex:function(header){
header=header.dom||header;
var parentNode=header.parentNode,children=parentNode.parentNode.childNodes,i=0,c;
for(;c=children[i];i++){
if(c==parentNode){
return i
}
}
return-1
},
setHdWidths:function(){
var els=this.innerHd.dom.getElementsByTagName('div'),i=0,columns=this.columns,len=columns.length;
for(;i<len;i++){
els[i].style.width=columns[i].width*100+'%'
}
}
});
Ext.reg('listview',Ext.list.ListView);
Ext.ListView=Ext.list.ListView;
Ext.list.Column=Ext.extend(Object,{
isColumn:true,
align:'left',
header:'',
width:null,
cls:'',
constructor:function(c){
if(!c.tpl){
c.tpl=new Ext.XTemplate('{'+c.dataIndex+'}')
}else if(Ext.isString(c.tpl)){
c.tpl=new Ext.XTemplate(c.tpl)
}
Ext.apply(this,c)
}
});
Ext.reg('lvcolumn',Ext.list.Column);
Ext.list.NumberColumn=Ext.extend(Ext.list.Column,{
format:'0,000.00',
constructor:function(c){
c.tpl=c.tpl||new Ext.XTemplate('{'+c.dataIndex+':number("'+(c.format||this.format)+'")}');
Ext.list.NumberColumn.superclass.constructor.call(this,c)
}
});
Ext.reg('lvnumbercolumn',Ext.list.NumberColumn);
Ext.list.DateColumn=Ext.extend(Ext.list.Column,{
format:'m/d/Y',
constructor:function(c){
c.tpl=c.tpl||new Ext.XTemplate('{'+c.dataIndex+':date("'+(c.format||this.format)+'")}');
Ext.list.DateColumn.superclass.constructor.call(this,c)
}
});
Ext.reg('lvdatecolumn',Ext.list.DateColumn);
Ext.list.BooleanColumn=Ext.extend(Ext.list.Column,{
trueText:'true',
falseText:'false',
undefinedText:'&#160;',
constructor:function(c){
c.tpl=c.tpl||new Ext.XTemplate('{'+c.dataIndex+':this.format}');
var t=this.trueText,f=this.falseText,u=this.undefinedText;
c.tpl.format=function(v){
if(v===undefined){
return u
}
if(!v||v==='false'){
return f
}
return t
};
Ext.list.DateColumn.superclass.constructor.call(this,c)
}
});
Ext.reg('lvbooleancolumn',Ext.list.BooleanColumn);
Ext.list.ColumnResizer=Ext.extend(Ext.util.Observable,{
minPct:0.05,
constructor:function(config){
Ext.apply(this,config);
Ext.list.ColumnResizer.superclass.constructor.call(this)
},
init:function(listView){
this.view=listView;
listView.on('render',this.initEvents,this)
},
initEvents:function(view){
view.mon(view.innerHd,'mousemove',this.handleHdMove,this);
this.tracker=new Ext.dd.DragTracker({
onBeforeStart:this.onBeforeStart.createDelegate(this),
onStart:this.onStart.createDelegate(this),
onDrag:this.onDrag.createDelegate(this),
onEnd:this.onEnd.createDelegate(this),
tolerance:3,
autoStart:300
});
this.tracker.initEl(view.innerHd);
view.on('beforedestroy',this.tracker.destroy,this.tracker)
},
handleHdMove:function(e,t){
var handleWidth=5,x=e.getPageX(),header=e.getTarget('em',3,true);
if(header){
var region=header.getRegion(),style=header.dom.style,parentNode=header.dom.parentNode;
if(x-region.left<=handleWidth&&parentNode!=parentNode.parentNode.firstChild){
this.activeHd=Ext.get(parentNode.previousSibling.firstChild);
style.cursor=Ext.isWebKit?'e-resize':'col-resize'
}else if(region.right-x<=handleWidth&&parentNode!=parentNode.parentNode.lastChild.previousSibling){
this.activeHd=header;
style.cursor=Ext.isWebKit?'w-resize':'col-resize'
}else{
delete this.activeHd;
style.cursor=''
}
}
},
onBeforeStart:function(e){
this.dragHd=this.activeHd;
return!!this.dragHd
},
onStart:function(e){
var me=this,view=me.view,dragHeader=me.dragHd,x=me.tracker.getXY()[0];
me.proxy=view.el.createChild({cls:'x-list-resizer'});
me.dragX=dragHeader.getX();
me.headerIndex=view.findHeaderIndex(dragHeader);
me.headersDisabled=view.disableHeaders;
view.disableHeaders=true;
me.proxy.setHeight(view.el.getHeight());
me.proxy.setX(me.dragX);
me.proxy.setWidth(x-me.dragX);
this.setBoundaries()
},
setBoundaries:function(relativeX){
var view=this.view,headerIndex=this.headerIndex,width=view.innerHd.getWidth(),relativeX=view.innerHd.getX(),minWidth=Math.ceil(width*this.minPct),maxWidth=width-minWidth,numColumns=view.columns.length,headers=view.innerHd.select('em',true),minX=minWidth+relativeX,maxX=maxWidth+relativeX,header;
if(numColumns==2){
this.minX=minX;
this.maxX=maxX
}else{
header=headers.item(headerIndex+2);
this.minX=headers.item(headerIndex).getX()+minWidth;
this.maxX=header?header.getX()-minWidth:maxX;
if(headerIndex==0){
this.minX=minX
}else if(headerIndex==numColumns-2){
this.maxX=maxX
}
}
},
onDrag:function(e){
var me=this,cursorX=me.tracker.getXY()[0].constrain(me.minX,me.maxX);
me.proxy.setWidth(cursorX-this.dragX)
},
onEnd:function(e){
var newWidth=this.proxy.getWidth(),index=this.headerIndex,view=this.view,columns=view.columns,width=view.innerHd.getWidth(),newPercent=Math.ceil(newWidth*view.maxColumnWidth/width)/100,disabled=this.headersDisabled,headerCol=columns[index],otherCol=columns[index+1],totalPercent=headerCol.width+otherCol.width;
this.proxy.remove();
headerCol.width=newPercent;
otherCol.width=totalPercent-newPercent;
delete this.dragHd;
view.setHdWidths();
view.refresh();
setTimeout(function(){
view.disableHeaders=disabled
},100)
}
});
Ext.ListView.ColumnResizer=Ext.list.ColumnResizer;
Ext.list.Sorter=Ext.extend(Ext.util.Observable,{
sortClasses:[
'sort-asc',
'sort-desc'
],
constructor:function(config){
Ext.apply(this,config);
Ext.list.Sorter.superclass.constructor.call(this)
},
init:function(listView){
this.view=listView;
listView.on('render',this.initEvents,this)
},
initEvents:function(view){
view.mon(view.innerHd,'click',this.onHdClick,this);
view.innerHd.setStyle('cursor','pointer');
view.mon(view.store,'datachanged',this.updateSortState,this);
this.updateSortState.defer(10,this,[view.store])
},
updateSortState:function(store){
var state=store.getSortState();
if(!state){
return
}
this.sortState=state;
var cs=this.view.columns,sortColumn=-1;
for(var i=0,len=cs.length;i<len;i++){
if(cs[i].dataIndex==state.field){
sortColumn=i;
break
}
}
if(sortColumn!=-1){
var sortDir=state.direction;
this.updateSortIcon(sortColumn,sortDir)
}
},
updateSortIcon:function(col,dir){
var sc=this.sortClasses;
var hds=this.view.innerHd.select('em').removeClass(sc);
hds.item(col).addClass(sc[dir=='DESC'?1:0])
},
onHdClick:function(e){
var hd=e.getTarget('em',3);
if(hd&&!this.view.disableHeaders){
var index=this.view.findHeaderIndex(hd);
this.view.store.sort(this.view.columns[index].dataIndex)
}
}
});
Ext.ListView.Sorter=Ext.list.Sorter;
Ext.TabPanel=Ext.extend(Ext.Panel,{
deferredRender:true,
tabWidth:120,
minTabWidth:30,
resizeTabs:false,
enableTabScroll:false,
scrollIncrement:0,
scrollRepeatInterval:400,
scrollDuration:0.35,
animScroll:true,
tabPosition:'top',
baseCls:'x-tab-panel',
autoTabs:false,
autoTabSelector:'div.x-tab',
activeTab:undefined,
tabMargin:2,
plain:false,
wheelIncrement:20,
idDelimiter:'__',
itemCls:'x-tab-item',
elements:'body',
headerAsText:false,
frame:false,
hideBorders:true,
initComponent:function(){
this.frame=false;
Ext.TabPanel.superclass.initComponent.call(this);
this.addEvents('beforetabchange','tabchange','contextmenu');
this.setLayout(new Ext.layout.CardLayout(Ext.apply({
layoutOnCardChange:this.layoutOnTabChange,
deferredRender:this.deferredRender
},this.layoutConfig)));
if(this.tabPosition=='top'){
this.elements+=',header';
this.stripTarget='header'
}else{
this.elements+=',footer';
this.stripTarget='footer'
}
if(!this.stack){
this.stack=Ext.TabPanel.AccessStack()
}
this.initItems()
},
onRender:function(ct,position){
Ext.TabPanel.superclass.onRender.call(this,ct,position);
if(this.plain){
var pos=this.tabPosition=='top'?'header':'footer';
this[pos].addClass('x-tab-panel-'+pos+'-plain')
}
var st=this[this.stripTarget];
this.stripWrap=st.createChild({
cls:'x-tab-strip-wrap',
cn:{
tag:'ul',
cls:'x-tab-strip x-tab-strip-'+this.tabPosition
}
});
var beforeEl=this.tabPosition=='bottom'?this.stripWrap:null;
st.createChild({cls:'x-tab-strip-spacer'},beforeEl);
this.strip=new Ext.Element(this.stripWrap.dom.firstChild);
this.edge=this.strip.createChild({
tag:'li',
cls:'x-tab-edge',
cn:[{
tag:'span',
cls:'x-tab-strip-text',
cn:'&#160;'
}]
});
this.strip.createChild({cls:'x-clear'});
this.body.addClass('x-tab-panel-body-'+this.tabPosition);
if(!this.itemTpl){
var tt=new Ext.Template('<li class="{cls}" id="{id}"><a class="x-tab-strip-close"></a>','<a class="x-tab-right" href="#"><em class="x-tab-left">','<span class="x-tab-strip-inner"><span class="x-tab-strip-text {iconCls}">{text}</span></span>','</em></a></li>');
tt.disableFormats=true;
tt.compile();
Ext.TabPanel.prototype.itemTpl=tt
}
this.items.each(this.initTab,this)
},
afterRender:function(){
Ext.TabPanel.superclass.afterRender.call(this);
if(this.autoTabs){
this.readTabs(false)
}
if(this.activeTab!==undefined){
var item=Ext.isObject(this.activeTab)?this.activeTab:this.items.get(this.activeTab);
delete this.activeTab;
this.setActiveTab(item)
}
},
initEvents:function(){
Ext.TabPanel.superclass.initEvents.call(this);
this.mon(this.strip,{
scope:this,
mousedown:this.onStripMouseDown,
contextmenu:this.onStripContextMenu
});
if(this.enableTabScroll){
this.mon(this.strip,'mousewheel',this.onWheel,this)
}
},
findTargets:function(e){
var item=null,itemEl=e.getTarget('li:not(.x-tab-edge)',this.strip);
if(itemEl){
item=this.getComponent(itemEl.id.split(this.idDelimiter)[1]);
if(item.disabled){
return{
close:null,
item:null,
el:null
}
}
}
return{
close:e.getTarget('.x-tab-strip-close',this.strip),
item:item,
el:itemEl
}
},
onStripMouseDown:function(e){
if(e.button!==0){
return
}
e.preventDefault();
var t=this.findTargets(e);
if(t.close){
if(t.item.fireEvent('beforeclose',t.item)!==false){
t.item.fireEvent('close',t.item);
this.remove(t.item)
}
return
}
if(t.item&&t.item!=this.activeTab){
this.setActiveTab(t.item)
}
},
onStripContextMenu:function(e){
e.preventDefault();
var t=this.findTargets(e);
if(t.item){
this.fireEvent('contextmenu',this,t.item,e)
}
},
readTabs:function(removeExisting){
if(removeExisting===true){
this.items.each(function(item){
this.remove(item)
},this)
}
var tabs=this.el.query(this.autoTabSelector);
for(var i=0,len=tabs.length;i<len;i++){
var tab=tabs[i],title=tab.getAttribute('title');
tab.removeAttribute('title');
this.add({
title:title,
contentEl:tab
})
}
},
initTab:function(item,index){
var before=this.strip.dom.childNodes[index],p=this.getTemplateArgs(item),el=before?this.itemTpl.insertBefore(before,p):this.itemTpl.append(this.strip,p),cls='x-tab-strip-over',tabEl=Ext.get(el);
tabEl.hover(function(){
if(!item.disabled){
tabEl.addClass(cls)
}
},function(){
tabEl.removeClass(cls)
});
if(item.tabTip){
tabEl.child('span.x-tab-strip-text',true).qtip=item.tabTip
}
item.tabEl=el;
tabEl.select('a').on('click',function(e){
if(!e.getPageX()){
this.onStripMouseDown(e)
}
},this,{preventDefault:true});
item.on({
scope:this,
disable:this.onItemDisabled,
enable:this.onItemEnabled,
titlechange:this.onItemTitleChanged,
iconchange:this.onItemIconChanged,
beforeshow:this.onBeforeShowItem
})
},
getTemplateArgs:function(item){
var cls=item.closable?'x-tab-strip-closable':'';
if(item.disabled){
cls+=' x-item-disabled'
}
if(item.iconCls){
cls+=' x-tab-with-icon'
}
if(item.tabCls){
cls+=' '+item.tabCls
}
return{
id:this.id+this.idDelimiter+item.getItemId(),
text:item.title,
cls:cls,
iconCls:item.iconCls||''
}
},
onAdd:function(c){
Ext.TabPanel.superclass.onAdd.call(this,c);
if(this.rendered){
var items=this.items;
this.initTab(c,items.indexOf(c));
this.delegateUpdates()
}
},
onBeforeAdd:function(item){
var existing=item.events?this.items.containsKey(item.getItemId())?item:null:this.items.get(item);
if(existing){
this.setActiveTab(item);
return false
}
Ext.TabPanel.superclass.onBeforeAdd.apply(this,arguments);
var es=item.elements;
item.elements=es?es.replace(',header',''):es;
item.border=item.border===true
},
onRemove:function(c){
var te=Ext.get(c.tabEl);
if(te){
te.select('a').removeAllListeners();
Ext.destroy(te)
}
Ext.TabPanel.superclass.onRemove.call(this,c);
this.stack.remove(c);
delete c.tabEl;
c.un('disable',this.onItemDisabled,this);
c.un('enable',this.onItemEnabled,this);
c.un('titlechange',this.onItemTitleChanged,this);
c.un('iconchange',this.onItemIconChanged,this);
c.un('beforeshow',this.onBeforeShowItem,this);
if(c==this.activeTab){
var next=this.stack.next();
if(next){
this.setActiveTab(next)
}else if(this.items.getCount()>0){
this.setActiveTab(0)
}else{
this.setActiveTab(null)
}
}
if(!this.destroying){
this.delegateUpdates()
}
},
onBeforeShowItem:function(item){
if(item!=this.activeTab){
this.setActiveTab(item);
return false
}
},
onItemDisabled:function(item){
var el=this.getTabEl(item);
if(el){
Ext.fly(el).addClass('x-item-disabled')
}
this.stack.remove(item)
},
onItemEnabled:function(item){
var el=this.getTabEl(item);
if(el){
Ext.fly(el).removeClass('x-item-disabled')
}
},
onItemTitleChanged:function(item){
var el=this.getTabEl(item);
if(el){
Ext.fly(el).child('span.x-tab-strip-text',true).innerHTML=item.title
}
},
onItemIconChanged:function(item,iconCls,oldCls){
var el=this.getTabEl(item);
if(el){
el=Ext.get(el);
el.child('span.x-tab-strip-text').replaceClass(oldCls,iconCls);
el[Ext.isEmpty(iconCls)?'removeClass':'addClass']('x-tab-with-icon')
}
},
getTabEl:function(item){
var c=this.getComponent(item);
return c?c.tabEl:null
},
onResize:function(){
Ext.TabPanel.superclass.onResize.apply(this,arguments);
this.delegateUpdates()
},
beginUpdate:function(){
this.suspendUpdates=true
},
endUpdate:function(){
this.suspendUpdates=false;
this.delegateUpdates()
},
hideTabStripItem:function(item){
item=this.getComponent(item);
var el=this.getTabEl(item);
if(el){
el.style.display='none';
this.delegateUpdates()
}
this.stack.remove(item)
},
unhideTabStripItem:function(item){
item=this.getComponent(item);
var el=this.getTabEl(item);
if(el){
el.style.display='';
this.delegateUpdates()
}
},
delegateUpdates:function(){
var rendered=this.rendered;
if(this.suspendUpdates){
return
}
if(this.resizeTabs&&rendered){
this.autoSizeTabs()
}
if(this.enableTabScroll&&rendered){
this.autoScrollTabs()
}
},
autoSizeTabs:function(){
var count=this.items.length,ce=this.tabPosition!='bottom'?'header':'footer',ow=this[ce].dom.offsetWidth,aw=this[ce].dom.clientWidth;
if(!this.resizeTabs||count<1||!aw){
return
}
var each=Math.max(Math.min(Math.floor((aw-4)/count)-this.tabMargin,this.tabWidth),this.minTabWidth);
this.lastTabWidth=each;
var lis=this.strip.query('li:not(.x-tab-edge)');
for(var i=0,len=lis.length;i<len;i++){
var li=lis[i],inner=Ext.fly(li).child('.x-tab-strip-inner',true),tw=li.offsetWidth,iw=inner.offsetWidth;
inner.style.width=each-(tw-iw)+'px'
}
},
adjustBodyWidth:function(w){
if(this.header){
this.header.setWidth(w)
}
if(this.footer){
this.footer.setWidth(w)
}
return w
},
setActiveTab:function(item){
item=this.getComponent(item);
if(this.fireEvent('beforetabchange',this,item,this.activeTab)===false){
return
}
if(!this.rendered){
this.activeTab=item;
return
}
if(this.activeTab!=item){
if(this.activeTab){
var oldEl=this.getTabEl(this.activeTab);
if(oldEl){
Ext.fly(oldEl).removeClass('x-tab-strip-active')
}
}
this.activeTab=item;
if(item){
var el=this.getTabEl(item);
Ext.fly(el).addClass('x-tab-strip-active');
this.stack.add(item);
this.layout.setActiveItem(item);
this.delegateUpdates();
if(this.scrolling){
this.scrollToTab(item,this.animScroll)
}
}
this.fireEvent('tabchange',this,item)
}
},
getActiveTab:function(){
return this.activeTab||null
},
getItem:function(item){
return this.getComponent(item)
},
autoScrollTabs:function(){
this.pos=this.tabPosition=='bottom'?this.footer:this.header;
var count=this.items.length,ow=this.pos.dom.offsetWidth,tw=this.pos.dom.clientWidth,wrap=this.stripWrap,wd=wrap.dom,cw=wd.offsetWidth,pos=this.getScrollPos(),l=this.edge.getOffsetsTo(this.stripWrap)[0]+pos;
if(!this.enableTabScroll||cw<20){
return
}
if(count==0||l<=tw){
wd.scrollLeft=0;
wrap.setWidth(tw);
if(this.scrolling){
this.scrolling=false;
this.pos.removeClass('x-tab-scrolling');
this.scrollLeft.hide();
this.scrollRight.hide();
if(Ext.isAir||Ext.isWebKit){
wd.style.marginLeft='';
wd.style.marginRight=''
}
}
}else{
if(!this.scrolling){
this.pos.addClass('x-tab-scrolling');
if(Ext.isAir||Ext.isWebKit){
wd.style.marginLeft='18px';
wd.style.marginRight='18px'
}
}
tw-=wrap.getMargins('lr');
wrap.setWidth(tw>20?tw:20);
if(!this.scrolling){
if(!this.scrollLeft){
this.createScrollers()
}else{
this.scrollLeft.show();
this.scrollRight.show()
}
}
this.scrolling=true;
if(pos>l-tw){
wd.scrollLeft=l-tw
}else{
this.scrollToTab(this.activeTab,false)
}
this.updateScrollButtons()
}
},
createScrollers:function(){
this.pos.addClass('x-tab-scrolling-'+this.tabPosition);
var h=this.stripWrap.dom.offsetHeight;
var sl=this.pos.insertFirst({cls:'x-tab-scroller-left'});
sl.setHeight(h);
sl.addClassOnOver('x-tab-scroller-left-over');
this.leftRepeater=new Ext.util.ClickRepeater(sl,{
interval:this.scrollRepeatInterval,
handler:this.onScrollLeft,
scope:this
});
this.scrollLeft=sl;
var sr=this.pos.insertFirst({cls:'x-tab-scroller-right'});
sr.setHeight(h);
sr.addClassOnOver('x-tab-scroller-right-over');
this.rightRepeater=new Ext.util.ClickRepeater(sr,{
interval:this.scrollRepeatInterval,
handler:this.onScrollRight,
scope:this
});
this.scrollRight=sr
},
getScrollWidth:function(){
return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos()
},
getScrollPos:function(){
return parseInt(this.stripWrap.dom.scrollLeft,10)||0
},
getScrollArea:function(){
return parseInt(this.stripWrap.dom.clientWidth,10)||0
},
getScrollAnim:function(){
return{
duration:this.scrollDuration,
callback:this.updateScrollButtons,
scope:this
}
},
getScrollIncrement:function(){
return this.scrollIncrement||(this.resizeTabs?this.lastTabWidth+2:100)
},
scrollToTab:function(item,animate){
if(!item){
return
}
var el=this.getTabEl(item),pos=this.getScrollPos(),area=this.getScrollArea(),left=Ext.fly(el).getOffsetsTo(this.stripWrap)[0]+pos,right=left+el.offsetWidth;
if(left<pos){
this.scrollTo(left,animate)
}else if(right>pos+area){
this.scrollTo(right-area,animate)
}
},
scrollTo:function(pos,animate){
this.stripWrap.scrollTo('left',pos,animate?this.getScrollAnim():false);
if(!animate){
this.updateScrollButtons()
}
},
onWheel:function(e){
var d=e.getWheelDelta()*this.wheelIncrement*-1;
e.stopEvent();
var pos=this.getScrollPos(),newpos=pos+d,sw=this.getScrollWidth()-this.getScrollArea();
var s=Math.max(0,Math.min(sw,newpos));
if(s!=pos){
this.scrollTo(s,false)
}
},
onScrollRight:function(){
var sw=this.getScrollWidth()-this.getScrollArea(),pos=this.getScrollPos(),s=Math.min(sw,pos+this.getScrollIncrement());
if(s!=pos){
this.scrollTo(s,this.animScroll)
}
},
onScrollLeft:function(){
var pos=this.getScrollPos(),s=Math.max(0,pos-this.getScrollIncrement());
if(s!=pos){
this.scrollTo(s,this.animScroll)
}
},
updateScrollButtons:function(){
var pos=this.getScrollPos();
this.scrollLeft[pos===0?'addClass':'removeClass']('x-tab-scroller-left-disabled');
this.scrollRight[pos>=this.getScrollWidth()-this.getScrollArea()?'addClass':'removeClass']('x-tab-scroller-right-disabled')
},
beforeDestroy:function(){
Ext.destroy(this.leftRepeater,this.rightRepeater);
this.deleteMembers('strip','edge','scrollLeft','scrollRight','stripWrap');
this.activeTab=null;
Ext.TabPanel.superclass.beforeDestroy.apply(this)
}
});
Ext.reg('tabpanel',Ext.TabPanel);
Ext.TabPanel.prototype.activate=Ext.TabPanel.prototype.setActiveTab;
Ext.TabPanel.AccessStack=function(){
var items=[];
return{
add:function(item){
items.push(item);
if(items.length>10){
items.shift()
}
},
remove:function(item){
var s=[];
for(var i=0,len=items.length;i<len;i++){
if(items[i]!=item){
s.push(items[i])
}
}
items=s
},
next:function(){
return items.pop()
}
}
};
Ext.Button=Ext.extend(Ext.BoxComponent,{
hidden:false,
disabled:false,
pressed:false,
enableToggle:false,
menuAlign:'tl-bl?',
type:'button',
menuClassTarget:'tr:nth(2)',
clickEvent:'click',
handleMouseEvents:true,
tooltipType:'qtip',
buttonSelector:'button:first-child',
scale:'small',
iconAlign:'left',
arrowAlign:'right',
initComponent:function(){
if(this.menu){
if(Ext.isArray(this.menu)){
this.menu={items:this.menu}
}
if(Ext.isObject(this.menu)){
this.menu.ownerCt=this
}
this.menu=Ext.menu.MenuMgr.get(this.menu);
this.menu.ownerCt=undefined
}
Ext.Button.superclass.initComponent.call(this);
this.addEvents('click','toggle','mouseover','mouseout','menushow','menuhide','menutriggerover','menutriggerout');
if(Ext.isString(this.toggleGroup)){
this.enableToggle=true
}
},
getTemplateArgs:function(){
return[
this.type,
'x-btn-'+this.scale+' x-btn-icon-'+this.scale+'-'+this.iconAlign,
this.getMenuClass(),
this.cls,
this.id
]
},
setButtonClass:function(){
if(this.useSetClass){
if(!Ext.isEmpty(this.oldCls)){
this.el.removeClass([
this.oldCls,
'x-btn-pressed'
])
}
this.oldCls=this.iconCls||this.icon?this.text?'x-btn-text-icon':'x-btn-icon':'x-btn-noicon';
this.el.addClass([
this.oldCls,
this.pressed?'x-btn-pressed':null
])
}
},
getMenuClass:function(){
return this.menu?this.arrowAlign!='bottom'?'x-btn-arrow':'x-btn-arrow-bottom':''
},
onRender:function(ct,position){
if(!this.template){
if(!Ext.Button.buttonTemplate){
Ext.Button.buttonTemplate=new Ext.Template('<table id="{4}" cellspacing="0" class="x-btn {3}"><tbody class="{1}">','<tr><td class="x-btn-tl"><i>&#160;</i></td><td class="x-btn-tc"></td><td class="x-btn-tr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-ml"><i>&#160;</i></td><td class="x-btn-mc"><em class="{2}" unselectable="on"><button type="{0}"></button></em></td><td class="x-btn-mr"><i>&#160;</i></td></tr>','<tr><td class="x-btn-bl"><i>&#160;</i></td><td class="x-btn-bc"></td><td class="x-btn-br"><i>&#160;</i></td></tr>','</tbody></table>');
Ext.Button.buttonTemplate.compile()
}
this.template=Ext.Button.buttonTemplate
}
var btn,targs=this.getTemplateArgs();
if(position){
btn=this.template.insertBefore(position,targs,true)
}else{
btn=this.template.append(ct,targs,true)
}
this.btnEl=btn.child(this.buttonSelector);
this.mon(this.btnEl,{
scope:this,
focus:this.onFocus,
blur:this.onBlur
});
this.initButtonEl(btn,this.btnEl);
Ext.ButtonToggleMgr.register(this)
},
initButtonEl:function(btn,btnEl){
this.el=btn;
this.setIcon(this.icon);
this.setText(this.text);
this.setIconClass(this.iconCls);
if(Ext.isDefined(this.tabIndex)){
btnEl.dom.tabIndex=this.tabIndex
}
if(this.tooltip){
this.setTooltip(this.tooltip,true)
}
if(this.handleMouseEvents){
this.mon(btn,{
scope:this,
mouseover:this.onMouseOver,
mousedown:this.onMouseDown
})
}
if(this.menu){
this.mon(this.menu,{
scope:this,
show:this.onMenuShow,
hide:this.onMenuHide
})
}
if(this.repeat){
var repeater=new Ext.util.ClickRepeater(btn,Ext.isObject(this.repeat)?this.repeat:{});
this.mon(repeater,'click',this.onRepeatClick,this)
}else{
this.mon(btn,this.clickEvent,this.onClick,this)
}
},
afterRender:function(){
Ext.Button.superclass.afterRender.call(this);
this.useSetClass=true;
this.setButtonClass();
this.doc=Ext.getDoc();
this.doAutoWidth()
},
setIconClass:function(cls){
this.iconCls=cls;
if(this.el){
this.btnEl.dom.className='';
this.btnEl.addClass([
'x-btn-text',
cls||''
]);
this.setButtonClass()
}
return this
},
setTooltip:function(tooltip,initial){
if(this.rendered){
if(!initial){
this.clearTip()
}
if(Ext.isObject(tooltip)){
Ext.QuickTips.register(Ext.apply({target:this.btnEl.id},tooltip));
this.tooltip=tooltip
}else{
this.btnEl.dom[this.tooltipType]=tooltip
}
}else{
this.tooltip=tooltip
}
return this
},
clearTip:function(){
if(Ext.isObject(this.tooltip)){
Ext.QuickTips.unregister(this.btnEl)
}
},
beforeDestroy:function(){
if(this.rendered){
this.clearTip()
}
if(this.menu&&this.destroyMenu!==false){
Ext.destroy(this.btnEl,this.menu)
}
Ext.destroy(this.repeater)
},
onDestroy:function(){
if(this.rendered){
this.doc.un('mouseover',this.monitorMouseOver,this);
this.doc.un('mouseup',this.onMouseUp,this);
delete this.doc;
delete this.btnEl;
Ext.ButtonToggleMgr.unregister(this)
}
Ext.Button.superclass.onDestroy.call(this)
},
doAutoWidth:function(){
if(this.autoWidth!==false&&this.el&&this.text&&this.width===undefined){
this.el.setWidth('auto');
if(Ext.isIE7&&Ext.isStrict){
var ib=this.btnEl;
if(ib&&ib.getWidth()>20){
ib.clip();
ib.setWidth(Ext.util.TextMetrics.measure(ib,this.text).width+ib.getFrameWidth('lr'))
}
}
if(this.minWidth){
if(this.el.getWidth()<this.minWidth){
this.el.setWidth(this.minWidth)
}
}
}
},
setHandler:function(handler,scope){
this.handler=handler;
this.scope=scope;
return this
},
setText:function(text){
this.text=text;
if(this.el){
this.btnEl.update(text||'&#160;');
this.setButtonClass()
}
this.doAutoWidth();
return this
},
setIcon:function(icon){
this.icon=icon;
if(this.el){
this.btnEl.setStyle('background-image',icon?'url('+icon+')':'');
this.setButtonClass()
}
return this
},
getText:function(){
return this.text
},
toggle:function(state,suppressEvent){
state=state===undefined?!this.pressed:!!state;
if(state!=this.pressed){
if(this.rendered){
this.el[state?'addClass':'removeClass']('x-btn-pressed')
}
this.pressed=state;
if(!suppressEvent){
this.fireEvent('toggle',this,state);
if(this.toggleHandler){
this.toggleHandler.call(this.scope||this,this,state)
}
}
}
return this
},
onDisable:function(){
this.onDisableChange(true)
},
onEnable:function(){
this.onDisableChange(false)
},
onDisableChange:function(disabled){
if(this.el){
if(!Ext.isIE6||!this.text){
this.el[disabled?'addClass':'removeClass'](this.disabledClass)
}
this.el.dom.disabled=disabled
}
this.disabled=disabled
},
showMenu:function(){
if(this.rendered&&this.menu){
if(this.tooltip){
Ext.QuickTips.getQuickTip().cancelShow(this.btnEl)
}
if(this.menu.isVisible()){
this.menu.hide()
}
this.menu.ownerCt=this;
this.menu.show(this.el,this.menuAlign)
}
return this
},
hideMenu:function(){
if(this.hasVisibleMenu()){
this.menu.hide()
}
return this
},
hasVisibleMenu:function(){
return this.menu&&this.menu.ownerCt==this&&this.menu.isVisible()
},
onRepeatClick:function(repeat,e){
this.onClick(e)
},
onClick:function(e){
if(e){
e.preventDefault()
}
if(e.button!==0){
return
}
if(!this.disabled){
this.doToggle();
if(this.menu&&!this.hasVisibleMenu()&&!this.ignoreNextClick){
this.showMenu()
}
this.fireEvent('click',this,e);
if(this.handler){
this.handler.call(this.scope||this,this,e)
}
}
},
doToggle:function(){
if(this.enableToggle&&(this.allowDepress!==false||!this.pressed)){
this.toggle()
}
},
isMenuTriggerOver:function(e,internal){
return this.menu&&!internal
},
isMenuTriggerOut:function(e,internal){
return this.menu&&!internal
},
onMouseOver:function(e){
if(!this.disabled){
var internal=e.within(this.el,true);
if(!internal){
this.el.addClass('x-btn-over');
if(!this.monitoringMouseOver){
this.doc.on('mouseover',this.monitorMouseOver,this);
this.monitoringMouseOver=true
}
this.fireEvent('mouseover',this,e)
}
if(this.isMenuTriggerOver(e,internal)){
this.fireEvent('menutriggerover',this,this.menu,e)
}
}
},
monitorMouseOver:function(e){
if(e.target!=this.el.dom&&!e.within(this.el)){
if(this.monitoringMouseOver){
this.doc.un('mouseover',this.monitorMouseOver,this);
this.monitoringMouseOver=false
}
this.onMouseOut(e)
}
},
onMouseOut:function(e){
var internal=e.within(this.el)&&e.target!=this.el.dom;
this.el.removeClass('x-btn-over');
this.fireEvent('mouseout',this,e);
if(this.isMenuTriggerOut(e,internal)){
this.fireEvent('menutriggerout',this,this.menu,e)
}
},
focus:function(){
this.btnEl.focus()
},
blur:function(){
this.btnEl.blur()
},
onFocus:function(e){
if(!this.disabled){
this.el.addClass('x-btn-focus')
}
},
onBlur:function(e){
this.el.removeClass('x-btn-focus')
},
getClickEl:function(e,isUp){
return this.el
},
onMouseDown:function(e){
if(!this.disabled&&e.button===0){
this.getClickEl(e).addClass('x-btn-click');
this.doc.on('mouseup',this.onMouseUp,this)
}
},
onMouseUp:function(e){
if(e.button===0){
this.getClickEl(e,true).removeClass('x-btn-click');
this.doc.un('mouseup',this.onMouseUp,this)
}
},
onMenuShow:function(e){
if(this.menu.ownerCt==this){
this.menu.ownerCt=this;
this.ignoreNextClick=0;
this.el.addClass('x-btn-menu-active');
this.fireEvent('menushow',this,this.menu)
}
},
onMenuHide:function(e){
if(this.menu.ownerCt==this){
this.el.removeClass('x-btn-menu-active');
this.ignoreNextClick=this.restoreClick.defer(250,this);
this.fireEvent('menuhide',this,this.menu);
delete this.menu.ownerCt
}
},
restoreClick:function(){
this.ignoreNextClick=0
}
});
Ext.reg('button',Ext.Button);
Ext.ButtonToggleMgr=function(){
var groups={};
function toggleGroup(btn,state){
if(state){
var g=groups[btn.toggleGroup];
for(var i=0,l=g.length;i<l;i++){
if(g[i]!=btn){
g[i].toggle(false)
}
}
}
}
return{
register:function(btn){
if(!btn.toggleGroup){
return
}
var g=groups[btn.toggleGroup];
if(!g){
g=groups[btn.toggleGroup]=[]
}
g.push(btn);
btn.on('toggle',toggleGroup)
},
unregister:function(btn){
if(!btn.toggleGroup){
return
}
var g=groups[btn.toggleGroup];
if(g){
g.remove(btn);
btn.un('toggle',toggleGroup)
}
},
getPressed:function(group){
var g=groups[group];
if(g){
for(var i=0,len=g.length;i<len;i++){
if(g[i].pressed===true){
return g[i]
}
}
}
return null
}
}
}();
Ext.SplitButton=Ext.extend(Ext.Button,{
arrowSelector:'em',
split:true,
initComponent:function(){
Ext.SplitButton.superclass.initComponent.call(this);
this.addEvents('arrowclick')
},
onRender:function(){
Ext.SplitButton.superclass.onRender.apply(this,arguments);
if(this.arrowTooltip){
this.el.child(this.arrowSelector).dom[this.tooltipType]=this.arrowTooltip
}
},
setArrowHandler:function(handler,scope){
this.arrowHandler=handler;
this.scope=scope
},
getMenuClass:function(){
return'x-btn-split'+(this.arrowAlign=='bottom'?'-bottom':'')
},
isClickOnArrow:function(e){
if(this.arrowAlign!='bottom'){
var visBtn=this.el.child('em.x-btn-split');
var right=visBtn.getRegion().right-visBtn.getPadding('r');
return e.getPageX()>right
}else{
return e.getPageY()>this.btnEl.getRegion().bottom
}
},
onClick:function(e,t){
e.preventDefault();
if(!this.disabled){
if(this.isClickOnArrow(e)){
if(this.menu&&!this.menu.isVisible()&&!this.ignoreNextClick){
this.showMenu()
}
this.fireEvent('arrowclick',this,e);
if(this.arrowHandler){
this.arrowHandler.call(this.scope||this,this,e)
}
}else{
this.doToggle();
this.fireEvent('click',this,e);
if(this.handler){
this.handler.call(this.scope||this,this,e)
}
}
}
},
isMenuTriggerOver:function(e){
return this.menu&&e.target.tagName==this.arrowSelector
},
isMenuTriggerOut:function(e,internal){
return this.menu&&e.target.tagName!=this.arrowSelector
}
});
Ext.reg('splitbutton',Ext.SplitButton);
Ext.CycleButton=Ext.extend(Ext.SplitButton,{
getItemText:function(item){
if(item&&this.showText===true){
var text='';
if(this.prependText){
text+=this.prependText
}
text+=item.text;
return text
}
return undefined
},
setActiveItem:function(item,suppressEvent){
if(!Ext.isObject(item)){
item=this.menu.getComponent(item)
}
if(item){
if(!this.rendered){
this.text=this.getItemText(item);
this.iconCls=item.iconCls
}else{
var t=this.getItemText(item);
if(t){
this.setText(t)
}
this.setIconClass(item.iconCls)
}
this.activeItem=item;
if(!item.checked){
item.setChecked(true,suppressEvent)
}
if(this.forceIcon){
this.setIconClass(this.forceIcon)
}
if(!suppressEvent){
this.fireEvent('change',this,item)
}
}
},
getActiveItem:function(){
return this.activeItem
},
initComponent:function(){
this.addEvents('change');
if(this.changeHandler){
this.on('change',this.changeHandler,this.scope||this);
delete this.changeHandler
}
this.itemCount=this.items.length;
this.menu={
cls:'x-cycle-menu',
items:[]
};
var checked=0;
Ext.each(this.items,function(item,i){
Ext.apply(item,{
group:item.group||this.id,
itemIndex:i,
checkHandler:this.checkHandler,
scope:this,
checked:item.checked||false
});
this.menu.items.push(item);
if(item.checked){
checked=i
}
},this);
Ext.CycleButton.superclass.initComponent.call(this);
this.on('click',this.toggleSelected,this);
this.setActiveItem(checked,true)
},
checkHandler:function(item,pressed){
if(pressed){
this.setActiveItem(item)
}
},
toggleSelected:function(){
var m=this.menu;
m.render();
if(!m.hasLayout){
m.doLayout()
}
var nextIdx,checkItem;
for(var i=1;i<this.itemCount;i++){
nextIdx=(this.activeItem.itemIndex+i)%this.itemCount;
checkItem=m.items.itemAt(nextIdx);
if(!checkItem.disabled){
checkItem.setChecked(true);
break
}
}
}
});
Ext.reg('cycle',Ext.CycleButton);
Ext.Toolbar=function(config){
if(Ext.isArray(config)){
config={
items:config,
layout:'toolbar'
}
}else{
config=Ext.apply({layout:'toolbar'},config);
if(config.buttons){
config.items=config.buttons
}
}
Ext.Toolbar.superclass.constructor.call(this,config)
};
(function(){
var T=Ext.Toolbar;
Ext.extend(T,Ext.Container,{
defaultType:'button',
enableOverflow:false,
trackMenus:true,
internalDefaults:{},
toolbarCls:'x-toolbar',
initComponent:function(){
T.superclass.initComponent.call(this);
this.addEvents('overflowchange')
},
onRender:function(ct,position){
if(!this.el){
if(!this.autoCreate){
this.autoCreate={cls:this.toolbarCls+' x-small-editor'}
}
this.el=ct.createChild(Ext.apply({id:this.id},this.autoCreate),position);
Ext.Toolbar.superclass.onRender.apply(this,arguments)
}
},
lookupComponent:function(c){
if(Ext.isString(c)){
if(c=='-'){
c=new T.Separator
}else if(c==' '){
c=new T.Spacer
}else if(c=='->'){
c=new T.Fill
}else{
c=new T.TextItem(c)
}
this.applyDefaults(c)
}else{
if(c.isFormField||c.render){
c=this.createComponent(c)
}else if(c.tag){
c=new T.Item({autoEl:c})
}else if(c.tagName){
c=new T.Item({el:c})
}else if(Ext.isObject(c)){
c=c.xtype?this.createComponent(c):this.constructButton(c)
}
}
return c
},
applyDefaults:function(c){
if(!Ext.isString(c)){
c=Ext.Toolbar.superclass.applyDefaults.call(this,c);
var d=this.internalDefaults;
if(c.events){
Ext.applyIf(c.initialConfig,d);
Ext.apply(c,d)
}else{
Ext.applyIf(c,d)
}
}
return c
},
addSeparator:function(){
return this.add(new T.Separator)
},
addSpacer:function(){
return this.add(new T.Spacer)
},
addFill:function(){
this.add(new T.Fill)
},
addElement:function(el){
return this.addItem(new T.Item({el:el}))
},
addItem:function(item){
return this.add.apply(this,arguments)
},
addButton:function(config){
if(Ext.isArray(config)){
var buttons=[];
for(var i=0,len=config.length;i<len;i++){
buttons.push(this.addButton(config[i]))
}
return buttons
}
return this.add(this.constructButton(config))
},
addText:function(text){
return this.addItem(new T.TextItem(text))
},
addDom:function(config){
return this.add(new T.Item({autoEl:config}))
},
addField:function(field){
return this.add(field)
},
insertButton:function(index,item){
if(Ext.isArray(item)){
var buttons=[];
for(var i=0,len=item.length;i<len;i++){
buttons.push(this.insertButton(index+i,item[i]))
}
return buttons
}
return Ext.Toolbar.superclass.insert.call(this,index,item)
},
trackMenu:function(item,remove){
if(this.trackMenus&&item.menu){
var method=remove?'mun':'mon';
this[method](item,'menutriggerover',this.onButtonTriggerOver,this);
this[method](item,'menushow',this.onButtonMenuShow,this);
this[method](item,'menuhide',this.onButtonMenuHide,this)
}
},
constructButton:function(item){
var b=item.events?item:this.createComponent(item,item.split?'splitbutton':this.defaultType);
return b
},
onAdd:function(c){
Ext.Toolbar.superclass.onAdd.call(this);
this.trackMenu(c);
if(this.disabled){
c.disable()
}
},
onRemove:function(c){
Ext.Toolbar.superclass.onRemove.call(this);
if(c==this.activeMenuBtn){
delete this.activeMenuBtn
}
this.trackMenu(c,true)
},
onDisable:function(){
this.items.each(function(item){
if(item.disable){
item.disable()
}
})
},
onEnable:function(){
this.items.each(function(item){
if(item.enable){
item.enable()
}
})
},
onButtonTriggerOver:function(btn){
if(this.activeMenuBtn&&this.activeMenuBtn!=btn){
this.activeMenuBtn.hideMenu();
btn.showMenu();
this.activeMenuBtn=btn
}
},
onButtonMenuShow:function(btn){
this.activeMenuBtn=btn
},
onButtonMenuHide:function(btn){
delete this.activeMenuBtn
}
});
Ext.reg('toolbar',Ext.Toolbar);
T.Item=Ext.extend(Ext.BoxComponent,{
enable:Ext.emptyFn,
disable:Ext.emptyFn,
focus:Ext.emptyFn
});
Ext.reg('tbitem',T.Item);
T.Separator=Ext.extend(T.Item,{
onRender:function(ct,position){
this.el=ct.createChild({
tag:'span',
cls:'xtb-sep'
},position)
}
});
Ext.reg('tbseparator',T.Separator);
T.Spacer=Ext.extend(T.Item,{
onRender:function(ct,position){
this.el=ct.createChild({
tag:'div',
cls:'xtb-spacer',
style:this.width?'width:'+this.width+'px':''
},position)
}
});
Ext.reg('tbspacer',T.Spacer);
T.Fill=Ext.extend(T.Item,{
render:Ext.emptyFn,
isFill:true
});
Ext.reg('tbfill',T.Fill);
T.TextItem=Ext.extend(T.Item,{
constructor:function(config){
T.TextItem.superclass.constructor.call(this,Ext.isString(config)?{text:config}:config)
},
onRender:function(ct,position){
this.autoEl={
cls:'xtb-text',
html:this.text||''
};
T.TextItem.superclass.onRender.call(this,ct,position)
},
setText:function(t){
if(this.rendered){
this.el.update(t)
}else{
this.text=t
}
}
});
Ext.reg('tbtext',T.TextItem);
T.Button=Ext.extend(Ext.Button,{});
T.SplitButton=Ext.extend(Ext.SplitButton,{});
Ext.reg('tbbutton',T.Button);
Ext.reg('tbsplit',T.SplitButton)
}());
Ext.ButtonGroup=Ext.extend(Ext.Panel,{
baseCls:'x-btn-group',
layout:'table',
defaultType:'button',
frame:true,
internalDefaults:{
removeMode:'container',
hideParent:true
},
initComponent:function(){
this.layoutConfig=this.layoutConfig||{};
Ext.applyIf(this.layoutConfig,{columns:this.columns});
if(!this.title){
this.addClass('x-btn-group-notitle')
}
this.on('afterlayout',this.onAfterLayout,this);
Ext.ButtonGroup.superclass.initComponent.call(this)
},
applyDefaults:function(c){
c=Ext.ButtonGroup.superclass.applyDefaults.call(this,c);
var d=this.internalDefaults;
if(c.events){
Ext.applyIf(c.initialConfig,d);
Ext.apply(c,d)
}else{
Ext.applyIf(c,d)
}
return c
},
onAfterLayout:function(){
var bodyWidth=this.body.getFrameWidth('lr')+this.body.dom.firstChild.offsetWidth;
this.body.setWidth(bodyWidth);
this.el.setWidth(bodyWidth+this.getFrameWidth())
}
});
Ext.reg('buttongroup',Ext.ButtonGroup);
(function(){
var T=Ext.Toolbar;
Ext.PagingToolbar=Ext.extend(Ext.Toolbar,{
pageSize:20,
displayMsg:'Displaying {0} - {1} of {2}',
emptyMsg:'No data to display',
beforePageText:'Page',
afterPageText:'of {0}',
firstText:'First Page',
prevText:'Previous Page',
nextText:'Next Page',
lastText:'Last Page',
refreshText:'Refresh',
initComponent:function(){
var pagingItems=[
this.first=new T.Button({
tooltip:this.firstText,
overflowText:this.firstText,
iconCls:'x-tbar-page-first',
disabled:true,
handler:this.moveFirst,
scope:this
}),
this.prev=new T.Button({
tooltip:this.prevText,
overflowText:this.prevText,
iconCls:'x-tbar-page-prev',
disabled:true,
handler:this.movePrevious,
scope:this
}),
'-',
this.beforePageText,
this.inputItem=new Ext.form.NumberField({
cls:'x-tbar-page-number',
allowDecimals:false,
allowNegative:false,
enableKeyEvents:true,
selectOnFocus:true,
submitValue:false,
listeners:{
scope:this,
keydown:this.onPagingKeyDown,
blur:this.onPagingBlur
}
}),
this.afterTextItem=new T.TextItem({text:String.format(this.afterPageText,1)}),
'-',
this.next=new T.Button({
tooltip:this.nextText,
overflowText:this.nextText,
iconCls:'x-tbar-page-next',
disabled:true,
handler:this.moveNext,
scope:this
}),
this.last=new T.Button({
tooltip:this.lastText,
overflowText:this.lastText,
iconCls:'x-tbar-page-last',
disabled:true,
handler:this.moveLast,
scope:this
}),
'-',
this.refresh=new T.Button({
tooltip:this.refreshText,
overflowText:this.refreshText,
iconCls:'x-tbar-loading',
handler:this.doRefresh,
scope:this
})
];
var userItems=this.items||this.buttons||[];
if(this.prependButtons){
this.items=userItems.concat(pagingItems)
}else{
this.items=pagingItems.concat(userItems)
}
delete this.buttons;
if(this.displayInfo){
this.items.push('->');
this.items.push(this.displayItem=new T.TextItem({}))
}
Ext.PagingToolbar.superclass.initComponent.call(this);
this.addEvents('change','beforechange');
this.on('afterlayout',this.onFirstLayout,this,{single:true});
this.cursor=0;
this.bindStore(this.store,true)
},
onFirstLayout:function(){
if(this.dsLoaded){
this.onLoad.apply(this,this.dsLoaded)
}
},
updateInfo:function(){
if(this.displayItem){
var count=this.store.getCount();
var msg=count==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+count,this.store.getTotalCount());
this.displayItem.setText(msg)
}
},
onLoad:function(store,r,o){
if(!this.rendered){
this.dsLoaded=[
store,
r,
o
];
return
}
var p=this.getParams();
this.cursor=o.params&&o.params[p.start]?o.params[p.start]:0;
var d=this.getPageData(),ap=d.activePage,ps=d.pages;
this.afterTextItem.setText(String.format(this.afterPageText,d.pages));
this.inputItem.setValue(ap);
this.first.setDisabled(ap==1);
this.prev.setDisabled(ap==1);
this.next.setDisabled(ap==ps);
this.last.setDisabled(ap==ps);
this.refresh.enable();
this.updateInfo();
this.fireEvent('change',this,d)
},
getPageData:function(){
var total=this.store.getTotalCount();
return{
total:total,
activePage:Math.ceil((this.cursor+this.pageSize)/this.pageSize),
pages:total<this.pageSize?1:Math.ceil(total/this.pageSize)
}
},
changePage:function(page){
this.doLoad(((page-1)*this.pageSize).constrain(0,this.store.getTotalCount()))
},
onLoadError:function(){
if(!this.rendered){
return
}
this.refresh.enable()
},
readPage:function(d){
var v=this.inputItem.getValue(),pageNum;
if(!v||isNaN(pageNum=parseInt(v,10))){
this.inputItem.setValue(d.activePage);
return false
}
return pageNum
},
onPagingFocus:function(){
this.inputItem.select()
},
onPagingBlur:function(e){
this.inputItem.setValue(this.getPageData().activePage)
},
onPagingKeyDown:function(field,e){
var k=e.getKey(),d=this.getPageData(),pageNum;
if(k==e.RETURN){
e.stopEvent();
pageNum=this.readPage(d);
if(pageNum!==false){
pageNum=Math.min(Math.max(1,pageNum),d.pages)-1;
this.doLoad(pageNum*this.pageSize)
}
}else if(k==e.HOME||k==e.END){
e.stopEvent();
pageNum=k==e.HOME?1:d.pages;
field.setValue(pageNum)
}else if(k==e.UP||k==e.PAGEUP||k==e.DOWN||k==e.PAGEDOWN){
e.stopEvent();
if(pageNum=this.readPage(d)){
var increment=e.shiftKey?10:1;
if(k==e.DOWN||k==e.PAGEDOWN){
increment*=-1
}
pageNum+=increment;
if(pageNum>=1&pageNum<=d.pages){
field.setValue(pageNum)
}
}
}
},
getParams:function(){
return this.paramNames||this.store.paramNames
},
beforeLoad:function(){
if(this.rendered&&this.refresh){
this.refresh.disable()
}
},
doLoad:function(start){
var o={},pn=this.getParams();
o[pn.start]=start;
o[pn.limit]=this.pageSize;
if(this.fireEvent('beforechange',this,o)!==false){
this.store.load({params:o})
}
},
moveFirst:function(){
this.doLoad(0)
},
movePrevious:function(){
this.doLoad(Math.max(0,this.cursor-this.pageSize))
},
moveNext:function(){
this.doLoad(this.cursor+this.pageSize)
},
moveLast:function(){
var total=this.store.getTotalCount(),extra=total%this.pageSize;
this.doLoad(extra?total-extra:total-this.pageSize)
},
doRefresh:function(){
this.doLoad(this.cursor)
},
bindStore:function(store,initial){
var doLoad;
if(!initial&&this.store){
if(store!==this.store&&this.store.autoDestroy){
this.store.destroy()
}else{
this.store.un('beforeload',this.beforeLoad,this);
this.store.un('load',this.onLoad,this);
this.store.un('exception',this.onLoadError,this)
}
if(!store){
this.store=null
}
}
if(store){
store=Ext.StoreMgr.lookup(store);
store.on({
scope:this,
beforeload:this.beforeLoad,
load:this.onLoad,
exception:this.onLoadError
});
doLoad=true
}
this.store=store;
if(doLoad){
this.onLoad(store,null,{})
}
},
unbind:function(store){
this.bindStore(null)
},
bind:function(store){
this.bindStore(store)
},
onDestroy:function(){
this.bindStore(null);
Ext.PagingToolbar.superclass.onDestroy.call(this)
}
})
}());
Ext.reg('paging',Ext.PagingToolbar);
Ext.History=function(){
var iframe,hiddenField;
var ready=false;
var currentToken;
function getHash(){
var href=location.href,i=href.indexOf('#'),hash=i>=0?href.substr(i+1):null;
if(Ext.isGecko){
hash=decodeURIComponent(hash)
}
return hash
}
function doSave(){
hiddenField.value=currentToken
}
function handleStateChange(token){
currentToken=token;
Ext.History.fireEvent('change',token)
}
function updateIFrame(token){
var html=[
'<html><body><div id="state">',
Ext.util.Format.htmlEncode(token),
'</div></body></html>'
].join('');
try{
var doc=iframe.contentWindow.document;
doc.open();
doc.write(html);
doc.close();
return true
}catch(e){
return false
}
}
function checkIFrame(){
if(!iframe.contentWindow||!iframe.contentWindow.document){
setTimeout(checkIFrame,10);
return
}
var doc=iframe.contentWindow.document;
var elem=doc.getElementById('state');
var token=elem?elem.innerText:null;
var hash=getHash();
setInterval(function(){
doc=iframe.contentWindow.document;
elem=doc.getElementById('state');
var newtoken=elem?elem.innerText:null;
var newHash=getHash();
if(newtoken!==token){
token=newtoken;
handleStateChange(token);
location.hash=token;
hash=token;
doSave()
}else if(newHash!==hash){
hash=newHash;
updateIFrame(newHash)
}
},50);
ready=true;
Ext.History.fireEvent('ready',Ext.History)
}
function startUp(){
currentToken=hiddenField.value?hiddenField.value:getHash();
if(Ext.isIE){
checkIFrame()
}else{
var hash=getHash();
setInterval(function(){
var newHash=getHash();
if(newHash!==hash){
hash=newHash;
handleStateChange(hash);
doSave()
}
},50);
ready=true;
Ext.History.fireEvent('ready',Ext.History)
}
}
return{
fieldId:'x-history-field',
iframeId:'x-history-frame',
events:{},
init:function(onReady,scope){
if(ready){
Ext.callback(onReady,scope,[this]);
return
}
if(!Ext.isReady){
Ext.onReady(function(){
Ext.History.init(onReady,scope)
});
return
}
hiddenField=Ext.getDom(Ext.History.fieldId);
if(Ext.isIE){
iframe=Ext.getDom(Ext.History.iframeId)
}
this.addEvents('ready','change');
if(onReady){
this.on('ready',onReady,scope,{single:true})
}
startUp()
},
add:function(token,preventDup){
if(preventDup!==false){
if(this.getToken()==token){
return true
}
}
if(Ext.isIE){
return updateIFrame(token)
}else{
location.hash=token;
return true
}
},
back:function(){
history.go(-1)
},
forward:function(){
history.go(1)
},
getToken:function(){
return ready?currentToken:getHash()
}
}
}();
Ext.apply(Ext.History,new Ext.util.Observable);
Ext.Tip=Ext.extend(Ext.Panel,{
minWidth:40,
maxWidth:300,
shadow:'sides',
defaultAlign:'tl-bl?',
autoRender:true,
quickShowInterval:250,
frame:true,
hidden:true,
baseCls:'x-tip',
floating:{
shadow:true,
shim:true,
useDisplay:true,
constrain:false
},
autoHeight:true,
closeAction:'hide',
initComponent:function(){
Ext.Tip.superclass.initComponent.call(this);
if(this.closable&&!this.title){
this.elements+=',header'
}
},
afterRender:function(){
Ext.Tip.superclass.afterRender.call(this);
if(this.closable){
this.addTool({
id:'close',
handler:this[this.closeAction],
scope:this
})
}
},
showAt:function(xy){
Ext.Tip.superclass.show.call(this);
if(this.measureWidth!==false&&(!this.initialConfig||typeof this.initialConfig.width!='number')){
this.doAutoWidth()
}
if(this.constrainPosition){
xy=this.el.adjustForConstraints(xy)
}
this.setPagePosition(xy[0],xy[1])
},
doAutoWidth:function(adjust){
adjust=adjust||0;
var bw=this.body.getTextWidth();
bw+=1;
if(this.title){
bw=Math.max(bw,this.header.child('span').getTextWidth(this.title))
}
bw+=this.getFrameWidth()+(this.closable?20:0)+this.body.getPadding('lr')+adjust;
this.setWidth(bw.constrain(this.minWidth,this.maxWidth));
if(Ext.isIE7&&!this.repainted){
this.el.repaint();
this.repainted=true
}
},
showBy:function(el,pos){
if(!this.rendered){
this.render(Ext.getBody())
}
this.showAt(this.el.getAlignToXY(el,pos||this.defaultAlign))
},
initDraggable:function(){
this.dd=new Ext.Tip.DD(this,typeof this.draggable=='boolean'?null:this.draggable);
this.header.addClass('x-tip-draggable')
}
});
Ext.reg('tip',Ext.Tip);
Ext.Tip.DD=function(tip,config){
Ext.apply(this,config);
this.tip=tip;
Ext.Tip.DD.superclass.constructor.call(this,tip.el.id,'WindowDD-'+tip.id);
this.setHandleElId(tip.header.id);
this.scroll=false
};
Ext.extend(Ext.Tip.DD,Ext.dd.DD,{
moveOnly:true,
scroll:false,
headerOffsets:[
100,
25
],
startDrag:function(){
this.tip.el.disableShadow()
},
endDrag:function(e){
this.tip.el.enableShadow(true)
}
});
Ext.ToolTip=Ext.extend(Ext.Tip,{
showDelay:500,
hideDelay:200,
dismissDelay:5000,
trackMouse:false,
anchorToTarget:true,
anchorOffset:0,
targetCounter:0,
constrainPosition:false,
initComponent:function(){
Ext.ToolTip.superclass.initComponent.call(this);
this.lastActive=new Date;
this.initTarget(this.target);
this.origAnchor=this.anchor
},
onRender:function(ct,position){
Ext.ToolTip.superclass.onRender.call(this,ct,position);
this.anchorCls='x-tip-anchor-'+this.getAnchorPosition();
this.anchorEl=this.el.createChild({cls:'x-tip-anchor '+this.anchorCls})
},
afterRender:function(){
Ext.ToolTip.superclass.afterRender.call(this);
this.anchorEl.setStyle('z-index',this.el.getZIndex()+1).setVisibilityMode(Ext.Element.DISPLAY)
},
initTarget:function(target){
var t;
if(t=Ext.get(target)){
if(this.target){
var tg=Ext.get(this.target);
this.mun(tg,'mouseover',this.onTargetOver,this);
this.mun(tg,'mouseout',this.onTargetOut,this);
this.mun(tg,'mousemove',this.onMouseMove,this)
}
this.mon(t,{
mouseover:this.onTargetOver,
mouseout:this.onTargetOut,
mousemove:this.onMouseMove,
scope:this
});
this.target=t
}
if(this.anchor){
this.anchorTarget=this.target
}
},
onMouseMove:function(e){
var t=this.delegate?e.getTarget(this.delegate):this.triggerElement=true;
if(t){
this.targetXY=e.getXY();
if(t===this.triggerElement){
if(!this.hidden&&this.trackMouse){
this.setPagePosition(this.getTargetXY())
}
}else{
this.hide();
this.lastActive=new Date(0);
this.onTargetOver(e)
}
}else if(!this.closable&&this.isVisible()){
this.hide()
}
},
getTargetXY:function(){
if(this.delegate){
this.anchorTarget=this.triggerElement
}
if(this.anchor){
this.targetCounter++;
var offsets=this.getOffsets(),xy=this.anchorToTarget&&!this.trackMouse?this.el.getAlignToXY(this.anchorTarget,this.getAnchorAlign()):this.targetXY,dw=Ext.lib.Dom.getViewWidth()-5,dh=Ext.lib.Dom.getViewHeight()-5,de=document.documentElement,bd=document.body,scrollX=(de.scrollLeft||bd.scrollLeft||0)+5,scrollY=(de.scrollTop||bd.scrollTop||0)+5,axy=[
xy[0]+offsets[0],
xy[1]+offsets[1]
],sz=this.getSize();
this.anchorEl.removeClass(this.anchorCls);
if(this.targetCounter<2){
if(axy[0]<scrollX){
if(this.anchorToTarget){
this.defaultAlign='l-r';
if(this.mouseOffset){
this.mouseOffset[0]*=-1
}
}
this.anchor='left';
return this.getTargetXY()
}
if(axy[0]+sz.width>dw){
if(this.anchorToTarget){
this.defaultAlign='r-l';
if(this.mouseOffset){
this.mouseOffset[0]*=-1
}
}
this.anchor='right';
return this.getTargetXY()
}
if(axy[1]<scrollY){
if(this.anchorToTarget){
this.defaultAlign='t-b';
if(this.mouseOffset){
this.mouseOffset[1]*=-1
}
}
this.anchor='top';
return this.getTargetXY()
}
if(axy[1]+sz.height>dh){
if(this.anchorToTarget){
this.defaultAlign='b-t';
if(this.mouseOffset){
this.mouseOffset[1]*=-1
}
}
this.anchor='bottom';
return this.getTargetXY()
}
}
this.anchorCls='x-tip-anchor-'+this.getAnchorPosition();
this.anchorEl.addClass(this.anchorCls);
this.targetCounter=0;
return axy
}else{
var mouseOffset=this.getMouseOffset();
return[
this.targetXY[0]+mouseOffset[0],
this.targetXY[1]+mouseOffset[1]
]
}
},
getMouseOffset:function(){
var offset=this.anchor?[
0,
0
]:[
15,
18
];
if(this.mouseOffset){
offset[0]+=this.mouseOffset[0];
offset[1]+=this.mouseOffset[1]
}
return offset
},
getAnchorPosition:function(){
if(this.anchor){
this.tipAnchor=this.anchor.charAt(0)
}else{
var m=this.defaultAlign.match(/^([a-z]+)-([a-z]+)(\?)?$/);
if(!m){
throw'AnchorTip.defaultAlign is invalid'
}
this.tipAnchor=m[1].charAt(0)
}
switch(this.tipAnchor){
case't':
return'top';
case'b':
return'bottom';
case'r':
return'right'
}
return'left'
},
getAnchorAlign:function(){
switch(this.anchor){
case'top':
return'tl-bl';
case'left':
return'tl-tr';
case'right':
return'tr-tl';
default:
return'bl-tl'
}
},
getOffsets:function(){
var offsets,ap=this.getAnchorPosition().charAt(0);
if(this.anchorToTarget&&!this.trackMouse){
switch(ap){
case't':
offsets=[
0,
9
];
break;
case'b':
offsets=[
0,
-13
];
break;
case'r':
offsets=[
-13,
0
];
break;
default:
offsets=[
9,
0
];
break
}
}else{
switch(ap){
case't':
offsets=[
-15-this.anchorOffset,
30
];
break;
case'b':
offsets=[
-19-this.anchorOffset,
-13-this.el.dom.offsetHeight
];
break;
case'r':
offsets=[
-15-this.el.dom.offsetWidth,
-13-this.anchorOffset
];
break;
default:
offsets=[
25,
-13-this.anchorOffset
];
break
}
}
var mouseOffset=this.getMouseOffset();
offsets[0]+=mouseOffset[0];
offsets[1]+=mouseOffset[1];
return offsets
},
onTargetOver:function(e){
if(this.disabled||e.within(this.target.dom,true)){
return
}
var t=e.getTarget(this.delegate);
if(t){
this.triggerElement=t;
this.clearTimer('hide');
this.targetXY=e.getXY();
this.delayShow()
}
},
delayShow:function(){
if(this.hidden&&!this.showTimer){
if(this.lastActive.getElapsed()<this.quickShowInterval){
this.show()
}else{
this.showTimer=this.show.defer(this.showDelay,this)
}
}else if(!this.hidden&&this.autoHide!==false){
this.show()
}
},
onTargetOut:function(e){
if(this.disabled||e.within(this.target.dom,true)){
return
}
this.clearTimer('show');
if(this.autoHide!==false){
this.delayHide()
}
},
delayHide:function(){
if(!this.hidden&&!this.hideTimer){
this.hideTimer=this.hide.defer(this.hideDelay,this)
}
},
hide:function(){
this.clearTimer('dismiss');
this.lastActive=new Date;
if(this.anchorEl){
this.anchorEl.hide()
}
Ext.ToolTip.superclass.hide.call(this);
delete this.triggerElement
},
show:function(){
if(this.anchor){
this.showAt([
-1000,
-1000
]);
this.origConstrainPosition=this.constrainPosition;
this.constrainPosition=false;
this.anchor=this.origAnchor
}
this.showAt(this.getTargetXY());
if(this.anchor){
this.anchorEl.show();
this.syncAnchor();
this.constrainPosition=this.origConstrainPosition
}else{
this.anchorEl.hide()
}
},
showAt:function(xy){
this.lastActive=new Date;
this.clearTimers();
Ext.ToolTip.superclass.showAt.call(this,xy);
if(this.dismissDelay&&this.autoHide!==false){
this.dismissTimer=this.hide.defer(this.dismissDelay,this)
}
if(this.anchor&&!this.anchorEl.isVisible()){
this.syncAnchor();
this.anchorEl.show()
}else{
this.anchorEl.hide()
}
},
syncAnchor:function(){
var anchorPos,targetPos,offset;
switch(this.tipAnchor.charAt(0)){
case't':
anchorPos='b';
targetPos='tl';
offset=[
20+this.anchorOffset,
2
];
break;
case'r':
anchorPos='l';
targetPos='tr';
offset=[
-2,
11+this.anchorOffset
];
break;
case'b':
anchorPos='t';
targetPos='bl';
offset=[
20+this.anchorOffset,
-2
];
break;
default:
anchorPos='r';
targetPos='tl';
offset=[
2,
11+this.anchorOffset
];
break
}
this.anchorEl.alignTo(this.el,anchorPos+'-'+targetPos,offset)
},
setPagePosition:function(x,y){
Ext.ToolTip.superclass.setPagePosition.call(this,x,y);
if(this.anchor){
this.syncAnchor()
}
},
clearTimer:function(name){
name=name+'Timer';
clearTimeout(this[name]);
delete this[name]
},
clearTimers:function(){
this.clearTimer('show');
this.clearTimer('dismiss');
this.clearTimer('hide')
},
onShow:function(){
Ext.ToolTip.superclass.onShow.call(this);
Ext.getDoc().on('mousedown',this.onDocMouseDown,this)
},
onHide:function(){
Ext.ToolTip.superclass.onHide.call(this);
Ext.getDoc().un('mousedown',this.onDocMouseDown,this)
},
onDocMouseDown:function(e){
if(this.autoHide!==true&&!this.closable&&!e.within(this.el.dom)){
this.disable();
this.doEnable.defer(100,this)
}
},
doEnable:function(){
if(!this.isDestroyed){
this.enable()
}
},
onDisable:function(){
this.clearTimers();
this.hide()
},
adjustPosition:function(x,y){
if(this.constrainPosition){
var ay=this.targetXY[1],h=this.getSize().height;
if(y<=ay&&y+h>=ay){
y=ay-h-5
}
}
return{
x:x,
y:y
}
},
beforeDestroy:function(){
this.clearTimers();
Ext.destroy(this.anchorEl);
delete this.anchorEl;
delete this.target;
delete this.anchorTarget;
delete this.triggerElement;
Ext.ToolTip.superclass.beforeDestroy.call(this)
},
onDestroy:function(){
Ext.getDoc().un('mousedown',this.onDocMouseDown,this);
Ext.ToolTip.superclass.onDestroy.call(this)
}
});
Ext.reg('tooltip',Ext.ToolTip);
Ext.QuickTip=Ext.extend(Ext.ToolTip,{
interceptTitles:false,
tagConfig:{
namespace:'ext',
attribute:'qtip',
width:'qwidth',
target:'target',
title:'qtitle',
hide:'hide',
cls:'qclass',
align:'qalign',
anchor:'anchor'
},
initComponent:function(){
this.target=this.target||Ext.getDoc();
this.targets=this.targets||{};
Ext.QuickTip.superclass.initComponent.call(this)
},
register:function(config){
var cs=Ext.isArray(config)?config:arguments;
for(var i=0,len=cs.length;i<len;i++){
var c=cs[i];
var target=c.target;
if(target){
if(Ext.isArray(target)){
for(var j=0,jlen=target.length;j<jlen;j++){
this.targets[Ext.id(target[j])]=c
}
}else{
this.targets[Ext.id(target)]=c
}
}
}
},
unregister:function(el){
delete this.targets[Ext.id(el)]
},
cancelShow:function(el){
var at=this.activeTarget;
el=Ext.get(el).dom;
if(this.isVisible()){
if(at&&at.el==el){
this.hide()
}
}else if(at&&at.el==el){
this.clearTimer('show')
}
},
getTipCfg:function(e){
var t=e.getTarget(),ttp,cfg;
if(this.interceptTitles&&t.title&&Ext.isString(t.title)){
ttp=t.title;
t.qtip=ttp;
t.removeAttribute('title');
e.preventDefault()
}else{
cfg=this.tagConfig;
ttp=t.qtip||Ext.fly(t).getAttribute(cfg.attribute,cfg.namespace)||t.parentElement&&t.parentElement.qtip
}
return ttp
},
onTargetOver:function(e){
if(this.disabled){
return
}
this.targetXY=e.getXY();
var t=e.getTarget();
if(!t||t.nodeType!==1||t==document||t==document.body){
return
}
if(this.activeTarget&&(t==this.activeTarget.el||Ext.fly(this.activeTarget.el).contains(t))){
this.clearTimer('hide');
this.show();
return
}
if(t&&this.targets[t.id]){
this.activeTarget=this.targets[t.id];
this.activeTarget.el=t;
this.anchor=this.activeTarget.anchor;
if(this.anchor){
this.anchorTarget=t
}
this.delayShow();
return
}
var ttp,et=Ext.fly(t),cfg=this.tagConfig,ns=cfg.namespace;
if(ttp=this.getTipCfg(e)){
var autoHide=et.getAttribute(cfg.hide,ns);
this.activeTarget={
el:t,
text:ttp,
width:et.getAttribute(cfg.width,ns),
autoHide:autoHide!='user'&&autoHide!=='false',
title:et.getAttribute(cfg.title,ns),
cls:et.getAttribute(cfg.cls,ns),
align:et.getAttribute(cfg.align,ns)
};
this.anchor=et.getAttribute(cfg.anchor,ns);
if(this.anchor){
this.anchorTarget=t
}
this.delayShow()
}
},
onTargetOut:function(e){
if(this.activeTarget&&e.within(this.activeTarget.el)&&!this.getTipCfg(e)){
return
}
this.clearTimer('show');
if(this.autoHide!==false){
this.delayHide()
}
},
showAt:function(xy){
var t=this.activeTarget;
if(t){
if(!this.rendered){
this.render(Ext.getBody());
this.activeTarget=t
}
if(t.width){
this.setWidth(t.width);
this.body.setWidth(this.adjustBodyWidth(t.width-this.getFrameWidth()));
this.measureWidth=false
}else{
this.measureWidth=true
}
this.setTitle(t.title||'');
this.body.update(t.text);
this.autoHide=t.autoHide;
this.dismissDelay=t.dismissDelay||this.dismissDelay;
if(this.lastCls){
this.el.removeClass(this.lastCls);
delete this.lastCls
}
if(t.cls){
this.el.addClass(t.cls);
this.lastCls=t.cls
}
if(this.anchor){
this.constrainPosition=false
}else if(t.align){
xy=this.el.getAlignToXY(t.el,t.align);
this.constrainPosition=false
}else{
this.constrainPosition=true
}
}
Ext.QuickTip.superclass.showAt.call(this,xy)
},
hide:function(){
delete this.activeTarget;
Ext.QuickTip.superclass.hide.call(this)
}
});
Ext.reg('quicktip',Ext.QuickTip);
Ext.QuickTips=function(){
var tip,disabled=false;
return{
init:function(autoRender){
if(!tip){
if(!Ext.isReady){
Ext.onReady(function(){
Ext.QuickTips.init(autoRender)
});
return
}
tip=new Ext.QuickTip({
elements:'header,body',
disabled:disabled
});
if(autoRender!==false){
tip.render(Ext.getBody())
}
}
},
ddDisable:function(){
if(tip&&!disabled){
tip.disable()
}
},
ddEnable:function(){
if(tip&&!disabled){
tip.enable()
}
},
enable:function(){
if(tip){
tip.enable()
}
disabled=false
},
disable:function(){
if(tip){
tip.disable()
}
disabled=true
},
isEnabled:function(){
return tip!==undefined&&!tip.disabled
},
getQuickTip:function(){
return tip
},
register:function(){
tip.register.apply(tip,arguments)
},
unregister:function(){
tip.unregister.apply(tip,arguments)
},
tips:function(){
tip.register.apply(tip,arguments)
}
}
}();
Ext.slider.Tip=Ext.extend(Ext.Tip,{
minWidth:10,
offsets:[
0,
-10
],
init:function(slider){
slider.on({
scope:this,
dragstart:this.onSlide,
drag:this.onSlide,
dragend:this.hide,
destroy:this.destroy
})
},
onSlide:function(slider,e,thumb){
this.show();
this.body.update(this.getText(thumb));
this.doAutoWidth();
this.el.alignTo(thumb.el,'b-t?',this.offsets)
},
getText:function(thumb){
return String(thumb.value)
}
});
Ext.ux.SliderTip=Ext.slider.Tip;
Ext.tree.TreePanel=Ext.extend(Ext.Panel,{
rootVisible:true,
animate:Ext.enableFx,
lines:true,
enableDD:false,
hlDrop:Ext.enableFx,
pathSeparator:'/',
bubbleEvents:[],
initComponent:function(){
Ext.tree.TreePanel.superclass.initComponent.call(this);
if(!this.eventModel){
this.eventModel=new Ext.tree.TreeEventModel(this)
}
var l=this.loader;
if(!l){
l=new Ext.tree.TreeLoader({
dataUrl:this.dataUrl,
requestMethod:this.requestMethod
})
}else if(Ext.isObject(l)&&!l.load){
l=new Ext.tree.TreeLoader(l)
}
this.loader=l;
this.nodeHash={};
if(this.root){
var r=this.root;
delete this.root;
this.setRootNode(r)
}
this.addEvents('append','remove','movenode','insert','beforeappend','beforeremove','beforemovenode','beforeinsert','beforeload','load','textchange','beforeexpandnode','beforecollapsenode','expandnode','disabledchange','collapsenode','beforeclick','click','containerclick','checkchange','beforedblclick','dblclick','containerdblclick','contextmenu','containercontextmenu','beforechildrenrendered','startdrag','enddrag','dragdrop','beforenodedrop','nodedrop','nodedragover');
if(this.singleExpand){
this.on('beforeexpandnode',this.restrictExpand,this)
}
},
proxyNodeEvent:function(ename,a1,a2,a3,a4,a5,a6){
if(ename=='collapse'||ename=='expand'||ename=='beforecollapse'||ename=='beforeexpand'||ename=='move'||ename=='beforemove'){
ename=ename+'node'
}
return this.fireEvent(ename,a1,a2,a3,a4,a5,a6)
},
getRootNode:function(){
return this.root
},
setRootNode:function(node){
this.destroyRoot();
if(!node.render){
node=this.loader.createNode(node)
}
this.root=node;
node.ownerTree=this;
node.isRoot=true;
this.registerNode(node);
if(!this.rootVisible){
var uiP=node.attributes.uiProvider;
node.ui=uiP?new uiP(node):new Ext.tree.RootTreeNodeUI(node)
}
if(this.innerCt){
this.clearInnerCt();
this.renderRoot()
}
return node
},
clearInnerCt:function(){
this.innerCt.update('')
},
renderRoot:function(){
this.root.render();
if(!this.rootVisible){
this.root.renderChildren()
}
},
getNodeById:function(id){
return this.nodeHash[id]
},
registerNode:function(node){
this.nodeHash[node.id]=node
},
unregisterNode:function(node){
delete this.nodeHash[node.id]
},
toString:function(){
return'[Tree'+(this.id?' '+this.id:'')+']'
},
restrictExpand:function(node){
var p=node.parentNode;
if(p){
if(p.expandedChild&&p.expandedChild.parentNode==p){
p.expandedChild.collapse()
}
p.expandedChild=node
}
},
getChecked:function(a,startNode){
startNode=startNode||this.root;
var r=[];
var f=function(){
if(this.attributes.checked){
r.push(!a?this:a=='id'?this.id:this.attributes[a])
}
};
startNode.cascade(f);
return r
},
getLoader:function(){
return this.loader
},
expandAll:function(){
this.root.expand(true)
},
collapseAll:function(){
this.root.collapse(true)
},
getSelectionModel:function(){
if(!this.selModel){
this.selModel=new Ext.tree.DefaultSelectionModel
}
return this.selModel
},
expandPath:function(path,attr,callback){
if(Ext.isEmpty(path)){
if(callback){
callback(false,undefined)
}
return
}
attr=attr||'id';
var keys=path.split(this.pathSeparator);
var curNode=this.root;
if(curNode.attributes[attr]!=keys[1]){
if(callback){
callback(false,null)
}
return
}
var index=1;
var f=function(){
if(++index==keys.length){
if(callback){
callback(true,curNode)
}
return
}
var c=curNode.findChild(attr,keys[index]);
if(!c){
if(callback){
callback(false,curNode)
}
return
}
curNode=c;
c.expand(false,false,f)
};
curNode.expand(false,false,f)
},
selectPath:function(path,attr,callback){
if(Ext.isEmpty(path)){
if(callback){
callback(false,undefined)
}
return
}
attr=attr||'id';
var keys=path.split(this.pathSeparator),v=keys.pop();
if(keys.length>1){
var f=function(success,node){
if(success&&node){
var n=node.findChild(attr,v);
if(n){
n.select();
if(callback){
callback(true,n)
}
}else if(callback){
callback(false,n)
}
}else{
if(callback){
callback(false,n)
}
}
};
this.expandPath(keys.join(this.pathSeparator),attr,f)
}else{
this.root.select();
if(callback){
callback(true,this.root)
}
}
},
getTreeEl:function(){
return this.body
},
onRender:function(ct,position){
Ext.tree.TreePanel.superclass.onRender.call(this,ct,position);
this.el.addClass('x-tree');
this.innerCt=this.body.createChild({
tag:'ul',
cls:'x-tree-root-ct '+(this.useArrows?'x-tree-arrows':this.lines?'x-tree-lines':'x-tree-no-lines')
})
},
initEvents:function(){
Ext.tree.TreePanel.superclass.initEvents.call(this);
if(this.containerScroll){
Ext.dd.ScrollManager.register(this.body)
}
if((this.enableDD||this.enableDrop)&&!this.dropZone){
this.dropZone=new Ext.tree.TreeDropZone(this,this.dropConfig||{
ddGroup:this.ddGroup||'TreeDD',
appendOnly:this.ddAppendOnly===true
})
}
if((this.enableDD||this.enableDrag)&&!this.dragZone){
this.dragZone=new Ext.tree.TreeDragZone(this,this.dragConfig||{
ddGroup:this.ddGroup||'TreeDD',
scroll:this.ddScroll
})
}
this.getSelectionModel().init(this)
},
afterRender:function(){
Ext.tree.TreePanel.superclass.afterRender.call(this);
this.renderRoot()
},
beforeDestroy:function(){
if(this.rendered){
Ext.dd.ScrollManager.unregister(this.body);
Ext.destroy(this.dropZone,this.dragZone)
}
this.destroyRoot();
Ext.destroy(this.loader);
this.nodeHash=this.root=this.loader=null;
Ext.tree.TreePanel.superclass.beforeDestroy.call(this)
},
destroyRoot:function(){
if(this.root&&this.root.destroy){
this.root.destroy(true)
}
}
});
Ext.tree.TreePanel.nodeTypes={};
Ext.reg('treepanel',Ext.tree.TreePanel);
Ext.tree.TreeEventModel=function(tree){
this.tree=tree;
this.tree.on('render',this.initEvents,this)
};
Ext.tree.TreeEventModel.prototype={
initEvents:function(){
var t=this.tree;
if(t.trackMouseOver!==false){
t.mon(t.innerCt,{
scope:this,
mouseover:this.delegateOver,
mouseout:this.delegateOut
})
}
t.mon(t.getTreeEl(),{
scope:this,
click:this.delegateClick,
dblclick:this.delegateDblClick,
contextmenu:this.delegateContextMenu
})
},
getNode:function(e){
var t;
if(t=e.getTarget('.x-tree-node-el',10)){
var id=Ext.fly(t,'_treeEvents').getAttribute('tree-node-id','ext');
if(id){
return this.tree.getNodeById(id)
}
}
return null
},
getNodeTarget:function(e){
var t=e.getTarget('.x-tree-node-icon',1);
if(!t){
t=e.getTarget('.x-tree-node-el',6)
}
return t
},
delegateOut:function(e,t){
if(!this.beforeEvent(e)){
return
}
if(e.getTarget('.x-tree-ec-icon',1)){
var n=this.getNode(e);
this.onIconOut(e,n);
if(n==this.lastEcOver){
delete this.lastEcOver
}
}
if((t=this.getNodeTarget(e))&&!e.within(t,true)){
this.onNodeOut(e,this.getNode(e))
}
},
delegateOver:function(e,t){
if(!this.beforeEvent(e)){
return
}
if(Ext.isGecko&&!this.trackingDoc){
Ext.getBody().on('mouseover',this.trackExit,this);
this.trackingDoc=true
}
if(this.lastEcOver){
this.onIconOut(e,this.lastEcOver);
delete this.lastEcOver
}
if(e.getTarget('.x-tree-ec-icon',1)){
this.lastEcOver=this.getNode(e);
this.onIconOver(e,this.lastEcOver)
}
if(t=this.getNodeTarget(e)){
this.onNodeOver(e,this.getNode(e))
}
},
trackExit:function(e){
if(this.lastOverNode){
if(this.lastOverNode.ui&&!e.within(this.lastOverNode.ui.getEl())){
this.onNodeOut(e,this.lastOverNode)
}
delete this.lastOverNode;
Ext.getBody().un('mouseover',this.trackExit,this);
this.trackingDoc=false
}
},
delegateClick:function(e,t){
if(this.beforeEvent(e)){
if(e.getTarget('input[type=checkbox]',1)){
this.onCheckboxClick(e,this.getNode(e))
}else if(e.getTarget('.x-tree-ec-icon',1)){
this.onIconClick(e,this.getNode(e))
}else if(this.getNodeTarget(e)){
this.onNodeClick(e,this.getNode(e))
}
}else{
this.checkContainerEvent(e,'click')
}
},
delegateDblClick:function(e,t){
if(this.beforeEvent(e)){
if(this.getNodeTarget(e)){
this.onNodeDblClick(e,this.getNode(e))
}
}else{
this.checkContainerEvent(e,'dblclick')
}
},
delegateContextMenu:function(e,t){
if(this.beforeEvent(e)){
if(this.getNodeTarget(e)){
this.onNodeContextMenu(e,this.getNode(e))
}
}else{
this.checkContainerEvent(e,'contextmenu')
}
},
checkContainerEvent:function(e,type){
if(this.disabled){
e.stopEvent();
return false
}
this.onContainerEvent(e,type)
},
onContainerEvent:function(e,type){
this.tree.fireEvent('container'+type,this.tree,e)
},
onNodeClick:function(e,node){
node.ui.onClick(e)
},
onNodeOver:function(e,node){
this.lastOverNode=node;
node.ui.onOver(e)
},
onNodeOut:function(e,node){
node.ui.onOut(e)
},
onIconOver:function(e,node){
node.ui.addClass('x-tree-ec-over')
},
onIconOut:function(e,node){
if(node.ui){
node.ui.removeClass('x-tree-ec-over')
}
},
onIconClick:function(e,node){
node.ui.ecClick(e)
},
onCheckboxClick:function(e,node){
node.ui.onCheckChange(e)
},
onNodeDblClick:function(e,node){
node.ui.onDblClick(e)
},
onNodeContextMenu:function(e,node){
node.ui.onContextMenu(e)
},
beforeEvent:function(e){
var node=this.getNode(e);
if(this.disabled||!node||!node.ui){
e.stopEvent();
return false
}
return true
},
disable:function(){
this.disabled=true
},
enable:function(){
this.disabled=false
}
};
Ext.tree.DefaultSelectionModel=Ext.extend(Ext.util.Observable,{
constructor:function(config){
this.selNode=null;
this.addEvents('selectionchange','beforeselect');
Ext.apply(this,config);
Ext.tree.DefaultSelectionModel.superclass.constructor.call(this)
},
init:function(tree){
this.tree=tree;
tree.mon(tree.getTreeEl(),'keydown',this.onKeyDown,this);
tree.on('click',this.onNodeClick,this)
},
onNodeClick:function(node,e){
this.select(node)
},
select:function(node,selectNextNode){
if(!Ext.fly(node.ui.wrap).isVisible()&&selectNextNode){
return selectNextNode.call(this,node)
}
var last=this.selNode;
if(node==last){
node.ui.onSelectedChange(true)
}else if(this.fireEvent('beforeselect',this,node,last)!==false){
if(last&&last.ui){
last.ui.onSelectedChange(false)
}
this.selNode=node;
node.ui.onSelectedChange(true);
this.fireEvent('selectionchange',this,node,last)
}
return node
},
unselect:function(node,silent){
if(this.selNode==node){
this.clearSelections(silent)
}
},
clearSelections:function(silent){
var n=this.selNode;
if(n){
n.ui.onSelectedChange(false);
this.selNode=null;
if(silent!==true){
this.fireEvent('selectionchange',this,null)
}
}
return n
},
getSelectedNode:function(){
return this.selNode
},
isSelected:function(node){
return this.selNode==node
},
selectPrevious:function(s){
if(!(s=s||this.selNode||this.lastSelNode)){
return null
}
var ps=s.previousSibling;
if(ps){
if(!ps.isExpanded()||ps.childNodes.length<1){
return this.select(ps,this.selectPrevious)
}else{
var lc=ps.lastChild;
while(lc&&lc.isExpanded()&&Ext.fly(lc.ui.wrap).isVisible()&&lc.childNodes.length>0){
lc=lc.lastChild
}
return this.select(lc,this.selectPrevious)
}
}else if(s.parentNode&&(this.tree.rootVisible||!s.parentNode.isRoot)){
return this.select(s.parentNode,this.selectPrevious)
}
return null
},
selectNext:function(s){
if(!(s=s||this.selNode||this.lastSelNode)){
return null
}
if(s.firstChild&&s.isExpanded()&&Ext.fly(s.ui.wrap).isVisible()){
return this.select(s.firstChild,this.selectNext)
}else if(s.nextSibling){
return this.select(s.nextSibling,this.selectNext)
}else if(s.parentNode){
var newS=null;
s.parentNode.bubble(function(){
if(this.nextSibling){
newS=this.getOwnerTree().selModel.select(this.nextSibling,this.selectNext);
return false
}
});
return newS
}
return null
},
onKeyDown:function(e){
var s=this.selNode||this.lastSelNode;
var sm=this;
if(!s){
return
}
var k=e.getKey();
switch(k){
case e.DOWN:
e.stopEvent();
this.selectNext();
break;
case e.UP:
e.stopEvent();
this.selectPrevious();
break;
case e.RIGHT:
e.preventDefault();
if(s.hasChildNodes()){
if(!s.isExpanded()){
s.expand()
}else if(s.firstChild){
this.select(s.firstChild,e)
}
}
break;
case e.LEFT:
e.preventDefault();
if(s.hasChildNodes()&&s.isExpanded()){
s.collapse()
}else if(s.parentNode&&(this.tree.rootVisible||s.parentNode!=this.tree.getRootNode())){
this.select(s.parentNode,e)
}
break
}
;
}
});
Ext.tree.MultiSelectionModel=Ext.extend(Ext.util.Observable,{
constructor:function(config){
this.selNodes=[];
this.selMap={};
this.addEvents('selectionchange');
Ext.apply(this,config);
Ext.tree.MultiSelectionModel.superclass.constructor.call(this)
},
init:function(tree){
this.tree=tree;
tree.mon(tree.getTreeEl(),'keydown',this.onKeyDown,this);
tree.on('click',this.onNodeClick,this)
},
onNodeClick:function(node,e){
if(e.ctrlKey&&this.isSelected(node)){
this.unselect(node)
}else{
this.select(node,e,e.ctrlKey)
}
},
select:function(node,e,keepExisting){
if(keepExisting!==true){
this.clearSelections(true)
}
if(this.isSelected(node)){
this.lastSelNode=node;
return node
}
this.selNodes.push(node);
this.selMap[node.id]=node;
this.lastSelNode=node;
node.ui.onSelectedChange(true);
this.fireEvent('selectionchange',this,this.selNodes);
return node
},
unselect:function(node){
if(this.selMap[node.id]){
node.ui.onSelectedChange(false);
var sn=this.selNodes;
var index=sn.indexOf(node);
if(index!=-1){
this.selNodes.splice(index,1)
}
delete this.selMap[node.id];
this.fireEvent('selectionchange',this,this.selNodes)
}
},
clearSelections:function(suppressEvent){
var sn=this.selNodes;
if(sn.length>0){
for(var i=0,len=sn.length;i<len;i++){
sn[i].ui.onSelectedChange(false)
}
this.selNodes=[];
this.selMap={};
if(suppressEvent!==true){
this.fireEvent('selectionchange',this,this.selNodes)
}
}
},
isSelected:function(node){
return this.selMap[node.id]?true:false
},
getSelectedNodes:function(){
return this.selNodes.concat([])
},
onKeyDown:Ext.tree.DefaultSelectionModel.prototype.onKeyDown,
selectNext:Ext.tree.DefaultSelectionModel.prototype.selectNext,
selectPrevious:Ext.tree.DefaultSelectionModel.prototype.selectPrevious
});
Ext.data.Tree=Ext.extend(Ext.util.Observable,{
constructor:function(root){
this.nodeHash={};
this.root=null;
if(root){
this.setRootNode(root)
}
this.addEvents('append','remove','move','insert','beforeappend','beforeremove','beforemove','beforeinsert');
Ext.data.Tree.superclass.constructor.call(this)
},
pathSeparator:'/',
proxyNodeEvent:function(){
return this.fireEvent.apply(this,arguments)
},
getRootNode:function(){
return this.root
},
setRootNode:function(node){
this.root=node;
node.ownerTree=this;
node.isRoot=true;
this.registerNode(node);
return node
},
getNodeById:function(id){
return this.nodeHash[id]
},
registerNode:function(node){
this.nodeHash[node.id]=node
},
unregisterNode:function(node){
delete this.nodeHash[node.id]
},
toString:function(){
return'[Tree'+(this.id?' '+this.id:'')+']'
}
});
Ext.data.Node=Ext.extend(Ext.util.Observable,{
constructor:function(attributes){
this.attributes=attributes||{};
this.leaf=this.attributes.leaf;
this.id=this.attributes.id;
if(!this.id){
this.id=Ext.id(null,'xnode-');
this.attributes.id=this.id
}
this.childNodes=[];
this.parentNode=null;
this.firstChild=null;
this.lastChild=null;
this.previousSibling=null;
this.nextSibling=null;
this.addEvents({
'append':true,
'remove':true,
'move':true,
'insert':true,
'beforeappend':true,
'beforeremove':true,
'beforemove':true,
'beforeinsert':true
});
this.listeners=this.attributes.listeners;
Ext.data.Node.superclass.constructor.call(this)
},
fireEvent:function(evtName){
if(Ext.data.Node.superclass.fireEvent.apply(this,arguments)===false){
return false
}
var ot=this.getOwnerTree();
if(ot){
if(ot.proxyNodeEvent.apply(ot,arguments)===false){
return false
}
}
return true
},
isLeaf:function(){
return this.leaf===true
},
setFirstChild:function(node){
this.firstChild=node
},
setLastChild:function(node){
this.lastChild=node
},
isLast:function(){
return!this.parentNode?true:this.parentNode.lastChild==this
},
isFirst:function(){
return!this.parentNode?true:this.parentNode.firstChild==this
},
hasChildNodes:function(){
return!this.isLeaf()&&this.childNodes.length>0
},
isExpandable:function(){
return this.attributes.expandable||this.hasChildNodes()
},
appendChild:function(node){
var multi=false;
if(Ext.isArray(node)){
multi=node
}else if(arguments.length>1){
multi=arguments
}
if(multi){
for(var i=0,len=multi.length;i<len;i++){
this.appendChild(multi[i])
}
}else{
if(this.fireEvent('beforeappend',this.ownerTree,this,node)===false){
return false
}
var index=this.childNodes.length;
var oldParent=node.parentNode;
if(oldParent){
if(node.fireEvent('beforemove',node.getOwnerTree(),node,oldParent,this,index)===false){
return false
}
oldParent.removeChild(node)
}
index=this.childNodes.length;
if(index===0){
this.setFirstChild(node)
}
this.childNodes.push(node);
node.parentNode=this;
var ps=this.childNodes[index-1];
if(ps){
node.previousSibling=ps;
ps.nextSibling=node
}else{
node.previousSibling=null
}
node.nextSibling=null;
this.setLastChild(node);
node.setOwnerTree(this.getOwnerTree());
this.fireEvent('append',this.ownerTree,this,node,index);
if(oldParent){
node.fireEvent('move',this.ownerTree,node,oldParent,this,index)
}
return node
}
},
removeChild:function(node,destroy){
var index=this.childNodes.indexOf(node);
if(index==-1){
return false
}
if(this.fireEvent('beforeremove',this.ownerTree,this,node)===false){
return false
}
this.childNodes.splice(index,1);
if(node.previousSibling){
node.previousSibling.nextSibling=node.nextSibling
}
if(node.nextSibling){
node.nextSibling.previousSibling=node.previousSibling
}
if(this.firstChild==node){
this.setFirstChild(node.nextSibling)
}
if(this.lastChild==node){
this.setLastChild(node.previousSibling)
}
this.fireEvent('remove',this.ownerTree,this,node);
if(destroy){
node.destroy(true)
}else{
node.clear()
}
return node
},
clear:function(destroy){
this.setOwnerTree(null,destroy);
this.parentNode=this.previousSibling=this.nextSibling=null;
if(destroy){
this.firstChild=this.lastChild=null
}
},
destroy:function(silent){
if(silent===true){
this.purgeListeners();
this.clear(true);
Ext.each(this.childNodes,function(n){
n.destroy(true)
});
this.childNodes=null
}else{
this.remove(true)
}
},
insertBefore:function(node,refNode){
if(!refNode){
return this.appendChild(node)
}
if(node==refNode){
return false
}
if(this.fireEvent('beforeinsert',this.ownerTree,this,node,refNode)===false){
return false
}
var index=this.childNodes.indexOf(refNode);
var oldParent=node.parentNode;
var refIndex=index;
if(oldParent==this&&this.childNodes.indexOf(node)<index){
refIndex--
}
if(oldParent){
if(node.fireEvent('beforemove',node.getOwnerTree(),node,oldParent,this,index,refNode)===false){
return false
}
oldParent.removeChild(node)
}
if(refIndex===0){
this.setFirstChild(node)
}
this.childNodes.splice(refIndex,0,node);
node.parentNode=this;
var ps=this.childNodes[refIndex-1];
if(ps){
node.previousSibling=ps;
ps.nextSibling=node
}else{
node.previousSibling=null
}
node.nextSibling=refNode;
refNode.previousSibling=node;
node.setOwnerTree(this.getOwnerTree());
this.fireEvent('insert',this.ownerTree,this,node,refNode);
if(oldParent){
node.fireEvent('move',this.ownerTree,node,oldParent,this,refIndex,refNode)
}
return node
},
remove:function(destroy){
if(this.parentNode){
this.parentNode.removeChild(this,destroy)
}
return this
},
removeAll:function(destroy){
var cn=this.childNodes,n;
while(n=cn[0]){
this.removeChild(n,destroy)
}
return this
},
item:function(index){
return this.childNodes[index]
},
replaceChild:function(newChild,oldChild){
var s=oldChild?oldChild.nextSibling:null;
this.removeChild(oldChild);
this.insertBefore(newChild,s);
return oldChild
},
indexOf:function(child){
return this.childNodes.indexOf(child)
},
getOwnerTree:function(){
if(!this.ownerTree){
var p=this;
while(p){
if(p.ownerTree){
this.ownerTree=p.ownerTree;
break
}
p=p.parentNode
}
}
return this.ownerTree
},
getDepth:function(){
var depth=0;
var p=this;
while(p.parentNode){
++depth;
p=p.parentNode
}
return depth
},
setOwnerTree:function(tree,destroy){
if(tree!=this.ownerTree){
if(this.ownerTree){
this.ownerTree.unregisterNode(this)
}
this.ownerTree=tree;
if(destroy!==true){
Ext.each(this.childNodes,function(n){
n.setOwnerTree(tree)
})
}
if(tree){
tree.registerNode(this)
}
}
},
setId:function(id){
if(id!==this.id){
var t=this.ownerTree;
if(t){
t.unregisterNode(this)
}
this.id=this.attributes.id=id;
if(t){
t.registerNode(this)
}
this.onIdChange(id)
}
},
onIdChange:Ext.emptyFn,
getPath:function(attr){
attr=attr||'id';
var p=this.parentNode;
var b=[this.attributes[attr]];
while(p){
b.unshift(p.attributes[attr]);
p=p.parentNode
}
var sep=this.getOwnerTree().pathSeparator;
return sep+b.join(sep)
},
bubble:function(fn,scope,args){
var p=this;
while(p){
if(fn.apply(scope||p,args||[p])===false){
break
}
p=p.parentNode
}
},
cascade:function(fn,scope,args){
if(fn.apply(scope||this,args||[this])!==false){
var cs=this.childNodes;
for(var i=0,len=cs.length;i<len;i++){
cs[i].cascade(fn,scope,args)
}
}
},
eachChild:function(fn,scope,args){
var cs=this.childNodes;
for(var i=0,len=cs.length;i<len;i++){
if(fn.apply(scope||cs[i],args||[cs[i]])===false){
break
}
}
},
findChild:function(attribute,value,deep){
return this.findChildBy(function(){
return this.attributes[attribute]==value
},null,deep)
},
findChildBy:function(fn,scope,deep){
var cs=this.childNodes,len=cs.length,i=0,n,res;
for(;i<len;i++){
n=cs[i];
if(fn.call(scope||n,n)===true){
return n
}else if(deep){
res=n.findChildBy(fn,scope,deep);
if(res!=null){
return res
}
}
}
return null
},
sort:function(fn,scope){
var cs=this.childNodes;
var len=cs.length;
if(len>0){
var sortFn=scope?function(){
fn.apply(scope,arguments)
}:fn;
cs.sort(sortFn);
for(var i=0;i<len;i++){
var n=cs[i];
n.previousSibling=cs[i-1];
n.nextSibling=cs[i+1];
if(i===0){
this.setFirstChild(n)
}
if(i==len-1){
this.setLastChild(n)
}
}
}
},
contains:function(node){
return node.isAncestor(this)
},
isAncestor:function(node){
var p=this.parentNode;
while(p){
if(p==node){
return true
}
p=p.parentNode
}
return false
},
toString:function(){
return'[Node'+(this.id?' '+this.id:'')+']'
}
});
Ext.tree.TreeNode=Ext.extend(Ext.data.Node,{
constructor:function(attributes){
attributes=attributes||{};
if(Ext.isString(attributes)){
attributes={text:attributes}
}
this.childrenRendered=false;
this.rendered=false;
Ext.tree.TreeNode.superclass.constructor.call(this,attributes);
this.expanded=attributes.expanded===true;
this.isTarget=attributes.isTarget!==false;
this.draggable=attributes.draggable!==false&&attributes.allowDrag!==false;
this.allowChildren=attributes.allowChildren!==false&&attributes.allowDrop!==false;
this.text=attributes.text;
this.disabled=attributes.disabled===true;
this.hidden=attributes.hidden===true;
this.addEvents('textchange','beforeexpand','beforecollapse','expand','disabledchange','collapse','beforeclick','click','checkchange','beforedblclick','dblclick','contextmenu','beforechildrenrendered');
var uiClass=this.attributes.uiProvider||this.defaultUI||Ext.tree.TreeNodeUI;
this.ui=new uiClass(this)
},
preventHScroll:true,
isExpanded:function(){
return this.expanded
},
getUI:function(){
return this.ui
},
getLoader:function(){
var owner;
return this.loader||((owner=this.getOwnerTree())&&owner.loader?owner.loader:this.loader=new Ext.tree.TreeLoader)
},
setFirstChild:function(node){
var of=this.firstChild;
Ext.tree.TreeNode.superclass.setFirstChild.call(this,node);
if(this.childrenRendered&&of&&node!=of){
of.renderIndent(true,true)
}
if(this.rendered){
this.renderIndent(true,true)
}
},
setLastChild:function(node){
var ol=this.lastChild;
Ext.tree.TreeNode.superclass.setLastChild.call(this,node);
if(this.childrenRendered&&ol&&node!=ol){
ol.renderIndent(true,true)
}
if(this.rendered){
this.renderIndent(true,true)
}
},
appendChild:function(n){
if(!n.render&&!Ext.isArray(n)){
n=this.getLoader().createNode(n)
}
var node=Ext.tree.TreeNode.superclass.appendChild.call(this,n);
if(node&&this.childrenRendered){
node.render()
}
this.ui.updateExpandIcon();
return node
},
removeChild:function(node,destroy){
this.ownerTree.getSelectionModel().unselect(node);
Ext.tree.TreeNode.superclass.removeChild.apply(this,arguments);
if(!destroy){
var rendered=node.ui.rendered;
if(rendered){
node.ui.remove()
}
if(rendered&&this.childNodes.length<1){
this.collapse(false,false)
}else{
this.ui.updateExpandIcon()
}
if(!this.firstChild&&!this.isHiddenRoot()){
this.childrenRendered=false
}
}
return node
},
insertBefore:function(node,refNode){
if(!node.render){
node=this.getLoader().createNode(node)
}
var newNode=Ext.tree.TreeNode.superclass.insertBefore.call(this,node,refNode);
if(newNode&&refNode&&this.childrenRendered){
node.render()
}
this.ui.updateExpandIcon();
return newNode
},
setText:function(text){
var oldText=this.text;
this.text=this.attributes.text=text;
if(this.rendered){
this.ui.onTextChange(this,text,oldText)
}
this.fireEvent('textchange',this,text,oldText)
},
setIconCls:function(cls){
var old=this.attributes.iconCls;
this.attributes.iconCls=cls;
if(this.rendered){
this.ui.onIconClsChange(this,cls,old)
}
},
setTooltip:function(tip,title){
this.attributes.qtip=tip;
this.attributes.qtipTitle=title;
if(this.rendered){
this.ui.onTipChange(this,tip,title)
}
},
setIcon:function(icon){
this.attributes.icon=icon;
if(this.rendered){
this.ui.onIconChange(this,icon)
}
},
setHref:function(href,target){
this.attributes.href=href;
this.attributes.hrefTarget=target;
if(this.rendered){
this.ui.onHrefChange(this,href,target)
}
},
setCls:function(cls){
var old=this.attributes.cls;
this.attributes.cls=cls;
if(this.rendered){
this.ui.onClsChange(this,cls,old)
}
},
select:function(){
var t=this.getOwnerTree();
if(t){
t.getSelectionModel().select(this)
}
},
unselect:function(silent){
var t=this.getOwnerTree();
if(t){
t.getSelectionModel().unselect(this,silent)
}
},
isSelected:function(){
var t=this.getOwnerTree();
return t?t.getSelectionModel().isSelected(this):false
},
expand:function(deep,anim,callback,scope){
if(!this.expanded){
if(this.fireEvent('beforeexpand',this,deep,anim)===false){
return
}
if(!this.childrenRendered){
this.renderChildren()
}
this.expanded=true;
if(!this.isHiddenRoot()&&(this.getOwnerTree().animate&&anim!==false)||anim){
this.ui.animExpand(function(){
this.fireEvent('expand',this);
this.runCallback(callback,scope||this,[this]);
if(deep===true){
this.expandChildNodes(true,true)
}
}.createDelegate(this));
return
}else{
this.ui.expand();
this.fireEvent('expand',this);
this.runCallback(callback,scope||this,[this])
}
}else{
this.runCallback(callback,scope||this,[this])
}
if(deep===true){
this.expandChildNodes(true)
}
},
runCallback:function(cb,scope,args){
if(Ext.isFunction(cb)){
cb.apply(scope,args)
}
},
isHiddenRoot:function(){
return this.isRoot&&!this.getOwnerTree().rootVisible
},
collapse:function(deep,anim,callback,scope){
if(this.expanded&&!this.isHiddenRoot()){
if(this.fireEvent('beforecollapse',this,deep,anim)===false){
return
}
this.expanded=false;
if(this.getOwnerTree().animate&&anim!==false||anim){
this.ui.animCollapse(function(){
this.fireEvent('collapse',this);
this.runCallback(callback,scope||this,[this]);
if(deep===true){
this.collapseChildNodes(true)
}
}.createDelegate(this));
return
}else{
this.ui.collapse();
this.fireEvent('collapse',this);
this.runCallback(callback,scope||this,[this])
}
}else if(!this.expanded){
this.runCallback(callback,scope||this,[this])
}
if(deep===true){
var cs=this.childNodes;
for(var i=0,len=cs.length;i<len;i++){
cs[i].collapse(true,false)
}
}
},
delayedExpand:function(delay){
if(!this.expandProcId){
this.expandProcId=this.expand.defer(delay,this)
}
},
cancelExpand:function(){
if(this.expandProcId){
clearTimeout(this.expandProcId)
}
this.expandProcId=false
},
toggle:function(){
if(this.expanded){
this.collapse()
}else{
this.expand()
}
},
ensureVisible:function(callback,scope){
var tree=this.getOwnerTree();
tree.expandPath(this.parentNode?this.parentNode.getPath():this.getPath(),false,function(){
var node=tree.getNodeById(this.id);
tree.getTreeEl().scrollChildIntoView(node.ui.anchor);
this.runCallback(callback,scope||this,[this])
}.createDelegate(this))
},
expandChildNodes:function(deep,anim){
var cs=this.childNodes,i,len=cs.length;
for(i=0;i<len;i++){
cs[i].expand(deep,anim)
}
},
collapseChildNodes:function(deep){
var cs=this.childNodes;
for(var i=0,len=cs.length;i<len;i++){
cs[i].collapse(deep)
}
},
disable:function(){
this.disabled=true;
this.unselect();
if(this.rendered&&this.ui.onDisableChange){
this.ui.onDisableChange(this,true)
}
this.fireEvent('disabledchange',this,true)
},
enable:function(){
this.disabled=false;
if(this.rendered&&this.ui.onDisableChange){
this.ui.onDisableChange(this,false)
}
this.fireEvent('disabledchange',this,false)
},
renderChildren:function(suppressEvent){
if(suppressEvent!==false){
this.fireEvent('beforechildrenrendered',this)
}
var cs=this.childNodes;
for(var i=0,len=cs.length;i<len;i++){
cs[i].render(true)
}
this.childrenRendered=true
},
sort:function(fn,scope){
Ext.tree.TreeNode.superclass.sort.apply(this,arguments);
if(this.childrenRendered){
var cs=this.childNodes;
for(var i=0,len=cs.length;i<len;i++){
cs[i].render(true)
}
}
},
render:function(bulkRender){
this.ui.render(bulkRender);
if(!this.rendered){
this.getOwnerTree().registerNode(this);
this.rendered=true;
if(this.expanded){
this.expanded=false;
this.expand(false,false)
}
}
},
renderIndent:function(deep,refresh){
if(refresh){
this.ui.childIndent=null
}
this.ui.renderIndent();
if(deep===true&&this.childrenRendered){
var cs=this.childNodes;
for(var i=0,len=cs.length;i<len;i++){
cs[i].renderIndent(true,refresh)
}
}
},
beginUpdate:function(){
this.childrenRendered=false
},
endUpdate:function(){
if(this.expanded&&this.rendered){
this.renderChildren()
}
},
destroy:function(silent){
if(silent===true){
this.unselect(true)
}
Ext.tree.TreeNode.superclass.destroy.call(this,silent);
Ext.destroy(this.ui,this.loader);
this.ui=this.loader=null
},
onIdChange:function(id){
this.ui.onIdChange(id)
}
});
Ext.tree.TreePanel.nodeTypes.node=Ext.tree.TreeNode;
Ext.tree.AsyncTreeNode=function(config){
this.loaded=config&&config.loaded===true;
this.loading=false;
Ext.tree.AsyncTreeNode.superclass.constructor.apply(this,arguments);
this.addEvents('beforeload','load')
};
Ext.extend(Ext.tree.AsyncTreeNode,Ext.tree.TreeNode,{
expand:function(deep,anim,callback,scope){
if(this.loading){
var timer;
var f=function(){
if(!this.loading){
clearInterval(timer);
this.expand(deep,anim,callback,scope)
}
}.createDelegate(this);
timer=setInterval(f,200);
return
}
if(!this.loaded){
if(this.fireEvent('beforeload',this)===false){
return
}
this.loading=true;
this.ui.beforeLoad(this);
var loader=this.loader||this.attributes.loader||this.getOwnerTree().getLoader();
if(loader){
loader.load(this,this.loadComplete.createDelegate(this,[
deep,
anim,
callback,
scope
]),this);
return
}
}
Ext.tree.AsyncTreeNode.superclass.expand.call(this,deep,anim,callback,scope)
},
isLoading:function(){
return this.loading
},
loadComplete:function(deep,anim,callback,scope){
this.loading=false;
this.loaded=true;
this.ui.afterLoad(this);
this.fireEvent('load',this);
this.expand(deep,anim,callback,scope)
},
isLoaded:function(){
return this.loaded
},
hasChildNodes:function(){
if(!this.isLeaf()&&!this.loaded){
return true
}else{
return Ext.tree.AsyncTreeNode.superclass.hasChildNodes.call(this)
}
},
reload:function(callback,scope){
this.collapse(false,false);
while(this.firstChild){
this.removeChild(this.firstChild).destroy()
}
this.childrenRendered=false;
this.loaded=false;
if(this.isHiddenRoot()){
this.expanded=false
}
this.expand(false,false,callback,scope)
}
});
Ext.tree.TreePanel.nodeTypes.async=Ext.tree.AsyncTreeNode;
Ext.tree.TreeNodeUI=Ext.extend(Object,{
constructor:function(node){
Ext.apply(this,{
node:node,
rendered:false,
animating:false,
wasLeaf:true,
ecc:'x-tree-ec-icon x-tree-elbow',
emptyIcon:Ext.BLANK_IMAGE_URL
})
},
removeChild:function(node){
if(this.rendered){
this.ctNode.removeChild(node.ui.getEl())
}
},
beforeLoad:function(){
this.addClass('x-tree-node-loading')
},
afterLoad:function(){
this.removeClass('x-tree-node-loading')
},
onTextChange:function(node,text,oldText){
if(this.rendered){
this.textNode.innerHTML=text
}
},
onIconClsChange:function(node,cls,oldCls){
if(this.rendered){
Ext.fly(this.iconNode).replaceClass(oldCls,cls)
}
},
onIconChange:function(node,icon){
if(this.rendered){
var empty=Ext.isEmpty(icon);
this.iconNode.src=empty?this.emptyIcon:icon;
Ext.fly(this.iconNode)[empty?'removeClass':'addClass']('x-tree-node-inline-icon')
}
},
onTipChange:function(node,tip,title){
if(this.rendered){
var hasTitle=Ext.isDefined(title);
if(this.textNode.setAttributeNS){
this.textNode.setAttributeNS('ext','qtip',tip);
if(hasTitle){
this.textNode.setAttributeNS('ext','qtitle',title)
}
}else{
this.textNode.setAttribute('ext:qtip',tip);
if(hasTitle){
this.textNode.setAttribute('ext:qtitle',title)
}
}
}
},
onHrefChange:function(node,href,target){
if(this.rendered){
this.anchor.href=this.getHref(href);
if(Ext.isDefined(target)){
this.anchor.target=target
}
}
},
onClsChange:function(node,cls,oldCls){
if(this.rendered){
Ext.fly(this.elNode).replaceClass(oldCls,cls)
}
},
onDisableChange:function(node,state){
this.disabled=state;
if(this.checkbox){
this.checkbox.disabled=state
}
this[state?'addClass':'removeClass']('x-tree-node-disabled')
},
onSelectedChange:function(state){
if(state){
this.focus();
this.addClass('x-tree-selected')
}else{
this.removeClass('x-tree-selected')
}
},
onMove:function(tree,node,oldParent,newParent,index,refNode){
this.childIndent=null;
if(this.rendered){
var targetNode=newParent.ui.getContainer();
if(!targetNode){
this.holder=document.createElement('div');
this.holder.appendChild(this.wrap);
return
}
var insertBefore=refNode?refNode.ui.getEl():null;
if(insertBefore){
targetNode.insertBefore(this.wrap,insertBefore)
}else{
targetNode.appendChild(this.wrap)
}
this.node.renderIndent(true,oldParent!=newParent)
}
},
addClass:function(cls){
if(this.elNode){
Ext.fly(this.elNode).addClass(cls)
}
},
removeClass:function(cls){
if(this.elNode){
Ext.fly(this.elNode).removeClass(cls)
}
},
remove:function(){
if(this.rendered){
this.holder=document.createElement('div');
this.holder.appendChild(this.wrap)
}
},
fireEvent:function(){
return this.node.fireEvent.apply(this.node,arguments)
},
initEvents:function(){
this.node.on('move',this.onMove,this);
if(this.node.disabled){
this.onDisableChange(this.node,true)
}
if(this.node.hidden){
this.hide()
}
var ot=this.node.getOwnerTree();
var dd=ot.enableDD||ot.enableDrag||ot.enableDrop;
if(dd&&(!this.node.isRoot||ot.rootVisible)){
Ext.dd.Registry.register(this.elNode,{
node:this.node,
handles:this.getDDHandles(),
isHandle:false
})
}
},
getDDHandles:function(){
return[
this.iconNode,
this.textNode,
this.elNode
]
},
hide:function(){
this.node.hidden=true;
if(this.wrap){
this.wrap.style.display='none'
}
},
show:function(){
this.node.hidden=false;
if(this.wrap){
this.wrap.style.display=''
}
},
onContextMenu:function(e){
if(this.node.hasListener('contextmenu')||this.node.getOwnerTree().hasListener('contextmenu')){
e.preventDefault();
this.focus();
this.fireEvent('contextmenu',this.node,e)
}
},
onClick:function(e){
if(this.dropping){
e.stopEvent();
return
}
if(this.fireEvent('beforeclick',this.node,e)!==false){
var a=e.getTarget('a');
if(!this.disabled&&this.node.attributes.href&&a){
this.fireEvent('click',this.node,e);
return
}else if(a&&e.ctrlKey){
e.stopEvent()
}
e.preventDefault();
if(this.disabled){
return
}
if(this.node.attributes.singleClickExpand&&!this.animating&&this.node.isExpandable()){
this.node.toggle()
}
this.fireEvent('click',this.node,e)
}else{
e.stopEvent()
}
},
onDblClick:function(e){
e.preventDefault();
if(this.disabled){
return
}
if(this.fireEvent('beforedblclick',this.node,e)!==false){
if(this.checkbox){
this.toggleCheck()
}
if(!this.animating&&this.node.isExpandable()){
this.node.toggle()
}
this.fireEvent('dblclick',this.node,e)
}
},
onOver:function(e){
this.addClass('x-tree-node-over')
},
onOut:function(e){
this.removeClass('x-tree-node-over')
},
onCheckChange:function(){
var checked=this.checkbox.checked;
this.checkbox.defaultChecked=checked;
this.node.attributes.checked=checked;
this.fireEvent('checkchange',this.node,checked)
},
ecClick:function(e){
if(!this.animating&&this.node.isExpandable()){
this.node.toggle()
}
},
startDrop:function(){
this.dropping=true
},
endDrop:function(){
setTimeout(function(){
this.dropping=false
}.createDelegate(this),50)
},
expand:function(){
this.updateExpandIcon();
this.ctNode.style.display=''
},
focus:function(){
if(!this.node.preventHScroll){
try{
this.anchor.focus()
}catch(e){
}
}else{
try{
var noscroll=this.node.getOwnerTree().getTreeEl().dom;
var l=noscroll.scrollLeft;
this.anchor.focus();
noscroll.scrollLeft=l
}catch(e){
}
}
},
toggleCheck:function(value){
var cb=this.checkbox;
if(cb){
cb.checked=value===undefined?!cb.checked:value;
this.onCheckChange()
}
},
blur:function(){
try{
this.anchor.blur()
}catch(e){
}
},
animExpand:function(callback){
var ct=Ext.get(this.ctNode);
ct.stopFx();
if(!this.node.isExpandable()){
this.updateExpandIcon();
this.ctNode.style.display='';
Ext.callback(callback);
return
}
this.animating=true;
this.updateExpandIcon();
ct.slideIn('t',{
callback:function(){
this.animating=false;
Ext.callback(callback)
},
scope:this,
duration:this.node.ownerTree.duration||0.25
})
},
highlight:function(){
var tree=this.node.getOwnerTree();
Ext.fly(this.wrap).highlight(tree.hlColor||'C3DAF9',{endColor:tree.hlBaseColor})
},
collapse:function(){
this.updateExpandIcon();
this.ctNode.style.display='none'
},
animCollapse:function(callback){
var ct=Ext.get(this.ctNode);
ct.enableDisplayMode('block');
ct.stopFx();
this.animating=true;
this.updateExpandIcon();
ct.slideOut('t',{
callback:function(){
this.animating=false;
Ext.callback(callback)
},
scope:this,
duration:this.node.ownerTree.duration||0.25
})
},
getContainer:function(){
return this.ctNode
},
getEl:function(){
return this.wrap
},
appendDDGhost:function(ghostNode){
ghostNode.appendChild(this.elNode.cloneNode(true))
},
getDDRepairXY:function(){
return Ext.lib.Dom.getXY(this.iconNode)
},
onRender:function(){
this.render()
},
render:function(bulkRender){
var n=this.node,a=n.attributes;
var targetNode=n.parentNode?n.parentNode.ui.getContainer():n.ownerTree.innerCt.dom;
if(!this.rendered){
this.rendered=true;
this.renderElements(n,a,targetNode,bulkRender);
if(a.qtip){
this.onTipChange(n,a.qtip,a.qtipTitle)
}else if(a.qtipCfg){
a.qtipCfg.target=Ext.id(this.textNode);
Ext.QuickTips.register(a.qtipCfg)
}
this.initEvents();
if(!this.node.expanded){
this.updateExpandIcon(true)
}
}else{
if(bulkRender===true){
targetNode.appendChild(this.wrap)
}
}
},
renderElements:function(n,a,targetNode,bulkRender){
this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():'';
var cb=Ext.isBoolean(a.checked),nel,href=this.getHref(a.href),buf=[
'<li class="x-tree-node"><div ext:tree-node-id="',
n.id,
'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',
a.cls,
'" unselectable="on">',
'<span class="x-tree-node-indent">',
this.indentMarkup,
'</span>',
'<img alt="" src="',
this.emptyIcon,
'" class="x-tree-ec-icon x-tree-elbow" />',
'<img alt="" src="',
a.icon||this.emptyIcon,
'" class="x-tree-node-icon',
a.icon?' x-tree-node-inline-icon':'',
a.iconCls?' '+a.iconCls:'',
'" unselectable="on" />',
cb?'<input class="x-tree-node-cb" type="checkbox" '+(a.checked?'checked="checked" />':'/>'):'',
'<a hidefocus="on" class="x-tree-node-anchor" href="',
href,
'" tabIndex="1" ',
a.hrefTarget?' target="'+a.hrefTarget+'"':'',
'><span unselectable="on">',
n.text,
'</span></a></div>',
'<ul class="x-tree-node-ct" style="display:none;"></ul>',
'</li>'
].join('');
if(bulkRender!==true&&n.nextSibling&&(nel=n.nextSibling.ui.getEl())){
this.wrap=Ext.DomHelper.insertHtml('beforeBegin',nel,buf)
}else{
this.wrap=Ext.DomHelper.insertHtml('beforeEnd',targetNode,buf)
}
this.elNode=this.wrap.childNodes[0];
this.ctNode=this.wrap.childNodes[1];
var cs=this.elNode.childNodes;
this.indentNode=cs[0];
this.ecNode=cs[1];
this.iconNode=cs[2];
var index=3;
if(cb){
this.checkbox=cs[3];
this.checkbox.defaultChecked=this.checkbox.checked;
index++
}
this.anchor=cs[index];
this.textNode=cs[index].firstChild
},
getHref:function(href){
return Ext.isEmpty(href)?Ext.isGecko?'':'#':href
},
getAnchor:function(){
return this.anchor
},
getTextEl:function(){
return this.textNode
},
getIconEl:function(){
return this.iconNode
},
isChecked:function(){
return this.checkbox?this.checkbox.checked:false
},
updateExpandIcon:function(){
if(this.rendered){
var n=this.node,c1,c2,cls=n.isLast()?'x-tree-elbow-end':'x-tree-elbow',hasChild=n.hasChildNodes();
if(hasChild||n.attributes.expandable){
if(n.expanded){
cls+='-minus';
c1='x-tree-node-collapsed';
c2='x-tree-node-expanded'
}else{
cls+='-plus';
c1='x-tree-node-expanded';
c2='x-tree-node-collapsed'
}
if(this.wasLeaf){
this.removeClass('x-tree-node-leaf');
this.wasLeaf=false
}
if(this.c1!=c1||this.c2!=c2){
Ext.fly(this.elNode).replaceClass(c1,c2);
this.c1=c1;
this.c2=c2
}
}else{
if(!this.wasLeaf){
Ext.fly(this.elNode).replaceClass('x-tree-node-expanded','x-tree-node-collapsed');
delete this.c1;
delete this.c2;
this.wasLeaf=true
}
}
var ecc='x-tree-ec-icon '+cls;
if(this.ecc!=ecc){
this.ecNode.className=ecc;
this.ecc=ecc
}
}
},
onIdChange:function(id){
if(this.rendered){
this.elNode.setAttribute('ext:tree-node-id',id)
}
},
getChildIndent:function(){
if(!this.childIndent){
var buf=[],p=this.node;
while(p){
if(!p.isRoot||p.isRoot&&p.ownerTree.rootVisible){
if(!p.isLast()){
buf.unshift('<img alt="" src="'+this.emptyIcon+'" class="x-tree-elbow-line" />')
}else{
buf.unshift('<img alt="" src="'+this.emptyIcon+'" class="x-tree-icon" />')
}
}
p=p.parentNode
}
this.childIndent=buf.join('')
}
return this.childIndent
},
renderIndent:function(){
if(this.rendered){
var indent='',p=this.node.parentNode;
if(p){
indent=p.ui.getChildIndent()
}
if(this.indentMarkup!=indent){
this.indentNode.innerHTML=indent;
this.indentMarkup=indent
}
this.updateExpandIcon()
}
},
destroy:function(){
if(this.elNode){
Ext.dd.Registry.unregister(this.elNode.id)
}
Ext.each([
'textnode',
'anchor',
'checkbox',
'indentNode',
'ecNode',
'iconNode',
'elNode',
'ctNode',
'wrap',
'holder'
],function(el){
if(this[el]){
Ext.fly(this[el]).remove();
delete this[el]
}
},this);
delete this.node
}
});
Ext.tree.RootTreeNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{
render:function(){
if(!this.rendered){
var targetNode=this.node.ownerTree.innerCt.dom;
this.node.expanded=true;
targetNode.innerHTML='<div class="x-tree-root-node"></div>';
this.wrap=this.ctNode=targetNode.firstChild
}
},
collapse:Ext.emptyFn,
expand:Ext.emptyFn
});
Ext.tree.TreeLoader=function(config){
this.baseParams={};
Ext.apply(this,config);
this.addEvents('beforeload','load','loadexception');
Ext.tree.TreeLoader.superclass.constructor.call(this);
if(Ext.isString(this.paramOrder)){
this.paramOrder=this.paramOrder.split(/[\s,|]/)
}
};
Ext.extend(Ext.tree.TreeLoader,Ext.util.Observable,{
uiProviders:{},
clearOnLoad:true,
paramOrder:undefined,
paramsAsHash:false,
nodeParameter:'node',
directFn:undefined,
load:function(node,callback,scope){
if(this.clearOnLoad){
while(node.firstChild){
node.removeChild(node.firstChild)
}
}
if(this.doPreload(node)){
this.runCallback(callback,scope||node,[node])
}else if(this.directFn||this.dataUrl||this.url){
this.requestData(node,callback,scope||node)
}
},
doPreload:function(node){
if(node.attributes.children){
if(node.childNodes.length<1){
var cs=node.attributes.children;
node.beginUpdate();
for(var i=0,len=cs.length;i<len;i++){
var cn=node.appendChild(this.createNode(cs[i]));
if(this.preloadChildren){
this.doPreload(cn)
}
}
node.endUpdate()
}
return true
}
return false
},
getParams:function(node){
var bp=Ext.apply({},this.baseParams),np=this.nodeParameter,po=this.paramOrder;
np&&(bp[np]=node.id);
if(this.directFn){
var buf=[node.id];
if(po){
if(np&&po.indexOf(np)>-1){
buf=[]
}
for(var i=0,len=po.length;i<len;i++){
buf.push(bp[po[i]])
}
}else if(this.paramsAsHash){
buf=[bp]
}
return buf
}else{
return bp
}
},
requestData:function(node,callback,scope){
if(this.fireEvent('beforeload',this,node,callback)!==false){
if(this.directFn){
var args=this.getParams(node);
args.push(this.processDirectResponse.createDelegate(this,[{
callback:callback,
node:node,
scope:scope
}],true));
this.directFn.apply(window,args)
}else{
this.transId=Ext.Ajax.request({
method:this.requestMethod,
url:this.dataUrl||this.url,
success:this.handleResponse,
failure:this.handleFailure,
scope:this,
argument:{
callback:callback,
node:node,
scope:scope
},
params:this.getParams(node)
})
}
}else{
this.runCallback(callback,scope||node,[])
}
},
processDirectResponse:function(result,response,args){
if(response.status){
this.handleResponse({
responseData:Ext.isArray(result)?result:null,
responseText:result,
argument:args
})
}else{
this.handleFailure({argument:args})
}
},
runCallback:function(cb,scope,args){
if(Ext.isFunction(cb)){
cb.apply(scope,args)
}
},
isLoading:function(){
return!!this.transId
},
abort:function(){
if(this.isLoading()){
Ext.Ajax.abort(this.transId)
}
},
createNode:function(attr){
if(this.baseAttrs){
Ext.applyIf(attr,this.baseAttrs)
}
if(this.applyLoader!==false&&!attr.loader){
attr.loader=this
}
if(Ext.isString(attr.uiProvider)){
attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)
}
if(attr.nodeType){
return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)
}else{
return attr.leaf?new Ext.tree.TreeNode(attr):new Ext.tree.AsyncTreeNode(attr)
}
},
processResponse:function(response,node,callback,scope){
var json=response.responseText;
try{
var o=response.responseData||Ext.decode(json);
node.beginUpdate();
for(var i=0,len=o.length;i<len;i++){
var n=this.createNode(o[i]);
if(n){
node.appendChild(n)
}
}
node.endUpdate();
this.runCallback(callback,scope||node,[node])
}catch(e){
this.handleFailure(response)
}
},
handleResponse:function(response){
this.transId=false;
var a=response.argument;
this.processResponse(response,a.node,a.callback,a.scope);
this.fireEvent('load',this,a.node,response)
},
handleFailure:function(response){
this.transId=false;
var a=response.argument;
this.fireEvent('loadexception',this,a.node,response);
this.runCallback(a.callback,a.scope||a.node,[a.node])
},
destroy:function(){
this.abort();
this.purgeListeners()
}
});
Ext.tree.TreeFilter=function(tree,config){
this.tree=tree;
this.filtered={};
Ext.apply(this,config)
};
Ext.tree.TreeFilter.prototype={
clearBlank:false,
reverse:false,
autoClear:false,
remove:false,
filter:function(value,attr,startNode){
attr=attr||'text';
var f;
if(typeof value=='string'){
var vlen=value.length;
if(vlen==0&&this.clearBlank){
this.clear();
return
}
value=value.toLowerCase();
f=function(n){
return n.attributes[attr].substr(0,vlen).toLowerCase()==value
}
}else if(value.exec){
f=function(n){
return value.test(n.attributes[attr])
}
}else{
throw'Illegal filter type, must be string or regex'
}
this.filterBy(f,null,startNode)
},
filterBy:function(fn,scope,startNode){
startNode=startNode||this.tree.root;
if(this.autoClear){
this.clear()
}
var af=this.filtered,rv=this.reverse;
var f=function(n){
if(n==startNode){
return true
}
if(af[n.id]){
return false
}
var m=fn.call(scope||n,n);
if(!m||rv){
af[n.id]=n;
n.ui.hide();
return false
}
return true
};
startNode.cascade(f);
if(this.remove){
for(var id in af){
if(typeof id!='function'){
var n=af[id];
if(n&&n.parentNode){
n.parentNode.removeChild(n)
}
}
}
}
},
clear:function(){
var t=this.tree;
var af=this.filtered;
for(var id in af){
if(typeof id!='function'){
var n=af[id];
if(n){
n.ui.show()
}
}
}
this.filtered={}
}
};
Ext.tree.TreeSorter=Ext.extend(Object,{
constructor:function(tree,config){
Ext.apply(this,config);
tree.on({
scope:this,
beforechildrenrendered:this.doSort,
append:this.updateSort,
insert:this.updateSort,
textchange:this.updateSortParent
});
var desc=this.dir&&this.dir.toLowerCase()=='desc',prop=this.property||'text',sortType=this.sortType,folderSort=this.folderSort,caseSensitive=this.caseSensitive===true,leafAttr=this.leafAttr||'leaf';
if(Ext.isString(sortType)){
sortType=Ext.data.SortTypes[sortType]
}
this.sortFn=function(n1,n2){
var attr1=n1.attributes,attr2=n2.attributes;
if(folderSort){
if(attr1[leafAttr]&&!attr2[leafAttr]){
return 1
}
if(!attr1[leafAttr]&&attr2[leafAttr]){
return-1
}
}
var prop1=attr1[prop],prop2=attr2[prop],v1=sortType?sortType(prop1):caseSensitive?prop1:prop1.toUpperCase(),v2=sortType?sortType(prop2):caseSensitive?prop2:prop2.toUpperCase();
if(v1<v2){
return desc?1:-1
}else if(v1>v2){
return desc?-1:1
}
return 0
}
},
doSort:function(node){
node.sort(this.sortFn)
},
updateSort:function(tree,node){
if(node.childrenRendered){
this.doSort.defer(1,this,[node])
}
},
updateSortParent:function(node){
var p=node.parentNode;
if(p&&p.childrenRendered){
this.doSort.defer(1,this,[p])
}
}
});
if(Ext.dd.DropZone){
Ext.tree.TreeDropZone=function(tree,config){
this.allowParentInsert=config.allowParentInsert||false;
this.allowContainerDrop=config.allowContainerDrop||false;
this.appendOnly=config.appendOnly||false;
Ext.tree.TreeDropZone.superclass.constructor.call(this,tree.getTreeEl(),config);
this.tree=tree;
this.dragOverData={};
this.lastInsertClass='x-tree-no-status'
};
Ext.extend(Ext.tree.TreeDropZone,Ext.dd.DropZone,{
ddGroup:'TreeDD',
expandDelay:1000,
expandNode:function(node){
if(node.hasChildNodes()&&!node.isExpanded()){
node.expand(false,null,this.triggerCacheRefresh.createDelegate(this))
}
},
queueExpand:function(node){
this.expandProcId=this.expandNode.defer(this.expandDelay,this,[node])
},
cancelExpand:function(){
if(this.expandProcId){
clearTimeout(this.expandProcId);
this.expandProcId=false
}
},
isValidDropPoint:function(n,pt,dd,e,data){
if(!n||!data){
return false
}
var targetNode=n.node;
var dropNode=data.node;
if(!(targetNode&&targetNode.isTarget&&pt)){
return false
}
if(pt=='append'&&targetNode.allowChildren===false){
return false
}
if((pt=='above'||pt=='below')&&(targetNode.parentNode&&targetNode.parentNode.allowChildren===false)){
return false
}
if(dropNode&&(targetNode==dropNode||dropNode.contains(targetNode))){
return false
}
var overEvent=this.dragOverData;
overEvent.tree=this.tree;
overEvent.target=targetNode;
overEvent.data=data;
overEvent.point=pt;
overEvent.source=dd;
overEvent.rawEvent=e;
overEvent.dropNode=dropNode;
overEvent.cancel=false;
var result=this.tree.fireEvent('nodedragover',overEvent);
return overEvent.cancel===false&&result!==false
},
getDropPoint:function(e,n,dd){
var tn=n.node;
if(tn.isRoot){
return tn.allowChildren!==false?'append':false
}
var dragEl=n.ddel;
var t=Ext.lib.Dom.getY(dragEl),b=t+dragEl.offsetHeight;
var y=Ext.lib.Event.getPageY(e);
var noAppend=tn.allowChildren===false||tn.isLeaf();
if(this.appendOnly||tn.parentNode.allowChildren===false){
return noAppend?false:'append'
}
var noBelow=false;
if(!this.allowParentInsert){
noBelow=tn.hasChildNodes()&&tn.isExpanded()
}
var q=(b-t)/(noAppend?2:3);
if(y>=t&&y<t+q){
return'above'
}else if(!noBelow&&(noAppend||y>=b-q&&y<=b)){
return'below'
}else{
return'append'
}
},
onNodeEnter:function(n,dd,e,data){
this.cancelExpand()
},
onContainerOver:function(dd,e,data){
if(this.allowContainerDrop&&this.isValidDropPoint({
ddel:this.tree.getRootNode().ui.elNode,
node:this.tree.getRootNode()
},'append',dd,e,data)){
return this.dropAllowed
}
return this.dropNotAllowed
},
onNodeOver:function(n,dd,e,data){
var pt=this.getDropPoint(e,n,dd);
var node=n.node;
if(!this.expandProcId&&pt=='append'&&node.hasChildNodes()&&!n.node.isExpanded()){
this.queueExpand(node)
}else if(pt!='append'){
this.cancelExpand()
}
var returnCls=this.dropNotAllowed;
if(this.isValidDropPoint(n,pt,dd,e,data)){
if(pt){
var el=n.ddel;
var cls;
if(pt=='above'){
returnCls=n.node.isFirst()?'x-tree-drop-ok-above':'x-tree-drop-ok-between';
cls='x-tree-drag-insert-above'
}else if(pt=='below'){
returnCls=n.node.isLast()?'x-tree-drop-ok-below':'x-tree-drop-ok-between';
cls='x-tree-drag-insert-below'
}else{
returnCls='x-tree-drop-ok-append';
cls='x-tree-drag-append'
}
if(this.lastInsertClass!=cls){
Ext.fly(el).replaceClass(this.lastInsertClass,cls);
this.lastInsertClass=cls
}
}
}
return returnCls
},
onNodeOut:function(n,dd,e,data){
this.cancelExpand();
this.removeDropIndicators(n)
},
onNodeDrop:function(n,dd,e,data){
var point=this.getDropPoint(e,n,dd);
var targetNode=n.node;
targetNode.ui.startDrop();
if(!this.isValidDropPoint(n,point,dd,e,data)){
targetNode.ui.endDrop();
return false
}
var dropNode=data.node||(dd.getTreeNode?dd.getTreeNode(data,targetNode,point,e):null);
return this.processDrop(targetNode,data,point,dd,e,dropNode)
},
onContainerDrop:function(dd,e,data){
if(this.allowContainerDrop&&this.isValidDropPoint({
ddel:this.tree.getRootNode().ui.elNode,
node:this.tree.getRootNode()
},'append',dd,e,data)){
var targetNode=this.tree.getRootNode();
targetNode.ui.startDrop();
var dropNode=data.node||(dd.getTreeNode?dd.getTreeNode(data,targetNode,'append',e):null);
return this.processDrop(targetNode,data,'append',dd,e,dropNode)
}
return false
},
processDrop:function(target,data,point,dd,e,dropNode){
var dropEvent={
tree:this.tree,
target:target,
data:data,
point:point,
source:dd,
rawEvent:e,
dropNode:dropNode,
cancel:!dropNode,
dropStatus:false
};
var retval=this.tree.fireEvent('beforenodedrop',dropEvent);
if(retval===false||dropEvent.cancel===true||!dropEvent.dropNode){
target.ui.endDrop();
return dropEvent.dropStatus
}
target=dropEvent.target;
if(point=='append'&&!target.isExpanded()){
target.expand(false,null,function(){
this.completeDrop(dropEvent)
}.createDelegate(this))
}else{
this.completeDrop(dropEvent)
}
return true
},
completeDrop:function(de){
var ns=de.dropNode,p=de.point,t=de.target;
if(!Ext.isArray(ns)){
ns=[ns]
}
var n;
for(var i=0,len=ns.length;i<len;i++){
n=ns[i];
if(p=='above'){
t.parentNode.insertBefore(n,t)
}else if(p=='below'){
t.parentNode.insertBefore(n,t.nextSibling)
}else{
t.appendChild(n)
}
}
n.ui.focus();
if(Ext.enableFx&&this.tree.hlDrop){
n.ui.highlight()
}
t.ui.endDrop();
this.tree.fireEvent('nodedrop',de)
},
afterNodeMoved:function(dd,data,e,targetNode,dropNode){
if(Ext.enableFx&&this.tree.hlDrop){
dropNode.ui.focus();
dropNode.ui.highlight()
}
this.tree.fireEvent('nodedrop',this.tree,targetNode,data,dd,e)
},
getTree:function(){
return this.tree
},
removeDropIndicators:function(n){
if(n&&n.ddel){
var el=n.ddel;
Ext.fly(el).removeClass([
'x-tree-drag-insert-above',
'x-tree-drag-insert-below',
'x-tree-drag-append'
]);
this.lastInsertClass='_noclass'
}
},
beforeDragDrop:function(target,e,id){
this.cancelExpand();
return true
},
afterRepair:function(data){
if(data&&Ext.enableFx){
data.node.ui.highlight()
}
this.hideProxy()
}
})
}
if(Ext.dd.DragZone){
Ext.tree.TreeDragZone=function(tree,config){
Ext.tree.TreeDragZone.superclass.constructor.call(this,tree.innerCt,config);
this.tree=tree
};
Ext.extend(Ext.tree.TreeDragZone,Ext.dd.DragZone,{
ddGroup:'TreeDD',
onBeforeDrag:function(data,e){
var n=data.node;
return n&&n.draggable&&!n.disabled
},
onInitDrag:function(e){
var data=this.dragData;
this.tree.getSelectionModel().select(data.node);
this.tree.eventModel.disable();
this.proxy.update('');
data.node.ui.appendDDGhost(this.proxy.ghost.dom);
this.tree.fireEvent('startdrag',this.tree,data.node,e)
},
getRepairXY:function(e,data){
return data.node.ui.getDDRepairXY()
},
onEndDrag:function(data,e){
this.tree.eventModel.enable.defer(100,this.tree.eventModel);
this.tree.fireEvent('enddrag',this.tree,data.node,e)
},
onValidDrop:function(dd,e,id){
this.tree.fireEvent('dragdrop',this.tree,this.dragData.node,dd,e);
this.hideProxy()
},
beforeInvalidDrop:function(e,id){
var sm=this.tree.getSelectionModel();
sm.clearSelections();
sm.select(this.dragData.node)
},
afterRepair:function(){
if(Ext.enableFx&&this.tree.hlDrop){
Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||'c3daf9')
}
this.dragging=false
}
})
}
Ext.tree.TreeEditor=function(tree,fc,config){
fc=fc||{};
var field=fc.events?fc:new Ext.form.TextField(fc);
Ext.tree.TreeEditor.superclass.constructor.call(this,field,config);
this.tree=tree;
if(!tree.rendered){
tree.on('render',this.initEditor,this)
}else{
this.initEditor(tree)
}
};
Ext.extend(Ext.tree.TreeEditor,Ext.Editor,{
alignment:'l-l',
autoSize:false,
hideEl:false,
cls:'x-small-editor x-tree-editor',
shim:false,
shadow:'frame',
maxWidth:250,
editDelay:350,
initEditor:function(tree){
tree.on({
scope:this,
beforeclick:this.beforeNodeClick,
dblclick:this.onNodeDblClick
});
this.on({
scope:this,
complete:this.updateNode,
beforestartedit:this.fitToTree,
specialkey:this.onSpecialKey
});
this.on('startedit',this.bindScroll,this,{delay:10})
},
fitToTree:function(ed,el){
var td=this.tree.getTreeEl().dom,nd=el.dom;
if(td.scrollLeft>nd.offsetLeft){
td.scrollLeft=nd.offsetLeft
}
var w=Math.min(this.maxWidth,(td.clientWidth>20?td.clientWidth:td.offsetWidth)-Math.max(0,nd.offsetLeft-td.scrollLeft)-5);
this.setSize(w,'')
},
triggerEdit:function(node,defer){
this.completeEdit();
if(node.attributes.editable!==false){
this.editNode=node;
if(this.tree.autoScroll){
Ext.fly(node.ui.getEl()).scrollIntoView(this.tree.body)
}
var value=node.text||'';
if(!Ext.isGecko&&Ext.isEmpty(node.text)){
node.setText('&#160;')
}
this.autoEditTimer=this.startEdit.defer(this.editDelay,this,[
node.ui.textNode,
value
]);
return false
}
},
bindScroll:function(){
this.tree.getTreeEl().on('scroll',this.cancelEdit,this)
},
beforeNodeClick:function(node,e){
clearTimeout(this.autoEditTimer);
if(this.tree.getSelectionModel().isSelected(node)){
e.stopEvent();
return this.triggerEdit(node)
}
},
onNodeDblClick:function(node,e){
clearTimeout(this.autoEditTimer)
},
updateNode:function(ed,value){
this.tree.getTreeEl().un('scroll',this.cancelEdit,this);
this.editNode.setText(value)
},
onHide:function(){
Ext.tree.TreeEditor.superclass.onHide.call(this);
if(this.editNode){
this.editNode.ui.focus.defer(50,this.editNode.ui)
}
},
onSpecialKey:function(field,e){
var k=e.getKey();
if(k==e.ESC){
e.stopEvent();
this.cancelEdit()
}else if(k==e.ENTER&&!e.hasModifier()){
e.stopEvent();
this.completeEdit()
}
},
onDestroy:function(){
clearTimeout(this.autoEditTimer);
Ext.tree.TreeEditor.superclass.onDestroy.call(this);
var tree=this.tree;
tree.un('beforeclick',this.beforeNodeClick,this);
tree.un('dblclick',this.onNodeDblClick,this)
}
});
Ext.menu.Menu=Ext.extend(Ext.Container,{
minWidth:120,
shadow:'sides',
subMenuAlign:'tl-tr?',
defaultAlign:'tl-bl?',
allowOtherMenus:false,
ignoreParentClicks:false,
enableScrolling:true,
maxHeight:null,
scrollIncrement:24,
showSeparator:true,
defaultOffsets:[
0,
0
],
plain:false,
floating:true,
zIndex:15000,
hidden:true,
layout:'menu',
hideMode:'offsets',
scrollerHeight:8,
autoLayout:true,
defaultType:'menuitem',
bufferResize:false,
initComponent:function(){
if(Ext.isArray(this.initialConfig)){
Ext.apply(this,{items:this.initialConfig})
}
this.addEvents('click','mouseover','mouseout','itemclick');
Ext.menu.MenuMgr.register(this);
if(this.floating){
Ext.EventManager.onWindowResize(this.hide,this)
}else{
if(this.initialConfig.hidden!==false){
this.hidden=false
}
this.internalDefaults={hideOnClick:false}
}
Ext.menu.Menu.superclass.initComponent.call(this);
if(this.autoLayout){
var fn=this.doLayout.createDelegate(this,[]);
this.on({
add:fn,
remove:fn
})
}
},
getLayoutTarget:function(){
return this.ul
},
onRender:function(ct,position){
if(!ct){
ct=Ext.getBody()
}
var dh={
id:this.getId(),
cls:'x-menu '+(this.floating?'x-menu-floating x-layer ':'')+(this.cls||'')+(this.plain?' x-menu-plain':'')+(this.showSeparator?'':' x-menu-nosep'),
style:this.style,
cn:[
{
tag:'a',
cls:'x-menu-focus',
href:'#',
onclick:'return false;',
tabIndex:'-1'
},
{
tag:'ul',
cls:'x-menu-list'
}
]
};
if(this.floating){
this.el=new Ext.Layer({
shadow:this.shadow,
dh:dh,
constrain:false,
parentEl:ct,
zindex:this.zIndex
})
}else{
this.el=ct.createChild(dh)
}
Ext.menu.Menu.superclass.onRender.call(this,ct,position);
if(!this.keyNav){
this.keyNav=new Ext.menu.MenuNav(this)
}
this.focusEl=this.el.child('a.x-menu-focus');
this.ul=this.el.child('ul.x-menu-list');
this.mon(this.ul,{
scope:this,
click:this.onClick,
mouseover:this.onMouseOver,
mouseout:this.onMouseOut
});
if(this.enableScrolling){
this.mon(this.el,{
scope:this,
delegate:'.x-menu-scroller',
click:this.onScroll,
mouseover:this.deactivateActive
})
}
},
findTargetItem:function(e){
var t=e.getTarget('.x-menu-list-item',this.ul,true);
if(t&&t.menuItemId){
return this.items.get(t.menuItemId)
}
},
onClick:function(e){
var t=this.findTargetItem(e);
if(t){
if(t.isFormField){
this.setActiveItem(t)
}else if(t instanceof Ext.menu.BaseItem){
if(t.menu&&this.ignoreParentClicks){
t.expandMenu();
e.preventDefault()
}else if(t.onClick){
t.onClick(e);
this.fireEvent('click',this,t,e)
}
}
}
},
setActiveItem:function(item,autoExpand){
if(item!=this.activeItem){
this.deactivateActive();
if((this.activeItem=item).isFormField){
item.focus()
}else{
item.activate(autoExpand)
}
}else if(autoExpand){
item.expandMenu()
}
},
deactivateActive:function(){
var a=this.activeItem;
if(a){
if(a.isFormField){
if(a.collapse){
a.collapse()
}
}else{
a.deactivate()
}
delete this.activeItem
}
},
tryActivate:function(start,step){
var items=this.items;
for(var i=start,len=items.length;i>=0&&i<len;i+=step){
var item=items.get(i);
if(item.isVisible()&&!item.disabled&&(item.canActivate||item.isFormField)){
this.setActiveItem(item,false);
return item
}
}
return false
},
onMouseOver:function(e){
var t=this.findTargetItem(e);
if(t){
if(t.canActivate&&!t.disabled){
this.setActiveItem(t,true)
}
}
this.over=true;
this.fireEvent('mouseover',this,e,t)
},
onMouseOut:function(e){
var t=this.findTargetItem(e);
if(t){
if(t==this.activeItem&&t.shouldDeactivate&&t.shouldDeactivate(e)){
this.activeItem.deactivate();
delete this.activeItem
}
}
this.over=false;
this.fireEvent('mouseout',this,e,t)
},
onScroll:function(e,t){
if(e){
e.stopEvent()
}
var ul=this.ul.dom,top=Ext.fly(t).is('.x-menu-scroller-top');
ul.scrollTop+=this.scrollIncrement*(top?-1:1);
if(top?ul.scrollTop<=0:ul.scrollTop+this.activeMax>=ul.scrollHeight){
this.onScrollerOut(null,t)
}
},
onScrollerIn:function(e,t){
var ul=this.ul.dom,top=Ext.fly(t).is('.x-menu-scroller-top');
if(top?ul.scrollTop>0:ul.scrollTop+this.activeMax<ul.scrollHeight){
Ext.fly(t).addClass([
'x-menu-item-active',
'x-menu-scroller-active'
])
}
},
onScrollerOut:function(e,t){
Ext.fly(t).removeClass([
'x-menu-item-active',
'x-menu-scroller-active'
])
},
show:function(el,pos,parentMenu){
if(this.floating){
this.parentMenu=parentMenu;
if(!this.el){
this.render();
this.doLayout(false,true)
}
this.showAt(this.el.getAlignToXY(el,pos||this.defaultAlign,this.defaultOffsets),parentMenu)
}else{
Ext.menu.Menu.superclass.show.call(this)
}
},
showAt:function(xy,parentMenu){
if(this.fireEvent('beforeshow',this)!==false){
this.parentMenu=parentMenu;
if(!this.el){
this.render()
}
if(this.enableScrolling){
this.el.setXY(xy);
xy[1]=this.constrainScroll(xy[1]);
xy=[
this.el.adjustForConstraints(xy)[0],
xy[1]
]
}else{
xy=this.el.adjustForConstraints(xy)
}
this.el.setXY(xy);
this.el.show();
Ext.menu.Menu.superclass.onShow.call(this);
if(Ext.isIE){
this.fireEvent('autosize',this);
if(!Ext.isIE8){
this.el.repaint()
}
}
this.hidden=false;
this.focus();
this.fireEvent('show',this)
}
},
constrainScroll:function(y){
var max,full=this.ul.setHeight('auto').getHeight(),returnY=y,normalY,parentEl,scrollTop,viewHeight;
if(this.floating){
parentEl=Ext.fly(this.el.dom.parentNode);
scrollTop=parentEl.getScroll().top;
viewHeight=parentEl.getViewSize().height;
normalY=y-scrollTop;
max=this.maxHeight?this.maxHeight:viewHeight-normalY;
if(full>viewHeight){
max=viewHeight;
returnY=y-normalY
}else if(max<full){
returnY=y-(full-max);
max=full
}
}else{
max=this.getHeight()
}
if(this.maxHeight){
max=Math.min(this.maxHeight,max)
}
if(full>max&&max>0){
this.activeMax=max-this.scrollerHeight*2-this.el.getFrameWidth('tb')-Ext.num(this.el.shadowOffset,0);
this.ul.setHeight(this.activeMax);
this.createScrollers();
this.el.select('.x-menu-scroller').setDisplayed('')
}else{
this.ul.setHeight(full);
this.el.select('.x-menu-scroller').setDisplayed('none')
}
this.ul.dom.scrollTop=0;
return returnY
},
createScrollers:function(){
if(!this.scroller){
this.scroller={
pos:0,
top:this.el.insertFirst({
tag:'div',
cls:'x-menu-scroller x-menu-scroller-top',
html:'&#160;'
}),
bottom:this.el.createChild({
tag:'div',
cls:'x-menu-scroller x-menu-scroller-bottom',
html:'&#160;'
})
};
this.scroller.top.hover(this.onScrollerIn,this.onScrollerOut,this);
this.scroller.topRepeater=new Ext.util.ClickRepeater(this.scroller.top,{
listeners:{
click:this.onScroll.createDelegate(this,[
null,
this.scroller.top
],false)
}
});
this.scroller.bottom.hover(this.onScrollerIn,this.onScrollerOut,this);
this.scroller.bottomRepeater=new Ext.util.ClickRepeater(this.scroller.bottom,{
listeners:{
click:this.onScroll.createDelegate(this,[
null,
this.scroller.bottom
],false)
}
})
}
},
onLayout:function(){
if(this.isVisible()){
if(this.enableScrolling){
this.constrainScroll(this.el.getTop())
}
if(this.floating){
this.el.sync()
}
}
},
focus:function(){
if(!this.hidden){
this.doFocus.defer(50,this)
}
},
doFocus:function(){
if(!this.hidden){
this.focusEl.focus()
}
},
hide:function(deep){
if(!this.isDestroyed){
this.deepHide=deep;
Ext.menu.Menu.superclass.hide.call(this);
delete this.deepHide
}
},
onHide:function(){
Ext.menu.Menu.superclass.onHide.call(this);
this.deactivateActive();
if(this.el&&this.floating){
this.el.hide()
}
var pm=this.parentMenu;
if(this.deepHide===true&&pm){
if(pm.floating){
pm.hide(true)
}else{
pm.deactivateActive()
}
}
},
lookupComponent:function(c){
if(Ext.isString(c)){
c=c=='separator'||c=='-'?new Ext.menu.Separator:new Ext.menu.TextItem(c);
this.applyDefaults(c)
}else{
if(Ext.isObject(c)){
c=this.getMenuItem(c)
}else if(c.tagName||c.el){
c=new Ext.BoxComponent({el:c})
}
}
return c
},
applyDefaults:function(c){
if(!Ext.isString(c)){
c=Ext.menu.Menu.superclass.applyDefaults.call(this,c);
var d=this.internalDefaults;
if(d){
if(c.events){
Ext.applyIf(c.initialConfig,d);
Ext.apply(c,d)
}else{
Ext.applyIf(c,d)
}
}
}
return c
},
getMenuItem:function(config){
config.ownerCt=this;
if(!config.isXType){
if(!config.xtype&&Ext.isBoolean(config.checked)){
return new Ext.menu.CheckItem(config)
}
return Ext.create(config,this.defaultType)
}
return config
},
addSeparator:function(){
return this.add(new Ext.menu.Separator)
},
addElement:function(el){
return this.add(new Ext.menu.BaseItem({el:el}))
},
addItem:function(item){
return this.add(item)
},
addMenuItem:function(config){
return this.add(this.getMenuItem(config))
},
addText:function(text){
return this.add(new Ext.menu.TextItem(text))
},
onDestroy:function(){
Ext.EventManager.removeResizeListener(this.hide,this);
var pm=this.parentMenu;
if(pm&&pm.activeChild==this){
delete pm.activeChild
}
delete this.parentMenu;
Ext.menu.Menu.superclass.onDestroy.call(this);
Ext.menu.MenuMgr.unregister(this);
if(this.keyNav){
this.keyNav.disable()
}
var s=this.scroller;
if(s){
Ext.destroy(s.topRepeater,s.bottomRepeater,s.top,s.bottom)
}
Ext.destroy(this.el,this.focusEl,this.ul)
}
});
Ext.reg('menu',Ext.menu.Menu);
Ext.menu.MenuNav=Ext.extend(Ext.KeyNav,function(){
function up(e,m){
if(!m.tryActivate(m.items.indexOf(m.activeItem)-1,-1)){
m.tryActivate(m.items.length-1,-1)
}
}
function down(e,m){
if(!m.tryActivate(m.items.indexOf(m.activeItem)+1,1)){
m.tryActivate(0,1)
}
}
return{
constructor:function(menu){
Ext.menu.MenuNav.superclass.constructor.call(this,menu.el);
this.scope=this.menu=menu
},
doRelay:function(e,h){
var k=e.getKey();
if(this.menu.activeItem&&this.menu.activeItem.isFormField&&k!=e.TAB){
return false
}
if(!this.menu.activeItem&&e.isNavKeyPress()&&k!=e.SPACE&&k!=e.RETURN){
this.menu.tryActivate(0,1);
return false
}
return h.call(this.scope||this,e,this.menu)
},
tab:function(e,m){
e.stopEvent();
if(e.shiftKey){
up(e,m)
}else{
down(e,m)
}
},
up:up,
down:down,
right:function(e,m){
if(m.activeItem){
m.activeItem.expandMenu(true)
}
},
left:function(e,m){
m.hide();
if(m.parentMenu&&m.parentMenu.activeItem){
m.parentMenu.activeItem.activate()
}
},
enter:function(e,m){
if(m.activeItem){
e.stopPropagation();
m.activeItem.onClick(e);
m.fireEvent('click',this,m.activeItem);
return true
}
}
}
}());
Ext.menu.MenuMgr=function(){
var menus,active,map,groups={},attached=false,lastShow=new Date;
function init(){
menus={};
active=new Ext.util.MixedCollection;
map=Ext.getDoc().addKeyListener(27,hideAll);
map.disable()
}
function hideAll(){
if(active&&active.length>0){
var c=active.clone();
c.each(function(m){
m.hide()
});
return true
}
return false
}
function onHide(m){
active.remove(m);
if(active.length<1){
map.disable();
Ext.getDoc().un('mousedown',onMouseDown);
attached=false
}
}
function onShow(m){
var last=active.last();
lastShow=new Date;
active.add(m);
if(!attached){
map.enable();
Ext.getDoc().on('mousedown',onMouseDown);
attached=true
}
if(m.parentMenu){
m.getEl().setZIndex(parseInt(m.parentMenu.getEl().getStyle('z-index'),10)+3);
m.parentMenu.activeChild=m
}else if(last&&!last.isDestroyed&&last.isVisible()){
m.getEl().setZIndex(parseInt(last.getEl().getStyle('z-index'),10)+3)
}
}
function onBeforeHide(m){
if(m.activeChild){
m.activeChild.hide()
}
if(m.autoHideTimer){
clearTimeout(m.autoHideTimer);
delete m.autoHideTimer
}
}
function onBeforeShow(m){
var pm=m.parentMenu;
if(!pm&&!m.allowOtherMenus){
hideAll()
}else if(pm&&pm.activeChild){
pm.activeChild.hide()
}
}
function onMouseDown(e){
if(lastShow.getElapsed()>50&&active.length>0&&!e.getTarget('.x-menu')){
hideAll()
}
}
return{
hideAll:function(){
return hideAll()
},
register:function(menu){
if(!menus){
init()
}
menus[menu.id]=menu;
menu.on({
beforehide:onBeforeHide,
hide:onHide,
beforeshow:onBeforeShow,
show:onShow
})
},
get:function(menu){
if(typeof menu=='string'){
if(!menus){
return null
}
return menus[menu]
}else if(menu.events){
return menu
}else if(typeof menu.length=='number'){
return new Ext.menu.Menu({items:menu})
}else{
return Ext.create(menu,'menu')
}
},
unregister:function(menu){
delete menus[menu.id];
menu.un('beforehide',onBeforeHide);
menu.un('hide',onHide);
menu.un('beforeshow',onBeforeShow);
menu.un('show',onShow)
},
registerCheckable:function(menuItem){
var g=menuItem.group;
if(g){
if(!groups[g]){
groups[g]=[]
}
groups[g].push(menuItem)
}
},
unregisterCheckable:function(menuItem){
var g=menuItem.group;
if(g){
groups[g].remove(menuItem)
}
},
onCheckChange:function(item,state){
if(item.group&&state){
var group=groups[item.group],i=0,len=group.length,current;
for(;i<len;i++){
current=group[i];
if(current!=item){
current.setChecked(false)
}
}
}
},
getCheckedItem:function(groupId){
var g=groups[groupId];
if(g){
for(var i=0,l=g.length;i<l;i++){
if(g[i].checked){
return g[i]
}
}
}
return null
},
setCheckedItem:function(groupId,itemId){
var g=groups[groupId];
if(g){
for(var i=0,l=g.length;i<l;i++){
if(g[i].id==itemId){
g[i].setChecked(true)
}
}
}
return null
}
}
}();
Ext.menu.BaseItem=Ext.extend(Ext.Component,{
canActivate:false,
activeClass:'x-menu-item-active',
hideOnClick:true,
clickHideDelay:1,
ctype:'Ext.menu.BaseItem',
actionMode:'container',
initComponent:function(){
Ext.menu.BaseItem.superclass.initComponent.call(this);
this.addEvents('click','activate','deactivate');
if(this.handler){
this.on('click',this.handler,this.scope)
}
},
onRender:function(container,position){
Ext.menu.BaseItem.superclass.onRender.apply(this,arguments);
if(this.ownerCt&&this.ownerCt instanceof Ext.menu.Menu){
this.parentMenu=this.ownerCt
}else{
this.container.addClass('x-menu-list-item');
this.mon(this.el,{
scope:this,
click:this.onClick,
mouseenter:this.activate,
mouseleave:this.deactivate
})
}
},
setHandler:function(handler,scope){
if(this.handler){
this.un('click',this.handler,this.scope)
}
this.on('click',this.handler=handler,this.scope=scope)
},
onClick:function(e){
if(!this.disabled&&this.fireEvent('click',this,e)!==false&&(this.parentMenu&&this.parentMenu.fireEvent('itemclick',this,e)!==false)){
this.handleClick(e)
}else{
e.stopEvent()
}
},
activate:function(){
if(this.disabled){
return false
}
var li=this.container;
li.addClass(this.activeClass);
this.region=li.getRegion().adjust(2,2,-2,-2);
this.fireEvent('activate',this);
return true
},
deactivate:function(){
this.container.removeClass(this.activeClass);
this.fireEvent('deactivate',this)
},
shouldDeactivate:function(e){
return!this.region||!this.region.contains(e.getPoint())
},
handleClick:function(e){
var pm=this.parentMenu;
if(this.hideOnClick){
if(pm.floating){
this.clickHideDelayTimer=pm.hide.defer(this.clickHideDelay,pm,[true])
}else{
pm.deactivateActive()
}
}
},
beforeDestroy:function(){
clearTimeout(this.clickHideDelayTimer);
Ext.menu.BaseItem.superclass.beforeDestroy.call(this)
},
expandMenu:Ext.emptyFn,
hideMenu:Ext.emptyFn
});
Ext.reg('menubaseitem',Ext.menu.BaseItem);
Ext.menu.TextItem=Ext.extend(Ext.menu.BaseItem,{
hideOnClick:false,
itemCls:'x-menu-text',
constructor:function(config){
if(typeof config=='string'){
config={text:config}
}
Ext.menu.TextItem.superclass.constructor.call(this,config)
},
onRender:function(){
var s=document.createElement('span');
s.className=this.itemCls;
s.innerHTML=this.text;
this.el=s;
Ext.menu.TextItem.superclass.onRender.apply(this,arguments)
}
});
Ext.reg('menutextitem',Ext.menu.TextItem);
Ext.menu.Separator=Ext.extend(Ext.menu.BaseItem,{
itemCls:'x-menu-sep',
hideOnClick:false,
activeClass:'',
onRender:function(li){
var s=document.createElement('span');
s.className=this.itemCls;
s.innerHTML='&#160;';
this.el=s;
li.addClass('x-menu-sep-li');
Ext.menu.Separator.superclass.onRender.apply(this,arguments)
}
});
Ext.reg('menuseparator',Ext.menu.Separator);
Ext.menu.Item=Ext.extend(Ext.menu.BaseItem,{
itemCls:'x-menu-item',
canActivate:true,
showDelay:200,
altText:'',
hideDelay:200,
ctype:'Ext.menu.Item',
initComponent:function(){
Ext.menu.Item.superclass.initComponent.call(this);
if(this.menu){
if(Ext.isArray(this.menu)){
this.menu={items:this.menu}
}
if(Ext.isObject(this.menu)){
this.menu.ownerCt=this
}
this.menu=Ext.menu.MenuMgr.get(this.menu);
this.menu.ownerCt=undefined
}
},
onRender:function(container,position){
if(!this.itemTpl){
this.itemTpl=Ext.menu.Item.prototype.itemTpl=new Ext.XTemplate('<a id="{id}" class="{cls}" hidefocus="true" unselectable="on" href="{href}"','<tpl if="hrefTarget">',' target="{hrefTarget}"','</tpl>','>','<img alt="{altText}" src="{icon}" class="x-menu-item-icon {iconCls}"/>','<span class="x-menu-item-text">{text}</span>','</a>')
}
var a=this.getTemplateArgs();
this.el=position?this.itemTpl.insertBefore(position,a,true):this.itemTpl.append(container,a,true);
this.iconEl=this.el.child('img.x-menu-item-icon');
this.textEl=this.el.child('.x-menu-item-text');
if(!this.href){
this.mon(this.el,'click',Ext.emptyFn,null,{preventDefault:true})
}
Ext.menu.Item.superclass.onRender.call(this,container,position)
},
getTemplateArgs:function(){
return{
id:this.id,
cls:this.itemCls+(this.menu?' x-menu-item-arrow':'')+(this.cls?' '+this.cls:''),
href:this.href||'#',
hrefTarget:this.hrefTarget,
icon:this.icon||Ext.BLANK_IMAGE_URL,
iconCls:this.iconCls||'',
text:this.itemText||this.text||'&#160;',
altText:this.altText||''
}
},
setText:function(text){
this.text=text||'&#160;';
if(this.rendered){
this.textEl.update(this.text);
this.parentMenu.layout.doAutoSize()
}
},
setIconClass:function(cls){
var oldCls=this.iconCls;
this.iconCls=cls;
if(this.rendered){
this.iconEl.replaceClass(oldCls,this.iconCls)
}
},
beforeDestroy:function(){
clearTimeout(this.showTimer);
clearTimeout(this.hideTimer);
if(this.menu){
delete this.menu.ownerCt;
this.menu.destroy()
}
Ext.menu.Item.superclass.beforeDestroy.call(this)
},
handleClick:function(e){
if(!this.href){
e.stopEvent()
}
Ext.menu.Item.superclass.handleClick.apply(this,arguments)
},
activate:function(autoExpand){
if(Ext.menu.Item.superclass.activate.apply(this,arguments)){
this.focus();
if(autoExpand){
this.expandMenu()
}
}
return true
},
shouldDeactivate:function(e){
if(Ext.menu.Item.superclass.shouldDeactivate.call(this,e)){
if(this.menu&&this.menu.isVisible()){
return!this.menu.getEl().getRegion().contains(e.getPoint())
}
return true
}
return false
},
deactivate:function(){
Ext.menu.Item.superclass.deactivate.apply(this,arguments);
this.hideMenu()
},
expandMenu:function(autoActivate){
if(!this.disabled&&this.menu){
clearTimeout(this.hideTimer);
delete this.hideTimer;
if(!this.menu.isVisible()&&!this.showTimer){
this.showTimer=this.deferExpand.defer(this.showDelay,this,[autoActivate])
}else if(this.menu.isVisible()&&autoActivate){
this.menu.tryActivate(0,1)
}
}
},
deferExpand:function(autoActivate){
delete this.showTimer;
this.menu.show(this.container,this.parentMenu.subMenuAlign||'tl-tr?',this.parentMenu);
if(autoActivate){
this.menu.tryActivate(0,1)
}
},
hideMenu:function(){
clearTimeout(this.showTimer);
delete this.showTimer;
if(!this.hideTimer&&this.menu&&this.menu.isVisible()){
this.hideTimer=this.deferHide.defer(this.hideDelay,this)
}
},
deferHide:function(){
delete this.hideTimer;
if(this.menu.over){
this.parentMenu.setActiveItem(this,false)
}else{
this.menu.hide()
}
}
});
Ext.reg('menuitem',Ext.menu.Item);
Ext.menu.CheckItem=Ext.extend(Ext.menu.Item,{
itemCls:'x-menu-item x-menu-check-item',
groupClass:'x-menu-group-item',
checked:false,
ctype:'Ext.menu.CheckItem',
initComponent:function(){
Ext.menu.CheckItem.superclass.initComponent.call(this);
this.addEvents('beforecheckchange','checkchange');
if(this.checkHandler){
this.on('checkchange',this.checkHandler,this.scope)
}
Ext.menu.MenuMgr.registerCheckable(this)
},
onRender:function(c){
Ext.menu.CheckItem.superclass.onRender.apply(this,arguments);
if(this.group){
this.el.addClass(this.groupClass)
}
if(this.checked){
this.checked=false;
this.setChecked(true,true)
}
},
destroy:function(){
Ext.menu.MenuMgr.unregisterCheckable(this);
Ext.menu.CheckItem.superclass.destroy.apply(this,arguments)
},
setChecked:function(state,suppressEvent){
var suppress=suppressEvent===true;
if(this.checked!=state&&(suppress||this.fireEvent('beforecheckchange',this,state)!==false)){
Ext.menu.MenuMgr.onCheckChange(this,state);
if(this.container){
this.container[state?'addClass':'removeClass']('x-menu-item-checked')
}
this.checked=state;
if(!suppress){
this.fireEvent('checkchange',this,state)
}
}
},
handleClick:function(e){
if(!this.disabled&&!(this.checked&&this.group)){
this.setChecked(!this.checked)
}
Ext.menu.CheckItem.superclass.handleClick.apply(this,arguments)
}
});
Ext.reg('menucheckitem',Ext.menu.CheckItem);
Ext.menu.DateMenu=Ext.extend(Ext.menu.Menu,{
enableScrolling:false,
hideOnClick:true,
pickerId:null,
cls:'x-date-menu',
initComponent:function(){
this.on('beforeshow',this.onBeforeShow,this);
if(this.strict=Ext.isIE7&&Ext.isStrict){
this.on('show',this.onShow,this,{
single:true,
delay:20
})
}
Ext.apply(this,{
plain:true,
showSeparator:false,
items:this.picker=new Ext.DatePicker(Ext.applyIf({
internalRender:this.strict||!Ext.isIE,
ctCls:'x-menu-date-item',
id:this.pickerId
},this.initialConfig))
});
this.picker.purgeListeners();
Ext.menu.DateMenu.superclass.initComponent.call(this);
this.relayEvents(this.picker,['select']);
this.on('show',this.picker.focus,this.picker);
this.on('select',this.menuHide,this);
if(this.handler){
this.on('select',this.handler,this.scope||this)
}
},
menuHide:function(){
if(this.hideOnClick){
this.hide(true)
}
},
onBeforeShow:function(){
if(this.picker){
this.picker.hideMonthPicker(true)
}
},
onShow:function(){
var el=this.picker.getEl();
el.setWidth(el.getWidth())
}
});
Ext.reg('datemenu',Ext.menu.DateMenu);
Ext.menu.ColorMenu=Ext.extend(Ext.menu.Menu,{
enableScrolling:false,
hideOnClick:true,
cls:'x-color-menu',
paletteId:null,
initComponent:function(){
Ext.apply(this,{
plain:true,
showSeparator:false,
items:this.palette=new Ext.ColorPalette(Ext.applyIf({id:this.paletteId},this.initialConfig))
});
this.palette.purgeListeners();
Ext.menu.ColorMenu.superclass.initComponent.call(this);
this.relayEvents(this.palette,['select']);
this.on('select',this.menuHide,this);
if(this.handler){
this.on('select',this.handler,this.scope||this)
}
},
menuHide:function(){
if(this.hideOnClick){
this.hide(true)
}
}
});
Ext.reg('colormenu',Ext.menu.ColorMenu);
Ext.form.Field=Ext.extend(Ext.BoxComponent,{
invalidClass:'x-form-invalid',
invalidText:'The value in this field is invalid',
focusClass:'x-form-focus',
validationEvent:'keyup',
validateOnBlur:true,
validationDelay:250,
defaultAutoCreate:{
tag:'input',
type:'text',
size:'20',
autocomplete:'off'
},
fieldClass:'x-form-field',
msgTarget:'qtip',
msgFx:'normal',
readOnly:false,
disabled:false,
submitValue:true,
isFormField:true,
msgDisplay:'',
hasFocus:false,
initComponent:function(){
Ext.form.Field.superclass.initComponent.call(this);
this.addEvents('focus','blur','specialkey','change','invalid','valid')
},
getName:function(){
return this.rendered&&this.el.dom.name?this.el.dom.name:this.name||this.id||''
},
onRender:function(ct,position){
if(!this.el){
var cfg=this.getAutoCreate();
if(!cfg.name){
cfg.name=this.name||this.id
}
if(this.inputType){
cfg.type=this.inputType
}
this.autoEl=cfg
}
Ext.form.Field.superclass.onRender.call(this,ct,position);
if(this.submitValue===false){
this.el.dom.removeAttribute('name')
}
var type=this.el.dom.type;
if(type){
if(type=='password'){
type='text'
}
this.el.addClass('x-form-'+type)
}
if(this.readOnly){
this.setReadOnly(true)
}
if(this.tabIndex!==undefined){
this.el.dom.setAttribute('tabIndex',this.tabIndex)
}
this.el.addClass([
this.fieldClass,
this.cls
])
},
getItemCt:function(){
return this.itemCt
},
initValue:function(){
if(this.value!==undefined){
this.setValue(this.value)
}else if(!Ext.isEmpty(this.el.dom.value)&&this.el.dom.value!=this.emptyText){
this.setValue(this.el.dom.value)
}
this.originalValue=this.getValue()
},
isDirty:function(){
if(this.disabled||!this.rendered){
return false
}
return String(this.getValue())!==String(this.originalValue)
},
setReadOnly:function(readOnly){
if(this.rendered){
this.el.dom.readOnly=readOnly
}
this.readOnly=readOnly
},
afterRender:function(){
Ext.form.Field.superclass.afterRender.call(this);
this.initEvents();
this.initValue()
},
fireKey:function(e){
if(e.isSpecialKey()){
this.fireEvent('specialkey',this,e)
}
},
reset:function(){
this.setValue(this.originalValue);
this.clearInvalid()
},
initEvents:function(){
this.mon(this.el,Ext.EventManager.getKeyEvent(),this.fireKey,this);
this.mon(this.el,'focus',this.onFocus,this);
this.mon(this.el,'blur',this.onBlur,this,this.inEditor?{buffer:10}:null)
},
preFocus:Ext.emptyFn,
onFocus:function(){
this.preFocus();
if(this.focusClass){
this.el.addClass(this.focusClass)
}
if(!this.hasFocus){
this.hasFocus=true;
this.startValue=this.getValue();
this.fireEvent('focus',this)
}
},
beforeBlur:Ext.emptyFn,
onBlur:function(){
this.beforeBlur();
if(this.focusClass){
this.el.removeClass(this.focusClass)
}
this.hasFocus=false;
if(this.validationEvent!==false&&(this.validateOnBlur||this.validationEvent=='blur')){
this.validate()
}
var v=this.getValue();
if(String(v)!==String(this.startValue)){
this.fireEvent('change',this,v,this.startValue)
}
this.fireEvent('blur',this);
this.postBlur()
},
postBlur:Ext.emptyFn,
isValid:function(preventMark){
if(this.disabled){
return true
}
var restore=this.preventMark;
this.preventMark=preventMark===true;
var v=this.validateValue(this.processValue(this.getRawValue()),preventMark);
this.preventMark=restore;
return v
},
validate:function(){
if(this.disabled||this.validateValue(this.processValue(this.getRawValue()))){
this.clearInvalid();
return true
}
return false
},
processValue:function(value){
return value
},
validateValue:function(value){
var error=this.getErrors(value)[0];
if(error==undefined){
return true
}else{
this.markInvalid(error);
return false
}
},
getErrors:function(){
return[]
},
getActiveError:function(){
return this.activeError||''
},
markInvalid:function(msg){
if(this.rendered&&!this.preventMark){
msg=msg||this.invalidText;
var mt=this.getMessageHandler();
if(mt){
mt.mark(this,msg)
}else if(this.msgTarget){
this.el.addClass(this.invalidClass);
var t=Ext.getDom(this.msgTarget);
if(t){
t.innerHTML=msg;
t.style.display=this.msgDisplay
}
}
}
this.setActiveError(msg)
},
clearInvalid:function(){
if(this.rendered&&!this.preventMark){
this.el.removeClass(this.invalidClass);
var mt=this.getMessageHandler();
if(mt){
mt.clear(this)
}else if(this.msgTarget){
this.el.removeClass(this.invalidClass);
var t=Ext.getDom(this.msgTarget);
if(t){
t.innerHTML='';
t.style.display='none'
}
}
}
this.unsetActiveError()
},
setActiveError:function(msg,suppressEvent){
this.activeError=msg;
if(suppressEvent!==true)
this.fireEvent('invalid',this,msg)
},
unsetActiveError:function(suppressEvent){
delete this.activeError;
if(suppressEvent!==true)
this.fireEvent('valid',this)
},
getMessageHandler:function(){
return Ext.form.MessageTargets[this.msgTarget]
},
getErrorCt:function(){
return this.el.findParent('.x-form-element',5,true)||this.el.findParent('.x-form-field-wrap',5,true)
},
alignErrorEl:function(){
this.errorEl.setWidth(this.getErrorCt().getWidth(true)-20)
},
alignErrorIcon:function(){
this.errorIcon.alignTo(this.el,'tl-tr',[
2,
0
])
},
getRawValue:function(){
var v=this.rendered?this.el.getValue():Ext.value(this.value,'');
if(v===this.emptyText){
v=''
}
return v
},
getValue:function(){
if(!this.rendered){
return this.value
}
var v=this.el.getValue();
if(v===this.emptyText||v===undefined){
v=''
}
return v
},
setRawValue:function(v){
return this.rendered?this.el.dom.value=Ext.isEmpty(v)?'':v:''
},
setValue:function(v){
this.value=v;
if(this.rendered){
this.el.dom.value=Ext.isEmpty(v)?'':v;
this.validate()
}
return this
},
append:function(v){
this.setValue([
this.getValue(),
v
].join(''))
}
});
Ext.form.MessageTargets={
'qtip':{
mark:function(field,msg){
field.el.addClass(field.invalidClass);
field.el.dom.qtip=msg;
field.el.dom.qclass='x-form-invalid-tip';
if(Ext.QuickTips){
Ext.QuickTips.enable()
}
},
clear:function(field){
field.el.removeClass(field.invalidClass);
field.el.dom.qtip=''
}
},
'title':{
mark:function(field,msg){
field.el.addClass(field.invalidClass);
field.el.dom.title=msg
},
clear:function(field){
field.el.dom.title=''
}
},
'under':{
mark:function(field,msg){
field.el.addClass(field.invalidClass);
if(!field.errorEl){
var elp=field.getErrorCt();
if(!elp){
field.el.dom.title=msg;
return
}
field.errorEl=elp.createChild({cls:'x-form-invalid-msg'});
field.on('resize',field.alignErrorEl,field);
field.on('destroy',function(){
Ext.destroy(this.errorEl)
},field)
}
field.alignErrorEl();
field.errorEl.update(msg);
Ext.form.Field.msgFx[field.msgFx].show(field.errorEl,field)
},
clear:function(field){
field.el.removeClass(field.invalidClass);
if(field.errorEl){
Ext.form.Field.msgFx[field.msgFx].hide(field.errorEl,field)
}else{
field.el.dom.title=''
}
}
},
'side':{
mark:function(field,msg){
field.el.addClass(field.invalidClass);
if(!field.errorIcon){
var elp=field.getErrorCt();
if(!elp){
field.el.dom.title=msg;
return
}
field.errorIcon=elp.createChild({cls:'x-form-invalid-icon'});
if(field.ownerCt){
field.ownerCt.on('afterlayout',field.alignErrorIcon,field);
field.ownerCt.on('expand',field.alignErrorIcon,field)
}
field.on('resize',field.alignErrorIcon,field);
field.on('destroy',function(){
Ext.destroy(this.errorIcon)
},field)
}
field.alignErrorIcon();
field.errorIcon.dom.qtip=msg;
field.errorIcon.dom.qclass='x-form-invalid-tip';
field.errorIcon.show()
},
clear:function(field){
field.el.removeClass(field.invalidClass);
if(field.errorIcon){
field.errorIcon.dom.qtip='';
field.errorIcon.hide()
}else{
field.el.dom.title=''
}
}
}
};
Ext.form.Field.msgFx={
normal:{
show:function(msgEl,f){
msgEl.setDisplayed('block')
},
hide:function(msgEl,f){
msgEl.setDisplayed(false).update('')
}
},
slide:{
show:function(msgEl,f){
msgEl.slideIn('t',{stopFx:true})
},
hide:function(msgEl,f){
msgEl.slideOut('t',{
stopFx:true,
useDisplay:true
})
}
},
slideRight:{
show:function(msgEl,f){
msgEl.fixDisplay();
msgEl.alignTo(f.el,'tl-tr');
msgEl.slideIn('l',{stopFx:true})
},
hide:function(msgEl,f){
msgEl.slideOut('l',{
stopFx:true,
useDisplay:true
})
}
}
};
Ext.reg('field',Ext.form.Field);
Ext.form.TextField=Ext.extend(Ext.form.Field,{
grow:false,
growMin:30,
growMax:800,
vtype:null,
maskRe:null,
disableKeyFilter:false,
allowBlank:true,
minLength:0,
maxLength:Number.MAX_VALUE,
minLengthText:'The minimum length for this field is {0}',
maxLengthText:'The maximum length for this field is {0}',
selectOnFocus:false,
blankText:'This field is required',
validator:null,
regex:null,
regexText:'',
emptyText:null,
emptyClass:'x-form-empty-field',
initComponent:function(){
Ext.form.TextField.superclass.initComponent.call(this);
this.addEvents('autosize','keydown','keyup','keypress')
},
initEvents:function(){
Ext.form.TextField.superclass.initEvents.call(this);
if(this.validationEvent=='keyup'){
this.validationTask=new Ext.util.DelayedTask(this.validate,this);
this.mon(this.el,'keyup',this.filterValidation,this)
}else if(this.validationEvent!==false&&this.validationEvent!='blur'){
this.mon(this.el,this.validationEvent,this.validate,this,{buffer:this.validationDelay})
}
if(this.selectOnFocus||this.emptyText){
this.mon(this.el,'mousedown',this.onMouseDown,this);
if(this.emptyText){
this.applyEmptyText()
}
}
if(this.maskRe||this.vtype&&this.disableKeyFilter!==true&&(this.maskRe=Ext.form.VTypes[this.vtype+'Mask'])){
this.mon(this.el,'keypress',this.filterKeys,this)
}
if(this.grow){
this.mon(this.el,'keyup',this.onKeyUpBuffered,this,{buffer:50});
this.mon(this.el,'click',this.autoSize,this)
}
if(this.enableKeyEvents){
this.mon(this.el,{
scope:this,
keyup:this.onKeyUp,
keydown:this.onKeyDown,
keypress:this.onKeyPress
})
}
},
onMouseDown:function(e){
if(!this.hasFocus){
this.mon(this.el,'mouseup',Ext.emptyFn,this,{
single:true,
preventDefault:true
})
}
},
processValue:function(value){
if(this.stripCharsRe){
var newValue=value.replace(this.stripCharsRe,'');
if(newValue!==value){
this.setRawValue(newValue);
return newValue
}
}
return value
},
filterValidation:function(e){
if(!e.isNavKeyPress()){
this.validationTask.delay(this.validationDelay)
}
},
onDisable:function(){
Ext.form.TextField.superclass.onDisable.call(this);
if(Ext.isIE){
this.el.dom.unselectable='on'
}
},
onEnable:function(){
Ext.form.TextField.superclass.onEnable.call(this);
if(Ext.isIE){
this.el.dom.unselectable=''
}
},
onKeyUpBuffered:function(e){
if(this.doAutoSize(e)){
this.autoSize()
}
},
doAutoSize:function(e){
return!e.isNavKeyPress()
},
onKeyUp:function(e){
this.fireEvent('keyup',this,e)
},
onKeyDown:function(e){
this.fireEvent('keydown',this,e)
},
onKeyPress:function(e){
this.fireEvent('keypress',this,e)
},
reset:function(){
Ext.form.TextField.superclass.reset.call(this);
this.applyEmptyText()
},
applyEmptyText:function(){
if(this.rendered&&this.emptyText&&this.getRawValue().length<1&&!this.hasFocus){
this.setRawValue(this.emptyText);
this.el.addClass(this.emptyClass)
}
},
preFocus:function(){
var el=this.el,isEmpty;
if(this.emptyText){
if(el.dom.value==this.emptyText){
this.setRawValue('');
isEmpty=true
}
el.removeClass(this.emptyClass)
}
if(this.selectOnFocus||isEmpty){
el.dom.select()
}
},
postBlur:function(){
this.applyEmptyText()
},
filterKeys:function(e){
if(e.ctrlKey){
return
}
var k=e.getKey();
if(Ext.isGecko&&(e.isNavKeyPress()||k==e.BACKSPACE||k==e.DELETE&&e.button==-1)){
return
}
var cc=String.fromCharCode(e.getCharCode());
if(!Ext.isGecko&&e.isSpecialKey()&&!cc){
return
}
if(!this.maskRe.test(cc)){
e.stopEvent()
}
},
setValue:function(v){
if(this.emptyText&&this.el&&!Ext.isEmpty(v)){
this.el.removeClass(this.emptyClass)
}
Ext.form.TextField.superclass.setValue.apply(this,arguments);
this.applyEmptyText();
this.autoSize();
return this
},
getErrors:function(value){
var errors=Ext.form.TextField.superclass.getErrors.apply(this,arguments);
value=Ext.isDefined(value)?value:this.processValue(this.getRawValue());
if(Ext.isFunction(this.validator)){
var msg=this.validator(value);
if(msg!==true){
errors.push(msg)
}
}
if(value.length<1||value===this.emptyText){
if(this.allowBlank){
return errors
}else{
errors.push(this.blankText)
}
}
if(!this.allowBlank&&(value.length<1||value===this.emptyText)){
errors.push(this.blankText)
}
if(value.length<this.minLength){
errors.push(String.format(this.minLengthText,this.minLength))
}
if(value.length>this.maxLength){
errors.push(String.format(this.maxLengthText,this.maxLength))
}
if(this.vtype){
var vt=Ext.form.VTypes;
if(!vt[this.vtype](value,this)){
errors.push(this.vtypeText||vt[this.vtype+'Text'])
}
}
if(this.regex&&!this.regex.test(value)){
errors.push(this.regexText)
}
return errors
},
selectText:function(start,end){
var v=this.getRawValue();
var doFocus=false;
if(v.length>0){
start=start===undefined?0:start;
end=end===undefined?v.length:end;
var d=this.el.dom;
if(d.setSelectionRange){
d.setSelectionRange(start,end)
}else if(d.createTextRange){
var range=d.createTextRange();
range.moveStart('character',start);
range.moveEnd('character',end-v.length);
range.select()
}
doFocus=Ext.isGecko||Ext.isOpera
}else{
doFocus=true
}
if(doFocus){
this.focus()
}
},
autoSize:function(){
if(!this.grow||!this.rendered){
return
}
if(!this.metrics){
this.metrics=Ext.util.TextMetrics.createInstance(this.el)
}
var el=this.el;
var v=el.dom.value;
var d=document.createElement('div');
d.appendChild(document.createTextNode(v));
v=d.innerHTML;
Ext.removeNode(d);
d=null;
v+='&#160;';
var w=Math.min(this.growMax,Math.max(this.metrics.getWidth(v)+10,this.growMin));
this.el.setWidth(w);
this.fireEvent('autosize',this,w)
},
onDestroy:function(){
if(this.validationTask){
this.validationTask.cancel();
this.validationTask=null
}
Ext.form.TextField.superclass.onDestroy.call(this)
}
});
Ext.reg('textfield',Ext.form.TextField);
Ext.form.TriggerField=Ext.extend(Ext.form.TextField,{
defaultAutoCreate:{
tag:'input',
type:'text',
size:'16',
autocomplete:'off'
},
hideTrigger:false,
editable:true,
readOnly:false,
wrapFocusClass:'x-trigger-wrap-focus',
autoSize:Ext.emptyFn,
monitorTab:true,
deferHeight:true,
mimicing:false,
actionMode:'wrap',
defaultTriggerWidth:17,
onResize:function(w,h){
Ext.form.TriggerField.superclass.onResize.call(this,w,h);
var tw=this.getTriggerWidth();
if(Ext.isNumber(w)){
this.el.setWidth(w-tw)
}
this.wrap.setWidth(this.el.getWidth()+tw)
},
getTriggerWidth:function(){
var tw=this.trigger.getWidth();
if(!this.hideTrigger&&!this.readOnly&&tw===0){
tw=this.defaultTriggerWidth
}
return tw
},
alignErrorIcon:function(){
if(this.wrap){
this.errorIcon.alignTo(this.wrap,'tl-tr',[
2,
0
])
}
},
onRender:function(ct,position){
this.doc=Ext.isIE?Ext.getBody():Ext.getDoc();
Ext.form.TriggerField.superclass.onRender.call(this,ct,position);
this.wrap=this.el.wrap({cls:'x-form-field-wrap x-form-field-trigger-wrap'});
this.trigger=this.wrap.createChild(this.triggerConfig||{
tag:'img',
src:Ext.BLANK_IMAGE_URL,
alt:'',
cls:'x-form-trigger '+this.triggerClass
});
this.initTrigger();
if(!this.width){
this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())
}
this.resizeEl=this.positionEl=this.wrap
},
getWidth:function(){
return this.el.getWidth()+this.trigger.getWidth()
},
updateEditState:function(){
if(this.rendered){
if(this.readOnly){
this.el.dom.readOnly=true;
this.el.addClass('x-trigger-noedit');
this.mun(this.el,'click',this.onTriggerClick,this);
this.trigger.setDisplayed(false)
}else{
if(!this.editable){
this.el.dom.readOnly=true;
this.el.addClass('x-trigger-noedit');
this.mon(this.el,'click',this.onTriggerClick,this)
}else{
this.el.dom.readOnly=false;
this.el.removeClass('x-trigger-noedit');
this.mun(this.el,'click',this.onTriggerClick,this)
}
this.trigger.setDisplayed(!this.hideTrigger)
}
this.onResize(this.width||this.wrap.getWidth())
}
},
setHideTrigger:function(hideTrigger){
if(hideTrigger!=this.hideTrigger){
this.hideTrigger=hideTrigger;
this.updateEditState()
}
},
setEditable:function(editable){
if(editable!=this.editable){
this.editable=editable;
this.updateEditState()
}
},
setReadOnly:function(readOnly){
if(readOnly!=this.readOnly){
this.readOnly=readOnly;
this.updateEditState()
}
},
afterRender:function(){
Ext.form.TriggerField.superclass.afterRender.call(this);
this.updateEditState()
},
initTrigger:function(){
this.mon(this.trigger,'click',this.onTriggerClick,this,{preventDefault:true});
this.trigger.addClassOnOver('x-form-trigger-over');
this.trigger.addClassOnClick('x-form-trigger-click')
},
onDestroy:function(){
Ext.destroy(this.trigger,this.wrap);
if(this.mimicing){
this.doc.un('mousedown',this.mimicBlur,this)
}
delete this.doc;
Ext.form.TriggerField.superclass.onDestroy.call(this)
},
onFocus:function(){
Ext.form.TriggerField.superclass.onFocus.call(this);
if(!this.mimicing){
this.wrap.addClass(this.wrapFocusClass);
this.mimicing=true;
this.doc.on('mousedown',this.mimicBlur,this,{delay:10});
if(this.monitorTab){
this.on('specialkey',this.checkTab,this)
}
}
},
checkTab:function(me,e){
if(e.getKey()==e.TAB){
this.triggerBlur()
}
},
onBlur:Ext.emptyFn,
mimicBlur:function(e){
if(!this.isDestroyed&&!this.wrap.contains(e.target)&&this.validateBlur(e)){
this.triggerBlur()
}
},
triggerBlur:function(){
this.mimicing=false;
this.doc.un('mousedown',this.mimicBlur,this);
if(this.monitorTab&&this.el){
this.un('specialkey',this.checkTab,this)
}
Ext.form.TriggerField.superclass.onBlur.call(this);
if(this.wrap){
this.wrap.removeClass(this.wrapFocusClass)
}
},
beforeBlur:Ext.emptyFn,
validateBlur:function(e){
return true
},
onTriggerClick:Ext.emptyFn
});
Ext.form.TwinTriggerField=Ext.extend(Ext.form.TriggerField,{
initComponent:function(){
Ext.form.TwinTriggerField.superclass.initComponent.call(this);
this.triggerConfig={
tag:'span',
cls:'x-form-twin-triggers',
cn:[
{
tag:'img',
src:Ext.BLANK_IMAGE_URL,
alt:'',
cls:'x-form-trigger '+this.trigger1Class
},
{
tag:'img',
src:Ext.BLANK_IMAGE_URL,
alt:'',
cls:'x-form-trigger '+this.trigger2Class
}
]
}
},
getTrigger:function(index){
return this.triggers[index]
},
afterRender:function(){
Ext.form.TwinTriggerField.superclass.afterRender.call(this);
var triggers=this.triggers,i=0,len=triggers.length;
for(;i<len;++i){
if(this['hideTrigger'+(i+1)]){
triggers[i].hide()
}
}
},
initTrigger:function(){
var ts=this.trigger.select('.x-form-trigger',true),triggerField=this;
ts.each(function(t,all,index){
var triggerIndex='Trigger'+(index+1);
t.hide=function(){
var w=triggerField.wrap.getWidth();
this.dom.style.display='none';
triggerField.el.setWidth(w-triggerField.trigger.getWidth());
triggerField['hidden'+triggerIndex]=true
};
t.show=function(){
var w=triggerField.wrap.getWidth();
this.dom.style.display='';
triggerField.el.setWidth(w-triggerField.trigger.getWidth());
triggerField['hidden'+triggerIndex]=false
};
this.mon(t,'click',this['on'+triggerIndex+'Click'],this,{preventDefault:true});
t.addClassOnOver('x-form-trigger-over');
t.addClassOnClick('x-form-trigger-click')
},this);
this.triggers=ts.elements
},
getTriggerWidth:function(){
var tw=0;
Ext.each(this.triggers,function(t,index){
var triggerIndex='Trigger'+(index+1),w=t.getWidth();
if(w===0&&!this['hidden'+triggerIndex]){
tw+=this.defaultTriggerWidth
}else{
tw+=w
}
},this);
return tw
},
onDestroy:function(){
Ext.destroy(this.triggers);
Ext.form.TwinTriggerField.superclass.onDestroy.call(this)
},
onTrigger1Click:Ext.emptyFn,
onTrigger2Click:Ext.emptyFn
});
Ext.reg('trigger',Ext.form.TriggerField);
Ext.form.TextArea=Ext.extend(Ext.form.TextField,{
growMin:60,
growMax:1000,
growAppend:'&#160;\n&#160;',
enterIsSpecial:false,
preventScrollbars:false,
onRender:function(ct,position){
if(!this.el){
this.defaultAutoCreate={
tag:'textarea',
style:'width:100px;height:60px;',
autocomplete:'off'
}
}
Ext.form.TextArea.superclass.onRender.call(this,ct,position);
if(this.grow){
this.textSizeEl=Ext.DomHelper.append(document.body,{
tag:'pre',
cls:'x-form-grow-sizer'
});
if(this.preventScrollbars){
this.el.setStyle('overflow','hidden')
}
this.el.setHeight(this.growMin)
}
},
onDestroy:function(){
Ext.removeNode(this.textSizeEl);
Ext.form.TextArea.superclass.onDestroy.call(this)
},
fireKey:function(e){
if(e.isSpecialKey()&&(this.enterIsSpecial||(e.getKey()!=e.ENTER||e.hasModifier()))){
this.fireEvent('specialkey',this,e)
}
},
doAutoSize:function(e){
return!e.isNavKeyPress()||e.getKey()==e.ENTER
},
filterValidation:function(e){
if(!e.isNavKeyPress()||!this.enterIsSpecial&&e.keyCode==e.ENTER){
this.validationTask.delay(this.validationDelay)
}
},
autoSize:function(){
if(!this.grow||!this.textSizeEl){
return
}
var el=this.el,v=Ext.util.Format.htmlEncode(el.dom.value),ts=this.textSizeEl,h;
Ext.fly(ts).setWidth(this.el.getWidth());
if(v.length<1){
v='&#160;&#160;'
}else{
v+=this.growAppend;
if(Ext.isIE){
v=v.replace(/\n/g,'&#160;<br />')
}
}
ts.innerHTML=v;
h=Math.min(this.growMax,Math.max(ts.offsetHeight,this.growMin));
if(h!=this.lastHeight){
this.lastHeight=h;
this.el.setHeight(h);
this.fireEvent('autosize',this,h)
}
}
});
Ext.reg('textarea',Ext.form.TextArea);
Ext.form.NumberField=Ext.extend(Ext.form.TextField,{
fieldClass:'x-form-field x-form-num-field',
allowDecimals:true,
decimalSeparator:'.',
decimalPrecision:2,
allowNegative:true,
minValue:Number.NEGATIVE_INFINITY,
maxValue:Number.MAX_VALUE,
minText:'The minimum value for this field is {0}',
maxText:'The maximum value for this field is {0}',
nanText:'{0} is not a valid number',
baseChars:'0123456789',
autoStripChars:false,
initEvents:function(){
var allowed=this.baseChars+'';
if(this.allowDecimals){
allowed+=this.decimalSeparator
}
if(this.allowNegative){
allowed+='-'
}
allowed=Ext.escapeRe(allowed);
this.maskRe=new RegExp('['+allowed+']');
if(this.autoStripChars){
this.stripCharsRe=new RegExp('[^'+allowed+']','gi')
}
Ext.form.NumberField.superclass.initEvents.call(this)
},
getErrors:function(value){
var errors=Ext.form.NumberField.superclass.getErrors.apply(this,arguments);
value=Ext.isDefined(value)?value:this.processValue(this.getRawValue());
if(value.length<1){
return errors
}
value=String(value).replace(this.decimalSeparator,'.');
if(isNaN(value)){
errors.push(String.format(this.nanText,value))
}
var num=this.parseValue(value);
if(num<this.minValue){
errors.push(String.format(this.minText,this.minValue))
}
if(num>this.maxValue){
errors.push(String.format(this.maxText,this.maxValue))
}
return errors
},
getValue:function(){
return this.fixPrecision(this.parseValue(Ext.form.NumberField.superclass.getValue.call(this)))
},
setValue:function(v){
v=Ext.isNumber(v)?v:parseFloat(String(v).replace(this.decimalSeparator,'.'));
v=this.fixPrecision(v);
v=isNaN(v)?'':String(v).replace('.',this.decimalSeparator);
return Ext.form.NumberField.superclass.setValue.call(this,v)
},
setMinValue:function(value){
this.minValue=Ext.num(value,Number.NEGATIVE_INFINITY)
},
setMaxValue:function(value){
this.maxValue=Ext.num(value,Number.MAX_VALUE)
},
parseValue:function(value){
if(value&&!this.allowDecimals){
value=parseInt(String(value))
}
value=parseFloat(String(value).replace(this.decimalSeparator,'.'));
return isNaN(value)?'':value
},
fixPrecision:function(value){
var nan=isNaN(value);
if(!this.allowDecimals||this.decimalPrecision==-1||nan||!value){
return nan?'':value
}
return parseFloat(parseFloat(value).toFixed(this.decimalPrecision))
},
beforeBlur:function(){
var v=this.parseValue(this.getRawValue());
if(!Ext.isEmpty(v)){
this.setValue(v)
}
}
});
Ext.reg('numberfield',Ext.form.NumberField);
Ext.form.DateField=Ext.extend(Ext.form.TriggerField,{
format:'m/d/Y',
altFormats:'m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d|n-j|n/j',
disabledDaysText:'Disabled',
disabledDatesText:'Disabled',
minText:'The date in this field must be equal to or after {0}',
maxText:'The date in this field must be equal to or before {0}',
invalidText:'{0} is not a valid date - it must be in the format {1}',
triggerClass:'x-form-date-trigger',
showToday:true,
startDay:0,
defaultAutoCreate:{
tag:'input',
type:'text',
size:'10',
autocomplete:'off'
},
initTime:'12',
initTimeFormat:'H',
safeParse:function(value,format){
if(Date.formatContainsHourInfo(format)){
return Date.parseDate(value,format)
}else{
var parsedDate=Date.parseDate(value+' '+this.initTime,format+' '+this.initTimeFormat);
if(parsedDate){
return parsedDate.clearTime()
}
}
},
initComponent:function(){
Ext.form.DateField.superclass.initComponent.call(this);
this.addEvents('select');
if(Ext.isString(this.minValue)){
this.minValue=this.parseDate(this.minValue)
}
if(Ext.isString(this.maxValue)){
this.maxValue=this.parseDate(this.maxValue)
}
this.disabledDatesRE=null;
this.initDisabledDays()
},
initEvents:function(){
Ext.form.DateField.superclass.initEvents.call(this);
this.keyNav=new Ext.KeyNav(this.el,{
'down':function(e){
this.onTriggerClick()
},
scope:this,
forceKeyDown:true
})
},
initDisabledDays:function(){
if(this.disabledDates){
var dd=this.disabledDates,len=dd.length-1,re='(?:';
Ext.each(dd,function(d,i){
re+=Ext.isDate(d)?'^'+Ext.escapeRe(d.dateFormat(this.format))+'$':dd[i];
if(i!=len){
re+='|'
}
},this);
this.disabledDatesRE=new RegExp(re+')')
}
},
setDisabledDates:function(dd){
this.disabledDates=dd;
this.initDisabledDays();
if(this.menu){
this.menu.picker.setDisabledDates(this.disabledDatesRE)
}
},
setDisabledDays:function(dd){
this.disabledDays=dd;
if(this.menu){
this.menu.picker.setDisabledDays(dd)
}
},
setMinValue:function(dt){
this.minValue=Ext.isString(dt)?this.parseDate(dt):dt;
if(this.menu){
this.menu.picker.setMinDate(this.minValue)
}
},
setMaxValue:function(dt){
this.maxValue=Ext.isString(dt)?this.parseDate(dt):dt;
if(this.menu){
this.menu.picker.setMaxDate(this.maxValue)
}
},
getErrors:function(value){
var errors=Ext.form.DateField.superclass.getErrors.apply(this,arguments);
value=this.formatDate(value||this.processValue(this.getRawValue()));
if(value.length<1){
return errors
}
var svalue=value;
value=this.parseDate(value);
if(!value){
errors.push(String.format(this.invalidText,svalue,this.format));
return errors
}
var time=value.getTime();
if(this.minValue&&time<this.minValue.clearTime().getTime()){
errors.push(String.format(this.minText,this.formatDate(this.minValue)))
}
if(this.maxValue&&time>this.maxValue.clearTime().getTime()){
errors.push(String.format(this.maxText,this.formatDate(this.maxValue)))
}
if(this.disabledDays){
var day=value.getDay();
for(var i=0;i<this.disabledDays.length;i++){
if(day===this.disabledDays[i]){
errors.push(this.disabledDaysText);
break
}
}
}
var fvalue=this.formatDate(value);
if(this.disabledDatesRE&&this.disabledDatesRE.test(fvalue)){
errors.push(String.format(this.disabledDatesText,fvalue))
}
return errors
},
validateBlur:function(){
return!this.menu||!this.menu.isVisible()
},
getValue:function(){
return this.parseDate(Ext.form.DateField.superclass.getValue.call(this))||''
},
setValue:function(date){
return Ext.form.DateField.superclass.setValue.call(this,this.formatDate(this.parseDate(date)))
},
parseDate:function(value){
if(!value||Ext.isDate(value)){
return value
}
var v=this.safeParse(value,this.format),af=this.altFormats,afa=this.altFormatsArray;
if(!v&&af){
afa=afa||af.split('|');
for(var i=0,len=afa.length;i<len&&!v;i++){
v=this.safeParse(value,afa[i])
}
}
return v
},
onDestroy:function(){
Ext.destroy(this.menu,this.keyNav);
Ext.form.DateField.superclass.onDestroy.call(this)
},
formatDate:function(date){
return Ext.isDate(date)?date.dateFormat(this.format):date
},
onTriggerClick:function(){
if(this.disabled){
return
}
if(this.menu==null){
this.menu=new Ext.menu.DateMenu({
hideOnClick:false,
focusOnSelect:false
})
}
this.onFocus();
Ext.apply(this.menu.picker,{
minDate:this.minValue,
maxDate:this.maxValue,
disabledDatesRE:this.disabledDatesRE,
disabledDatesText:this.disabledDatesText,
disabledDays:this.disabledDays,
disabledDaysText:this.disabledDaysText,
format:this.format,
showToday:this.showToday,
startDay:this.startDay,
minText:String.format(this.minText,this.formatDate(this.minValue)),
maxText:String.format(this.maxText,this.formatDate(this.maxValue))
});
this.menu.picker.setValue(this.getValue()||new Date);
this.menu.show(this.el,'tl-bl?');
this.menuEvents('on')
},
menuEvents:function(method){
this.menu[method]('select',this.onSelect,this);
this.menu[method]('hide',this.onMenuHide,this);
this.menu[method]('show',this.onFocus,this)
},
onSelect:function(m,d){
this.setValue(d);
this.fireEvent('select',this,d);
this.menu.hide()
},
onMenuHide:function(){
this.focus(false,60);
this.menuEvents('un')
},
beforeBlur:function(){
var v=this.parseDate(this.getRawValue());
if(v){
this.setValue(v)
}
}
});
Ext.reg('datefield',Ext.form.DateField);
Ext.form.DisplayField=Ext.extend(Ext.form.Field,{
validationEvent:false,
validateOnBlur:false,
defaultAutoCreate:{tag:'div'},
fieldClass:'x-form-display-field',
htmlEncode:false,
initEvents:Ext.emptyFn,
isValid:function(){
return true
},
validate:function(){
return true
},
getRawValue:function(){
var v=this.rendered?this.el.dom.innerHTML:Ext.value(this.value,'');
if(v===this.emptyText){
v=''
}
if(this.htmlEncode){
v=Ext.util.Format.htmlDecode(v)
}
return v
},
getValue:function(){
return this.getRawValue()
},
getName:function(){
return this.name
},
setRawValue:function(v){
if(this.htmlEncode){
v=Ext.util.Format.htmlEncode(v)
}
return this.rendered?this.el.dom.innerHTML=Ext.isEmpty(v)?'':v:this.value=v
},
setValue:function(v){
this.setRawValue(v);
return this
}
});
Ext.reg('displayfield',Ext.form.DisplayField);
Ext.form.ComboBox=Ext.extend(Ext.form.TriggerField,{
defaultAutoCreate:{
tag:'input',
type:'text',
size:'24',
autocomplete:'off'
},
listWidth:'auto',
listClass:'',
selectedClass:'x-combo-selected',
listEmptyText:'',
triggerClass:'x-form-arrow-trigger',
shadow:'sides',
listAlign:'tl-bl?',
maxHeight:300,
minHeight:22,
triggerAction:'query',
minChars:4,
autoSelect:true,
typeAhead:false,
queryDelay:500,
pageSize:0,
selectOnFocus:false,
queryParam:'query',
loadingText:'Loading...',
resizable:false,
handleHeight:8,
allQuery:'',
mode:'remote',
minListWidth:70,
forceSelection:false,
typeAheadDelay:250,
lazyInit:true,
clearFilterOnReset:true,
submitValue:undefined,
initComponent:function(){
Ext.form.ComboBox.superclass.initComponent.call(this);
this.addEvents('expand','collapse','beforeselect','select','beforequery');
if(this.transform){
var s=Ext.getDom(this.transform);
if(!this.hiddenName){
this.hiddenName=s.name
}
if(!this.store){
this.mode='local';
var d=[],opts=s.options;
for(var i=0,len=opts.length;i<len;i++){
var o=opts[i],value=(o.hasAttribute?o.hasAttribute('value'):o.getAttributeNode('value').specified)?o.value:o.text;
if(o.selected&&Ext.isEmpty(this.value,true)){
this.value=value
}
d.push([
value,
o.text
])
}
this.store=new Ext.data.ArrayStore({
idIndex:0,
fields:[
'value',
'text'
],
data:d,
autoDestroy:true
});
this.valueField='value';
this.displayField='text'
}
s.name=Ext.id();
if(!this.lazyRender){
this.target=true;
this.el=Ext.DomHelper.insertBefore(s,this.autoCreate||this.defaultAutoCreate);
this.render(this.el.parentNode,s)
}
Ext.removeNode(s)
}else if(this.store){
this.store=Ext.StoreMgr.lookup(this.store);
if(this.store.autoCreated){
this.displayField=this.valueField='field1';
if(!this.store.expandData){
this.displayField='field2'
}
this.mode='local'
}
}
this.selectedIndex=-1;
if(this.mode=='local'){
if(!Ext.isDefined(this.initialConfig.queryDelay)){
this.queryDelay=10
}
if(!Ext.isDefined(this.initialConfig.minChars)){
this.minChars=0
}
}
},
onRender:function(ct,position){
if(this.hiddenName&&!Ext.isDefined(this.submitValue)){
this.submitValue=false
}
Ext.form.ComboBox.superclass.onRender.call(this,ct,position);
if(this.hiddenName){
this.hiddenField=this.el.insertSibling({
tag:'input',
type:'hidden',
name:this.hiddenName,
id:this.hiddenId||Ext.id()
},'before',true)
}
if(Ext.isGecko){
this.el.dom.setAttribute('autocomplete','off')
}
if(!this.lazyInit){
this.initList()
}else{
this.on('focus',this.initList,this,{single:true})
}
},
initValue:function(){
Ext.form.ComboBox.superclass.initValue.call(this);
if(this.hiddenField){
this.hiddenField.value=Ext.value(Ext.isDefined(this.hiddenValue)?this.hiddenValue:this.value,'')
}
},
getParentZIndex:function(){
var zindex;
if(this.ownerCt){
this.findParentBy(function(ct){
zindex=parseInt(ct.getPositionEl().getStyle('z-index'),10);
return!!zindex
})
}
return zindex
},
getZIndex:function(listParent){
listParent=listParent||Ext.getDom(this.getListParent()||Ext.getBody());
var zindex=parseInt(Ext.fly(listParent).getStyle('z-index'),10);
if(!zindex){
zindex=this.getParentZIndex()
}
return(zindex||12000)+5
},
initList:function(){
if(!this.list){
var cls='x-combo-list',listParent=Ext.getDom(this.getListParent()||Ext.getBody());
this.list=new Ext.Layer({
parentEl:listParent,
shadow:this.shadow,
cls:[
cls,
this.listClass
].join(' '),
constrain:false,
zindex:this.getZIndex(listParent)
});
var lw=this.listWidth,minListWidth=Math.max(this.wrap.getWidth(),this.minListWidth);
this.list.setSize(lw,'auto');
this.list.setStyle('min-width',this.list.addUnits(minListWidth));
this.list.swallowEvent('mousewheel');
this.assetHeight=0;
if(this.syncFont!==false){
this.list.setStyle('font-size',this.el.getStyle('font-size'))
}
if(this.title){
this.header=this.list.createChild({
cls:cls+'-hd',
html:this.title
});
this.assetHeight+=this.header.getHeight()
}
this.innerList=this.list.createChild({cls:cls+'-inner'});
this.mon(this.innerList,'mouseover',this.onViewOver,this);
this.mon(this.innerList,'mousemove',this.onViewMove,this);
if(lw!=='auto'){
this.list.addClass('x-combo-list-overflowable');
this.innerList.setWidth(lw-this.list.getFrameWidth('lr'))
}
if(this.pageSize){
this.footer=this.list.createChild({cls:cls+'-ft'});
this.pageTb=new Ext.PagingToolbar({
store:this.store,
pageSize:this.pageSize,
renderTo:this.footer
});
this.assetHeight+=this.footer.getHeight()
}
if(!this.tpl){
this.tpl='<tpl for="."><div class="'+cls+'-item">{'+this.displayField+'}</div></tpl>'
}
this.view=new Ext.DataView({
applyTo:this.innerList,
tpl:this.tpl,
singleSelect:true,
selectedClass:this.selectedClass,
itemSelector:this.itemSelector||'.'+cls+'-item',
emptyText:this.listEmptyText,
deferEmptyText:false
});
this.mon(this.view,{
containerclick:this.onViewClick,
click:this.onViewClick,
scope:this
});
this.bindStore(this.store,true);
if(this.resizable){
this.resizer=new Ext.Resizable(this.list,{
pinned:true,
handles:'se'
});
this.mon(this.resizer,'resize',function(r,w,h){
this.maxHeight=h-this.handleHeight-this.list.getFrameWidth('tb')-this.assetHeight;
this.listWidth=w;
this.innerList.setWidth(w-this.list.getFrameWidth('lr'));
this.restrictHeight()
},this);
this[this.pageSize?'footer':'innerList'].setStyle('margin-bottom',this.handleHeight+'px')
}
}
},
getListParent:function(){
return document.body
},
getStore:function(){
return this.store
},
bindStore:function(store,initial){
if(this.store&&!initial){
if(this.store!==store&&this.store.autoDestroy){
this.store.destroy()
}else{
this.store.un('beforeload',this.onBeforeLoad,this);
this.store.un('load',this.onLoad,this);
this.store.un('exception',this.collapse,this)
}
if(!store){
this.store=null;
if(this.view){
this.view.bindStore(null)
}
if(this.pageTb){
this.pageTb.bindStore(null)
}
}
}
if(store){
if(!initial){
this.lastQuery=null;
if(this.pageTb){
this.pageTb.bindStore(store)
}
}
this.store=Ext.StoreMgr.lookup(store);
this.store.on({
scope:this,
beforeload:this.onBeforeLoad,
load:this.onLoad,
exception:this.collapse
});
if(this.view){
this.view.bindStore(store)
}
}
},
reset:function(){
if(this.clearFilterOnReset&&this.mode=='local'){
this.store.clearFilter()
}
Ext.form.ComboBox.superclass.reset.call(this)
},
initEvents:function(){
Ext.form.ComboBox.superclass.initEvents.call(this);
this.keyNav=new Ext.KeyNav(this.el,{
'up':function(e){
this.inKeyMode=true;
this.selectPrev()
},
'down':function(e){
if(!this.isExpanded()){
this.onTriggerClick()
}else{
this.inKeyMode=true;
this.selectNext()
}
},
'enter':function(e){
this.onViewClick()
},
'esc':function(e){
this.collapse()
},
'tab':function(e){
if(this.forceSelection===true){
this.collapse()
}else{
this.onViewClick(false)
}
return true
},
scope:this,
doRelay:function(e,h,hname){
if(hname=='down'||this.scope.isExpanded()){
var relay=Ext.KeyNav.prototype.doRelay.apply(this,arguments);
if(!Ext.isIE&&Ext.EventManager.useKeydown){
this.scope.fireKey(e)
}
return relay
}
return true
},
forceKeyDown:true,
defaultEventAction:'stopEvent'
});
this.queryDelay=Math.max(this.queryDelay||10,this.mode=='local'?10:250);
this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);
if(this.typeAhead){
this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)
}
if(!this.enableKeyEvents){
this.mon(this.el,'keyup',this.onKeyUp,this)
}
},
onDestroy:function(){
if(this.dqTask){
this.dqTask.cancel();
this.dqTask=null
}
this.bindStore(null);
Ext.destroy(this.resizer,this.view,this.pageTb,this.list);
Ext.destroyMembers(this,'hiddenField');
Ext.form.ComboBox.superclass.onDestroy.call(this)
},
fireKey:function(e){
if(!this.isExpanded()){
Ext.form.ComboBox.superclass.fireKey.call(this,e)
}
},
onResize:function(w,h){
Ext.form.ComboBox.superclass.onResize.apply(this,arguments);
if(!isNaN(w)&&this.isVisible()&&this.list){
this.doResize(w)
}else{
this.bufferSize=w
}
},
doResize:function(w){
if(!Ext.isDefined(this.listWidth)){
var lw=Math.max(w,this.minListWidth);
this.list.setWidth(lw);
this.innerList.setWidth(lw-this.list.getFrameWidth('lr'))
}
},
onEnable:function(){
Ext.form.ComboBox.superclass.onEnable.apply(this,arguments);
if(this.hiddenField){
this.hiddenField.disabled=false
}
},
onDisable:function(){
Ext.form.ComboBox.superclass.onDisable.apply(this,arguments);
if(this.hiddenField){
this.hiddenField.disabled=true
}
},
onBeforeLoad:function(){
if(!this.hasFocus){
return
}
this.innerList.update(this.loadingText?'<div class="loading-indicator">'+this.loadingText+'</div>':'');
this.restrictHeight();
this.selectedIndex=-1
},
onLoad:function(){
if(!this.hasFocus){
return
}
if(this.store.getCount()>0||this.listEmptyText){
this.expand();
this.restrictHeight();
if(this.lastQuery==this.allQuery){
if(this.editable){
this.el.dom.select()
}
if(this.autoSelect!==false&&!this.selectByValue(this.value,true)){
this.select(0,true)
}
}else{
if(this.autoSelect!==false){
this.selectNext()
}
if(this.typeAhead&&this.lastKey!=Ext.EventObject.BACKSPACE&&this.lastKey!=Ext.EventObject.DELETE){
this.taTask.delay(this.typeAheadDelay)
}
}
}else{
this.collapse()
}
},
onTypeAhead:function(){
if(this.store.getCount()>0){
var r=this.store.getAt(0);
var newValue=r.data[this.displayField];
var len=newValue.length;
var selStart=this.getRawValue().length;
if(selStart!=len){
this.setRawValue(newValue);
this.selectText(selStart,newValue.length)
}
}
},
assertValue:function(){
var val=this.getRawValue(),rec;
if(this.valueField&&Ext.isDefined(this.value)){
rec=this.findRecord(this.valueField,this.value)
}
if(!rec||rec.get(this.displayField)!=val){
rec=this.findRecord(this.displayField,val)
}
if(!rec&&this.forceSelection){
if(val.length>0&&val!=this.emptyText){
this.el.dom.value=Ext.value(this.lastSelectionText,'');
this.applyEmptyText()
}else{
this.clearValue()
}
}else{
if(rec&&this.valueField){
if(this.value==val){
return
}
val=rec.get(this.valueField||this.displayField)
}
this.setValue(val)
}
},
onSelect:function(record,index){
if(this.fireEvent('beforeselect',this,record,index)!==false){
this.setValue(record.data[this.valueField||this.displayField]);
this.collapse();
this.fireEvent('select',this,record,index)
}
},
getName:function(){
var hf=this.hiddenField;
return hf&&hf.name?hf.name:this.hiddenName||Ext.form.ComboBox.superclass.getName.call(this)
},
getValue:function(){
if(this.valueField){
return Ext.isDefined(this.value)?this.value:''
}else{
return Ext.form.ComboBox.superclass.getValue.call(this)
}
},
clearValue:function(){
if(this.hiddenField){
this.hiddenField.value=''
}
this.setRawValue('');
this.lastSelectionText='';
this.applyEmptyText();
this.value=''
},
setValue:function(v){
var text=v;
if(this.valueField){
var r=this.findRecord(this.valueField,v);
if(r){
text=r.data[this.displayField]
}else if(Ext.isDefined(this.valueNotFoundText)){
text=this.valueNotFoundText
}
}
this.lastSelectionText=text;
if(this.hiddenField){
this.hiddenField.value=Ext.value(v,'')
}
Ext.form.ComboBox.superclass.setValue.call(this,text);
this.value=v;
return this
},
findRecord:function(prop,value){
var record;
if(this.store.getCount()>0){
this.store.each(function(r){
if(r.data[prop]==value){
record=r;
return false
}
})
}
return record
},
onViewMove:function(e,t){
this.inKeyMode=false
},
onViewOver:function(e,t){
if(this.inKeyMode){
return
}
var item=this.view.findItemFromChild(t);
if(item){
var index=this.view.indexOf(item);
this.select(index,false)
}
},
onViewClick:function(doFocus){
var index=this.view.getSelectedIndexes()[0],s=this.store,r=s.getAt(index);
if(r){
this.onSelect(r,index)
}else{
this.collapse()
}
if(doFocus!==false){
this.el.focus()
}
},
restrictHeight:function(){
this.innerList.dom.style.height='';
var inner=this.innerList.dom;
if(Ext.isNumber(this.maxHeight)){
this.innerList.setStyle('max-height',this.innerList.addUnits(this.maxHeight))
}
if(Ext.isNumber(this.minHeight)){
this.innerList.setStyle('min-height',this.innerList.addUnits(this.minHeight))
}
this.list.beginUpdate();
this.list.alignTo.apply(this.list,[this.el].concat(this.listAlign));
this.list.endUpdate()
},
isExpanded:function(){
return this.list&&this.list.isVisible()
},
selectByValue:function(v,scrollIntoView){
if(!Ext.isEmpty(v,true)){
var r=this.findRecord(this.valueField||this.displayField,v);
if(r){
this.select(this.store.indexOf(r),scrollIntoView);
return true
}
}
return false
},
select:function(index,scrollIntoView){
this.selectedIndex=index;
this.view.select(index);
if(scrollIntoView!==false){
var el=this.view.getNode(index);
if(el){
this.innerList.scrollChildIntoView(el,false)
}
}
},
selectNext:function(){
var ct=this.store.getCount();
if(ct>0){
if(this.selectedIndex==-1){
this.select(0)
}else if(this.selectedIndex<ct-1){
this.select(this.selectedIndex+1)
}
}
},
selectPrev:function(){
var ct=this.store.getCount();
if(ct>0){
if(this.selectedIndex==-1){
this.select(0)
}else if(this.selectedIndex!==0){
this.select(this.selectedIndex-1)
}
}
},
onKeyUp:function(e){
var k=e.getKey();
if(this.editable!==false&&this.readOnly!==true&&(k==e.BACKSPACE||!e.isSpecialKey())){
this.lastKey=k;
this.dqTask.delay(this.queryDelay)
}
Ext.form.ComboBox.superclass.onKeyUp.call(this,e)
},
validateBlur:function(){
return!this.list||!this.list.isVisible()
},
initQuery:function(){
this.doQuery(this.getRawValue())
},
beforeBlur:function(){
this.assertValue()
},
postBlur:function(){
Ext.form.ComboBox.superclass.postBlur.call(this);
this.collapse();
this.inKeyMode=false
},
doQuery:function(q,forceAll){
q=Ext.isEmpty(q)?'':q;
var qe={
query:q,
forceAll:forceAll,
combo:this,
cancel:false
};
if(this.fireEvent('beforequery',qe)===false||qe.cancel){
return false
}
q=qe.query;
forceAll=qe.forceAll;
if(forceAll===true||q.length>=this.minChars){
if(this.lastQuery!==q){
this.lastQuery=q;
if(this.mode=='local'){
this.selectedIndex=-1;
if(forceAll){
this.store.clearFilter()
}else{
this.store.filter(this.displayField,q)
}
this.onLoad()
}else{
this.store.baseParams[this.queryParam]=q;
this.store.load({params:this.getParams(q)});
this.expand()
}
}else{
this.selectedIndex=-1;
this.onLoad()
}
}
},
getParams:function(q){
var params={},paramNames=this.store.paramNames;
if(this.pageSize){
params[paramNames.start]=0;
params[paramNames.limit]=this.pageSize
}
return params
},
collapse:function(){
if(!this.isExpanded()){
return
}
this.list.hide();
Ext.getDoc().un('mousewheel',this.collapseIf,this);
Ext.getDoc().un('mousedown',this.collapseIf,this);
this.fireEvent('collapse',this)
},
collapseIf:function(e){
if(!this.isDestroyed&&!e.within(this.wrap)&&!e.within(this.list)){
this.collapse()
}
},
expand:function(){
if(this.isExpanded()||!this.hasFocus){
return
}
if(this.title||this.pageSize){
this.assetHeight=0;
if(this.title){
this.assetHeight+=this.header.getHeight()
}
if(this.pageSize){
this.assetHeight+=this.footer.getHeight()
}
}
if(this.bufferSize){
this.doResize(this.bufferSize);
delete this.bufferSize
}
this.list.alignTo.apply(this.list,[this.el].concat(this.listAlign));
this.list.setZIndex(this.getZIndex());
this.list.show();
if(Ext.isGecko2){
this.innerList.setOverflow('auto')
}
this.mon(Ext.getDoc(),{
scope:this,
mousewheel:this.collapseIf,
mousedown:this.collapseIf
});
this.fireEvent('expand',this)
},
onTriggerClick:function(){
if(this.readOnly||this.disabled){
return
}
if(this.isExpanded()){
this.collapse();
this.el.focus()
}else{
this.onFocus({});
if(this.triggerAction=='all'){
this.doQuery(this.allQuery,true)
}else{
this.doQuery(this.getRawValue())
}
this.el.focus()
}
}
});
Ext.reg('combo',Ext.form.ComboBox);
Ext.form.Checkbox=Ext.extend(Ext.form.Field,{
focusClass:undefined,
fieldClass:'x-form-field',
checked:false,
boxLabel:'&#160;',
defaultAutoCreate:{
tag:'input',
type:'checkbox',
autocomplete:'off'
},
actionMode:'wrap',
initComponent:function(){
Ext.form.Checkbox.superclass.initComponent.call(this);
this.addEvents('check')
},
onResize:function(){
Ext.form.Checkbox.superclass.onResize.apply(this,arguments);
if(!this.boxLabel&&!this.fieldLabel){
this.el.alignTo(this.wrap,'c-c')
}
},
initEvents:function(){
Ext.form.Checkbox.superclass.initEvents.call(this);
this.mon(this.el,{
scope:this,
click:this.onClick,
change:this.onClick
})
},
markInvalid:Ext.emptyFn,
clearInvalid:Ext.emptyFn,
onRender:function(ct,position){
Ext.form.Checkbox.superclass.onRender.call(this,ct,position);
if(this.inputValue!==undefined){
this.el.dom.value=this.inputValue
}
this.wrap=this.el.wrap({cls:'x-form-check-wrap'});
if(this.boxLabel){
this.wrap.createChild({
tag:'label',
htmlFor:this.el.id,
cls:'x-form-cb-label',
html:this.boxLabel
})
}
if(this.checked){
this.setValue(true)
}else{
this.checked=this.el.dom.checked
}
if(Ext.isIE&&!Ext.isStrict){
this.wrap.repaint()
}
this.resizeEl=this.positionEl=this.wrap
},
onDestroy:function(){
Ext.destroy(this.wrap);
Ext.form.Checkbox.superclass.onDestroy.call(this)
},
initValue:function(){
this.originalValue=this.getValue()
},
getValue:function(){
if(this.rendered){
return this.el.dom.checked
}
return this.checked
},
onClick:function(){
if(this.el.dom.checked!=this.checked){
this.setValue(this.el.dom.checked)
}
},
setValue:function(v){
var checked=this.checked,inputVal=this.inputValue;
if(v===false){
this.checked=false
}else{
this.checked=v===true||v==='true'||v=='1'||(inputVal?v==inputVal:String(v).toLowerCase()=='on')
}
if(this.rendered){
this.el.dom.checked=this.checked;
this.el.dom.defaultChecked=this.checked
}
if(checked!=this.checked){
this.fireEvent('check',this,this.checked);
if(this.handler){
this.handler.call(this.scope||this,this,this.checked)
}
}
return this
}
});
Ext.reg('checkbox',Ext.form.Checkbox);
Ext.form.CheckboxGroup=Ext.extend(Ext.form.Field,{
columns:'auto',
vertical:false,
allowBlank:true,
blankText:'You must select at least one item in this group',
defaultType:'checkbox',
groupCls:'x-form-check-group',
initComponent:function(){
this.addEvents('change');
this.on('change',this.validate,this);
Ext.form.CheckboxGroup.superclass.initComponent.call(this)
},
onRender:function(ct,position){
if(!this.el){
var panelCfg={
autoEl:{id:this.id},
cls:this.groupCls,
layout:'column',
renderTo:ct,
bufferResize:false
};
var colCfg={
xtype:'container',
defaultType:this.defaultType,
layout:'form',
defaults:{
hideLabel:true,
anchor:'100%'
}
};
if(this.items[0].items){
Ext.apply(panelCfg,{
layoutConfig:{columns:this.items.length},
defaults:this.defaults,
items:this.items
});
for(var i=0,len=this.items.length;i<len;i++){
Ext.applyIf(this.items[i],colCfg)
}
}else{
var numCols,cols=[];
if(typeof this.columns=='string'){
this.columns=this.items.length
}
if(!Ext.isArray(this.columns)){
var cs=[];
for(var i=0;i<this.columns;i++){
cs.push(100/this.columns*0.01)
}
this.columns=cs
}
numCols=this.columns.length;
for(var i=0;i<numCols;i++){
var cc=Ext.apply({items:[]},colCfg);
cc[this.columns[i]<=1?'columnWidth':'width']=this.columns[i];
if(this.defaults){
cc.defaults=Ext.apply(cc.defaults||{},this.defaults)
}
cols.push(cc)
}
;
if(this.vertical){
var rows=Math.ceil(this.items.length/numCols),ri=0;
for(var i=0,len=this.items.length;i<len;i++){
if(i>0&&i%rows==0){
ri++
}
if(this.items[i].fieldLabel){
this.items[i].hideLabel=false
}
cols[ri].items.push(this.items[i])
}
;
}else{
for(var i=0,len=this.items.length;i<len;i++){
var ci=i%numCols;
if(this.items[i].fieldLabel){
this.items[i].hideLabel=false
}
cols[ci].items.push(this.items[i])
}
;
}
Ext.apply(panelCfg,{
layoutConfig:{columns:numCols},
items:cols
})
}
this.panel=new Ext.Container(panelCfg);
this.panel.ownerCt=this;
this.el=this.panel.getEl();
if(this.forId&&this.itemCls){
var l=this.el.up(this.itemCls).child('label',true);
if(l){
l.setAttribute('htmlFor',this.forId)
}
}
var fields=this.panel.findBy(function(c){
return c.isFormField
},this);
this.items=new Ext.util.MixedCollection;
this.items.addAll(fields)
}
Ext.form.CheckboxGroup.superclass.onRender.call(this,ct,position)
},
initValue:function(){
if(this.value){
this.setValue.apply(this,this.buffered?this.value:[this.value]);
delete this.buffered;
delete this.value
}
},
afterRender:function(){
Ext.form.CheckboxGroup.superclass.afterRender.call(this);
this.eachItem(function(item){
item.on('check',this.fireChecked,this);
item.inGroup=true
})
},
doLayout:function(){
if(this.rendered){
this.panel.forceLayout=this.ownerCt.forceLayout;
this.panel.doLayout()
}
},
fireChecked:function(){
var arr=[];
this.eachItem(function(item){
if(item.checked){
arr.push(item)
}
});
this.fireEvent('change',this,arr)
},
getErrors:function(){
var errors=Ext.form.CheckboxGroup.superclass.getErrors.apply(this,arguments);
if(!this.allowBlank){
var blank=true;
this.eachItem(function(f){
if(f.checked){
return blank=false
}
});
if(blank)
errors.push(this.blankText)
}
return errors
},
isDirty:function(){
if(this.disabled||!this.rendered){
return false
}
var dirty=false;
this.eachItem(function(item){
if(item.isDirty()){
dirty=true;
return false
}
});
return dirty
},
setReadOnly:function(readOnly){
if(this.rendered){
this.eachItem(function(item){
item.setReadOnly(readOnly)
})
}
this.readOnly=readOnly
},
onDisable:function(){
this.eachItem(function(item){
item.disable()
})
},
onEnable:function(){
this.eachItem(function(item){
item.enable()
})
},
onResize:function(w,h){
this.panel.setSize(w,h);
this.panel.doLayout()
},
reset:function(){
if(this.originalValue){
this.eachItem(function(c){
if(c.setValue){
c.setValue(false);
c.originalValue=c.getValue()
}
});
this.resetOriginal=true;
this.setValue(this.originalValue);
delete this.resetOriginal
}else{
this.eachItem(function(c){
if(c.reset){
c.reset()
}
})
}
(function(){
this.clearInvalid()
}.defer(50,this))
},
setValue:function(){
if(this.rendered){
this.onSetValue.apply(this,arguments)
}else{
this.buffered=true;
this.value=arguments
}
return this
},
onSetValue:function(id,value){
if(arguments.length==1){
if(Ext.isArray(id)){
Ext.each(id,function(val,idx){
if(Ext.isObject(val)&&val.setValue){
val.setValue(true);
if(this.resetOriginal===true){
val.originalValue=val.getValue()
}
}else{
var item=this.items.itemAt(idx);
if(item){
item.setValue(val)
}
}
},this)
}else if(Ext.isObject(id)){
for(var i in id){
var f=this.getBox(i);
if(f){
f.setValue(id[i])
}
}
}else{
this.setValueForItem(id)
}
}else{
var f=this.getBox(id);
if(f){
f.setValue(value)
}
}
},
beforeDestroy:function(){
Ext.destroy(this.panel);
if(!this.rendered){
Ext.destroy(this.items)
}
Ext.form.CheckboxGroup.superclass.beforeDestroy.call(this)
},
setValueForItem:function(val){
val=String(val).split(',');
this.eachItem(function(item){
if(val.indexOf(item.inputValue)>-1){
item.setValue(true)
}
})
},
getBox:function(id){
var box=null;
this.eachItem(function(f){
if(id==f||f.dataIndex==id||f.id==id||f.getName()==id){
box=f;
return false
}
});
return box
},
getValue:function(){
var out=[];
this.eachItem(function(item){
if(item.checked){
out.push(item)
}
});
return out
},
eachItem:function(fn,scope){
if(this.items&&this.items.each){
this.items.each(fn,scope||this)
}
},
getRawValue:Ext.emptyFn,
setRawValue:Ext.emptyFn
});
Ext.reg('checkboxgroup',Ext.form.CheckboxGroup);
Ext.form.CompositeField=Ext.extend(Ext.form.Field,{
defaultMargins:'0 5 0 0',
skipLastItemMargin:true,
isComposite:true,
combineErrors:true,
labelConnector:', ',
initComponent:function(){
var labels=[],items=this.items,item;
for(var i=0,j=items.length;i<j;i++){
item=items[i];
if(!Ext.isEmpty(item.ref)){
item.ref='../'+item.ref
}
labels.push(item.fieldLabel);
Ext.applyIf(item,this.defaults);
if(!(i==j-1&&this.skipLastItemMargin)){
Ext.applyIf(item,{margins:this.defaultMargins})
}
}
this.fieldLabel=this.fieldLabel||this.buildLabel(labels);
this.fieldErrors=new Ext.util.MixedCollection(true,function(item){
return item.field
});
this.fieldErrors.on({
scope:this,
add:this.updateInvalidMark,
remove:this.updateInvalidMark,
replace:this.updateInvalidMark
});
Ext.form.CompositeField.superclass.initComponent.apply(this,arguments);
this.innerCt=new Ext.Container({
layout:'hbox',
items:this.items,
cls:'x-form-composite',
defaultMargins:'0 3 0 0',
ownerCt:this
});
this.innerCt.ownerCt=undefined;
var fields=this.innerCt.findBy(function(c){
return c.isFormField
},this);
this.items=new Ext.util.MixedCollection;
this.items.addAll(fields)
},
onRender:function(ct,position){
if(!this.el){
var innerCt=this.innerCt;
innerCt.render(ct);
this.el=innerCt.getEl();
if(this.combineErrors){
this.eachItem(function(field){
Ext.apply(field,{
markInvalid:this.onFieldMarkInvalid.createDelegate(this,[field],0),
clearInvalid:this.onFieldClearInvalid.createDelegate(this,[field],0)
})
})
}
var l=this.el.parent().parent().child('label',true);
if(l){
l.setAttribute('for',this.items.items[0].id)
}
}
Ext.form.CompositeField.superclass.onRender.apply(this,arguments)
},
onFieldMarkInvalid:function(field,message){
var name=field.getName(),error={
field:name,
errorName:field.fieldLabel||name,
error:message
};
this.fieldErrors.replace(name,error);
if(!field.preventMark){
field.el.addClass(field.invalidClass)
}
},
onFieldClearInvalid:function(field){
this.fieldErrors.removeKey(field.getName());
field.el.removeClass(field.invalidClass)
},
updateInvalidMark:function(){
var ieStrict=Ext.isIE6&&Ext.isStrict;
if(this.fieldErrors.length==0){
this.clearInvalid();
if(ieStrict){
this.clearInvalid.defer(50,this)
}
}else{
var message=this.buildCombinedErrorMessage(this.fieldErrors.items);
this.sortErrors();
this.markInvalid(message);
if(ieStrict){
this.markInvalid(message)
}
}
},
validateValue:function(value,preventMark){
var valid=true;
this.eachItem(function(field){
if(!field.isValid(preventMark)){
valid=false
}
});
return valid
},
buildCombinedErrorMessage:function(errors){
var combined=[],error;
for(var i=0,j=errors.length;i<j;i++){
error=errors[i];
combined.push(String.format('{0}: {1}',error.errorName,error.error))
}
return combined.join('<br />')
},
sortErrors:function(){
var fields=this.items;
this.fieldErrors.sort('ASC',function(a,b){
var findByName=function(key){
return function(field){
return field.getName()==key
}
};
var aIndex=fields.findIndexBy(findByName(a.field)),bIndex=fields.findIndexBy(findByName(b.field));
return aIndex<bIndex?-1:1
})
},
reset:function(){
this.eachItem(function(item){
item.reset()
});
(function(){
this.clearInvalid()
}.defer(50,this))
},
clearInvalidChildren:function(){
this.eachItem(function(item){
item.clearInvalid()
})
},
buildLabel:function(segments){
return Ext.clean(segments).join(this.labelConnector)
},
isDirty:function(){
if(this.disabled||!this.rendered){
return false
}
var dirty=false;
this.eachItem(function(item){
if(item.isDirty()){
dirty=true;
return false
}
});
return dirty
},
eachItem:function(fn,scope){
if(this.items&&this.items.each){
this.items.each(fn,scope||this)
}
},
onResize:function(adjWidth,adjHeight,rawWidth,rawHeight){
var innerCt=this.innerCt;
if(this.rendered&&innerCt.rendered){
innerCt.setSize(adjWidth,adjHeight)
}
Ext.form.CompositeField.superclass.onResize.apply(this,arguments)
},
doLayout:function(shallow,force){
if(this.rendered){
var innerCt=this.innerCt;
innerCt.forceLayout=this.ownerCt.forceLayout;
innerCt.doLayout(shallow,force)
}
},
beforeDestroy:function(){
Ext.destroy(this.innerCt);
Ext.form.CompositeField.superclass.beforeDestroy.call(this)
},
setReadOnly:function(readOnly){
if(readOnly==undefined){
readOnly=true
}
readOnly=!!readOnly;
if(this.rendered){
this.eachItem(function(item){
item.setReadOnly(readOnly)
})
}
this.readOnly=readOnly
},
onShow:function(){
Ext.form.CompositeField.superclass.onShow.call(this);
this.doLayout()
},
onDisable:function(){
this.eachItem(function(item){
item.disable()
})
},
onEnable:function(){
this.eachItem(function(item){
item.enable()
})
}
});
Ext.reg('compositefield',Ext.form.CompositeField);
Ext.form.Radio=Ext.extend(Ext.form.Checkbox,{
inputType:'radio',
markInvalid:Ext.emptyFn,
clearInvalid:Ext.emptyFn,
getGroupValue:function(){
var p=this.el.up('form')||Ext.getBody();
var c=p.child('input[name="'+this.el.dom.name+'"]:checked',true);
return c?c.value:null
},
setValue:function(v){
var checkEl,els,radio;
if(typeof v=='boolean'){
Ext.form.Radio.superclass.setValue.call(this,v)
}else if(this.rendered){
checkEl=this.getCheckEl();
radio=checkEl.child('input[name="'+this.el.dom.name+'"][value="'+v+'"]',true);
if(radio){
Ext.getCmp(radio.id).setValue(true)
}
}
if(this.rendered&&this.checked){
checkEl=checkEl||this.getCheckEl();
els=this.getCheckEl().select('input[name="'+this.el.dom.name+'"]');
els.each(function(el){
if(el.dom.id!=this.id){
Ext.getCmp(el.dom.id).setValue(false)
}
},this)
}
return this
},
getCheckEl:function(){
if(this.inGroup){
return this.el.up('.x-form-radio-group')
}
return this.el.up('form')||Ext.getBody()
}
});
Ext.reg('radio',Ext.form.Radio);
Ext.form.RadioGroup=Ext.extend(Ext.form.CheckboxGroup,{
allowBlank:true,
blankText:'You must select one item in this group',
defaultType:'radio',
groupCls:'x-form-radio-group',
getValue:function(){
var out=null;
this.eachItem(function(item){
if(item.checked){
out=item;
return false
}
});
return out
},
onSetValue:function(id,value){
if(arguments.length>1){
var f=this.getBox(id);
if(f){
f.setValue(value);
if(f.checked){
this.eachItem(function(item){
if(item!==f){
item.setValue(false)
}
})
}
}
}else{
this.setValueForItem(id)
}
},
setValueForItem:function(val){
val=String(val).split(',')[0];
this.eachItem(function(item){
item.setValue(val==item.inputValue)
})
},
fireChecked:function(){
if(!this.checkTask){
this.checkTask=new Ext.util.DelayedTask(this.bufferChecked,this)
}
this.checkTask.delay(10)
},
bufferChecked:function(){
var out=null;
this.eachItem(function(item){
if(item.checked){
out=item;
return false
}
});
this.fireEvent('change',this,out)
},
onDestroy:function(){
if(this.checkTask){
this.checkTask.cancel();
this.checkTask=null
}
Ext.form.RadioGroup.superclass.onDestroy.call(this)
}
});
Ext.reg('radiogroup',Ext.form.RadioGroup);
Ext.form.Hidden=Ext.extend(Ext.form.Field,{
inputType:'hidden',
shouldLayout:false,
onRender:function(){
Ext.form.Hidden.superclass.onRender.apply(this,arguments)
},
initEvents:function(){
this.originalValue=this.getValue()
},
setSize:Ext.emptyFn,
setWidth:Ext.emptyFn,
setHeight:Ext.emptyFn,
setPosition:Ext.emptyFn,
setPagePosition:Ext.emptyFn,
markInvalid:Ext.emptyFn,
clearInvalid:Ext.emptyFn
});
Ext.reg('hidden',Ext.form.Hidden);
Ext.form.BasicForm=Ext.extend(Ext.util.Observable,{
constructor:function(el,config){
Ext.apply(this,config);
if(Ext.isString(this.paramOrder)){
this.paramOrder=this.paramOrder.split(/[\s,|]/)
}
this.items=new Ext.util.MixedCollection(false,function(o){
return o.getItemId()
});
this.addEvents('beforeaction','actionfailed','actioncomplete');
if(el){
this.initEl(el)
}
Ext.form.BasicForm.superclass.constructor.call(this)
},
timeout:30,
paramOrder:undefined,
paramsAsHash:false,
waitTitle:'Please Wait...',
activeAction:null,
trackResetOnLoad:false,
initEl:function(el){
this.el=Ext.get(el);
this.id=this.el.id||Ext.id();
if(!this.standardSubmit){
this.el.on('submit',this.onSubmit,this)
}
this.el.addClass('x-form')
},
getEl:function(){
return this.el
},
onSubmit:function(e){
e.stopEvent()
},
destroy:function(bound){
if(bound!==true){
this.items.each(function(f){
Ext.destroy(f)
});
Ext.destroy(this.el)
}
this.items.clear();
this.purgeListeners()
},
isValid:function(){
var valid=true;
this.items.each(function(f){
if(!f.validate()){
valid=false
}
});
return valid
},
isDirty:function(){
var dirty=false;
this.items.each(function(f){
if(f.isDirty()){
dirty=true;
return false
}
});
return dirty
},
doAction:function(action,options){
if(Ext.isString(action)){
action=new Ext.form.Action.ACTION_TYPES[action](this,options)
}
if(this.fireEvent('beforeaction',this,action)!==false){
this.beforeAction(action);
action.run.defer(100,action)
}
return this
},
submit:function(options){
options=options||{};
if(this.standardSubmit){
var v=options.clientValidation===false||this.isValid();
if(v){
var el=this.el.dom;
if(this.url&&Ext.isEmpty(el.action)){
el.action=this.url
}
el.submit()
}
return v
}
var submitAction=String.format('{0}submit',this.api?'direct':'');
this.doAction(submitAction,options);
return this
},
load:function(options){
var loadAction=String.format('{0}load',this.api?'direct':'');
this.doAction(loadAction,options);
return this
},
updateRecord:function(record){
record.beginEdit();
var fs=record.fields,field,value;
fs.each(function(f){
field=this.findField(f.name);
if(field){
value=field.getValue();
if(Ext.type(value)!==false&&value.getGroupValue){
value=value.getGroupValue()
}else if(field.eachItem){
value=[];
field.eachItem(function(item){
value.push(item.getValue())
})
}
record.set(f.name,value)
}
},this);
record.endEdit();
return this
},
loadRecord:function(record){
this.setValues(record.data);
return this
},
beforeAction:function(action){
this.items.each(function(f){
if(f.isFormField&&f.syncValue){
f.syncValue()
}
});
var o=action.options;
if(o.waitMsg){
if(this.waitMsgTarget===true){
this.el.mask(o.waitMsg,'x-mask-loading')
}else if(this.waitMsgTarget){
this.waitMsgTarget=Ext.get(this.waitMsgTarget);
this.waitMsgTarget.mask(o.waitMsg,'x-mask-loading')
}else{
Ext.MessageBox.wait(o.waitMsg,o.waitTitle||this.waitTitle)
}
}
},
afterAction:function(action,success){
this.activeAction=null;
var o=action.options;
if(o.waitMsg){
if(this.waitMsgTarget===true){
this.el.unmask()
}else if(this.waitMsgTarget){
this.waitMsgTarget.unmask()
}else{
Ext.MessageBox.updateProgress(1);
Ext.MessageBox.hide()
}
}
if(success){
if(o.reset){
this.reset()
}
Ext.callback(o.success,o.scope,[
this,
action
]);
this.fireEvent('actioncomplete',this,action)
}else{
Ext.callback(o.failure,o.scope,[
this,
action
]);
this.fireEvent('actionfailed',this,action)
}
},
findField:function(id){
var field=this.items.get(id);
if(!Ext.isObject(field)){
var findMatchingField=function(f){
if(f.isFormField){
if(f.dataIndex==id||f.id==id||f.getName()==id){
field=f;
return false
}else if(f.isComposite){
return f.items.each(findMatchingField)
}else if(f instanceof Ext.form.CheckboxGroup&&f.rendered){
return f.eachItem(findMatchingField)
}
}
};
this.items.each(findMatchingField)
}
return field||null
},
markInvalid:function(errors){
if(Ext.isArray(errors)){
for(var i=0,len=errors.length;i<len;i++){
var fieldError=errors[i];
var f=this.findField(fieldError.id);
if(f){
f.markInvalid(fieldError.msg)
}
}
}else{
var field,id;
for(id in errors){
if(!Ext.isFunction(errors[id])&&(field=this.findField(id))){
field.markInvalid(errors[id])
}
}
}
return this
},
setValues:function(values){
if(Ext.isArray(values)){
for(var i=0,len=values.length;i<len;i++){
var v=values[i];
var f=this.findField(v.id);
if(f){
f.setValue(v.value);
if(this.trackResetOnLoad){
f.originalValue=f.getValue()
}
}
}
}else{
var field,id;
for(id in values){
if(!Ext.isFunction(values[id])&&(field=this.findField(id))){
field.setValue(values[id]);
if(this.trackResetOnLoad){
field.originalValue=field.getValue()
}
}
}
}
return this
},
getValues:function(asString){
var fs=Ext.lib.Ajax.serializeForm(this.el.dom);
if(asString===true){
return fs
}
return Ext.urlDecode(fs)
},
getFieldValues:function(dirtyOnly){
var o={},n,key,val;
this.items.each(function(f){
if(!f.disabled&&(dirtyOnly!==true||f.isDirty())){
n=f.getName();
key=o[n];
val=f.getValue();
if(Ext.isDefined(key)){
if(Ext.isArray(key)){
o[n].push(val)
}else{
o[n]=[
key,
val
]
}
}else{
o[n]=val
}
}
});
return o
},
clearInvalid:function(){
this.items.each(function(f){
f.clearInvalid()
});
return this
},
reset:function(){
this.items.each(function(f){
f.reset()
});
return this
},
add:function(){
this.items.addAll(Array.prototype.slice.call(arguments,0));
return this
},
remove:function(field){
this.items.remove(field);
return this
},
cleanDestroyed:function(){
this.items.filterBy(function(o){
return!!o.isDestroyed
}).each(this.remove,this)
},
render:function(){
this.items.each(function(f){
if(f.isFormField&&!f.rendered&&document.getElementById(f.id)){
f.applyToMarkup(f.id)
}
});
return this
},
applyToFields:function(o){
this.items.each(function(f){
Ext.apply(f,o)
});
return this
},
applyIfToFields:function(o){
this.items.each(function(f){
Ext.applyIf(f,o)
});
return this
},
callFieldMethod:function(fnName,args){
args=args||[];
this.items.each(function(f){
if(Ext.isFunction(f[fnName])){
f[fnName].apply(f,args)
}
});
return this
}
});
Ext.BasicForm=Ext.form.BasicForm;
Ext.FormPanel=Ext.extend(Ext.Panel,{
minButtonWidth:75,
labelAlign:'left',
monitorValid:false,
monitorPoll:200,
layout:'form',
initComponent:function(){
this.form=this.createForm();
Ext.FormPanel.superclass.initComponent.call(this);
this.bodyCfg={
tag:'form',
cls:this.baseCls+'-body',
method:this.method||'POST',
id:this.formId||Ext.id()
};
if(this.fileUpload){
this.bodyCfg.enctype='multipart/form-data'
}
this.initItems();
this.addEvents('clientvalidation');
this.relayEvents(this.form,[
'beforeaction',
'actionfailed',
'actioncomplete'
])
},
createForm:function(){
var config=Ext.applyIf({listeners:{}},this.initialConfig);
return new Ext.form.BasicForm(null,config)
},
initFields:function(){
var f=this.form;
var formPanel=this;
var fn=function(c){
if(formPanel.isField(c)){
f.add(c)
}else if(c.findBy&&c!=formPanel){
formPanel.applySettings(c);
if(c.items&&c.items.each){
c.items.each(fn,this)
}
}
};
this.items.each(fn,this)
},
applySettings:function(c){
var ct=c.ownerCt;
Ext.applyIf(c,{
labelAlign:ct.labelAlign,
labelWidth:ct.labelWidth,
itemCls:ct.itemCls
})
},
getLayoutTarget:function(){
return this.form.el
},
getForm:function(){
return this.form
},
onRender:function(ct,position){
this.initFields();
Ext.FormPanel.superclass.onRender.call(this,ct,position);
this.form.initEl(this.body)
},
beforeDestroy:function(){
this.stopMonitoring();
this.form.destroy(true);
Ext.FormPanel.superclass.beforeDestroy.call(this)
},
isField:function(c){
return!!c.setValue&&!!c.getValue&&!!c.markInvalid&&!!c.clearInvalid
},
initEvents:function(){
Ext.FormPanel.superclass.initEvents.call(this);
this.on({
scope:this,
add:this.onAddEvent,
remove:this.onRemoveEvent
});
if(this.monitorValid){
this.startMonitoring()
}
},
onAdd:function(c){
Ext.FormPanel.superclass.onAdd.call(this,c);
this.processAdd(c)
},
onAddEvent:function(ct,c){
if(ct!==this){
this.processAdd(c)
}
},
processAdd:function(c){
if(this.isField(c)){
this.form.add(c)
}else if(c.findBy){
this.applySettings(c);
this.form.add.apply(this.form,c.findBy(this.isField))
}
},
onRemove:function(c){
Ext.FormPanel.superclass.onRemove.call(this,c);
this.processRemove(c)
},
onRemoveEvent:function(ct,c){
if(ct!==this){
this.processRemove(c)
}
},
processRemove:function(c){
if(!this.destroying){
if(this.isField(c)){
this.form.remove(c)
}else if(c.findBy){
Ext.each(c.findBy(this.isField),this.form.remove,this.form);
this.form.cleanDestroyed()
}
}
},
startMonitoring:function(){
if(!this.validTask){
this.validTask=new Ext.util.TaskRunner;
this.validTask.start({
run:this.bindHandler,
interval:this.monitorPoll||200,
scope:this
})
}
},
stopMonitoring:function(){
if(this.validTask){
this.validTask.stopAll();
this.validTask=null
}
},
load:function(){
this.form.load.apply(this.form,arguments)
},
onDisable:function(){
Ext.FormPanel.superclass.onDisable.call(this);
if(this.form){
this.form.items.each(function(){
this.disable()
})
}
},
onEnable:function(){
Ext.FormPanel.superclass.onEnable.call(this);
if(this.form){
this.form.items.each(function(){
this.enable()
})
}
},
bindHandler:function(){
var valid=true;
this.form.items.each(function(f){
if(!f.isValid(true)){
valid=false;
return false
}
});
if(this.fbar){
var fitems=this.fbar.items.items;
for(var i=0,len=fitems.length;i<len;i++){
var btn=fitems[i];
if(btn.formBind===true&&btn.disabled===valid){
btn.setDisabled(!valid)
}
}
}
this.fireEvent('clientvalidation',this,valid)
}
});
Ext.reg('form',Ext.FormPanel);
Ext.form.FormPanel=Ext.FormPanel;
Ext.form.FieldSet=Ext.extend(Ext.Panel,{
baseCls:'x-fieldset',
layout:'form',
animCollapse:false,
onRender:function(ct,position){
if(!this.el){
this.el=document.createElement('fieldset');
this.el.id=this.id;
if(this.title||this.header||this.checkboxToggle){
this.el.appendChild(document.createElement('legend')).className=this.baseCls+'-header'
}
}
Ext.form.FieldSet.superclass.onRender.call(this,ct,position);
if(this.checkboxToggle){
var o=typeof this.checkboxToggle=='object'?this.checkboxToggle:{
tag:'input',
type:'checkbox',
name:this.checkboxName||this.id+'-checkbox'
};
this.checkbox=this.header.insertFirst(o);
this.checkbox.dom.checked=!this.collapsed;
this.mon(this.checkbox,'click',this.onCheckClick,this)
}
},
onCollapse:function(doAnim,animArg){
if(this.checkbox){
this.checkbox.dom.checked=false
}
Ext.form.FieldSet.superclass.onCollapse.call(this,doAnim,animArg)
},
onExpand:function(doAnim,animArg){
if(this.checkbox){
this.checkbox.dom.checked=true
}
Ext.form.FieldSet.superclass.onExpand.call(this,doAnim,animArg)
},
onCheckClick:function(){
this[this.checkbox.dom.checked?'expand':'collapse']()
}
});
Ext.reg('fieldset',Ext.form.FieldSet);
Ext.form.HtmlEditor=Ext.extend(Ext.form.Field,{
enableFormat:true,
enableFontSize:true,
enableColors:true,
enableAlignments:true,
enableLists:true,
enableSourceEdit:true,
enableLinks:true,
enableFont:true,
createLinkText:'Please enter the URL for the link:',
defaultLinkValue:'http:/'+'/',
fontFamilies:[
'Arial',
'Courier New',
'Tahoma',
'Times New Roman',
'Verdana'
],
defaultFont:'tahoma',
defaultValue:Ext.isOpera||Ext.isIE6?'&#160;':'&#8203;',
actionMode:'wrap',
validationEvent:false,
deferHeight:true,
initialized:false,
activated:false,
sourceEditMode:false,
onFocus:Ext.emptyFn,
iframePad:3,
hideMode:'offsets',
defaultAutoCreate:{
tag:'textarea',
style:'width:500px;height:300px;',
autocomplete:'off'
},
initComponent:function(){
this.addEvents('initialize','activate','beforesync','beforepush','sync','push','editmodechange');
Ext.form.HtmlEditor.superclass.initComponent.call(this)
},
createFontOptions:function(){
var buf=[],fs=this.fontFamilies,ff,lc;
for(var i=0,len=fs.length;i<len;i++){
ff=fs[i];
lc=ff.toLowerCase();
buf.push('<option value="',lc,'" style="font-family:',ff,';"',this.defaultFont==lc?' selected="true">':'>',ff,'</option>')
}
return buf.join('')
},
createToolbar:function(editor){
var items=[];
var tipsEnabled=Ext.QuickTips&&Ext.QuickTips.isEnabled();
function btn(id,toggle,handler){
return{
itemId:id,
cls:'x-btn-icon',
iconCls:'x-edit-'+id,
enableToggle:toggle!==false,
scope:editor,
handler:handler||editor.relayBtnCmd,
clickEvent:'mousedown',
tooltip:tipsEnabled?editor.buttonTips[id]||undefined:undefined,
overflowText:editor.buttonTips[id].title||undefined,
tabIndex:-1
}
}
if(this.enableFont&&!Ext.isSafari2){
var fontSelectItem=new Ext.Toolbar.Item({
autoEl:{
tag:'select',
cls:'x-font-select',
html:this.createFontOptions()
}
});
items.push(fontSelectItem,'-')
}
if(this.enableFormat){
items.push(btn('bold'),btn('italic'),btn('underline'))
}
if(this.enableFontSize){
items.push('-',btn('increasefontsize',false,this.adjustFont),btn('decreasefontsize',false,this.adjustFont))
}
if(this.enableColors){
items.push('-',{
itemId:'forecolor',
cls:'x-btn-icon',
iconCls:'x-edit-forecolor',
clickEvent:'mousedown',
tooltip:tipsEnabled?editor.buttonTips.forecolor||undefined:undefined,
tabIndex:-1,
menu:new Ext.menu.ColorMenu({
allowReselect:true,
focus:Ext.emptyFn,
value:'000000',
plain:true,
listeners:{
scope:this,
select:function(cp,color){
this.execCmd('forecolor',Ext.isWebKit||Ext.isIE?'#'+color:color);
this.deferFocus()
}
},
clickEvent:'mousedown'
})
},{
itemId:'backcolor',
cls:'x-btn-icon',
iconCls:'x-edit-backcolor',
clickEvent:'mousedown',
tooltip:tipsEnabled?editor.buttonTips.backcolor||undefined:undefined,
tabIndex:-1,
menu:new Ext.menu.ColorMenu({
focus:Ext.emptyFn,
value:'FFFFFF',
plain:true,
allowReselect:true,
listeners:{
scope:this,
select:function(cp,color){
if(Ext.isGecko){
this.execCmd('useCSS',false);
this.execCmd('hilitecolor',color);
this.execCmd('useCSS',true);
this.deferFocus()
}else{
this.execCmd(Ext.isOpera?'hilitecolor':'backcolor',Ext.isWebKit||Ext.isIE?'#'+color:color);
this.deferFocus()
}
}
},
clickEvent:'mousedown'
})
})
}
if(this.enableAlignments){
items.push('-',btn('justifyleft'),btn('justifycenter'),btn('justifyright'))
}
if(!Ext.isSafari2){
if(this.enableLinks){
items.push('-',btn('createlink',false,this.createLink))
}
if(this.enableLists){
items.push('-',btn('insertorderedlist'),btn('insertunorderedlist'))
}
if(this.enableSourceEdit){
items.push('-',btn('sourceedit',true,function(btn){
this.toggleSourceEdit(!this.sourceEditMode)
}))
}
}
var tb=new Ext.Toolbar({
renderTo:this.wrap.dom.firstChild,
items:items
});
if(fontSelectItem){
this.fontSelect=fontSelectItem.el;
this.mon(this.fontSelect,'change',function(){
var font=this.fontSelect.dom.value;
this.relayCmd('fontname',font);
this.deferFocus()
},this)
}
this.mon(tb.el,'click',function(e){
e.preventDefault()
});
this.tb=tb;
this.tb.doLayout()
},
onDisable:function(){
this.wrap.mask();
Ext.form.HtmlEditor.superclass.onDisable.call(this)
},
onEnable:function(){
this.wrap.unmask();
Ext.form.HtmlEditor.superclass.onEnable.call(this)
},
setReadOnly:function(readOnly){
Ext.form.HtmlEditor.superclass.setReadOnly.call(this,readOnly);
if(this.initialized){
if(Ext.isIE){
this.getEditorBody().contentEditable=!readOnly
}else{
this.setDesignMode(!readOnly)
}
var bd=this.getEditorBody();
if(bd){
bd.style.cursor=this.readOnly?'default':'text'
}
this.disableItems(readOnly)
}
},
getDocMarkup:function(){
var h=Ext.fly(this.iframe).getHeight()-this.iframePad*2;
return String.format('<html><head><style type="text/css">body{border: 0; margin: 0; padding: {0}px; height: {1}px; cursor: text}</style></head><body></body></html>',this.iframePad,h)
},
getEditorBody:function(){
var doc=this.getDoc();
return doc.body||doc.documentElement
},
getDoc:function(){
return Ext.isIE?this.getWin().document:this.iframe.contentDocument||this.getWin().document
},
getWin:function(){
return Ext.isIE?this.iframe.contentWindow:window.frames[this.iframe.name]
},
onRender:function(ct,position){
Ext.form.HtmlEditor.superclass.onRender.call(this,ct,position);
this.el.dom.style.border='0 none';
this.el.dom.setAttribute('tabIndex',-1);
this.el.addClass('x-hidden');
if(Ext.isIE){
this.el.applyStyles('margin-top:-1px;margin-bottom:-1px;')
}
this.wrap=this.el.wrap({
cls:'x-html-editor-wrap',
cn:{cls:'x-html-editor-tb'}
});
this.createToolbar(this);
this.disableItems(true);
this.tb.doLayout();
this.createIFrame();
if(!this.width){
var sz=this.el.getSize();
this.setSize(sz.width,this.height||sz.height)
}
this.resizeEl=this.positionEl=this.wrap
},
createIFrame:function(){
var iframe=document.createElement('iframe');
iframe.name=Ext.id();
iframe.frameBorder='0';
iframe.style.overflow='auto';
iframe.src=Ext.SSL_SECURE_URL;
this.wrap.dom.appendChild(iframe);
this.iframe=iframe;
this.monitorTask=Ext.TaskMgr.start({
run:this.checkDesignMode,
scope:this,
interval:100
})
},
initFrame:function(){
Ext.TaskMgr.stop(this.monitorTask);
var doc=this.getDoc();
this.win=this.getWin();
doc.open();
doc.write(this.getDocMarkup());
doc.close();
var task={
run:function(){
var doc=this.getDoc();
if(doc.body||doc.readyState=='complete'){
Ext.TaskMgr.stop(task);
this.setDesignMode(true);
this.initEditor.defer(10,this)
}
},
interval:10,
duration:10000,
scope:this
};
Ext.TaskMgr.start(task)
},
checkDesignMode:function(){
if(this.wrap&&this.wrap.dom.offsetWidth){
var doc=this.getDoc();
if(!doc){
return
}
if(!doc.editorInitialized||this.getDesignMode()!='on'){
this.initFrame()
}
}
},
setDesignMode:function(mode){
var doc=this.getDoc();
if(doc){
if(this.readOnly){
mode=false
}
doc.designMode=/on|true/i.test(String(mode).toLowerCase())?'on':'off'
}
},
getDesignMode:function(){
var doc=this.getDoc();
if(!doc){
return''
}
return String(doc.designMode).toLowerCase()
},
disableItems:function(disabled){
if(this.fontSelect){
this.fontSelect.dom.disabled=disabled
}
this.tb.items.each(function(item){
if(item.getItemId()!='sourceedit'){
item.setDisabled(disabled)
}
})
},
onResize:function(w,h){
Ext.form.HtmlEditor.superclass.onResize.apply(this,arguments);
if(this.el&&this.iframe){
if(Ext.isNumber(w)){
var aw=w-this.wrap.getFrameWidth('lr');
this.el.setWidth(aw);
this.tb.setWidth(aw);
this.iframe.style.width=Math.max(aw,0)+'px'
}
if(Ext.isNumber(h)){
var ah=h-this.wrap.getFrameWidth('tb')-this.tb.el.getHeight();
this.el.setHeight(ah);
this.iframe.style.height=Math.max(ah,0)+'px';
var bd=this.getEditorBody();
if(bd){
bd.style.height=Math.max(ah-this.iframePad*2,0)+'px'
}
}
}
},
toggleSourceEdit:function(sourceEditMode){
var iframeHeight,elHeight;
if(sourceEditMode===undefined){
sourceEditMode=!this.sourceEditMode
}
this.sourceEditMode=sourceEditMode===true;
var btn=this.tb.getComponent('sourceedit');
if(btn.pressed!==this.sourceEditMode){
btn.toggle(this.sourceEditMode);
if(!btn.xtbHidden){
return
}
}
if(this.sourceEditMode){
this.previousSize=this.getSize();
iframeHeight=Ext.get(this.iframe).getHeight();
this.disableItems(true);
this.syncValue();
this.iframe.className='x-hidden';
this.el.removeClass('x-hidden');
this.el.dom.removeAttribute('tabIndex');
this.el.focus();
this.el.dom.style.height=iframeHeight+'px'
}else{
elHeight=parseInt(this.el.dom.style.height,10);
if(this.initialized){
this.disableItems(this.readOnly)
}
this.pushValue();
this.iframe.className='';
this.el.addClass('x-hidden');
this.el.dom.setAttribute('tabIndex',-1);
this.deferFocus();
this.setSize(this.previousSize);
delete this.previousSize;
this.iframe.style.height=elHeight+'px'
}
this.fireEvent('editmodechange',this,this.sourceEditMode)
},
createLink:function(){
var url=prompt(this.createLinkText,this.defaultLinkValue);
if(url&&url!='http:/'+'/'){
this.relayCmd('createlink',url)
}
},
initEvents:function(){
this.originalValue=this.getValue()
},
markInvalid:Ext.emptyFn,
clearInvalid:Ext.emptyFn,
setValue:function(v){
Ext.form.HtmlEditor.superclass.setValue.call(this,v);
this.pushValue();
return this
},
cleanHtml:function(html){
html=String(html);
if(Ext.isWebKit){
html=html.replace(/\sclass="(?:Apple-style-span|khtml-block-placeholder)"/gi,'')
}
if(html.charCodeAt(0)==this.defaultValue.replace(/\D/g,'')){
html=html.substring(1)
}
return html
},
syncValue:function(){
if(this.initialized){
var bd=this.getEditorBody();
var html=bd.innerHTML;
if(Ext.isWebKit){
var bs=bd.getAttribute('style');
var m=bs.match(/text-align:(.*?);/i);
if(m&&m[1]){
html='<div style="'+m[0]+'">'+html+'</div>'
}
}
html=this.cleanHtml(html);
if(this.fireEvent('beforesync',this,html)!==false){
this.el.dom.value=html;
this.fireEvent('sync',this,html)
}
}
},
getValue:function(){
this[this.sourceEditMode?'pushValue':'syncValue']();
return Ext.form.HtmlEditor.superclass.getValue.call(this)
},
pushValue:function(){
if(this.initialized){
var v=this.el.dom.value;
if(!this.activated&&v.length<1){
v=this.defaultValue
}
if(this.fireEvent('beforepush',this,v)!==false){
this.getEditorBody().innerHTML=v;
if(Ext.isGecko){
this.setDesignMode(false);
this.setDesignMode(true)
}
this.fireEvent('push',this,v)
}
}
},
deferFocus:function(){
this.focus.defer(10,this)
},
focus:function(){
if(this.win&&!this.sourceEditMode){
this.win.focus()
}else{
this.el.focus()
}
},
initEditor:function(){
try{
var dbody=this.getEditorBody(),ss=this.el.getStyles('font-size','font-family','background-image','background-repeat','background-color','color'),doc,fn;
ss['background-attachment']='fixed';
dbody.bgProperties='fixed';
Ext.DomHelper.applyStyles(dbody,ss);
doc=this.getDoc();
if(doc){
try{
Ext.EventManager.removeAll(doc)
}catch(e){
}
}
fn=this.onEditorEvent.createDelegate(this);
Ext.EventManager.on(doc,{
mousedown:fn,
dblclick:fn,
click:fn,
keyup:fn,
buffer:100
});
if(Ext.isGecko){
Ext.EventManager.on(doc,'keypress',this.applyCommand,this)
}
if(Ext.isIE||Ext.isWebKit||Ext.isOpera){
Ext.EventManager.on(doc,'keydown',this.fixKeys,this)
}
doc.editorInitialized=true;
this.initialized=true;
this.pushValue();
this.setReadOnly(this.readOnly);
this.fireEvent('initialize',this)
}catch(e){
}
},
beforeDestroy:function(){
if(this.monitorTask){
Ext.TaskMgr.stop(this.monitorTask)
}
if(this.rendered){
Ext.destroy(this.tb);
var doc=this.getDoc();
if(doc){
try{
Ext.EventManager.removeAll(doc);
for(var prop in doc){
delete doc[prop]
}
}catch(e){
}
}
if(this.wrap){
this.wrap.dom.innerHTML='';
this.wrap.remove()
}
}
Ext.form.HtmlEditor.superclass.beforeDestroy.call(this)
},
onFirstFocus:function(){
this.activated=true;
this.disableItems(this.readOnly);
if(Ext.isGecko){
this.win.focus();
var s=this.win.getSelection();
if(!s.focusNode||s.focusNode.nodeType!=3){
var r=s.getRangeAt(0);
r.selectNodeContents(this.getEditorBody());
r.collapse(true);
this.deferFocus()
}
try{
this.execCmd('useCSS',true);
this.execCmd('styleWithCSS',false)
}catch(e){
}
}
this.fireEvent('activate',this)
},
adjustFont:function(btn){
var adjust=btn.getItemId()=='increasefontsize'?1:-1,doc=this.getDoc(),v=parseInt(doc.queryCommandValue('FontSize')||2,10);
if(Ext.isSafari&&!Ext.isSafari2||Ext.isChrome||Ext.isAir){
if(v<=10){
v=1+adjust
}else if(v<=13){
v=2+adjust
}else if(v<=16){
v=3+adjust
}else if(v<=18){
v=4+adjust
}else if(v<=24){
v=5+adjust
}else{
v=6+adjust
}
v=v.constrain(1,6)
}else{
if(Ext.isSafari){
adjust*=2
}
v=Math.max(1,v+adjust)+(Ext.isSafari?'px':0)
}
this.execCmd('FontSize',v)
},
onEditorEvent:function(e){
this.updateToolbar()
},
updateToolbar:function(){
if(this.readOnly){
return
}
if(!this.activated){
this.onFirstFocus();
return
}
var btns=this.tb.items.map,doc=this.getDoc();
if(this.enableFont&&!Ext.isSafari2){
var name=(doc.queryCommandValue('FontName')||this.defaultFont).toLowerCase();
if(name!=this.fontSelect.dom.value){
this.fontSelect.dom.value=name
}
}
if(this.enableFormat){
btns.bold.toggle(doc.queryCommandState('bold'));
btns.italic.toggle(doc.queryCommandState('italic'));
btns.underline.toggle(doc.queryCommandState('underline'))
}
if(this.enableAlignments){
btns.justifyleft.toggle(doc.queryCommandState('justifyleft'));
btns.justifycenter.toggle(doc.queryCommandState('justifycenter'));
btns.justifyright.toggle(doc.queryCommandState('justifyright'))
}
if(!Ext.isSafari2&&this.enableLists){
btns.insertorderedlist.toggle(doc.queryCommandState('insertorderedlist'));
btns.insertunorderedlist.toggle(doc.queryCommandState('insertunorderedlist'))
}
Ext.menu.MenuMgr.hideAll();
this.syncValue()
},
relayBtnCmd:function(btn){
this.relayCmd(btn.getItemId())
},
relayCmd:function(cmd,value){
(function(){
this.focus();
this.execCmd(cmd,value);
this.updateToolbar()
}.defer(10,this))
},
execCmd:function(cmd,value){
var doc=this.getDoc();
doc.execCommand(cmd,false,value===undefined?null:value);
this.syncValue()
},
applyCommand:function(e){
if(e.ctrlKey){
var c=e.getCharCode(),cmd;
if(c>0){
c=String.fromCharCode(c);
switch(c){
case'b':
cmd='bold';
break;
case'i':
cmd='italic';
break;
case'u':
cmd='underline';
break
}
if(cmd){
this.win.focus();
this.execCmd(cmd);
this.deferFocus();
e.preventDefault()
}
}
}
},
insertAtCursor:function(text){
if(!this.activated){
return
}
if(Ext.isIE){
this.win.focus();
var doc=this.getDoc(),r=doc.selection.createRange();
if(r){
r.pasteHTML(text);
this.syncValue();
this.deferFocus()
}
}else{
this.win.focus();
this.execCmd('InsertHTML',text);
this.deferFocus()
}
},
fixKeys:function(){
if(Ext.isIE){
return function(e){
var k=e.getKey(),doc=this.getDoc(),r;
if(k==e.TAB){
e.stopEvent();
r=doc.selection.createRange();
if(r){
r.collapse(true);
r.pasteHTML('&nbsp;&nbsp;&nbsp;&nbsp;');
this.deferFocus()
}
}else if(k==e.ENTER){
r=doc.selection.createRange();
if(r){
var target=r.parentElement();
if(!target||target.tagName.toLowerCase()!='li'){
e.stopEvent();
r.pasteHTML('<br />');
r.collapse(false);
r.select()
}
}
}
}
}else if(Ext.isOpera){
return function(e){
var k=e.getKey();
if(k==e.TAB){
e.stopEvent();
this.win.focus();
this.execCmd('InsertHTML','&nbsp;&nbsp;&nbsp;&nbsp;');
this.deferFocus()
}
}
}else if(Ext.isWebKit){
return function(e){
var k=e.getKey();
if(k==e.TAB){
e.stopEvent();
this.execCmd('InsertText','	');
this.deferFocus()
}else if(k==e.ENTER){
e.stopEvent();
this.execCmd('InsertHtml','<br /><br />');
this.deferFocus()
}
}
}
}(),
getToolbar:function(){
return this.tb
},
buttonTips:{
bold:{
title:'Bold (Ctrl+B)',
text:'Make the selected text bold.',
cls:'x-html-editor-tip'
},
italic:{
title:'Italic (Ctrl+I)',
text:'Make the selected text italic.',
cls:'x-html-editor-tip'
},
underline:{
title:'Underline (Ctrl+U)',
text:'Underline the selected text.',
cls:'x-html-editor-tip'
},
increasefontsize:{
title:'Grow Text',
text:'Increase the font size.',
cls:'x-html-editor-tip'
},
decreasefontsize:{
title:'Shrink Text',
text:'Decrease the font size.',
cls:'x-html-editor-tip'
},
backcolor:{
title:'Text Highlight Color',
text:'Change the background color of the selected text.',
cls:'x-html-editor-tip'
},
forecolor:{
title:'Font Color',
text:'Change the color of the selected text.',
cls:'x-html-editor-tip'
},
justifyleft:{
title:'Align Text Left',
text:'Align text to the left.',
cls:'x-html-editor-tip'
},
justifycenter:{
title:'Center Text',
text:'Center text in the editor.',
cls:'x-html-editor-tip'
},
justifyright:{
title:'Align Text Right',
text:'Align text to the right.',
cls:'x-html-editor-tip'
},
insertunorderedlist:{
title:'Bullet List',
text:'Start a bulleted list.',
cls:'x-html-editor-tip'
},
insertorderedlist:{
title:'Numbered List',
text:'Start a numbered list.',
cls:'x-html-editor-tip'
},
createlink:{
title:'Hyperlink',
text:'Make the selected text a hyperlink.',
cls:'x-html-editor-tip'
},
sourceedit:{
title:'Source Edit',
text:'Switch to source editing mode.',
cls:'x-html-editor-tip'
}
}
});
Ext.reg('htmleditor',Ext.form.HtmlEditor);
Ext.form.TimeField=Ext.extend(Ext.form.ComboBox,{
minValue:undefined,
maxValue:undefined,
minText:'The time in this field must be equal to or after {0}',
maxText:'The time in this field must be equal to or before {0}',
invalidText:'{0} is not a valid time',
format:'g:i A',
altFormats:'g:ia|g:iA|g:i a|g:i A|h:i|g:i|H:i|ga|ha|gA|h a|g a|g A|gi|hi|gia|hia|g|H|gi a|hi a|giA|hiA|gi A|hi A',
increment:15,
mode:'local',
triggerAction:'all',
typeAhead:false,
initDate:'1/1/2008',
initDateFormat:'j/n/Y',
initComponent:function(){
if(Ext.isDefined(this.minValue)){
this.setMinValue(this.minValue,true)
}
if(Ext.isDefined(this.maxValue)){
this.setMaxValue(this.maxValue,true)
}
if(!this.store){
this.generateStore(true)
}
Ext.form.TimeField.superclass.initComponent.call(this)
},
setMinValue:function(value,initial){
this.setLimit(value,true,initial);
return this
},
setMaxValue:function(value,initial){
this.setLimit(value,false,initial);
return this
},
generateStore:function(initial){
var min=this.minValue||new Date(this.initDate).clearTime(),max=this.maxValue||new Date(this.initDate).clearTime().add('mi',24*60-1),times=[];
while(min<=max){
times.push(min.dateFormat(this.format));
min=min.add('mi',this.increment)
}
this.bindStore(times,initial)
},
setLimit:function(value,isMin,initial){
var d;
if(Ext.isString(value)){
d=this.parseDate(value)
}else if(Ext.isDate(value)){
d=value
}
if(d){
var val=new Date(this.initDate).clearTime();
val.setHours(d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds());
this[isMin?'minValue':'maxValue']=val;
if(!initial){
this.generateStore()
}
}
},
getValue:function(){
var v=Ext.form.TimeField.superclass.getValue.call(this);
return this.formatDate(this.parseDate(v))||''
},
setValue:function(value){
return Ext.form.TimeField.superclass.setValue.call(this,this.formatDate(this.parseDate(value)))
},
validateValue:Ext.form.DateField.prototype.validateValue,
formatDate:Ext.form.DateField.prototype.formatDate,
parseDate:function(value){
if(!value||Ext.isDate(value)){
return value
}
var id=this.initDate+' ',idf=this.initDateFormat+' ',v=Date.parseDate(id+value,idf+this.format),af=this.altFormats;
if(!v&&af){
if(!this.altFormatsArray){
this.altFormatsArray=af.split('|')
}
for(var i=0,afa=this.altFormatsArray,len=afa.length;i<len&&!v;i++){
v=Date.parseDate(id+value,idf+afa[i])
}
}
return v
}
});
Ext.reg('timefield',Ext.form.TimeField);
Ext.form.SliderField=Ext.extend(Ext.form.Field,{
useTips:true,
tipText:null,
actionMode:'wrap',
initComponent:function(){
var cfg=Ext.copyTo({id:this.id+'-slider'},this.initialConfig,[
'vertical',
'minValue',
'maxValue',
'decimalPrecision',
'keyIncrement',
'increment',
'clickToChange',
'animate'
]);
if(this.useTips){
var plug=this.tipText?{getText:this.tipText}:{};
cfg.plugins=[new Ext.slider.Tip(plug)]
}
this.slider=new Ext.Slider(cfg);
Ext.form.SliderField.superclass.initComponent.call(this)
},
onRender:function(ct,position){
this.autoCreate={
id:this.id,
name:this.name,
type:'hidden',
tag:'input'
};
Ext.form.SliderField.superclass.onRender.call(this,ct,position);
this.wrap=this.el.wrap({cls:'x-form-field-wrap'});
this.resizeEl=this.positionEl=this.wrap;
this.slider.render(this.wrap)
},
onResize:function(w,h,aw,ah){
Ext.form.SliderField.superclass.onResize.call(this,w,h,aw,ah);
this.slider.setSize(w,h)
},
initEvents:function(){
Ext.form.SliderField.superclass.initEvents.call(this);
this.slider.on('change',this.onChange,this)
},
onChange:function(slider,v){
this.setValue(v,undefined,true)
},
onEnable:function(){
Ext.form.SliderField.superclass.onEnable.call(this);
this.slider.enable()
},
onDisable:function(){
Ext.form.SliderField.superclass.onDisable.call(this);
this.slider.disable()
},
beforeDestroy:function(){
Ext.destroy(this.slider);
Ext.form.SliderField.superclass.beforeDestroy.call(this)
},
alignErrorIcon:function(){
this.errorIcon.alignTo(this.slider.el,'tl-tr',[
2,
0
])
},
setMinValue:function(v){
this.slider.setMinValue(v);
return this
},
setMaxValue:function(v){
this.slider.setMaxValue(v);
return this
},
setValue:function(v,animate,silent){
if(!silent){
this.slider.setValue(v,animate)
}
return Ext.form.SliderField.superclass.setValue.call(this,this.slider.getValue())
},
getValue:function(){
return this.slider.getValue()
}
});
Ext.reg('sliderfield',Ext.form.SliderField);
Ext.form.Label=Ext.extend(Ext.BoxComponent,{
onRender:function(ct,position){
if(!this.el){
this.el=document.createElement('label');
this.el.id=this.getId();
this.el.innerHTML=this.text?Ext.util.Format.htmlEncode(this.text):this.html||'';
if(this.forId){
this.el.setAttribute('for',this.forId)
}
}
Ext.form.Label.superclass.onRender.call(this,ct,position)
},
setText:function(t,encode){
var e=encode===false;
this[!e?'text':'html']=t;
delete this[e?'text':'html'];
if(this.rendered){
this.el.dom.innerHTML=encode!==false?Ext.util.Format.htmlEncode(t):t
}
return this
}
});
Ext.reg('label',Ext.form.Label);
Ext.form.Action=function(form,options){
this.form=form;
this.options=options||{}
};
Ext.form.Action.CLIENT_INVALID='client';
Ext.form.Action.SERVER_INVALID='server';
Ext.form.Action.CONNECT_FAILURE='connect';
Ext.form.Action.LOAD_FAILURE='load';
Ext.form.Action.prototype={
type:'default',
run:function(options){
},
success:function(response){
},
handleResponse:function(response){
},
failure:function(response){
this.response=response;
this.failureType=Ext.form.Action.CONNECT_FAILURE;
this.form.afterAction(this,false)
},
processResponse:function(response){
this.response=response;
if(!response.responseText&&!response.responseXML){
return true
}
this.result=this.handleResponse(response);
return this.result
},
decodeResponse:function(response){
try{
return Ext.decode(response.responseText)
}catch(e){
return false
}
},
getUrl:function(appendParams){
var url=this.options.url||this.form.url||this.form.el.dom.action;
if(appendParams){
var p=this.getParams();
if(p){
url=Ext.urlAppend(url,p)
}
}
return url
},
getMethod:function(){
return(this.options.method||this.form.method||this.form.el.dom.method||'POST').toUpperCase()
},
getParams:function(){
var bp=this.form.baseParams;
var p=this.options.params;
if(p){
if(typeof p=='object'){
p=Ext.urlEncode(Ext.applyIf(p,bp))
}else if(typeof p=='string'&&bp){
p+='&'+Ext.urlEncode(bp)
}
}else if(bp){
p=Ext.urlEncode(bp)
}
return p
},
createCallback:function(opts){
var opts=opts||{};
return{
success:this.success,
failure:this.failure,
scope:this,
timeout:opts.timeout*1000||this.form.timeout*1000,
upload:this.form.fileUpload?this.success:undefined
}
}
};
Ext.form.Action.Submit=function(form,options){
Ext.form.Action.Submit.superclass.constructor.call(this,form,options)
};
Ext.extend(Ext.form.Action.Submit,Ext.form.Action,{
type:'submit',
run:function(){
var o=this.options,method=this.getMethod(),isGet=method=='GET';
if(o.clientValidation===false||this.form.isValid()){
if(o.submitEmptyText===false){
var fields=this.form.items,emptyFields=[],setupEmptyFields=function(f){
if(f.el.getValue()==f.emptyText){
emptyFields.push(f);
f.el.dom.value=''
}
if(f.isComposite&&f.rendered){
f.items.each(setupEmptyFields)
}
};
fields.each(setupEmptyFields)
}
Ext.Ajax.request(Ext.apply(this.createCallback(o),{
form:this.form.el.dom,
url:this.getUrl(isGet),
method:method,
headers:o.headers,
params:!isGet?this.getParams():null,
isUpload:this.form.fileUpload
}));
if(o.submitEmptyText===false){
Ext.each(emptyFields,function(f){
if(f.applyEmptyText){
f.applyEmptyText()
}
})
}
}else if(o.clientValidation!==false){
this.failureType=Ext.form.Action.CLIENT_INVALID;
this.form.afterAction(this,false)
}
},
success:function(response){
var result=this.processResponse(response);
if(result===true||result.success){
this.form.afterAction(this,true);
return
}
if(result.errors){
this.form.markInvalid(result.errors)
}
this.failureType=Ext.form.Action.SERVER_INVALID;
this.form.afterAction(this,false)
},
handleResponse:function(response){
if(this.form.errorReader){
var rs=this.form.errorReader.read(response);
var errors=[];
if(rs.records){
for(var i=0,len=rs.records.length;i<len;i++){
var r=rs.records[i];
errors[i]=r.data
}
}
if(errors.length<1){
errors=null
}
return{
success:rs.success,
errors:errors
}
}
return this.decodeResponse(response)
}
});
Ext.form.Action.Load=function(form,options){
Ext.form.Action.Load.superclass.constructor.call(this,form,options);
this.reader=this.form.reader
};
Ext.extend(Ext.form.Action.Load,Ext.form.Action,{
type:'load',
run:function(){
Ext.Ajax.request(Ext.apply(this.createCallback(this.options),{
method:this.getMethod(),
url:this.getUrl(false),
headers:this.options.headers,
params:this.getParams()
}))
},
success:function(response){
var result=this.processResponse(response);
if(result===true||!result.success||!result.data){
this.failureType=Ext.form.Action.LOAD_FAILURE;
this.form.afterAction(this,false);
return
}
this.form.clearInvalid();
this.form.setValues(result.data);
this.form.afterAction(this,true)
},
handleResponse:function(response){
if(this.form.reader){
var rs=this.form.reader.read(response);
var data=rs.records&&rs.records[0]?rs.records[0].data:null;
return{
success:rs.success,
data:data
}
}
return this.decodeResponse(response)
}
});
Ext.form.Action.DirectLoad=Ext.extend(Ext.form.Action.Load,{
constructor:function(form,opts){
Ext.form.Action.DirectLoad.superclass.constructor.call(this,form,opts)
},
type:'directload',
run:function(){
var args=this.getParams();
args.push(this.success,this);
this.form.api.load.apply(window,args)
},
getParams:function(){
var buf=[],o={};
var bp=this.form.baseParams;
var p=this.options.params;
Ext.apply(o,p,bp);
var paramOrder=this.form.paramOrder;
if(paramOrder){
for(var i=0,len=paramOrder.length;i<len;i++){
buf.push(o[paramOrder[i]])
}
}else if(this.form.paramsAsHash){
buf.push(o)
}
return buf
},
processResponse:function(result){
this.result=result;
return result
},
success:function(response,trans){
if(trans.type==Ext.Direct.exceptions.SERVER){
response={}
}
Ext.form.Action.DirectLoad.superclass.success.call(this,response)
}
});
Ext.form.Action.DirectSubmit=Ext.extend(Ext.form.Action.Submit,{
constructor:function(form,opts){
Ext.form.Action.DirectSubmit.superclass.constructor.call(this,form,opts)
},
type:'directsubmit',
run:function(){
var o=this.options;
if(o.clientValidation===false||this.form.isValid()){
this.success.params=this.getParams();
this.form.api.submit(this.form.el.dom,this.success,this)
}else if(o.clientValidation!==false){
this.failureType=Ext.form.Action.CLIENT_INVALID;
this.form.afterAction(this,false)
}
},
getParams:function(){
var o={};
var bp=this.form.baseParams;
var p=this.options.params;
Ext.apply(o,p,bp);
return o
},
processResponse:function(result){
this.result=result;
return result
},
success:function(response,trans){
if(trans.type==Ext.Direct.exceptions.SERVER){
response={}
}
Ext.form.Action.DirectSubmit.superclass.success.call(this,response)
}
});
Ext.form.Action.ACTION_TYPES={
'load':Ext.form.Action.Load,
'submit':Ext.form.Action.Submit,
'directload':Ext.form.Action.DirectLoad,
'directsubmit':Ext.form.Action.DirectSubmit
};
Ext.form.VTypes=function(){
var alpha=/^[a-zA-Z_]+$/,alphanum=/^[a-zA-Z0-9_]+$/,email=/^(\w+)([\-+.\'][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/,url=/(((^https?)|(^ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;
return{
'email':function(v){
return email.test(v)
},
'emailText':'This field should be an e-mail address in the format "user@example.com"',
'emailMask':/[a-z0-9_\.\-\+\'@]/i,
'url':function(v){
return url.test(v)
},
'urlText':'This field should be a URL in the format "http:/'+'/www.example.com"',
'alpha':function(v){
return alpha.test(v)
},
'alphaText':'This field should only contain letters and _',
'alphaMask':/[a-z_]/i,
'alphanum':function(v){
return alphanum.test(v)
},
'alphanumText':'This field should only contain letters, numbers and _',
'alphanumMask':/[a-z0-9_]/i
}
}();
Ext.grid.GridPanel=Ext.extend(Ext.Panel,{
autoExpandColumn:false,
autoExpandMax:1000,
autoExpandMin:50,
columnLines:false,
ddText:'{0} selected row{1}',
deferRowRender:true,
enableColumnHide:true,
enableColumnMove:true,
enableDragDrop:false,
enableHdMenu:true,
loadMask:false,
minColumnWidth:25,
stripeRows:false,
trackMouseOver:true,
stateEvents:[
'columnmove',
'columnresize',
'sortchange',
'groupchange'
],
view:null,
bubbleEvents:[],
rendered:false,
viewReady:false,
initComponent:function(){
Ext.grid.GridPanel.superclass.initComponent.call(this);
if(this.columnLines){
this.cls=(this.cls||'')+' x-grid-with-col-lines'
}
this.autoScroll=false;
this.autoWidth=false;
if(Ext.isArray(this.columns)){
this.colModel=new Ext.grid.ColumnModel(this.columns);
delete this.columns
}
if(this.ds){
this.store=this.ds;
delete this.ds
}
if(this.cm){
this.colModel=this.cm;
delete this.cm
}
if(this.sm){
this.selModel=this.sm;
delete this.sm
}
this.store=Ext.StoreMgr.lookup(this.store);
this.addEvents('click','dblclick','contextmenu','mousedown','mouseup','mouseover','mouseout','keypress','keydown','cellmousedown','rowmousedown','headermousedown','groupmousedown','rowbodymousedown','containermousedown','cellclick','celldblclick','rowclick','rowdblclick','headerclick','headerdblclick','groupclick','groupdblclick','containerclick','containerdblclick','rowbodyclick','rowbodydblclick','rowcontextmenu','cellcontextmenu','headercontextmenu','groupcontextmenu','containercontextmenu','rowbodycontextmenu','bodyscroll','columnresize','columnmove','sortchange','groupchange','reconfigure','viewready')
},
onRender:function(ct,position){
Ext.grid.GridPanel.superclass.onRender.apply(this,arguments);
var c=this.getGridEl();
this.el.addClass('x-grid-panel');
this.mon(c,{
scope:this,
mousedown:this.onMouseDown,
click:this.onClick,
dblclick:this.onDblClick,
contextmenu:this.onContextMenu
});
this.relayEvents(c,[
'mousedown',
'mouseup',
'mouseover',
'mouseout',
'keypress',
'keydown'
]);
var view=this.getView();
view.init(this);
view.render();
this.getSelectionModel().init(this)
},
initEvents:function(){
Ext.grid.GridPanel.superclass.initEvents.call(this);
if(this.loadMask){
this.loadMask=new Ext.LoadMask(this.bwrap,Ext.apply({store:this.store},this.loadMask))
}
},
initStateEvents:function(){
Ext.grid.GridPanel.superclass.initStateEvents.call(this);
this.mon(this.colModel,'hiddenchange',this.saveState,this,{delay:100})
},
applyState:function(state){
var cm=this.colModel,cs=state.columns,store=this.store,s,c,colIndex;
if(cs){
for(var i=0,len=cs.length;i<len;i++){
s=cs[i];
c=cm.getColumnById(s.id);
if(c){
colIndex=cm.getIndexById(s.id);
cm.setState(colIndex,{
hidden:s.hidden,
width:s.width,
sortable:s.sortable
});
if(colIndex!=i){
cm.moveColumn(colIndex,i)
}
}
}
}
if(store){
s=state.sort;
if(s){
store[store.remoteSort?'setDefaultSort':'sort'](s.field,s.direction)
}
s=state.group;
if(store.groupBy){
if(s){
store.groupBy(s)
}else{
store.clearGrouping()
}
}
}
var o=Ext.apply({},state);
delete o.columns;
delete o.sort;
Ext.grid.GridPanel.superclass.applyState.call(this,o)
},
getState:function(){
var o={columns:[]},store=this.store,ss,gs;
for(var i=0,c;c=this.colModel.config[i];i++){
o.columns[i]={
id:c.id,
width:c.width
};
if(c.hidden){
o.columns[i].hidden=true
}
if(c.sortable){
o.columns[i].sortable=true
}
}
if(store){
ss=store.getSortState();
if(ss){
o.sort=ss
}
if(store.getGroupState){
gs=store.getGroupState();
if(gs){
o.group=gs
}
}
}
return o
},
afterRender:function(){
Ext.grid.GridPanel.superclass.afterRender.call(this);
var v=this.view;
this.on('bodyresize',v.layout,v);
v.layout(true);
if(this.deferRowRender){
if(!this.deferRowRenderTask){
this.deferRowRenderTask=new Ext.util.DelayedTask(v.afterRender,this.view)
}
this.deferRowRenderTask.delay(10)
}else{
v.afterRender()
}
this.viewReady=true
},
reconfigure:function(store,colModel){
var rendered=this.rendered;
if(rendered){
if(this.loadMask){
this.loadMask.destroy();
this.loadMask=new Ext.LoadMask(this.bwrap,Ext.apply({},{store:store},this.initialConfig.loadMask))
}
}
if(this.view){
this.view.initData(store,colModel)
}
this.store=store;
this.colModel=colModel;
if(rendered){
this.view.refresh(true)
}
this.fireEvent('reconfigure',this,store,colModel)
},
onDestroy:function(){
if(this.deferRowRenderTask&&this.deferRowRenderTask.cancel){
this.deferRowRenderTask.cancel()
}
if(this.rendered){
Ext.destroy(this.view,this.loadMask)
}else if(this.store&&this.store.autoDestroy){
this.store.destroy()
}
Ext.destroy(this.colModel,this.selModel);
this.store=this.selModel=this.colModel=this.view=this.loadMask=null;
Ext.grid.GridPanel.superclass.onDestroy.call(this)
},
processEvent:function(name,e){
this.view.processEvent(name,e)
},
onClick:function(e){
this.processEvent('click',e)
},
onMouseDown:function(e){
this.processEvent('mousedown',e)
},
onContextMenu:function(e,t){
this.processEvent('contextmenu',e)
},
onDblClick:function(e){
this.processEvent('dblclick',e)
},
walkCells:function(row,col,step,fn,scope){
var cm=this.colModel,clen=cm.getColumnCount(),ds=this.store,rlen=ds.getCount(),first=true;
if(step<0){
if(col<0){
row--;
first=false
}
while(row>=0){
if(!first){
col=clen-1
}
first=false;
while(col>=0){
if(fn.call(scope||this,row,col,cm)===true){
return[
row,
col
]
}
col--
}
row--
}
}else{
if(col>=clen){
row++;
first=false
}
while(row<rlen){
if(!first){
col=0
}
first=false;
while(col<clen){
if(fn.call(scope||this,row,col,cm)===true){
return[
row,
col
]
}
col++
}
row++
}
}
return null
},
getGridEl:function(){
return this.body
},
stopEditing:Ext.emptyFn,
getSelectionModel:function(){
if(!this.selModel){
this.selModel=new Ext.grid.RowSelectionModel(this.disableSelection?{selectRow:Ext.emptyFn}:null)
}
return this.selModel
},
getStore:function(){
return this.store
},
getColumnModel:function(){
return this.colModel
},
getView:function(){
if(!this.view){
this.view=new Ext.grid.GridView(this.viewConfig)
}
return this.view
},
getDragDropText:function(){
var count=this.selModel.getCount();
return String.format(this.ddText,count,count==1?'':'s')
}
});
Ext.reg('grid',Ext.grid.GridPanel);
Ext.grid.PivotGrid=Ext.extend(Ext.grid.GridPanel,{
aggregator:'sum',
renderer:undefined,
initComponent:function(){
Ext.grid.PivotGrid.superclass.initComponent.apply(this,arguments);
this.initAxes();
this.enableColumnResize=false;
this.viewConfig=Ext.apply(this.viewConfig||{},{forceFit:true});
this.colModel=new Ext.grid.ColumnModel({})
},
getAggregator:function(){
if(typeof this.aggregator=='string'){
return Ext.grid.PivotAggregatorMgr.types[this.aggregator]
}else{
return this.aggregator
}
},
setAggregator:function(aggregator){
this.aggregator=aggregator
},
setMeasure:function(measure){
this.measure=measure
},
setLeftAxis:function(axis,refresh){
this.leftAxis=axis;
if(refresh){
this.view.refresh()
}
},
setTopAxis:function(axis,refresh){
this.topAxis=axis;
if(refresh){
this.view.refresh()
}
},
initAxes:function(){
var PivotAxis=Ext.grid.PivotAxis;
if(!(this.leftAxis instanceof PivotAxis)){
this.setLeftAxis(new PivotAxis({
orientation:'vertical',
dimensions:this.leftAxis||[],
store:this.store
}))
}
;
if(!(this.topAxis instanceof PivotAxis)){
this.setTopAxis(new PivotAxis({
orientation:'horizontal',
dimensions:this.topAxis||[],
store:this.store
}))
}
;
},
extractData:function(){
var records=this.store.data.items,recCount=records.length,cells=[],record,i,j,k;
if(recCount==0){
return[]
}
var leftTuples=this.leftAxis.getTuples(),leftCount=leftTuples.length,topTuples=this.topAxis.getTuples(),topCount=topTuples.length,aggregator=this.getAggregator();
for(i=0;i<recCount;i++){
record=records[i];
for(j=0;j<leftCount;j++){
cells[j]=cells[j]||[];
if(leftTuples[j].matcher(record)===true){
for(k=0;k<topCount;k++){
cells[j][k]=cells[j][k]||[];
if(topTuples[k].matcher(record)){
cells[j][k].push(record)
}
}
}
}
}
var rowCount=cells.length,colCount,row;
for(i=0;i<rowCount;i++){
row=cells[i];
colCount=row.length;
for(j=0;j<colCount;j++){
cells[i][j]=aggregator(cells[i][j],this.measure)
}
}
return cells
},
getView:function(){
if(!this.view){
this.view=new Ext.grid.PivotGridView(this.viewConfig)
}
return this.view
}
});
Ext.reg('pivotgrid',Ext.grid.PivotGrid);
Ext.grid.PivotAggregatorMgr=new Ext.AbstractManager;
Ext.grid.PivotAggregatorMgr.registerType('sum',function(records,measure){
var length=records.length,total=0,i;
for(i=0;i<length;i++){
total+=records[i].get(measure)
}
return total
});
Ext.grid.PivotAggregatorMgr.registerType('avg',function(records,measure){
var length=records.length,total=0,i;
for(i=0;i<length;i++){
total+=records[i].get(measure)
}
return total/length||'n/a'
});
Ext.grid.PivotAggregatorMgr.registerType('min',function(records,measure){
var data=[],length=records.length,i;
for(i=0;i<length;i++){
data.push(records[i].get(measure))
}
return Math.min.apply(this,data)||'n/a'
});
Ext.grid.PivotAggregatorMgr.registerType('max',function(records,measure){
var data=[],length=records.length,i;
for(i=0;i<length;i++){
data.push(records[i].get(measure))
}
return Math.max.apply(this,data)||'n/a'
});
Ext.grid.PivotAggregatorMgr.registerType('count',function(records,measure){
return records.length
});
Ext.grid.GridView=Ext.extend(Ext.util.Observable,{
deferEmptyText:true,
scrollOffset:undefined,
autoFill:false,
forceFit:false,
sortClasses:[
'sort-asc',
'sort-desc'
],
sortAscText:'Sort Ascending',
sortDescText:'Sort Descending',
columnsText:'Columns',
selectedRowClass:'x-grid3-row-selected',
borderWidth:2,
tdClass:'x-grid3-cell',
hdCls:'x-grid3-hd',
markDirty:true,
cellSelectorDepth:4,
rowSelectorDepth:10,
rowBodySelectorDepth:10,
cellSelector:'td.x-grid3-cell',
rowSelector:'div.x-grid3-row',
rowBodySelector:'div.x-grid3-row-body',
firstRowCls:'x-grid3-row-first',
lastRowCls:'x-grid3-row-last',
rowClsRe:/(?:^|\s+)x-grid3-row-(first|last|alt)(?:\s+|$)/g,
headerMenuOpenCls:'x-grid3-hd-menu-open',
rowOverCls:'x-grid3-row-over',
constructor:function(config){
Ext.apply(this,config);
this.addEvents('beforerowremoved','beforerowsinserted','beforerefresh','rowremoved','rowsinserted','rowupdated','refresh');
Ext.grid.GridView.superclass.constructor.call(this)
},
masterTpl:new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header">','<div class="x-grid3-header-inner">','<div class="x-grid3-header-offset" style="{ostyle}">{header}</div>','</div>','<div class="x-clear"></div>','</div>','<div class="x-grid3-scroller">','<div class="x-grid3-body" style="{bstyle}">{body}</div>','<a href="#" class="x-grid3-focus" tabIndex="-1"></a>','</div>','</div>','<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>','</div>'),
headerTpl:new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<thead>','<tr class="x-grid3-hd-row">{cells}</tr>','</thead>','</table>'),
bodyTpl:new Ext.Template('{rows}'),
cellTpl:new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>','</td>'),
initTemplates:function(){
var templates=this.templates||{},template,name,headerCellTpl=new Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':'','{value}','<img alt="" class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />','</div>','</td>'),rowBodyText=[
'<tr class="x-grid3-row-body-tr" style="{bodyStyle}">',
'<td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on">',
'<div class="x-grid3-row-body">{body}</div>',
'</td>',
'</tr>'
].join(''),innerText=[
'<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',
'<tbody>',
'<tr>{cells}</tr>',
this.enableRowBody?rowBodyText:'',
'</tbody>',
'</table>'
].join('');
Ext.applyIf(templates,{
hcell:headerCellTpl,
cell:this.cellTpl,
body:this.bodyTpl,
header:this.headerTpl,
master:this.masterTpl,
row:new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}">'+innerText+'</div>'),
rowInner:new Ext.Template(innerText)
});
for(name in templates){
template=templates[name];
if(template&&Ext.isFunction(template.compile)&&!template.compiled){
template.disableFormats=true;
template.compile()
}
}
this.templates=templates;
this.colRe=new RegExp('x-grid3-td-([^\\s]+)','')
},
fly:function(el){
if(!this._flyweight){
this._flyweight=new Ext.Element.Flyweight(document.body)
}
this._flyweight.dom=el;
return this._flyweight
},
getEditorParent:function(){
return this.scroller.dom
},
initElements:function(){
var Element=Ext.Element,el=Ext.get(this.grid.getGridEl().dom.firstChild),mainWrap=new Element(el.child('div.x-grid3-viewport')),mainHd=new Element(mainWrap.child('div.x-grid3-header')),scroller=new Element(mainWrap.child('div.x-grid3-scroller'));
if(this.grid.hideHeaders){
mainHd.setDisplayed(false)
}
if(this.forceFit){
scroller.setStyle('overflow-x','hidden')
}
Ext.apply(this,{
el:el,
mainWrap:mainWrap,
scroller:scroller,
mainHd:mainHd,
innerHd:mainHd.child('div.x-grid3-header-inner').dom,
mainBody:new Element(Element.fly(scroller).child('div.x-grid3-body')),
focusEl:new Element(Element.fly(scroller).child('a')),
resizeMarker:new Element(el.child('div.x-grid3-resize-marker')),
resizeProxy:new Element(el.child('div.x-grid3-resize-proxy'))
});
this.focusEl.swallowEvent('click',true)
},
getRows:function(){
return this.hasRows()?this.mainBody.dom.childNodes:[]
},
findCell:function(el){
if(!el){
return false
}
return this.fly(el).findParent(this.cellSelector,this.cellSelectorDepth)
},
findCellIndex:function(el,requiredCls){
var cell=this.findCell(el),hasCls;
if(cell){
hasCls=this.fly(cell).hasClass(requiredCls);
if(!requiredCls||hasCls){
return this.getCellIndex(cell)
}
}
return false
},
getCellIndex:function(el){
if(el){
var match=el.className.match(this.colRe);
if(match&&match[1]){
return this.cm.getIndexById(match[1])
}
}
return false
},
findHeaderCell:function(el){
var cell=this.findCell(el);
return cell&&this.fly(cell).hasClass(this.hdCls)?cell:null
},
findHeaderIndex:function(el){
return this.findCellIndex(el,this.hdCls)
},
findRow:function(el){
if(!el){
return false
}
return this.fly(el).findParent(this.rowSelector,this.rowSelectorDepth)
},
findRowIndex:function(el){
var row=this.findRow(el);
return row?row.rowIndex:false
},
findRowBody:function(el){
if(!el){
return false
}
return this.fly(el).findParent(this.rowBodySelector,this.rowBodySelectorDepth)
},
getRow:function(row){
return this.getRows()[row]
},
getCell:function(row,col){
return Ext.fly(this.getRow(row)).query(this.cellSelector)[col]
},
getHeaderCell:function(index){
return this.mainHd.dom.getElementsByTagName('td')[index]
},
addRowClass:function(rowId,cls){
var row=this.getRow(rowId);
if(row){
this.fly(row).addClass(cls)
}
},
removeRowClass:function(row,cls){
var r=this.getRow(row);
if(r){
this.fly(r).removeClass(cls)
}
},
removeRow:function(row){
Ext.removeNode(this.getRow(row));
this.syncFocusEl(row)
},
removeRows:function(firstRow,lastRow){
var bd=this.mainBody.dom,rowIndex;
for(rowIndex=firstRow;rowIndex<=lastRow;rowIndex++){
Ext.removeNode(bd.childNodes[firstRow])
}
this.syncFocusEl(firstRow)
},
getScrollState:function(){
var sb=this.scroller.dom;
return{
left:sb.scrollLeft,
top:sb.scrollTop
}
},
restoreScroll:function(state){
var sb=this.scroller.dom;
sb.scrollLeft=state.left;
sb.scrollTop=state.top
},
scrollToTop:function(){
var dom=this.scroller.dom;
dom.scrollTop=0;
dom.scrollLeft=0
},
syncScroll:function(){
this.syncHeaderScroll();
var mb=this.scroller.dom;
this.grid.fireEvent('bodyscroll',mb.scrollLeft,mb.scrollTop)
},
syncHeaderScroll:function(){
var innerHd=this.innerHd,scrollLeft=this.scroller.dom.scrollLeft;
innerHd.scrollLeft=scrollLeft;
innerHd.scrollLeft=scrollLeft
},
updateSortIcon:function(col,dir){
var sortClasses=this.sortClasses,sortClass=sortClasses[dir=='DESC'?1:0],headers=this.mainHd.select('td').removeClass(sortClasses);
headers.item(col).addClass(sortClass)
},
updateAllColumnWidths:function(){
var totalWidth=this.getTotalWidth(),colCount=this.cm.getColumnCount(),rows=this.getRows(),rowCount=rows.length,widths=[],row,rowFirstChild,trow,i,j;
for(i=0;i<colCount;i++){
widths[i]=this.getColumnWidth(i);
this.getHeaderCell(i).style.width=widths[i]
}
this.updateHeaderWidth();
for(i=0;i<rowCount;i++){
row=rows[i];
row.style.width=totalWidth;
rowFirstChild=row.firstChild;
if(rowFirstChild){
rowFirstChild.style.width=totalWidth;
trow=rowFirstChild.rows[0];
for(j=0;j<colCount;j++){
trow.childNodes[j].style.width=widths[j]
}
}
}
this.onAllColumnWidthsUpdated(widths,totalWidth)
},
updateColumnWidth:function(column,width){
var columnWidth=this.getColumnWidth(column),totalWidth=this.getTotalWidth(),headerCell=this.getHeaderCell(column),nodes=this.getRows(),nodeCount=nodes.length,row,i,firstChild;
this.updateHeaderWidth();
headerCell.style.width=columnWidth;
for(i=0;i<nodeCount;i++){
row=nodes[i];
firstChild=row.firstChild;
row.style.width=totalWidth;
if(firstChild){
firstChild.style.width=totalWidth;
firstChild.rows[0].childNodes[column].style.width=columnWidth
}
}
this.onColumnWidthUpdated(column,columnWidth,totalWidth)
},
updateColumnHidden:function(col,hidden){
var totalWidth=this.getTotalWidth(),display=hidden?'none':'',headerCell=this.getHeaderCell(col),nodes=this.getRows(),nodeCount=nodes.length,row,rowFirstChild,i;
this.updateHeaderWidth();
headerCell.style.display=display;
for(i=0;i<nodeCount;i++){
row=nodes[i];
row.style.width=totalWidth;
rowFirstChild=row.firstChild;
if(rowFirstChild){
rowFirstChild.style.width=totalWidth;
rowFirstChild.rows[0].childNodes[col].style.display=display
}
}
this.onColumnHiddenUpdated(col,hidden,totalWidth);
delete this.lastViewWidth;
this.layout()
},
doRender:function(columns,records,store,startRow,colCount,stripe){
var templates=this.templates,cellTemplate=templates.cell,rowTemplate=templates.row,last=colCount-1,tstyle='width:'+this.getTotalWidth()+';',rowBuffer=[],colBuffer=[],rowParams={tstyle:tstyle},meta={},len=records.length,alt,column,record,i,j,rowIndex;
for(j=0;j<len;j++){
record=records[j];
colBuffer=[];
rowIndex=j+startRow;
for(i=0;i<colCount;i++){
column=columns[i];
meta.id=column.id;
meta.css=i===0?'x-grid3-cell-first ':i==last?'x-grid3-cell-last ':'';
meta.attr=meta.cellAttr='';
meta.style=column.style;
meta.value=column.renderer.call(column.scope,record.data[column.name],meta,record,rowIndex,i,store);
if(Ext.isEmpty(meta.value)){
meta.value='&#160;'
}
if(this.markDirty&&record.dirty&&typeof record.modified[column.name]!='undefined'){
meta.css+=' x-grid3-dirty-cell'
}
colBuffer[colBuffer.length]=cellTemplate.apply(meta)
}
alt=[];
if(stripe&&(rowIndex+1)%2===0){
alt[0]='x-grid3-row-alt'
}
if(record.dirty){
alt[1]=' x-grid3-dirty-row'
}
rowParams.cols=colCount;
if(this.getRowClass){
alt[2]=this.getRowClass(record,rowIndex,rowParams,store)
}
rowParams.alt=alt.join(' ');
rowParams.cells=colBuffer.join('');
rowBuffer[rowBuffer.length]=rowTemplate.apply(rowParams)
}
return rowBuffer.join('')
},
processRows:function(startRow,skipStripe){
if(!this.ds||this.ds.getCount()<1){
return
}
var rows=this.getRows(),length=rows.length,row,i;
skipStripe=skipStripe||!this.grid.stripeRows;
startRow=startRow||0;
for(i=0;i<length;i++){
row=rows[i];
if(row){
row.rowIndex=i;
if(!skipStripe){
row.className=row.className.replace(this.rowClsRe,' ');
if((i+1)%2===0){
row.className+=' x-grid3-row-alt'
}
}
}
}
if(startRow===0){
Ext.fly(rows[0]).addClass(this.firstRowCls)
}
Ext.fly(rows[length-1]).addClass(this.lastRowCls)
},
afterRender:function(){
if(!this.ds||!this.cm){
return
}
this.mainBody.dom.innerHTML=this.renderBody()||'&#160;';
this.processRows(0,true);
if(this.deferEmptyText!==true){
this.applyEmptyText()
}
this.grid.fireEvent('viewready',this.grid)
},
afterRenderUI:function(){
var grid=this.grid;
this.initElements();
Ext.fly(this.innerHd).on('click',this.handleHdDown,this);
this.mainHd.on({
scope:this,
mouseover:this.handleHdOver,
mouseout:this.handleHdOut,
mousemove:this.handleHdMove
});
this.scroller.on('scroll',this.syncScroll,this);
if(grid.enableColumnResize!==false){
this.splitZone=new Ext.grid.GridView.SplitDragZone(grid,this.mainHd.dom)
}
if(grid.enableColumnMove){
this.columnDrag=new Ext.grid.GridView.ColumnDragZone(grid,this.innerHd);
this.columnDrop=new Ext.grid.HeaderDropZone(grid,this.mainHd.dom)
}
if(grid.enableHdMenu!==false){
this.hmenu=new Ext.menu.Menu({id:grid.id+'-hctx'});
this.hmenu.add({
itemId:'asc',
text:this.sortAscText,
cls:'xg-hmenu-sort-asc'
},{
itemId:'desc',
text:this.sortDescText,
cls:'xg-hmenu-sort-desc'
});
if(grid.enableColumnHide!==false){
this.colMenu=new Ext.menu.Menu({id:grid.id+'-hcols-menu'});
this.colMenu.on({
scope:this,
beforeshow:this.beforeColMenuShow,
itemclick:this.handleHdMenuClick
});
this.hmenu.add('-',{
itemId:'columns',
hideOnClick:false,
text:this.columnsText,
menu:this.colMenu,
iconCls:'x-cols-icon'
})
}
this.hmenu.on('itemclick',this.handleHdMenuClick,this)
}
if(grid.trackMouseOver){
this.mainBody.on({
scope:this,
mouseover:this.onRowOver,
mouseout:this.onRowOut
})
}
if(grid.enableDragDrop||grid.enableDrag){
this.dragZone=new Ext.grid.GridDragZone(grid,{ddGroup:grid.ddGroup||'GridDD'})
}
this.updateHeaderSortState()
},
renderUI:function(){
var templates=this.templates;
return templates.master.apply({
body:templates.body.apply({rows:'&#160;'}),
header:this.renderHeaders(),
ostyle:'width:'+this.getOffsetWidth()+';',
bstyle:'width:'+this.getTotalWidth()+';'
})
},
processEvent:function(name,e){
var target=e.getTarget(),grid=this.grid,header=this.findHeaderIndex(target),row,cell,col,body;
grid.fireEvent(name,e);
if(header!==false){
grid.fireEvent('header'+name,grid,header,e)
}else{
row=this.findRowIndex(target);
if(row!==false){
cell=this.findCellIndex(target);
if(cell!==false){
col=grid.colModel.getColumnAt(cell);
if(grid.fireEvent('cell'+name,grid,row,cell,e)!==false){
if(!col||col.processEvent&&col.processEvent(name,e,grid,row,cell)!==false){
grid.fireEvent('row'+name,grid,row,e)
}
}
}else{
if(grid.fireEvent('row'+name,grid,row,e)!==false){
(body=this.findRowBody(target))&&grid.fireEvent('rowbody'+name,grid,row,e)
}
}
}else{
grid.fireEvent('container'+name,grid,e)
}
}
},
layout:function(initial){
if(!this.mainBody){
return
}
var grid=this.grid,gridEl=grid.getGridEl(),gridSize=gridEl.getSize(true),gridWidth=gridSize.width,gridHeight=gridSize.height,scroller=this.scroller,scrollStyle,headerHeight,scrollHeight;
if(gridWidth<20||gridHeight<20){
return
}
if(grid.autoHeight){
scrollStyle=scroller.dom.style;
scrollStyle.overflow='visible';
if(Ext.isWebKit){
scrollStyle.position='static'
}
}else{
this.el.setSize(gridWidth,gridHeight);
headerHeight=this.mainHd.getHeight();
scrollHeight=gridHeight-headerHeight;
scroller.setSize(gridWidth,scrollHeight);
if(this.innerHd){
this.innerHd.style.width=gridWidth+'px'
}
}
if(this.forceFit||initial===true&&this.autoFill){
if(this.lastViewWidth!=gridWidth){
this.fitColumns(false,false);
this.lastViewWidth=gridWidth
}
}else{
this.autoExpand();
this.syncHeaderScroll()
}
this.onLayout(gridWidth,scrollHeight)
},
onLayout:function(vw,vh){
},
onColumnWidthUpdated:function(col,w,tw){
},
onAllColumnWidthsUpdated:function(ws,tw){
},
onColumnHiddenUpdated:function(col,hidden,tw){
},
updateColumnText:function(col,text){
},
afterMove:function(colIndex){
},
init:function(grid){
this.grid=grid;
this.initTemplates();
this.initData(grid.store,grid.colModel);
this.initUI(grid)
},
getColumnId:function(index){
return this.cm.getColumnId(index)
},
getOffsetWidth:function(){
return this.cm.getTotalWidth()+this.getScrollOffset()+'px'
},
getScrollOffset:function(){
return Ext.num(this.scrollOffset,Ext.getScrollBarWidth())
},
renderHeaders:function(){
var colModel=this.cm,templates=this.templates,headerTpl=templates.hcell,properties={},colCount=colModel.getColumnCount(),last=colCount-1,cells=[],i,cssCls;
for(i=0;i<colCount;i++){
if(i==0){
cssCls='x-grid3-cell-first '
}else{
cssCls=i==last?'x-grid3-cell-last ':''
}
properties={
id:colModel.getColumnId(i),
value:colModel.getColumnHeader(i)||'',
style:this.getColumnStyle(i,true),
css:cssCls,
tooltip:this.getColumnTooltip(i)
};
if(colModel.config[i].align=='right'){
properties.istyle='padding-right: 16px;'
}else{
delete properties.istyle
}
cells[i]=headerTpl.apply(properties)
}
return templates.header.apply({
cells:cells.join(''),
tstyle:String.format('width: {0};',this.getTotalWidth())
})
},
getColumnTooltip:function(i){
var tooltip=this.cm.getColumnTooltip(i);
if(tooltip){
if(Ext.QuickTips.isEnabled()){
return'ext:qtip="'+tooltip+'"'
}else{
return'title="'+tooltip+'"'
}
}
return''
},
beforeUpdate:function(){
this.grid.stopEditing(true)
},
updateHeaders:function(){
this.innerHd.firstChild.innerHTML=this.renderHeaders();
this.updateHeaderWidth(false)
},
updateHeaderWidth:function(updateMain){
var innerHdChild=this.innerHd.firstChild,totalWidth=this.getTotalWidth();
innerHdChild.style.width=this.getOffsetWidth();
innerHdChild.firstChild.style.width=totalWidth;
if(updateMain!==false){
this.mainBody.dom.style.width=totalWidth
}
},
focusRow:function(row){
this.focusCell(row,0,false)
},
focusCell:function(row,col,hscroll){
this.syncFocusEl(this.ensureVisible(row,col,hscroll));
var focusEl=this.focusEl;
if(Ext.isGecko){
focusEl.focus()
}else{
focusEl.focus.defer(1,focusEl)
}
},
resolveCell:function(row,col,hscroll){
if(!Ext.isNumber(row)){
row=row.rowIndex
}
if(!this.ds){
return null
}
if(row<0||row>=this.ds.getCount()){
return null
}
col=col!==undefined?col:0;
var rowEl=this.getRow(row),colModel=this.cm,colCount=colModel.getColumnCount(),cellEl;
if(!(hscroll===false&&col===0)){
while(col<colCount&&colModel.isHidden(col)){
col++
}
cellEl=this.getCell(row,col)
}
return{
row:rowEl,
cell:cellEl
}
},
getResolvedXY:function(resolved){
if(!resolved){
return null
}
var cell=resolved.cell,row=resolved.row;
if(cell){
return Ext.fly(cell).getXY()
}else{
return[
this.el.getX(),
Ext.fly(row).getY()
]
}
},
syncFocusEl:function(row,col,hscroll){
var xy=row;
if(!Ext.isArray(xy)){
row=Math.min(row,Math.max(0,this.getRows().length-1));
if(isNaN(row)){
return
}
xy=this.getResolvedXY(this.resolveCell(row,col,hscroll))
}
this.focusEl.setXY(xy||this.scroller.getXY())
},
ensureVisible:function(row,col,hscroll){
var resolved=this.resolveCell(row,col,hscroll);
if(!resolved||!resolved.row){
return null
}
var rowEl=resolved.row,cellEl=resolved.cell,c=this.scroller.dom,p=rowEl,ctop=0,stop=this.el.dom;
while(p&&p!=stop){
ctop+=p.offsetTop;
p=p.offsetParent
}
ctop-=this.mainHd.dom.offsetHeight;
stop=parseInt(c.scrollTop,10);
var cbot=ctop+rowEl.offsetHeight,ch=c.clientHeight,sbot=stop+ch;
if(ctop<stop){
c.scrollTop=ctop
}else if(cbot>sbot){
c.scrollTop=cbot-ch
}
if(hscroll!==false){
var cleft=parseInt(cellEl.offsetLeft,10),cright=cleft+cellEl.offsetWidth,sleft=parseInt(c.scrollLeft,10),sright=sleft+c.clientWidth;
if(cleft<sleft){
c.scrollLeft=cleft
}else if(cright>sright){
c.scrollLeft=cright-c.clientWidth
}
}
return this.getResolvedXY(resolved)
},
insertRows:function(dm,firstRow,lastRow,isUpdate){
var last=dm.getCount()-1;
if(!isUpdate&&firstRow===0&&lastRow>=last){
this.fireEvent('beforerowsinserted',this,firstRow,lastRow);
this.refresh();
this.fireEvent('rowsinserted',this,firstRow,lastRow)
}else{
if(!isUpdate){
this.fireEvent('beforerowsinserted',this,firstRow,lastRow)
}
var html=this.renderRows(firstRow,lastRow),before=this.getRow(firstRow);
if(before){
if(firstRow===0){
Ext.fly(this.getRow(0)).removeClass(this.firstRowCls)
}
Ext.DomHelper.insertHtml('beforeBegin',before,html)
}else{
var r=this.getRow(last-1);
if(r){
Ext.fly(r).removeClass(this.lastRowCls)
}
Ext.DomHelper.insertHtml('beforeEnd',this.mainBody.dom,html)
}
if(!isUpdate){
this.processRows(firstRow);
this.fireEvent('rowsinserted',this,firstRow,lastRow)
}else if(firstRow===0||firstRow>=last){
Ext.fly(this.getRow(firstRow)).addClass(firstRow===0?this.firstRowCls:this.lastRowCls)
}
}
this.syncFocusEl(firstRow)
},
deleteRows:function(dm,firstRow,lastRow){
if(dm.getRowCount()<1){
this.refresh()
}else{
this.fireEvent('beforerowsdeleted',this,firstRow,lastRow);
this.removeRows(firstRow,lastRow);
this.processRows(firstRow);
this.fireEvent('rowsdeleted',this,firstRow,lastRow)
}
},
getColumnStyle:function(colIndex,isHeader){
var colModel=this.cm,colConfig=colModel.config,style=isHeader?'':colConfig[colIndex].css||'',align=colConfig[colIndex].align;
style+=String.format('width: {0};',this.getColumnWidth(colIndex));
if(colModel.isHidden(colIndex)){
style+='display: none; '
}
if(align){
style+=String.format('text-align: {0};',align)
}
return style
},
getColumnWidth:function(column){
var columnWidth=this.cm.getColumnWidth(column),borderWidth=this.borderWidth;
if(Ext.isNumber(columnWidth)){
if(Ext.isBorderBox||Ext.isWebKit&&!Ext.isSafari2){
return columnWidth+'px'
}else{
return Math.max(columnWidth-borderWidth,0)+'px'
}
}else{
return columnWidth
}
},
getTotalWidth:function(){
return this.cm.getTotalWidth()+'px'
},
fitColumns:function(preventRefresh,onlyExpand,omitColumn){
var grid=this.grid,colModel=this.cm,totalColWidth=colModel.getTotalWidth(false),gridWidth=this.getGridInnerWidth(),extraWidth=gridWidth-totalColWidth,columns=[],extraCol=0,width=0,colWidth,fraction,i;
if(gridWidth<20||extraWidth===0){
return false
}
var visibleColCount=colModel.getColumnCount(true),totalColCount=colModel.getColumnCount(false),adjCount=visibleColCount-(Ext.isNumber(omitColumn)?1:0);
if(adjCount===0){
adjCount=1;
omitColumn=undefined
}
for(i=0;i<totalColCount;i++){
if(!colModel.isFixed(i)&&i!==omitColumn){
colWidth=colModel.getColumnWidth(i);
columns.push(i,colWidth);
if(!colModel.isHidden(i)){
extraCol=i;
width+=colWidth
}
}
}
fraction=(gridWidth-colModel.getTotalWidth())/width;
while(columns.length){
colWidth=columns.pop();
i=columns.pop();
colModel.setColumnWidth(i,Math.max(grid.minColumnWidth,Math.floor(colWidth+colWidth*fraction)),true)
}
totalColWidth=colModel.getTotalWidth(false);
if(totalColWidth>gridWidth){
var adjustCol=adjCount==visibleColCount?extraCol:omitColumn,newWidth=Math.max(1,colModel.getColumnWidth(adjustCol)-(totalColWidth-gridWidth));
colModel.setColumnWidth(adjustCol,newWidth,true)
}
if(preventRefresh!==true){
this.updateAllColumnWidths()
}
return true
},
autoExpand:function(preventUpdate){
var grid=this.grid,colModel=this.cm,gridWidth=this.getGridInnerWidth(),totalColumnWidth=colModel.getTotalWidth(false),autoExpandColumn=grid.autoExpandColumn;
if(!this.userResized&&autoExpandColumn){
if(gridWidth!=totalColumnWidth){
var colIndex=colModel.getIndexById(autoExpandColumn),currentWidth=colModel.getColumnWidth(colIndex),desiredWidth=gridWidth-totalColumnWidth+currentWidth,newWidth=Math.min(Math.max(desiredWidth,grid.autoExpandMin),grid.autoExpandMax);
if(currentWidth!=newWidth){
colModel.setColumnWidth(colIndex,newWidth,true);
if(preventUpdate!==true){
this.updateColumnWidth(colIndex,newWidth)
}
}
}
}
},
getGridInnerWidth:function(){
return this.grid.getGridEl().getWidth(true)-this.getScrollOffset()
},
getColumnData:function(){
var columns=[],colModel=this.cm,colCount=colModel.getColumnCount(),fields=this.ds.fields,i,name;
for(i=0;i<colCount;i++){
name=colModel.getDataIndex(i);
columns[i]={
name:Ext.isDefined(name)?name:fields.get(i)?fields.get(i).name:undefined,
renderer:colModel.getRenderer(i),
scope:colModel.getRendererScope(i),
id:colModel.getColumnId(i),
style:this.getColumnStyle(i)
}
}
return columns
},
renderRows:function(startRow,endRow){
var grid=this.grid,store=grid.store,stripe=grid.stripeRows,colModel=grid.colModel,colCount=colModel.getColumnCount(),rowCount=store.getCount(),records;
if(rowCount<1){
return''
}
startRow=startRow||0;
endRow=Ext.isDefined(endRow)?endRow:rowCount-1;
records=store.getRange(startRow,endRow);
return this.doRender(this.getColumnData(),records,store,startRow,colCount,stripe)
},
renderBody:function(){
var markup=this.renderRows()||'&#160;';
return this.templates.body.apply({rows:markup})
},
refreshRow:function(record){
var store=this.ds,colCount=this.cm.getColumnCount(),columns=this.getColumnData(),last=colCount-1,cls=['x-grid3-row'],rowParams={tstyle:String.format('width: {0};',this.getTotalWidth())},colBuffer=[],cellTpl=this.templates.cell,rowIndex,row,column,meta,css,i;
if(Ext.isNumber(record)){
rowIndex=record;
record=store.getAt(rowIndex)
}else{
rowIndex=store.indexOf(record)
}
if(!record||rowIndex<0){
return
}
for(i=0;i<colCount;i++){
column=columns[i];
if(i==0){
css='x-grid3-cell-first'
}else{
css=i==last?'x-grid3-cell-last ':''
}
meta={
id:column.id,
style:column.style,
css:css,
attr:'',
cellAttr:''
};
meta.value=column.renderer.call(column.scope,record.data[column.name],meta,record,rowIndex,i,store);
if(Ext.isEmpty(meta.value)){
meta.value='&#160;'
}
if(this.markDirty&&record.dirty&&typeof record.modified[column.name]!='undefined'){
meta.css+=' x-grid3-dirty-cell'
}
colBuffer[i]=cellTpl.apply(meta)
}
row=this.getRow(rowIndex);
row.className='';
if(this.grid.stripeRows&&(rowIndex+1)%2===0){
cls.push('x-grid3-row-alt')
}
if(this.getRowClass){
rowParams.cols=colCount;
cls.push(this.getRowClass(record,rowIndex,rowParams,store))
}
this.fly(row).addClass(cls).setStyle(rowParams.tstyle);
rowParams.cells=colBuffer.join('');
row.innerHTML=this.templates.rowInner.apply(rowParams);
this.fireEvent('rowupdated',this,rowIndex,record)
},
refresh:function(headersToo){
this.fireEvent('beforerefresh',this);
this.grid.stopEditing(true);
var result=this.renderBody();
this.mainBody.update(result).setWidth(this.getTotalWidth());
if(headersToo===true){
this.updateHeaders();
this.updateHeaderSortState()
}
this.processRows(0,true);
this.layout();
this.applyEmptyText();
this.fireEvent('refresh',this)
},
applyEmptyText:function(){
if(this.emptyText&&!this.hasRows()){
this.mainBody.update('<div class="x-grid-empty">'+this.emptyText+'</div>')
}
},
updateHeaderSortState:function(){
var state=this.ds.getSortState();
if(!state){
return
}
if(!this.sortState||(this.sortState.field!=state.field||this.sortState.direction!=state.direction)){
this.grid.fireEvent('sortchange',this.grid,state)
}
this.sortState=state;
var sortColumn=this.cm.findColumnIndex(state.field);
if(sortColumn!=-1){
var sortDir=state.direction;
this.updateSortIcon(sortColumn,sortDir)
}
},
clearHeaderSortState:function(){
if(!this.sortState){
return
}
this.grid.fireEvent('sortchange',this.grid,null);
this.mainHd.select('td').removeClass(this.sortClasses);
delete this.sortState
},
destroy:function(){
var me=this,grid=me.grid,gridEl=grid.getGridEl(),dragZone=me.dragZone,splitZone=me.splitZone,columnDrag=me.columnDrag,columnDrop=me.columnDrop,scrollToTopTask=me.scrollToTopTask,columnDragData,columnDragProxy;
if(scrollToTopTask&&scrollToTopTask.cancel){
scrollToTopTask.cancel()
}
Ext.destroyMembers(me,'colMenu','hmenu');
me.initData(null,null);
me.purgeListeners();
Ext.fly(me.innerHd).un('click',me.handleHdDown,me);
if(grid.enableColumnMove){
columnDragData=columnDrag.dragData;
columnDragProxy=columnDrag.proxy;
Ext.destroy(columnDrag.el,columnDragProxy.ghost,columnDragProxy.el,columnDrop.el,columnDrop.proxyTop,columnDrop.proxyBottom,columnDragData.ddel,columnDragData.header);
if(columnDragProxy.anim){
Ext.destroy(columnDragProxy.anim)
}
delete columnDragProxy.ghost;
delete columnDragData.ddel;
delete columnDragData.header;
columnDrag.destroy();
delete Ext.dd.DDM.locationCache[columnDrag.id];
delete columnDrag._domRef;
delete columnDrop.proxyTop;
delete columnDrop.proxyBottom;
columnDrop.destroy();
delete Ext.dd.DDM.locationCache['gridHeader'+gridEl.id];
delete columnDrop._domRef;
delete Ext.dd.DDM.ids[columnDrop.ddGroup]
}
if(splitZone){
splitZone.destroy();
delete splitZone._domRef;
delete Ext.dd.DDM.ids['gridSplitters'+gridEl.id]
}
Ext.fly(me.innerHd).removeAllListeners();
Ext.removeNode(me.innerHd);
delete me.innerHd;
Ext.destroy(me.el,me.mainWrap,me.mainHd,me.scroller,me.mainBody,me.focusEl,me.resizeMarker,me.resizeProxy,me.activeHdBtn,me._flyweight,dragZone,splitZone);
delete grid.container;
if(dragZone){
dragZone.destroy()
}
Ext.dd.DDM.currentTarget=null;
delete Ext.dd.DDM.locationCache[gridEl.id];
Ext.EventManager.removeResizeListener(me.onWindowResize,me)
},
onDenyColumnHide:function(){
},
render:function(){
if(this.autoFill){
var ct=this.grid.ownerCt;
if(ct&&ct.getLayout()){
ct.on('afterlayout',function(){
this.fitColumns(true,true);
this.updateHeaders();
this.updateHeaderSortState()
},this,{single:true})
}
}else if(this.forceFit){
this.fitColumns(true,false)
}else if(this.grid.autoExpandColumn){
this.autoExpand(true)
}
this.grid.getGridEl().dom.innerHTML=this.renderUI();
this.afterRenderUI()
},
initData:function(newStore,newColModel){
var me=this;
if(me.ds){
var oldStore=me.ds;
oldStore.un('add',me.onAdd,me);
oldStore.un('load',me.onLoad,me);
oldStore.un('clear',me.onClear,me);
oldStore.un('remove',me.onRemove,me);
oldStore.un('update',me.onUpdate,me);
oldStore.un('datachanged',me.onDataChange,me);
if(oldStore!==newStore&&oldStore.autoDestroy){
oldStore.destroy()
}
}
if(newStore){
newStore.on({
scope:me,
load:me.onLoad,
add:me.onAdd,
remove:me.onRemove,
update:me.onUpdate,
clear:me.onClear,
datachanged:me.onDataChange
})
}
if(me.cm){
var oldColModel=me.cm;
oldColModel.un('configchange',me.onColConfigChange,me);
oldColModel.un('widthchange',me.onColWidthChange,me);
oldColModel.un('headerchange',me.onHeaderChange,me);
oldColModel.un('hiddenchange',me.onHiddenChange,me);
oldColModel.un('columnmoved',me.onColumnMove,me)
}
if(newColModel){
delete me.lastViewWidth;
newColModel.on({
scope:me,
configchange:me.onColConfigChange,
widthchange:me.onColWidthChange,
headerchange:me.onHeaderChange,
hiddenchange:me.onHiddenChange,
columnmoved:me.onColumnMove
})
}
me.ds=newStore;
me.cm=newColModel
},
onDataChange:function(){
this.refresh(true);
this.updateHeaderSortState();
this.syncFocusEl(0)
},
onClear:function(){
this.refresh();
this.syncFocusEl(0)
},
onUpdate:function(store,record){
this.refreshRow(record)
},
onAdd:function(store,records,index){
this.insertRows(store,index,index+(records.length-1))
},
onRemove:function(store,record,index,isUpdate){
if(isUpdate!==true){
this.fireEvent('beforerowremoved',this,index,record)
}
this.removeRow(index);
if(isUpdate!==true){
this.processRows(index);
this.applyEmptyText();
this.fireEvent('rowremoved',this,index,record)
}
},
onLoad:function(){
if(Ext.isGecko){
if(!this.scrollToTopTask){
this.scrollToTopTask=new Ext.util.DelayedTask(this.scrollToTop,this)
}
this.scrollToTopTask.delay(1)
}else{
this.scrollToTop()
}
},
onColWidthChange:function(cm,col,width){
this.updateColumnWidth(col,width)
},
onHeaderChange:function(cm,col,text){
this.updateHeaders()
},
onHiddenChange:function(cm,col,hidden){
this.updateColumnHidden(col,hidden)
},
onColumnMove:function(cm,oldIndex,newIndex){
this.indexMap=null;
this.refresh(true);
this.restoreScroll(this.getScrollState());
this.afterMove(newIndex);
this.grid.fireEvent('columnmove',oldIndex,newIndex)
},
onColConfigChange:function(){
delete this.lastViewWidth;
this.indexMap=null;
this.refresh(true)
},
initUI:function(grid){
grid.on('headerclick',this.onHeaderClick,this)
},
initEvents:Ext.emptyFn,
onHeaderClick:function(g,index){
if(this.headersDisabled||!this.cm.isSortable(index)){
return
}
g.stopEditing(true);
g.store.sort(this.cm.getDataIndex(index))
},
onRowOver:function(e,target){
var row=this.findRowIndex(target);
if(row!==false){
this.addRowClass(row,this.rowOverCls)
}
},
onRowOut:function(e,target){
var row=this.findRowIndex(target);
if(row!==false&&!e.within(this.getRow(row),true)){
this.removeRowClass(row,this.rowOverCls)
}
},
onRowSelect:function(row){
this.addRowClass(row,this.selectedRowClass)
},
onRowDeselect:function(row){
this.removeRowClass(row,this.selectedRowClass)
},
onCellSelect:function(row,col){
var cell=this.getCell(row,col);
if(cell){
this.fly(cell).addClass('x-grid3-cell-selected')
}
},
onCellDeselect:function(row,col){
var cell=this.getCell(row,col);
if(cell){
this.fly(cell).removeClass('x-grid3-cell-selected')
}
},
handleWheel:function(e){
e.stopPropagation()
},
onColumnSplitterMoved:function(cellIndex,width){
this.userResized=true;
this.grid.colModel.setColumnWidth(cellIndex,width,true);
if(this.forceFit){
this.fitColumns(true,false,cellIndex);
this.updateAllColumnWidths()
}else{
this.updateColumnWidth(cellIndex,width);
this.syncHeaderScroll()
}
this.grid.fireEvent('columnresize',cellIndex,width)
},
beforeColMenuShow:function(){
var colModel=this.cm,colCount=colModel.getColumnCount(),colMenu=this.colMenu,i;
colMenu.removeAll();
for(i=0;i<colCount;i++){
if(colModel.config[i].hideable!==false){
colMenu.add(new Ext.menu.CheckItem({
text:colModel.getColumnHeader(i),
itemId:'col-'+colModel.getColumnId(i),
checked:!colModel.isHidden(i),
disabled:colModel.config[i].hideable===false,
hideOnClick:false
}))
}
}
},
handleHdMenuClick:function(item){
var store=this.ds,dataIndex=this.cm.getDataIndex(this.hdCtxIndex);
switch(item.getItemId()){
case'asc':
store.sort(dataIndex,'ASC');
break;
case'desc':
store.sort(dataIndex,'DESC');
break;
default:
this.handleHdMenuClickDefault(item)
}
return true
},
handleHdMenuClickDefault:function(item){
var colModel=this.cm,itemId=item.getItemId(),index=colModel.getIndexById(itemId.substr(4));
if(index!=-1){
if(item.checked&&colModel.getColumnsBy(this.isHideableColumn,this).length<=1){
this.onDenyColumnHide();
return
}
colModel.setHidden(index,item.checked)
}
},
handleHdDown:function(e,target){
if(Ext.fly(target).hasClass('x-grid3-hd-btn')){
e.stopEvent();
var colModel=this.cm,header=this.findHeaderCell(target),index=this.getCellIndex(header),sortable=colModel.isSortable(index),menu=this.hmenu,menuItems=menu.items,menuCls=this.headerMenuOpenCls;
this.hdCtxIndex=index;
Ext.fly(header).addClass(menuCls);
menuItems.get('asc').setDisabled(!sortable);
menuItems.get('desc').setDisabled(!sortable);
menu.on('hide',function(){
Ext.fly(header).removeClass(menuCls)
},this,{single:true});
menu.show(target,'tl-bl?')
}
},
handleHdMove:function(e){
var header=this.findHeaderCell(this.activeHdRef);
if(header&&!this.headersDisabled){
var handleWidth=this.splitHandleWidth||5,activeRegion=this.activeHdRegion,headerStyle=header.style,colModel=this.cm,cursor='',pageX=e.getPageX();
if(this.grid.enableColumnResize!==false){
var activeHeaderIndex=this.activeHdIndex,previousVisible=this.getPreviousVisible(activeHeaderIndex),currentResizable=colModel.isResizable(activeHeaderIndex),previousResizable=previousVisible&&colModel.isResizable(previousVisible),inLeftResizer=pageX-activeRegion.left<=handleWidth,inRightResizer=activeRegion.right-pageX<=(!this.activeHdBtn?handleWidth:2);
if(inLeftResizer&&previousResizable){
cursor=Ext.isAir?'move':Ext.isWebKit?'e-resize':'col-resize'
}else if(inRightResizer&&currentResizable){
cursor=Ext.isAir?'move':Ext.isWebKit?'w-resize':'col-resize'
}
}
headerStyle.cursor=cursor
}
},
getPreviousVisible:function(index){
while(index>0){
if(!this.cm.isHidden(index-1)){
return index
}
index--
}
return undefined
},
handleHdOver:function(e,target){
var header=this.findHeaderCell(target);
if(header&&!this.headersDisabled){
var fly=this.fly(header);
this.activeHdRef=target;
this.activeHdIndex=this.getCellIndex(header);
this.activeHdRegion=fly.getRegion();
if(!this.isMenuDisabled(this.activeHdIndex,fly)){
fly.addClass('x-grid3-hd-over');
this.activeHdBtn=fly.child('.x-grid3-hd-btn');
if(this.activeHdBtn){
this.activeHdBtn.dom.style.height=header.firstChild.offsetHeight-1+'px'
}
}
}
},
handleHdOut:function(e,target){
var header=this.findHeaderCell(target);
if(header&&(!Ext.isIE||!e.within(header,true))){
this.activeHdRef=null;
this.fly(header).removeClass('x-grid3-hd-over');
header.style.cursor=''
}
},
isMenuDisabled:function(cellIndex,el){
return this.cm.isMenuDisabled(cellIndex)
},
hasRows:function(){
var fc=this.mainBody.dom.firstChild;
return fc&&fc.nodeType==1&&fc.className!='x-grid-empty'
},
isHideableColumn:function(c){
return!c.hidden
},
bind:function(d,c){
this.initData(d,c)
}
});
Ext.grid.GridView.SplitDragZone=Ext.extend(Ext.dd.DDProxy,{
constructor:function(grid,hd){
this.grid=grid;
this.view=grid.getView();
this.marker=this.view.resizeMarker;
this.proxy=this.view.resizeProxy;
Ext.grid.GridView.SplitDragZone.superclass.constructor.call(this,hd,'gridSplitters'+this.grid.getGridEl().id,{
dragElId:Ext.id(this.proxy.dom),
resizeFrame:false
});
this.scroll=false;
this.hw=this.view.splitHandleWidth||5
},
b4StartDrag:function(x,y){
this.dragHeadersDisabled=this.view.headersDisabled;
this.view.headersDisabled=true;
var h=this.view.mainWrap.getHeight();
this.marker.setHeight(h);
this.marker.show();
this.marker.alignTo(this.view.getHeaderCell(this.cellIndex),'tl-tl',[
-2,
0
]);
this.proxy.setHeight(h);
var w=this.cm.getColumnWidth(this.cellIndex),minw=Math.max(w-this.grid.minColumnWidth,0);
this.resetConstraints();
this.setXConstraint(minw,1000);
this.setYConstraint(0,0);
this.minX=x-minw;
this.maxX=x+1000;
this.startPos=x;
Ext.dd.DDProxy.prototype.b4StartDrag.call(this,x,y)
},
allowHeaderDrag:function(e){
return true
},
handleMouseDown:function(e){
var t=this.view.findHeaderCell(e.getTarget());
if(t&&this.allowHeaderDrag(e)){
var xy=this.view.fly(t).getXY(),x=xy[0],exy=e.getXY(),ex=exy[0],w=t.offsetWidth,adjust=false;
if(ex-x<=this.hw){
adjust=-1
}else if(x+w-ex<=this.hw){
adjust=0
}
if(adjust!==false){
this.cm=this.grid.colModel;
var ci=this.view.getCellIndex(t);
if(adjust==-1){
if(ci+adjust<0){
return
}
while(this.cm.isHidden(ci+adjust)){
--adjust;
if(ci+adjust<0){
return
}
}
}
this.cellIndex=ci+adjust;
this.split=t.dom;
if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){
Ext.grid.GridView.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)
}
}else if(this.view.columnDrag){
this.view.columnDrag.callHandleMouseDown(e)
}
}
},
endDrag:function(e){
this.marker.hide();
var v=this.view,endX=Math.max(this.minX,e.getPageX()),diff=endX-this.startPos,disabled=this.dragHeadersDisabled;
v.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+diff);
setTimeout(function(){
v.headersDisabled=disabled
},50)
},
autoOffset:function(){
this.setDelta(0,0)
}
});
Ext.grid.PivotGridView=Ext.extend(Ext.grid.GridView,{
colHeaderCellCls:'grid-hd-group-cell',
title:'',
getColumnHeaders:function(){
return this.grid.topAxis.buildHeaders();
;
},
getRowHeaders:function(){
return this.grid.leftAxis.buildHeaders()
},
renderRows:function(startRow,endRow){
var grid=this.grid,rows=grid.extractData(),rowCount=rows.length,templates=this.templates,renderer=grid.renderer,hasRenderer=typeof renderer=='function',getCellCls=this.getCellCls,hasGetCellCls=typeof getCellCls=='function',cellTemplate=templates.cell,rowTemplate=templates.row,rowBuffer=[],meta={},tstyle='width:'+this.getGridInnerWidth()+'px;',colBuffer,colCount,column,i,row;
startRow=startRow||0;
endRow=Ext.isDefined(endRow)?endRow:rowCount-1;
for(i=0;i<rowCount;i++){
row=rows[i];
colCount=row.length;
colBuffer=[];
for(var j=0;j<colCount;j++){
meta.id=i+'-'+j;
meta.css=j===0?'x-grid3-cell-first ':j==colCount-1?'x-grid3-cell-last ':'';
meta.attr=meta.cellAttr='';
meta.value=row[j];
if(Ext.isEmpty(meta.value)){
meta.value='&#160;'
}
if(hasRenderer){
meta.value=renderer(meta.value)
}
if(hasGetCellCls){
meta.css+=getCellCls(meta.value)+' '
}
colBuffer[colBuffer.length]=cellTemplate.apply(meta)
}
rowBuffer[rowBuffer.length]=rowTemplate.apply({
tstyle:tstyle,
cols:colCount,
cells:colBuffer.join(''),
alt:''
})
}
return rowBuffer.join('')
},
masterTpl:new Ext.Template('<div class="x-grid3 x-pivotgrid" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header">','<div class="x-grid3-header-title"><span>{title}</span></div>','<div class="x-grid3-header-inner">','<div class="x-grid3-header-offset" style="{ostyle}"></div>','</div>','<div class="x-clear"></div>','</div>','<div class="x-grid3-scroller">','<div class="x-grid3-row-headers"></div>','<div class="x-grid3-body" style="{bstyle}">{body}</div>','<a href="#" class="x-grid3-focus" tabIndex="-1"></a>','</div>','</div>','<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>','</div>'),
initTemplates:function(){
Ext.grid.PivotGridView.superclass.initTemplates.apply(this,arguments);
var templates=this.templates||{};
if(!templates.gcell){
templates.gcell=new Ext.XTemplate('<td class="x-grid3-hd x-grid3-gcell x-grid3-td-{id} ux-grid-hd-group-row-{row} '+this.colHeaderCellCls+'" style="{style}">','<div {tooltip} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':'','{value}','</div>','</td>')
}
this.templates=templates;
this.hrowRe=new RegExp('ux-grid-hd-group-row-(\\d+)','')
},
initElements:function(){
Ext.grid.PivotGridView.superclass.initElements.apply(this,arguments);
this.rowHeadersEl=new Ext.Element(this.scroller.child('div.x-grid3-row-headers'));
this.headerTitleEl=new Ext.Element(this.mainHd.child('div.x-grid3-header-title'))
},
getGridInnerWidth:function(){
var previousWidth=Ext.grid.PivotGridView.superclass.getGridInnerWidth.apply(this,arguments);
return previousWidth-this.getTotalRowHeaderWidth()
},
getTotalRowHeaderWidth:function(){
var headers=this.getRowHeaders(),length=headers.length,total=0,i;
for(i=0;i<length;i++){
total+=headers[i].width
}
return total
},
getTotalColumnHeaderHeight:function(){
return this.getColumnHeaders().length*21
},
getCellIndex:function(el){
if(el){
var match=el.className.match(this.colRe),data;
if(match&&(data=match[1])){
return parseInt(data.split('-')[1],10)
}
}
return false
},
renderUI:function(){
var templates=this.templates,innerWidth=this.getGridInnerWidth();
return templates.master.apply({
body:templates.body.apply({rows:'&#160;'}),
ostyle:'width:'+innerWidth+'px',
bstyle:'width:'+innerWidth+'px'
})
},
onLayout:function(width,height){
Ext.grid.PivotGridView.superclass.onLayout.apply(this,arguments);
var width=this.getGridInnerWidth();
this.resizeColumnHeaders(width);
this.resizeAllRows(width)
},
refresh:function(headersToo){
this.fireEvent('beforerefresh',this);
this.grid.stopEditing(true);
var result=this.renderBody();
this.mainBody.update(result).setWidth(this.getGridInnerWidth());
if(headersToo===true){
this.updateHeaders();
this.updateHeaderSortState()
}
this.processRows(0,true);
this.layout();
this.applyEmptyText();
this.fireEvent('refresh',this)
},
renderHeaders:Ext.emptyFn,
fitColumns:Ext.emptyFn,
resizeColumnHeaders:function(width){
var topAxis=this.grid.topAxis;
if(topAxis.rendered){
topAxis.el.setWidth(width)
}
},
resizeRowHeaders:function(){
var rowHeaderWidth=this.getTotalRowHeaderWidth(),marginStyle=String.format('margin-left: {0}px;',rowHeaderWidth);
this.rowHeadersEl.setWidth(rowHeaderWidth);
this.mainBody.applyStyles(marginStyle);
Ext.fly(this.innerHd).applyStyles(marginStyle);
this.headerTitleEl.setWidth(rowHeaderWidth);
this.headerTitleEl.setHeight(this.getTotalColumnHeaderHeight())
},
resizeAllRows:function(width){
var rows=this.getRows(),length=rows.length,i;
for(i=0;i<length;i++){
Ext.fly(rows[i]).setWidth(width);
Ext.fly(rows[i]).child('table').setWidth(width)
}
},
updateHeaders:function(){
this.renderGroupRowHeaders();
this.renderGroupColumnHeaders()
},
renderGroupRowHeaders:function(){
var leftAxis=this.grid.leftAxis;
this.resizeRowHeaders();
leftAxis.rendered=false;
leftAxis.render(this.rowHeadersEl);
this.setTitle(this.title)
},
setTitle:function(title){
this.headerTitleEl.child('span').dom.innerHTML=title
},
renderGroupColumnHeaders:function(){
var topAxis=this.grid.topAxis;
topAxis.rendered=false;
topAxis.render(this.innerHd.firstChild)
},
isMenuDisabled:function(cellIndex,el){
return true
}
});
Ext.grid.PivotAxis=Ext.extend(Ext.Component,{
orientation:'horizontal',
defaultHeaderWidth:80,
paddingWidth:7,
setDimensions:function(dimensions){
this.dimensions=dimensions
},
onRender:function(ct,position){
var rows=this.orientation=='horizontal'?this.renderHorizontalRows():this.renderVerticalRows();
this.el=Ext.DomHelper.overwrite(ct.dom,{
tag:'table',
cn:rows
},true)
},
renderHorizontalRows:function(){
var headers=this.buildHeaders(),rowCount=headers.length,rows=[],cells,cols,colCount,i,j;
for(i=0;i<rowCount;i++){
cells=[];
cols=headers[i].items;
colCount=cols.length;
for(j=0;j<colCount;j++){
cells.push({
tag:'td',
html:cols[j].header,
colspan:cols[j].span
})
}
rows[i]={
tag:'tr',
cn:cells
}
}
return rows
},
renderVerticalRows:function(){
var headers=this.buildHeaders(),colCount=headers.length,rowCells=[],rows=[],rowCount,col,row,colWidth,i,j;
for(i=0;i<colCount;i++){
col=headers[i];
colWidth=col.width||80;
rowCount=col.items.length;
for(j=0;j<rowCount;j++){
row=col.items[j];
rowCells[row.start]=rowCells[row.start]||[];
rowCells[row.start].push({
tag:'td',
html:row.header,
rowspan:row.span,
width:Ext.isBorderBox?colWidth:colWidth-this.paddingWidth
})
}
}
rowCount=rowCells.length;
for(i=0;i<rowCount;i++){
rows[i]={
tag:'tr',
cn:rowCells[i]
}
}
return rows
},
getTuples:function(){
var newStore=new Ext.data.Store({});
newStore.data=this.store.data.clone();
newStore.fields=this.store.fields;
var sorters=[],dimensions=this.dimensions,length=dimensions.length,i;
for(i=0;i<length;i++){
sorters.push({
field:dimensions[i].dataIndex,
direction:dimensions[i].direction||'ASC'
})
}
newStore.sort(sorters);
var records=newStore.data.items,hashes=[],tuples=[],recData,hash,info,data,key;
length=records.length;
for(i=0;i<length;i++){
info=this.getRecordInfo(records[i]);
data=info.data;
hash='';
for(key in data){
hash+=data[key]+'---'
}
if(hashes.indexOf(hash)==-1){
hashes.push(hash);
tuples.push(info)
}
}
newStore.destroy();
return tuples
},
getRecordInfo:function(record){
var dimensions=this.dimensions,length=dimensions.length,data={},dimension,dataIndex,i;
for(i=0;i<length;i++){
dimension=dimensions[i];
dataIndex=dimension.dataIndex;
data[dataIndex]=record.get(dataIndex)
}
var createMatcherFunction=function(data){
return function(record){
for(var dataIndex in data){
if(record.get(dataIndex)!=data[dataIndex]){
return false
}
}
return true
}
};
return{
data:data,
matcher:createMatcherFunction(data)
}
},
buildHeaders:function(){
var tuples=this.getTuples(),rowCount=tuples.length,dimensions=this.dimensions,dimension,colCount=dimensions.length,headers=[],tuple,rows,currentHeader,previousHeader,span,start,isLast,changed,i,j;
for(i=0;i<colCount;i++){
dimension=dimensions[i];
rows=[];
span=0;
start=0;
for(j=0;j<rowCount;j++){
tuple=tuples[j];
isLast=j==rowCount-1;
currentHeader=tuple.data[dimension.dataIndex];
changed=previousHeader!=undefined&&previousHeader!=currentHeader;
if(i>0&&j>0){
changed=changed||tuple.data[dimensions[i-1].dataIndex]!=tuples[j-1].data[dimensions[i-1].dataIndex]
}
if(changed){
rows.push({
header:previousHeader,
span:span,
start:start
});
start+=span;
span=0
}
if(isLast){
rows.push({
header:currentHeader,
span:span+1,
start:start
});
start+=span;
span=0
}
previousHeader=currentHeader;
span++
}
headers.push({
items:rows,
width:dimension.width||this.defaultHeaderWidth
});
previousHeader=undefined
}
return headers
}
});
Ext.grid.HeaderDragZone=Ext.extend(Ext.dd.DragZone,{
maxDragWidth:120,
constructor:function(grid,hd,hd2){
this.grid=grid;
this.view=grid.getView();
this.ddGroup='gridHeader'+this.grid.getGridEl().id;
Ext.grid.HeaderDragZone.superclass.constructor.call(this,hd);
if(hd2){
this.setHandleElId(Ext.id(hd));
this.setOuterHandleElId(Ext.id(hd2))
}
this.scroll=false
},
getDragData:function(e){
var t=Ext.lib.Event.getTarget(e),h=this.view.findHeaderCell(t);
if(h){
return{
ddel:h.firstChild,
header:h
}
}
return false
},
onInitDrag:function(e){
this.dragHeadersDisabled=this.view.headersDisabled;
this.view.headersDisabled=true;
var clone=this.dragData.ddel.cloneNode(true);
clone.id=Ext.id();
clone.style.width=Math.min(this.dragData.header.offsetWidth,this.maxDragWidth)+'px';
this.proxy.update(clone);
return true
},
afterValidDrop:function(){
this.completeDrop()
},
afterInvalidDrop:function(){
this.completeDrop()
},
completeDrop:function(){
var v=this.view,disabled=this.dragHeadersDisabled;
setTimeout(function(){
v.headersDisabled=disabled
},50)
}
});
Ext.grid.HeaderDropZone=Ext.extend(Ext.dd.DropZone,{
proxyOffsets:[
-4,
-9
],
fly:Ext.Element.fly,
constructor:function(grid,hd,hd2){
this.grid=grid;
this.view=grid.getView();
this.proxyTop=Ext.DomHelper.append(document.body,{
cls:'col-move-top',
html:'&#160;'
},true);
this.proxyBottom=Ext.DomHelper.append(document.body,{
cls:'col-move-bottom',
html:'&#160;'
},true);
this.proxyTop.hide=this.proxyBottom.hide=function(){
this.setLeftTop(-100,-100);
this.setStyle('visibility','hidden')
};
this.ddGroup='gridHeader'+this.grid.getGridEl().id;
Ext.grid.HeaderDropZone.superclass.constructor.call(this,grid.getGridEl().dom)
},
getTargetFromEvent:function(e){
var t=Ext.lib.Event.getTarget(e),cindex=this.view.findCellIndex(t);
if(cindex!==false){
return this.view.getHeaderCell(cindex)
}
},
nextVisible:function(h){
var v=this.view,cm=this.grid.colModel;
h=h.nextSibling;
while(h){
if(!cm.isHidden(v.getCellIndex(h))){
return h
}
h=h.nextSibling
}
return null
},
prevVisible:function(h){
var v=this.view,cm=this.grid.colModel;
h=h.prevSibling;
while(h){
if(!cm.isHidden(v.getCellIndex(h))){
return h
}
h=h.prevSibling
}
return null
},
positionIndicator:function(h,n,e){
var x=Ext.lib.Event.getPageX(e),r=Ext.lib.Dom.getRegion(n.firstChild),px,pt,py=r.top+this.proxyOffsets[1];
if(r.right-x<=(r.right-r.left)/2){
px=r.right+this.view.borderWidth;
pt='after'
}else{
px=r.left;
pt='before'
}
if(this.grid.colModel.isFixed(this.view.getCellIndex(n))){
return false
}
px+=this.proxyOffsets[0];
this.proxyTop.setLeftTop(px,py);
this.proxyTop.show();
if(!this.bottomOffset){
this.bottomOffset=this.view.mainHd.getHeight()
}
this.proxyBottom.setLeftTop(px,py+this.proxyTop.dom.offsetHeight+this.bottomOffset);
this.proxyBottom.show();
return pt
},
onNodeEnter:function(n,dd,e,data){
if(data.header!=n){
this.positionIndicator(data.header,n,e)
}
},
onNodeOver:function(n,dd,e,data){
var result=false;
if(data.header!=n){
result=this.positionIndicator(data.header,n,e)
}
if(!result){
this.proxyTop.hide();
this.proxyBottom.hide()
}
return result?this.dropAllowed:this.dropNotAllowed
},
onNodeOut:function(n,dd,e,data){
this.proxyTop.hide();
this.proxyBottom.hide()
},
onNodeDrop:function(n,dd,e,data){
var h=data.header;
if(h!=n){
var cm=this.grid.colModel,x=Ext.lib.Event.getPageX(e),r=Ext.lib.Dom.getRegion(n.firstChild),pt=r.right-x<=(r.right-r.left)/2?'after':'before',oldIndex=this.view.getCellIndex(h),newIndex=this.view.getCellIndex(n);
if(pt=='after'){
newIndex++
}
if(oldIndex<newIndex){
newIndex--
}
cm.moveColumn(oldIndex,newIndex);
return true
}
return false
}
});
Ext.grid.GridView.ColumnDragZone=Ext.extend(Ext.grid.HeaderDragZone,{
constructor:function(grid,hd){
Ext.grid.GridView.ColumnDragZone.superclass.constructor.call(this,grid,hd,null);
this.proxy.el.addClass('x-grid3-col-dd')
},
handleMouseDown:function(e){
},
callHandleMouseDown:function(e){
Ext.grid.GridView.ColumnDragZone.superclass.handleMouseDown.call(this,e)
}
});
Ext.grid.SplitDragZone=Ext.extend(Ext.dd.DDProxy,{
fly:Ext.Element.fly,
constructor:function(grid,hd,hd2){
this.grid=grid;
this.view=grid.getView();
this.proxy=this.view.resizeProxy;
Ext.grid.SplitDragZone.superclass.constructor.call(this,hd,'gridSplitters'+this.grid.getGridEl().id,{
dragElId:Ext.id(this.proxy.dom),
resizeFrame:false
});
this.setHandleElId(Ext.id(hd));
this.setOuterHandleElId(Ext.id(hd2));
this.scroll=false
},
b4StartDrag:function(x,y){
this.view.headersDisabled=true;
this.proxy.setHeight(this.view.mainWrap.getHeight());
var w=this.cm.getColumnWidth(this.cellIndex);
var minw=Math.max(w-this.grid.minColumnWidth,0);
this.resetConstraints();
this.setXConstraint(minw,1000);
this.setYConstraint(0,0);
this.minX=x-minw;
this.maxX=x+1000;
this.startPos=x;
Ext.dd.DDProxy.prototype.b4StartDrag.call(this,x,y)
},
handleMouseDown:function(e){
var ev=Ext.EventObject.setEvent(e);
var t=this.fly(ev.getTarget());
if(t.hasClass('x-grid-split')){
this.cellIndex=this.view.getCellIndex(t.dom);
this.split=t.dom;
this.cm=this.grid.colModel;
if(this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)){
Ext.grid.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)
}
}
},
endDrag:function(e){
this.view.headersDisabled=false;
var endX=Math.max(this.minX,Ext.lib.Event.getPageX(e));
var diff=endX-this.startPos;
this.view.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+diff)
},
autoOffset:function(){
this.setDelta(0,0)
}
});
Ext.grid.GridDragZone=function(grid,config){
this.view=grid.getView();
Ext.grid.GridDragZone.superclass.constructor.call(this,this.view.mainBody.dom,config);
this.scroll=false;
this.grid=grid;
this.ddel=document.createElement('div');
this.ddel.className='x-grid-dd-wrap'
};
Ext.extend(Ext.grid.GridDragZone,Ext.dd.DragZone,{
ddGroup:'GridDD',
getDragData:function(e){
var t=Ext.lib.Event.getTarget(e);
var rowIndex=this.view.findRowIndex(t);
if(rowIndex!==false){
var sm=this.grid.selModel;
if(!sm.isSelected(rowIndex)||e.hasModifier()){
sm.handleMouseDown(this.grid,rowIndex,e)
}
return{
grid:this.grid,
ddel:this.ddel,
rowIndex:rowIndex,
selections:sm.getSelections()
}
}
return false
},
onInitDrag:function(e){
var data=this.dragData;
this.ddel.innerHTML=this.grid.getDragDropText();
this.proxy.update(this.ddel)
},
afterRepair:function(){
this.dragging=false
},
getRepairXY:function(e,data){
return false
},
onEndDrag:function(data,e){
},
onValidDrop:function(dd,e,id){
this.hideProxy()
},
beforeInvalidDrop:function(e,id){
}
});
Ext.grid.ColumnModel=Ext.extend(Ext.util.Observable,{
defaultWidth:100,
defaultSortable:false,
constructor:function(config){
if(config.columns){
Ext.apply(this,config);
this.setConfig(config.columns,true)
}else{
this.setConfig(config,true)
}
this.addEvents('widthchange','headerchange','hiddenchange','columnmoved','configchange');
Ext.grid.ColumnModel.superclass.constructor.call(this)
},
getColumnId:function(index){
return this.config[index].id
},
getColumnAt:function(index){
return this.config[index]
},
setConfig:function(config,initial){
var i,c,len;
if(!initial){
delete this.totalWidth;
for(i=0,len=this.config.length;i<len;i++){
c=this.config[i];
if(c.setEditor){
c.setEditor(null)
}
}
}
this.defaults=Ext.apply({
width:this.defaultWidth,
sortable:this.defaultSortable
},this.defaults);
this.config=config;
this.lookup={};
for(i=0,len=config.length;i<len;i++){
c=Ext.applyIf(config[i],this.defaults);
if(Ext.isEmpty(c.id)){
c.id=i
}
if(!c.isColumn){
var Cls=Ext.grid.Column.types[c.xtype||'gridcolumn'];
c=new Cls(c);
config[i]=c
}
this.lookup[c.id]=c
}
if(!initial){
this.fireEvent('configchange',this)
}
},
getColumnById:function(id){
return this.lookup[id]
},
getIndexById:function(id){
for(var i=0,len=this.config.length;i<len;i++){
if(this.config[i].id==id){
return i
}
}
return-1
},
moveColumn:function(oldIndex,newIndex){
var config=this.config,c=config[oldIndex];
config.splice(oldIndex,1);
config.splice(newIndex,0,c);
this.dataMap=null;
this.fireEvent('columnmoved',this,oldIndex,newIndex)
},
getColumnCount:function(visibleOnly){
var length=this.config.length,c=0,i;
if(visibleOnly===true){
for(i=0;i<length;i++){
if(!this.isHidden(i)){
c++
}
}
return c
}
return length
},
getColumnsBy:function(fn,scope){
var config=this.config,length=config.length,result=[],i,c;
for(i=0;i<length;i++){
c=config[i];
if(fn.call(scope||this,c,i)===true){
result[result.length]=c
}
}
return result
},
isSortable:function(col){
return!!this.config[col].sortable
},
isMenuDisabled:function(col){
return!!this.config[col].menuDisabled
},
getRenderer:function(col){
return this.config[col].renderer||Ext.grid.ColumnModel.defaultRenderer
},
getRendererScope:function(col){
return this.config[col].scope
},
setRenderer:function(col,fn){
this.config[col].renderer=fn
},
getColumnWidth:function(col){
var width=this.config[col].width;
if(typeof width!='number'){
width=this.defaultWidth
}
return width
},
setColumnWidth:function(col,width,suppressEvent){
this.config[col].width=width;
this.totalWidth=null;
if(!suppressEvent){
this.fireEvent('widthchange',this,col,width)
}
},
getTotalWidth:function(includeHidden){
if(!this.totalWidth){
this.totalWidth=0;
for(var i=0,len=this.config.length;i<len;i++){
if(includeHidden||!this.isHidden(i)){
this.totalWidth+=this.getColumnWidth(i)
}
}
}
return this.totalWidth
},
getColumnHeader:function(col){
return this.config[col].header
},
setColumnHeader:function(col,header){
this.config[col].header=header;
this.fireEvent('headerchange',this,col,header)
},
getColumnTooltip:function(col){
return this.config[col].tooltip
},
setColumnTooltip:function(col,tooltip){
this.config[col].tooltip=tooltip
},
getDataIndex:function(col){
return this.config[col].dataIndex
},
setDataIndex:function(col,dataIndex){
this.config[col].dataIndex=dataIndex
},
findColumnIndex:function(dataIndex){
var c=this.config;
for(var i=0,len=c.length;i<len;i++){
if(c[i].dataIndex==dataIndex){
return i
}
}
return-1
},
isCellEditable:function(colIndex,rowIndex){
var c=this.config[colIndex],ed=c.editable;
return!!(ed||!Ext.isDefined(ed)&&c.editor)
},
getCellEditor:function(colIndex,rowIndex){
return this.config[colIndex].getCellEditor(rowIndex)
},
setEditable:function(col,editable){
this.config[col].editable=editable
},
isHidden:function(colIndex){
return!!this.config[colIndex].hidden
},
isFixed:function(colIndex){
return!!this.config[colIndex].fixed
},
isResizable:function(colIndex){
return colIndex>=0&&this.config[colIndex].resizable!==false&&this.config[colIndex].fixed!==true
},
setHidden:function(colIndex,hidden){
var c=this.config[colIndex];
if(c.hidden!==hidden){
c.hidden=hidden;
this.totalWidth=null;
this.fireEvent('hiddenchange',this,colIndex,hidden)
}
},
setEditor:function(col,editor){
this.config[col].setEditor(editor)
},
destroy:function(){
var length=this.config.length,i=0;
for(;i<length;i++){
this.config[i].destroy()
}
delete this.config;
delete this.lookup;
this.purgeListeners()
},
setState:function(col,state){
state=Ext.applyIf(state,this.defaults);
Ext.apply(this.config[col],state)
}
});
Ext.grid.ColumnModel.defaultRenderer=function(value){
if(typeof value=='string'&&value.length<1){
return'&#160;'
}
return value
};
Ext.grid.AbstractSelectionModel=Ext.extend(Ext.util.Observable,{
constructor:function(){
this.locked=false;
Ext.grid.AbstractSelectionModel.superclass.constructor.call(this)
},
init:function(grid){
this.grid=grid;
if(this.lockOnInit){
delete this.lockOnInit;
this.locked=false;
this.lock()
}
this.initEvents()
},
lock:function(){
if(!this.locked){
this.locked=true;
var g=this.grid;
if(g){
g.getView().on({
scope:this,
beforerefresh:this.sortUnLock,
refresh:this.sortLock
})
}else{
this.lockOnInit=true
}
}
},
sortLock:function(){
this.locked=true
},
sortUnLock:function(){
this.locked=false
},
unlock:function(){
if(this.locked){
this.locked=false;
var g=this.grid,gv;
if(g){
gv=g.getView();
gv.un('beforerefresh',this.sortUnLock,this);
gv.un('refresh',this.sortLock,this)
}else{
delete this.lockOnInit
}
}
},
isLocked:function(){
return this.locked
},
destroy:function(){
this.unlock();
this.purgeListeners()
}
});
Ext.grid.RowSelectionModel=Ext.extend(Ext.grid.AbstractSelectionModel,{
singleSelect:false,
constructor:function(config){
Ext.apply(this,config);
this.selections=new Ext.util.MixedCollection(false,function(o){
return o.id
});
this.last=false;
this.lastActive=false;
this.addEvents('selectionchange','beforerowselect','rowselect','rowdeselect');
Ext.grid.RowSelectionModel.superclass.constructor.call(this)
},
initEvents:function(){
if(!this.grid.enableDragDrop&&!this.grid.enableDrag){
this.grid.on('rowmousedown',this.handleMouseDown,this)
}
this.rowNav=new Ext.KeyNav(this.grid.getGridEl(),{
up:this.onKeyPress,
down:this.onKeyPress,
scope:this
});
this.grid.getView().on({
scope:this,
refresh:this.onRefresh,
rowupdated:this.onRowUpdated,
rowremoved:this.onRemove
})
},
onKeyPress:function(e,name){
var up=name=='up',method=up?'selectPrevious':'selectNext',add=up?-1:1,last;
if(!e.shiftKey||this.singleSelect){
this[method](false)
}else if(this.last!==false&&this.lastActive!==false){
last=this.last;
this.selectRange(this.last,this.lastActive+add);
this.grid.getView().focusRow(this.lastActive);
if(last!==false){
this.last=last
}
}else{
this.selectFirstRow()
}
},
onRefresh:function(){
var ds=this.grid.store,s=this.getSelections(),i=0,len=s.length,index,r;
this.silent=true;
this.clearSelections(true);
for(;i<len;i++){
r=s[i];
if((index=ds.indexOfId(r.id))!=-1){
this.selectRow(index,true)
}
}
if(s.length!=this.selections.getCount()){
this.fireEvent('selectionchange',this)
}
this.silent=false
},
onRemove:function(v,index,r){
if(this.selections.remove(r)!==false){
this.fireEvent('selectionchange',this)
}
},
onRowUpdated:function(v,index,r){
if(this.isSelected(r)){
v.onRowSelect(index)
}
},
selectRecords:function(records,keepExisting){
if(!keepExisting){
this.clearSelections()
}
var ds=this.grid.store,i=0,len=records.length;
for(;i<len;i++){
this.selectRow(ds.indexOf(records[i]),true)
}
},
getCount:function(){
return this.selections.length
},
selectFirstRow:function(){
this.selectRow(0)
},
selectLastRow:function(keepExisting){
this.selectRow(this.grid.store.getCount()-1,keepExisting)
},
selectNext:function(keepExisting){
if(this.hasNext()){
this.selectRow(this.last+1,keepExisting);
this.grid.getView().focusRow(this.last);
return true
}
return false
},
selectPrevious:function(keepExisting){
if(this.hasPrevious()){
this.selectRow(this.last-1,keepExisting);
this.grid.getView().focusRow(this.last);
return true
}
return false
},
hasNext:function(){
return this.last!==false&&this.last+1<this.grid.store.getCount()
},
hasPrevious:function(){
return!!this.last
},
getSelections:function(){
return[].concat(this.selections.items)
},
getSelected:function(){
return this.selections.itemAt(0)
},
each:function(fn,scope){
var s=this.getSelections(),i=0,len=s.length;
for(;i<len;i++){
if(fn.call(scope||this,s[i],i)===false){
return false
}
}
return true
},
clearSelections:function(fast){
if(this.isLocked()){
return
}
if(fast!==true){
var ds=this.grid.store,s=this.selections;
s.each(function(r){
this.deselectRow(ds.indexOfId(r.id))
},this);
s.clear()
}else{
this.selections.clear()
}
this.last=false
},
selectAll:function(){
if(this.isLocked()){
return
}
this.selections.clear();
for(var i=0,len=this.grid.store.getCount();i<len;i++){
this.selectRow(i,true)
}
},
hasSelection:function(){
return this.selections.length>0
},
isSelected:function(index){
var r=Ext.isNumber(index)?this.grid.store.getAt(index):index;
return r&&this.selections.key(r.id)?true:false
},
isIdSelected:function(id){
return this.selections.key(id)?true:false
},
handleMouseDown:function(g,rowIndex,e){
if(e.button!==0||this.isLocked()){
return
}
var view=this.grid.getView();
if(e.shiftKey&&!this.singleSelect&&this.last!==false){
var last=this.last;
this.selectRange(last,rowIndex,e.ctrlKey);
this.last=last;
view.focusRow(rowIndex)
}else{
var isSelected=this.isSelected(rowIndex);
if(e.ctrlKey&&isSelected){
this.deselectRow(rowIndex)
}else if(!isSelected||this.getCount()>1){
this.selectRow(rowIndex,e.ctrlKey||e.shiftKey);
view.focusRow(rowIndex)
}
}
},
selectRows:function(rows,keepExisting){
if(!keepExisting){
this.clearSelections()
}
for(var i=0,len=rows.length;i<len;i++){
this.selectRow(rows[i],true)
}
},
selectRange:function(startRow,endRow,keepExisting){
var i;
if(this.isLocked()){
return
}
if(!keepExisting){
this.clearSelections()
}
if(startRow<=endRow){
for(i=startRow;i<=endRow;i++){
this.selectRow(i,true)
}
}else{
for(i=startRow;i>=endRow;i--){
this.selectRow(i,true)
}
}
},
deselectRange:function(startRow,endRow,preventViewNotify){
if(this.isLocked()){
return
}
for(var i=startRow;i<=endRow;i++){
this.deselectRow(i,preventViewNotify)
}
},
selectRow:function(index,keepExisting,preventViewNotify){
if(this.isLocked()||(index<0||index>=this.grid.store.getCount())||keepExisting&&this.isSelected(index)){
return
}
var r=this.grid.store.getAt(index);
if(r&&this.fireEvent('beforerowselect',this,index,keepExisting,r)!==false){
if(!keepExisting||this.singleSelect){
this.clearSelections()
}
this.selections.add(r);
this.last=this.lastActive=index;
if(!preventViewNotify){
this.grid.getView().onRowSelect(index)
}
if(!this.silent){
this.fireEvent('rowselect',this,index,r);
this.fireEvent('selectionchange',this)
}
}
},
deselectRow:function(index,preventViewNotify){
if(this.isLocked()){
return
}
if(this.last==index){
this.last=false
}
if(this.lastActive==index){
this.lastActive=false
}
var r=this.grid.store.getAt(index);
if(r){
this.selections.remove(r);
if(!preventViewNotify){
this.grid.getView().onRowDeselect(index)
}
this.fireEvent('rowdeselect',this,index,r);
this.fireEvent('selectionchange',this)
}
},
acceptsNav:function(row,col,cm){
return!cm.isHidden(col)&&cm.isCellEditable(col,row)
},
onEditorKey:function(field,e){
var k=e.getKey(),newCell,g=this.grid,last=g.lastEdit,ed=g.activeEditor,shift=e.shiftKey,ae,last,r,c;
if(k==e.TAB){
e.stopEvent();
ed.completeEdit();
if(shift){
newCell=g.walkCells(ed.row,ed.col-1,-1,this.acceptsNav,this)
}else{
newCell=g.walkCells(ed.row,ed.col+1,1,this.acceptsNav,this)
}
}else if(k==e.ENTER){
if(this.moveEditorOnEnter!==false){
if(shift){
newCell=g.walkCells(last.row-1,last.col,-1,this.acceptsNav,this)
}else{
newCell=g.walkCells(last.row+1,last.col,1,this.acceptsNav,this)
}
}
}
if(newCell){
r=newCell[0];
c=newCell[1];
this.onEditorSelect(r,last.row);
if(g.isEditor&&g.editing){
ae=g.activeEditor;
if(ae&&ae.field.triggerBlur){
ae.field.triggerBlur()
}
}
g.startEditing(r,c)
}
},
onEditorSelect:function(row,lastRow){
if(lastRow!=row){
this.selectRow(row)
}
},
destroy:function(){
Ext.destroy(this.rowNav);
this.rowNav=null;
Ext.grid.RowSelectionModel.superclass.destroy.call(this)
}
});
Ext.grid.Column=Ext.extend(Ext.util.Observable,{
isColumn:true,
constructor:function(config){
Ext.apply(this,config);
if(Ext.isString(this.renderer)){
this.renderer=Ext.util.Format[this.renderer]
}else if(Ext.isObject(this.renderer)){
this.scope=this.renderer.scope;
this.renderer=this.renderer.fn
}
if(!this.scope){
this.scope=this
}
var ed=this.editor;
delete this.editor;
this.setEditor(ed);
this.addEvents('click','contextmenu','dblclick','mousedown');
Ext.grid.Column.superclass.constructor.call(this)
},
processEvent:function(name,e,grid,rowIndex,colIndex){
return this.fireEvent(name,this,grid,rowIndex,e)
},
destroy:function(){
if(this.setEditor){
this.setEditor(null)
}
this.purgeListeners()
},
renderer:function(value){
return value
},
getEditor:function(rowIndex){
return this.editable!==false?this.editor:null
},
setEditor:function(editor){
var ed=this.editor;
if(ed){
if(ed.gridEditor){
ed.gridEditor.destroy();
delete ed.gridEditor
}else{
ed.destroy()
}
}
this.editor=null;
if(editor){
if(!editor.isXType){
editor=Ext.create(editor,'textfield')
}
this.editor=editor
}
},
getCellEditor:function(rowIndex){
var ed=this.getEditor(rowIndex);
if(ed){
if(!ed.startEdit){
if(!ed.gridEditor){
ed.gridEditor=new Ext.grid.GridEditor(ed)
}
ed=ed.gridEditor
}
}
return ed
}
});
Ext.grid.BooleanColumn=Ext.extend(Ext.grid.Column,{
trueText:'true',
falseText:'false',
undefinedText:'&#160;',
constructor:function(cfg){
Ext.grid.BooleanColumn.superclass.constructor.call(this,cfg);
var t=this.trueText,f=this.falseText,u=this.undefinedText;
this.renderer=function(v){
if(v===undefined){
return u
}
if(!v||v==='false'){
return f
}
return t
}
}
});
Ext.grid.NumberColumn=Ext.extend(Ext.grid.Column,{
format:'0,000.00',
constructor:function(cfg){
Ext.grid.NumberColumn.superclass.constructor.call(this,cfg);
this.renderer=Ext.util.Format.numberRenderer(this.format)
}
});
Ext.grid.DateColumn=Ext.extend(Ext.grid.Column,{
format:'m/d/Y',
constructor:function(cfg){
Ext.grid.DateColumn.superclass.constructor.call(this,cfg);
this.renderer=Ext.util.Format.dateRenderer(this.format)
}
});
Ext.grid.TemplateColumn=Ext.extend(Ext.grid.Column,{
constructor:function(cfg){
Ext.grid.TemplateColumn.superclass.constructor.call(this,cfg);
var tpl=!Ext.isPrimitive(this.tpl)&&this.tpl.compile?this.tpl:new Ext.XTemplate(this.tpl);
this.renderer=function(value,p,r){
return tpl.apply(r.data)
};
this.tpl=tpl
}
});
Ext.grid.ActionColumn=Ext.extend(Ext.grid.Column,{
header:'&#160;',
actionIdRe:/x-action-col-(\d+)/,
altText:'',
constructor:function(cfg){
var me=this,items=cfg.items||(me.items=[me]),l=items.length,i,item;
Ext.grid.ActionColumn.superclass.constructor.call(me,cfg);
me.renderer=function(v,meta){
v=Ext.isFunction(cfg.renderer)?cfg.renderer.apply(this,arguments)||'':'';
meta.css+=' x-action-col-cell';
for(i=0;i<l;i++){
item=items[i];
v+='<img alt="'+(item.altText||me.altText)+'" src="'+(item.icon||Ext.BLANK_IMAGE_URL)+'" class="x-action-col-icon x-action-col-'+String(i)+' '+(item.iconCls||'')+' '+(Ext.isFunction(item.getClass)?item.getClass.apply(item.scope||this.scope||this,arguments):'')+'"'+(item.tooltip?' ext:qtip="'+item.tooltip+'"':'')+' />'
}
return v
}
},
destroy:function(){
delete this.items;
delete this.renderer;
return Ext.grid.ActionColumn.superclass.destroy.apply(this,arguments)
},
processEvent:function(name,e,grid,rowIndex,colIndex){
var m=e.getTarget().className.match(this.actionIdRe),item,fn;
if(m&&(item=this.items[parseInt(m[1],10)])){
if(name=='click'){
(fn=item.handler||this.handler)&&fn.call(item.scope||this.scope||this,grid,rowIndex,colIndex,item,e)
}else if(name=='mousedown'&&item.stopSelection!==false){
return false
}
}
return Ext.grid.ActionColumn.superclass.processEvent.apply(this,arguments)
}
});
Ext.grid.Column.types={
gridcolumn:Ext.grid.Column,
booleancolumn:Ext.grid.BooleanColumn,
numbercolumn:Ext.grid.NumberColumn,
datecolumn:Ext.grid.DateColumn,
templatecolumn:Ext.grid.TemplateColumn,
actioncolumn:Ext.grid.ActionColumn
};
Ext.grid.RowNumberer=Ext.extend(Object,{
header:'',
width:23,
sortable:false,
constructor:function(config){
Ext.apply(this,config);
if(this.rowspan){
this.renderer=this.renderer.createDelegate(this)
}
},
fixed:true,
hideable:false,
menuDisabled:true,
dataIndex:'',
id:'numberer',
rowspan:undefined,
renderer:function(v,p,record,rowIndex){
if(this.rowspan){
p.cellAttr='rowspan="'+this.rowspan+'"'
}
return rowIndex+1
}
});
Ext.grid.CheckboxSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,{
header:'<div class="x-grid3-hd-checker">&#160;</div>',
width:20,
sortable:false,
menuDisabled:true,
fixed:true,
hideable:false,
dataIndex:'',
id:'checker',
isColumn:true,
constructor:function(){
Ext.grid.CheckboxSelectionModel.superclass.constructor.apply(this,arguments);
if(this.checkOnly){
this.handleMouseDown=Ext.emptyFn
}
},
initEvents:function(){
Ext.grid.CheckboxSelectionModel.superclass.initEvents.call(this);
this.grid.on('render',function(){
Ext.fly(this.grid.getView().innerHd).on('mousedown',this.onHdMouseDown,this)
},this)
},
processEvent:function(name,e,grid,rowIndex,colIndex){
if(name=='mousedown'){
this.onMouseDown(e,e.getTarget());
return false
}else{
return Ext.grid.Column.prototype.processEvent.apply(this,arguments)
}
},
onMouseDown:function(e,t){
if(e.button===0&&t.className=='x-grid3-row-checker'){
e.stopEvent();
var row=e.getTarget('.x-grid3-row');
if(row){
var index=row.rowIndex;
if(this.isSelected(index)){
this.deselectRow(index)
}else{
this.selectRow(index,true);
this.grid.getView().focusRow(index)
}
}
}
},
onHdMouseDown:function(e,t){
if(t.className=='x-grid3-hd-checker'){
e.stopEvent();
var hd=Ext.fly(t.parentNode);
var isChecked=hd.hasClass('x-grid3-hd-checker-on');
if(isChecked){
hd.removeClass('x-grid3-hd-checker-on');
this.clearSelections()
}else{
hd.addClass('x-grid3-hd-checker-on');
this.selectAll()
}
}
},
renderer:function(v,p,record){
return'<div class="x-grid3-row-checker">&#160;</div>'
},
onEditorSelect:function(row,lastRow){
if(lastRow!=row&&!this.checkOnly){
this.selectRow(row)
}
}
});
Ext.origId=Ext.id;
Ext.apply(Ext,{
id:function(el,prefix){
el=Ext.getDom(el,true)||{};
if(el.nodeName&&el.nodeType===3){
return
}else{
return Ext.origId(el,prefix)
}
}
});
(function(){
if(/Edge\//.test(navigator.userAgent)){
Ext.isChrome=false;
Ext.isMSEdge=true
}else if(Ext.isIE){
var version=document.documentMode;
if(version>=6&&version<=10){
var isIE6=false,isIE7=false,isIE8=false,isIE9=false,isIE10=false,classIE='';
switch(version){
case 7:
isIE7=true;
classIE='ext-ie7';
break;
case 8:
isIE8=true;
classIE='ext-ie8';
break;
case 9:
isIE9=true;
classIE='ext-ie9';
break;
case 10:
isIE10=true;
classIE='ext-ie10';
break;
default:
isIE6=true;
classIE='ext-ie6';
break
}
Ext.isIE6=isIE6;
Ext.isIE7=isIE7;
Ext.isIE8=isIE8;
Ext.isIE9=isIE9;
Ext.isIE10=isIE10;
var improviseExtCss=function(){
var bd=document.body||document.getElementsByTagName('body')[0];
Ext.fly(bd,'_internal').removeClass([
'ext-ie6',
'ext-ie7',
'ext-ie8',
'ext-ie9',
'ext-ie10'
]).addClass(classIE)
};
Ext.onReady(improviseExtCss)
}
}else if(navigator.appName==='Netscape'&&/Trident\//.test(navigator.userAgent)){
var re=new RegExp('Trident/.*rv:([0-9]{1,}[.0-9]{0,})'),rv=-1,ua=navigator.userAgent;
if(re.exec(ua)!==null){
rv=parseFloat(RegExp.$1)
}
Ext.isModernIE=true;
Ext.isGecko=false;
Ext['isIE'+rv]=true
}
}());
Ext.data.Connection.prototype.disableCaching=false;
Ext.USE_NATIVE_JSON=true;
Ext.lib.Region.prototype.intersect=function(region){
if(!region){
one.fatal('region is "'+region+'" when calculating "intersect"')
}
var that=this,t=Math.max(that.top,region.top),r=Math.min(that.right,region.right),b=Math.min(that.bottom,region.bottom),l=Math.max(that.left,region.left);
if(b>=t&&r>=l){
return new Ext.lib.Region(t,r,b,l)
}
};
(function(){
var FnClass=function(){
var useHasOwn=!!{}.hasOwnProperty,isNative=function(){
var useNative=null;
return function(){
if(useNative===null){
useNative=Ext.USE_NATIVE_JSON&&window.JSON&&JSON.toString()==='[object JSON]'
}
return useNative
}
}(),pad=function(n){
return n<10?'0'+n:n
},doDecode=function(json){
return json?eval('('+json+')'):''
},doEncode=function(o){
if(!Ext.isDefined(o)||o===null){
return'null'
}else if(Ext.isArray(o)){
return encodeArray(o)
}else if(Ext.isDate(o)){
return Ext.util.JSON.encodeDate(o)
}else if(Ext.isString(o)){
return encodeString(o)
}else if(typeof o==='number'){
return isFinite(o)?String(o):'null'
}else if(Ext.isBoolean(o)){
return String(o)
}else{
var a=[];
a.push('{');
var b,i,v;
for(i in o){
if(!o.getElementsByTagName){
if(!useHasOwn||o.hasOwnProperty(i)){
v=o[i];
switch(typeof v){
case'undefined':
case'function':
case'unknown':
break;
default:
if(b){
a.push(',')
}
a.push(doEncode(i),':',v===null?'null':doEncode(v));
b=true
}
}
}
}
a.push('}');
return a.join('')
}
},m={
'':'\\b',
'	':'\\t',
'\n':'\\n',
'':'\\f',
'\r':'\\r',
'"':'\\"',
'\\':'\\\\'
},encodeString=function(s){
if(/["\\\x00-\x1f]/.test(s)){
return'"'+s.replace(/([\x00-\x1f\\"])/g,function(a,b){
var c=m[b];
if(c){
return c
}
c=b.charCodeAt();
return'\\u00'+Math.floor(c/16).toString(16)+(c%16).toString(16)
})+'"'
}
return'"'+s+'"'
},encodeArray=function(o){
var a=['['],b,i,l=o.length,v;
for(i=0;i<l;i+=1){
v=o[i];
switch(typeof v){
case'undefined':
case'function':
case'unknown':
break;
default:
if(b){
a.push(',')
}
a.push(v===null?'null':Ext.util.JSON.encode(v));
b=true
}
}
a.push(']');
return a.join('')
};
this.encodeDate=function(o){
return'"'+o.getFullYear()+'-'+pad(o.getMonth()+1)+'-'+pad(o.getDate())+'T'+pad(o.getHours())+':'+pad(o.getMinutes())+':'+pad(o.getSeconds())+'"'
};
this.encode=function(){
var ec;
return function(o){
if(!ec){
ec=isNative()?JSON.stringify:doEncode
}
return ec(o)
}
}();
this.decode=function(){
var dc;
return function(json){
if(!dc){
dc=isNative()?JSON.parse:doDecode
}
try{
return dc(json)
}catch(e){
if(window.one){
var recentAjaxRequests='';
if(one.fatal.recordDALAjaxRequests){
recentAjaxRequests=one.fatal.recordDALAjaxRequests;
one.fatal.recordDALAjaxRequests=''
}
one.fatal(e.message,{
simpleDescription:'Error in '+(isNative()?'JSON.parse - ':'doDecode - ')+typeof json,
recentAjaxRequests:recentAjaxRequests,
jsonString:json&&json.toString?'json.toString() = '+json.toString():'json = '+json
})
}
throw new Error('#Error logging is already handled')
}
}
}()
};
Ext.util.JSON=new FnClass
}());
Ext.encode=Ext.util.JSON.encode;
Ext.decode=Ext.util.JSON.decode;
Ext.override(Ext.Element,{
removeClass:function(className){
var that=this,trimRe=/^\s+|\s+$/g,spacesRe=/\s+/,i,idx,len,cls,elClasses;
if(!Ext.isArray(className)){
className=className?className.split(spacesRe):[className]
}
if(that.dom&&that.dom.className){
elClasses=that.dom.className.replace(trimRe,'').split(spacesRe);
for(i=0,len=className.length;i<len;i+=1){
cls=className[i];
if(typeof cls==='string'){
cls=cls.replace(trimRe,'');
idx=elClasses.indexOf(cls);
if(idx!==-1){
elClasses.splice(idx,1)
}
}
}
that.dom.className=elClasses.join(' ')
}
return that
}
});
(function(){
var libFlyweight;
function fly(el){
if(!libFlyweight){
libFlyweight=new Ext.Element.Flyweight
}
libFlyweight.dom=el;
return libFlyweight
}
(function(){
var doc=document,PARSEINT=parseInt;
Ext.lib.Dom.getXY=function(el){
var p,pe,b,bt,bl,dbd,x=0,y=0,scroll,hasAbsolute,bd=doc.body||doc.documentElement,ret=[
0,
0
];
el=Ext.getDom(el);
if(el!==bd){
if(el.getBoundingClientRect){
try{
b=el.getBoundingClientRect()
}catch(e){
b={
top:el.offsetTop,
left:el.offsetLeft
}
}
scroll=fly(document).getScroll();
ret=[
Math.round(b.left+scroll.left),
Math.round(b.top+scroll.top)
]
}else{
p=el;
hasAbsolute=fly(el).isStyle('position','absolute');
while(p){
pe=fly(p);
x+=p.offsetLeft;
y+=p.offsetTop;
hasAbsolute=hasAbsolute||pe.isStyle('position','absolute');
if(Ext.isGecko){
y+=bt=parseInt(pe.getStyle('borderTopWidth'),10)||0;
x+=bl=PARSEINT(pe.getStyle('borderLeftWidth'),10)||0;
if(p!==el&&!pe.isStyle('overflow','visible')){
x+=bl;
y+=bt
}
}
p=p.offsetParent
}
if(Ext.isSafari&&hasAbsolute){
x-=bd.offsetLeft;
y-=bd.offsetTop
}
if(Ext.isGecko&&!hasAbsolute){
dbd=fly(bd);
x+=PARSEINT(dbd.getStyle('borderLeftWidth'),10)||0;
y+=PARSEINT(dbd.getStyle('borderTopWidth'),10)||0
}
p=el.parentNode;
while(p&&p!==bd){
if(!Ext.isOpera||p.tagName!=='TR'&&!fly(p).isStyle('display','inline')){
x-=p.scrollLeft;
y-=p.scrollTop
}
p=p.parentNode
}
ret=[
x,
y
]
}
}
return ret
}
}())
}());
Ext.ns('one');
one.Log=function(){
var instance,logHandlers=[],logLevel=0,logList=[],logListSize=200,saveLogStrategy,levelNames;
levelNames=[
'DEBUG',
'INFO',
'WARN',
'ERROR',
'FATAL'
];
saveLogStrategy=function(){
return true
};
instance={
DEBUG:0,
INFO:1,
WARN:2,
ERROR:3,
FATAL:4,
OFF:5,
addHandler:function(level,handler,bindToAll){
var bindLevel=bindToAll||false,i=level,len=bindLevel?instance.FATAL:level;
for(;i<=len;i+=1){
if(!logHandlers[i]){
logHandlers[i]=[]
}
logHandlers[i].push(handler)
}
},
setLogLevel:function(level){
logLevel=level
},
getLogListSize:function(){
return logListSize
},
setLogListSize:function(size){
logListSize=size
},
setSaveLogStrategy:function(fn){
saveLogStrategy=fn
},
saveLog:function(){
var success=saveLogStrategy();
if(success){
logList=[]
}
},
getLogList:function(){
return logList
},
log:function(level,msg,obj){
var i,timestamp=new Date().getTime();
if(level>=logLevel&&logHandlers[level]&&level!==undefined&&msg){
for(i=0;i<logHandlers[level].length;i+=1){
logHandlers[level][i](msg,obj,levelNames[level],timestamp)
}
if(obj){
logList.push([
levelNames[level],
msg,
obj,
timestamp
])
}else{
logList.push([
levelNames[level],
msg,
'-',
timestamp
])
}
if(logList.length>logListSize){
logList.shift()
}
}
}
};
return instance
}();
one.debug=function(msg,obj){
one.Log.log(one.Log.DEBUG,msg,obj)
};
one.info=function(msg,obj){
one.Log.log(one.Log.INFO,msg,obj)
};
one.warn=function(msg,obj){
one.Log.log(one.Log.WARN,msg,obj)
};
one.error=function(msg,obj){
one.Log.log(one.Log.ERROR,msg,obj)
};
one.fatal=function(msg,obj){
one.Log.log(one.Log.FATAL,msg,obj)
};
one.Log.addHandler(one.Log.ERROR,function(message,object,level){
var title='An error occurred';
if(object&&typeof object==='string'){
title=object
}
Ext.Msg.show({
title:title,
msg:message,
cls:'web-modal-warning',
iconCls:'web-warning-icon',
buttons:Ext.MessageBox.OK,
minWidth:Ext.MessageBox.minWidth
})
});
one.Log.addHandler(one.Log.FATAL,function(msg,errOrAdditionalInfo){
var err;
if(errOrAdditionalInfo instanceof Error){
err=errOrAdditionalInfo;
errOrAdditionalInfo=undefined;
err.message=msg
}else{
err=new Error(msg)
}
if(window.one&&one.viewport&&one.viewport.application&&one.viewport.application.dal){
err.user=one.viewport.application.dal.domain
}else{
try{
err.user=one.boneAuth.parseCookieValue().realm
}catch(e){
}
}
one.crashReporter.reportCrash(err,errOrAdditionalInfo)
});
/*! jQuery v1.8.3 jquery.com | jquery.org/license */
(function(e,t){
function _(e){
var t=M[e]={};
return v.each(e.split(y),function(e,n){
t[n]=!0
}),t
}
function H(e,n,r){
if(r===t&&e.nodeType===1){
var i='data-'+n.replace(P,'-$1').toLowerCase();
r=e.getAttribute(i);
if(typeof r=='string'){
try{
r=r==='true'?!0:r==='false'?!1:r==='null'?null:+r+''===r?+r:D.test(r)?v.parseJSON(r):r
}catch(s){
}
v.data(e,n,r)
}else
r=t
}
return r
}
function B(e){
var t;
for(t in e){
if(t==='data'&&v.isEmptyObject(e[t]))
continue;
if(t!=='toJSON')
return!1
}
return!0
}
function et(){
return!1
}
function tt(){
return!0
}
function ut(e){
return!e||!e.parentNode||e.parentNode.nodeType===11
}
function at(e,t){
do
e=e[t];
while(e&&e.nodeType!==1);
return e
}
function ft(e,t,n){
t=t||0;
if(v.isFunction(t))
return v.grep(e,function(e,r){
var i=!!t.call(e,r,e);
return i===n
});
if(t.nodeType)
return v.grep(e,function(e,r){
return e===t===n
});
if(typeof t=='string'){
var r=v.grep(e,function(e){
return e.nodeType===1
});
if(it.test(t))
return v.filter(t,r,!n);
t=v.filter(t,r)
}
return v.grep(e,function(e,r){
return v.inArray(e,t)>=0===n
})
}
function lt(e){
var t=ct.split('|'),n=e.createDocumentFragment();
if(n.createElement)
while(t.length)
n.createElement(t.pop());
return n
}
function Lt(e,t){
return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))
}
function At(e,t){
if(t.nodeType!==1||!v.hasData(e))
return;
var n,r,i,s=v._data(e),o=v._data(t,s),u=s.events;
if(u){
delete o.handle,o.events={};
for(n in u)
for(r=0,i=u[n].length;r<i;r++)
v.event.add(t,n,u[n][r])
}
o.data&&(o.data=v.extend({},o.data))
}
function Ot(e,t){
var n;
if(t.nodeType!==1)
return;
t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n==='object'?(t.parentNode&&(t.outerHTML=e.outerHTML),v.support.html5Clone&&e.innerHTML&&!v.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):n==='input'&&Et.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):n==='option'?t.selected=e.defaultSelected:n==='input'||n==='textarea'?t.defaultValue=e.defaultValue:n==='script'&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(v.expando)
}
function Mt(e){
return typeof e.getElementsByTagName!='undefined'?e.getElementsByTagName('*'):typeof e.querySelectorAll!='undefined'?e.querySelectorAll('*'):[]
}
function _t(e){
Et.test(e.type)&&(e.defaultChecked=e.checked)
}
function Qt(e,t){
if(t in e)
return t;
var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Jt.length;
while(i--){
t=Jt[i]+n;
if(t in e)
return t
}
return r
}
function Gt(e,t){
return e=t||e,v.css(e,'display')==='none'||!v.contains(e.ownerDocument,e)
}
function Yt(e,t){
var n,r,i=[],s=0,o=e.length;
for(;s<o;s++){
n=e[s];
if(!n.style)
continue;
i[s]=v._data(n,'olddisplay'),t?(!i[s]&&n.style.display==='none'&&(n.style.display=''),n.style.display===''&&Gt(n)&&(i[s]=v._data(n,'olddisplay',nn(n.nodeName)))):(r=Dt(n,'display'),!i[s]&&r!=='none'&&v._data(n,'olddisplay',r))
}
for(s=0;s<o;s++){
n=e[s];
if(!n.style)
continue;
if(!t||n.style.display==='none'||n.style.display==='')
n.style.display=t?i[s]||'':'none'
}
return e
}
function Zt(e,t,n){
var r=Rt.exec(t);
return r?Math.max(0,r[1]-(n||0))+(r[2]||'px'):t
}
function en(e,t,n,r){
var i=n===(r?'border':'content')?4:t==='width'?1:0,s=0;
for(;i<4;i+=2)
n==='margin'&&(s+=v.css(e,n+$t[i],!0)),r?(n==='content'&&(s-=parseFloat(Dt(e,'padding'+$t[i]))||0),n!=='margin'&&(s-=parseFloat(Dt(e,'border'+$t[i]+'Width'))||0)):(s+=parseFloat(Dt(e,'padding'+$t[i]))||0,n!=='padding'&&(s+=parseFloat(Dt(e,'border'+$t[i]+'Width'))||0));
return s
}
function tn(e,t,n){
var r=t==='width'?e.offsetWidth:e.offsetHeight,i=!0,s=v.support.boxSizing&&v.css(e,'boxSizing')==='border-box';
if(r<=0||r==null){
r=Dt(e,t);
if(r<0||r==null)
r=e.style[t];
if(Ut.test(r))
return r;
i=s&&(v.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0
}
return r+en(e,t,n||(s?'border':'content'),i)+'px'
}
function nn(e){
if(Wt[e])
return Wt[e];
var t=v('<'+e+'>').appendTo(i.body),n=t.css('display');
t.remove();
if(n==='none'||n===''){
Pt=i.body.appendChild(Pt||v.extend(i.createElement('iframe'),{
frameBorder:0,
width:0,
height:0
}));
if(!Ht||!Pt.createElement)
Ht=(Pt.contentWindow||Pt.contentDocument).document,Ht.write('<!doctype html><html><body>'),Ht.close();
t=Ht.body.appendChild(Ht.createElement(e)),n=Dt(t,'display'),i.body.removeChild(Pt)
}
return Wt[e]=n,n
}
function fn(e,t,n,r){
var i;
if(v.isArray(t))
v.each(t,function(t,i){
n||sn.test(e)?r(e,i):fn(e+'['+(typeof i=='object'?t:'')+']',i,n,r)
});
else if(!n&&v.type(t)==='object')
for(i in t)
fn(e+'['+i+']',t[i],n,r);
else
r(e,t)
}
function Cn(e){
return function(t,n){
typeof t!='string'&&(n=t,t='*');
var r,i,s,o=t.toLowerCase().split(y),u=0,a=o.length;
if(v.isFunction(n))
for(;u<a;u++)
r=o[u],s=/^\+/.test(r),s&&(r=r.substr(1)||'*'),i=e[r]=e[r]||[],i[s?'unshift':'push'](n)
}
}
function kn(e,n,r,i,s,o){
s=s||n.dataTypes[0],o=o||{},o[s]=!0;
var u,a=e[s],f=0,l=a?a.length:0,c=e===Sn;
for(;f<l&&(c||!u);f++)
u=a[f](n,r,i),typeof u=='string'&&(!c||o[u]?u=t:(n.dataTypes.unshift(u),u=kn(e,n,r,i,u,o)));
return(c||!u)&&!o['*']&&(u=kn(e,n,r,i,'*',o)),u
}
function Ln(e,n){
var r,i,s=v.ajaxSettings.flatOptions||{};
for(r in n)
n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);
i&&v.extend(!0,e,i)
}
function An(e,n,r){
var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;
for(s in l)
s in r&&(n[l[s]]=r[s]);
while(f[0]==='*')
f.shift(),i===t&&(i=e.mimeType||n.getResponseHeader('content-type'));
if(i)
for(s in a)
if(a[s]&&a[s].test(i)){
f.unshift(s);
break
}
if(f[0]in r)
o=f[0];
else{
for(s in r){
if(!f[0]||e.converters[s+' '+f[0]]){
o=s;
break
}
u||(u=s)
}
o=o||u
}
if(o)
return o!==f[0]&&f.unshift(o),r[o]
}
function On(e,t){
var n,r,i,s,o=e.dataTypes.slice(),u=o[0],a={},f=0;
e.dataFilter&&(t=e.dataFilter(t,e.dataType));
if(o[1])
for(n in e.converters)
a[n.toLowerCase()]=e.converters[n];
for(;i=o[++f];)
if(i!=='*'){
if(u!=='*'&&u!==i){
n=a[u+' '+i]||a['* '+i];
if(!n)
for(r in a){
s=r.split(' ');
if(s[1]===i){
n=a[u+' '+s[0]]||a['* '+s[0]];
if(n){
n===!0?n=a[r]:a[r]!==!0&&(i=s[0],o.splice(f--,0,i));
break
}
}
}
if(n!==!0)
if(n&&e['throws'])
t=n(t);
else
try{
t=n(t)
}catch(l){
return{
state:'parsererror',
error:n?l:'No conversion from '+u+' to '+i
}
}
}
u=i
}
return{
state:'success',
data:t
}
}
function Fn(){
try{
return new e.XMLHttpRequest
}catch(t){
}
}
function In(){
try{
return new e.ActiveXObject('Microsoft.XMLHTTP')
}catch(t){
}
}
function $n(){
return setTimeout(function(){
qn=t
},0),qn=v.now()
}
function Jn(e,t){
v.each(t,function(t,n){
var r=(Vn[t]||[]).concat(Vn['*']),i=0,s=r.length;
for(;i<s;i++)
if(r[i].call(e,t,n))
return
})
}
function Kn(e,t,n){
var r,i=0,s=0,o=Xn.length,u=v.Deferred().always(function(){
delete a.elem
}),a=function(){
var t=qn||$n(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,i=1-r,s=0,o=f.tweens.length;
for(;s<o;s++)
f.tweens[s].run(i);
return u.notifyWith(e,[
f,
i,
n
]),i<1&&o?n:(u.resolveWith(e,[f]),!1)
},f=u.promise({
elem:e,
props:v.extend({},t),
opts:v.extend(!0,{specialEasing:{}},n),
originalProperties:t,
originalOptions:n,
startTime:qn||$n(),
duration:n.duration,
tweens:[],
createTween:function(t,n,r){
var i=v.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);
return f.tweens.push(i),i
},
stop:function(t){
var n=0,r=t?f.tweens.length:0;
for(;n<r;n++)
f.tweens[n].run(1);
return t?u.resolveWith(e,[
f,
t
]):u.rejectWith(e,[
f,
t
]),this
}
}),l=f.props;
Qn(l,f.opts.specialEasing);
for(;i<o;i++){
r=Xn[i].call(f,e,l,f.opts);
if(r)
return r
}
return Jn(f,l),v.isFunction(f.opts.start)&&f.opts.start.call(e,f),v.fx.timer(v.extend(a,{
anim:f,
queue:f.opts.queue,
elem:e
})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)
}
function Qn(e,t){
var n,r,i,s,o;
for(n in e){
r=v.camelCase(n),i=t[r],s=e[n],v.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=v.cssHooks[r];
if(o&&'expand'in o){
s=o.expand(s),delete e[r];
for(n in s)
n in e||(e[n]=s[n],t[n]=i)
}else
t[r]=i
}
}
function Gn(e,t,n){
var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},m=[],g=e.nodeType&&Gt(e);
n.queue||(l=v._queueHooks(e,'fx'),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){
l.unqueued||c()
}),l.unqueued++,h.always(function(){
h.always(function(){
l.unqueued--,v.queue(e,'fx').length||l.empty.fire()
})
})),e.nodeType===1&&('height'in t||'width'in t)&&(n.overflow=[
p.overflow,
p.overflowX,
p.overflowY
],v.css(e,'display')==='inline'&&v.css(e,'float')==='none'&&(!v.support.inlineBlockNeedsLayout||nn(e.nodeName)==='inline'?p.display='inline-block':p.zoom=1)),n.overflow&&(p.overflow='hidden',v.support.shrinkWrapBlocks||h.done(function(){
p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]
}));
for(r in t){
s=t[r];
if(Un.exec(s)){
delete t[r],a=a||s==='toggle';
if(s===(g?'hide':'show'))
continue;
m.push(r)
}
}
o=m.length;
if(o){
u=v._data(e,'fxshow')||v._data(e,'fxshow',{}),'hidden'in u&&(g=u.hidden),a&&(u.hidden=!g),g?v(e).show():h.done(function(){
v(e).hide()
}),h.done(function(){
var t;
v.removeData(e,'fxshow',!0);
for(t in d)
v.style(e,t,d[t])
});
for(r=0;r<o;r++)
i=m[r],f=h.createTween(i,g?u[i]:0),d[i]=u[i]||v.style(e,i),i in u||(u[i]=f.start,g&&(f.end=f.start,f.start=i==='width'||i==='height'?1:0))
}
}
function Yn(e,t,n,r,i){
return new Yn.prototype.init(e,t,n,r,i)
}
function Zn(e,t){
var n,r={height:e},i=0;
t=t?1:0;
for(;i<4;i+=2-t)
n=$t[i],r['margin'+n]=r['padding'+n]=e;
return t&&(r.opacity=r.width=e),r
}
function tr(e){
return v.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1
}
var n,r,i=e.document,s=e.location,o=e.navigator,u=e.jQuery,a=e.$,f=Array.prototype.push,l=Array.prototype.slice,c=Array.prototype.indexOf,h=Object.prototype.toString,p=Object.prototype.hasOwnProperty,d=String.prototype.trim,v=function(e,t){
return new v.fn.init(e,t,n)
},m=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,g=/\S/,y=/\s+/,b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,w=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,T=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,N=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,C=/^-ms-/,k=/-([\da-z])/gi,L=function(e,t){
return(t+'').toUpperCase()
},A=function(){
i.addEventListener?(i.removeEventListener('DOMContentLoaded',A,!1),v.ready()):i.readyState==='complete'&&(i.detachEvent('onreadystatechange',A),v.ready())
},O={};
v.fn=v.prototype={
constructor:v,
init:function(e,n,r){
var s,o,u,a;
if(!e)
return this;
if(e.nodeType)
return this.context=this[0]=e,this.length=1,this;
if(typeof e=='string'){
e.charAt(0)==='<'&&e.charAt(e.length-1)==='>'&&e.length>=3?s=[
null,
e,
null
]:s=w.exec(e);
if(s&&(s[1]||!n)){
if(s[1])
return n=n instanceof v?n[0]:n,a=n&&n.nodeType?n.ownerDocument||n:i,e=v.parseHTML(s[1],a,!0),E.test(s[1])&&v.isPlainObject(n)&&this.attr.call(e,n,!0),v.merge(this,e);
o=i.getElementById(s[2]);
if(o&&o.parentNode){
if(o.id!==s[2])
return r.find(e);
this.length=1,this[0]=o
}
return this.context=i,this.selector=e,this
}
return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)
}
return v.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),v.makeArray(e,this))
},
selector:'',
jquery:'1.8.3',
length:0,
size:function(){
return this.length
},
toArray:function(){
return l.call(this)
},
get:function(e){
return e==null?this.toArray():e<0?this[this.length+e]:this[e]
},
pushStack:function(e,t,n){
var r=v.merge(this.constructor(),e);
return r.prevObject=this,r.context=this.context,t==='find'?r.selector=this.selector+(this.selector?' ':'')+n:t&&(r.selector=this.selector+'.'+t+'('+n+')'),r
},
each:function(e,t){
return v.each(this,e,t)
},
ready:function(e){
return v.ready.promise().done(e),this
},
eq:function(e){
return e=+e,e===-1?this.slice(e):this.slice(e,e+1)
},
first:function(){
return this.eq(0)
},
last:function(){
return this.eq(-1)
},
slice:function(){
return this.pushStack(l.apply(this,arguments),'slice',l.call(arguments).join(','))
},
map:function(e){
return this.pushStack(v.map(this,function(t,n){
return e.call(t,n,t)
}))
},
end:function(){
return this.prevObject||this.constructor(null)
},
push:f,
sort:[].sort,
splice:[].splice
},v.fn.init.prototype=v.fn,v.extend=v.fn.extend=function(){
var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;
typeof u=='boolean'&&(l=u,u=arguments[1]||{},a=2),typeof u!='object'&&!v.isFunction(u)&&(u={}),f===a&&(u=this,--a);
for(;a<f;a++)
if((e=arguments[a])!=null)
for(n in e){
r=u[n],i=e[n];
if(u===i)
continue;
l&&i&&(v.isPlainObject(i)||(s=v.isArray(i)))?(s?(s=!1,o=r&&v.isArray(r)?r:[]):o=r&&v.isPlainObject(r)?r:{},u[n]=v.extend(l,o,i)):i!==t&&(u[n]=i)
}
return u
},v.extend({
noConflict:function(t){
return e.$===v&&(e.$=a),t&&e.jQuery===v&&(e.jQuery=u),v
},
isReady:!1,
readyWait:1,
holdReady:function(e){
e?v.readyWait++:v.ready(!0)
},
ready:function(e){
if(e===!0?--v.readyWait:v.isReady)
return;
if(!i.body)
return setTimeout(v.ready,1);
v.isReady=!0;
if(e!==!0&&--v.readyWait>0)
return;
r.resolveWith(i,[v]),v.fn.trigger&&v(i).trigger('ready').off('ready')
},
isFunction:function(e){
return v.type(e)==='function'
},
isArray:Array.isArray||function(e){
return v.type(e)==='array'
},
isWindow:function(e){
return e!=null&&e==e.window
},
isNumeric:function(e){
return!isNaN(parseFloat(e))&&isFinite(e)
},
type:function(e){
return e==null?String(e):O[h.call(e)]||'object'
},
isPlainObject:function(e){
if(!e||v.type(e)!=='object'||e.nodeType||v.isWindow(e))
return!1;
try{
if(e.constructor&&!p.call(e,'constructor')&&!p.call(e.constructor.prototype,'isPrototypeOf'))
return!1
}catch(n){
return!1
}
var r;
for(r in e);
return r===t||p.call(e,r)
},
isEmptyObject:function(e){
var t;
for(t in e)
return!1;
return!0
},
error:function(e){
throw new Error(e)
},
parseHTML:function(e,t,n){
var r;
return!e||typeof e!='string'?null:(typeof t=='boolean'&&(n=t,t=0),t=t||i,(r=E.exec(e))?[t.createElement(r[1])]:(r=v.buildFragment([e],t,n?null:[]),v.merge([],(r.cacheable?v.clone(r.fragment):r.fragment).childNodes)))
},
parseJSON:function(t){
if(!t||typeof t!='string')
return null;
t=v.trim(t);
if(e.JSON&&e.JSON.parse)
return e.JSON.parse(t);
if(S.test(t.replace(T,'@').replace(N,']').replace(x,'')))
return new Function('return '+t)();
v.error('Invalid JSON: '+t)
},
parseXML:function(n){
var r,i;
if(!n||typeof n!='string')
return null;
try{
e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,'text/xml')):(r=new ActiveXObject('Microsoft.XMLDOM'),r.async='false',r.loadXML(n))
}catch(s){
r=t
}
return(!r||!r.documentElement||r.getElementsByTagName('parsererror').length)&&v.error('Invalid XML: '+n),r
},
noop:function(){
},
globalEval:function(t){
t&&g.test(t)&&(e.execScript||function(t){
e.eval.call(e,t)
})(t)
},
camelCase:function(e){
return e.replace(C,'ms-').replace(k,L)
},
nodeName:function(e,t){
return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()
},
each:function(e,n,r){
var i,s=0,o=e.length,u=o===t||v.isFunction(e);
if(r){
if(u){
for(i in e)
if(n.apply(e[i],r)===!1)
break
}else
for(;s<o;)
if(n.apply(e[s++],r)===!1)
break
}else if(u){
for(i in e)
if(n.call(e[i],i,e[i])===!1)
break
}else
for(;s<o;)
if(n.call(e[s],s,e[s++])===!1)
break;
return e
},
trim:d&&!d.call('﻿ ')?function(e){
return e==null?'':d.call(e)
}:function(e){
return e==null?'':(e+'').replace(b,'')
},
makeArray:function(e,t){
var n,r=t||[];
return e!=null&&(n=v.type(e),e.length==null||n==='string'||n==='function'||n==='regexp'||v.isWindow(e)?f.call(r,e):v.merge(r,e)),r
},
inArray:function(e,t,n){
var r;
if(t){
if(c)
return c.call(t,e,n);
r=t.length,n=n?n<0?Math.max(0,r+n):n:0;
for(;n<r;n++)
if(n in t&&t[n]===e)
return n
}
return-1
},
merge:function(e,n){
var r=n.length,i=e.length,s=0;
if(typeof r=='number')
for(;s<r;s++)
e[i++]=n[s];
else
while(n[s]!==t)
e[i++]=n[s++];
return e.length=i,e
},
grep:function(e,t,n){
var r,i=[],s=0,o=e.length;
n=!!n;
for(;s<o;s++)
r=!!t(e[s],s),n!==r&&i.push(e[s]);
return i
},
map:function(e,n,r){
var i,s,o=[],u=0,a=e.length,f=e instanceof v||a!==t&&typeof a=='number'&&(a>0&&e[0]&&e[a-1]||a===0||v.isArray(e));
if(f)
for(;u<a;u++)
i=n(e[u],u,r),i!=null&&(o[o.length]=i);
else
for(s in e)
i=n(e[s],s,r),i!=null&&(o[o.length]=i);
return o.concat.apply([],o)
},
guid:1,
proxy:function(e,n){
var r,i,s;
return typeof n=='string'&&(r=e[n],n=e,e=r),v.isFunction(e)?(i=l.call(arguments,2),s=function(){
return e.apply(n,i.concat(l.call(arguments)))
},s.guid=e.guid=e.guid||v.guid++,s):t
},
access:function(e,n,r,i,s,o,u){
var a,f=r==null,l=0,c=e.length;
if(r&&typeof r=='object'){
for(l in r)
v.access(e,n,l,r[l],1,o,i);
s=1
}else if(i!==t){
a=u===t&&v.isFunction(i),f&&(a?(a=n,n=function(e,t,n){
return a.call(v(e),n)
}):(n.call(e,i),n=null));
if(n)
for(;l<c;l++)
n(e[l],r,a?i.call(e[l],l,n(e[l],r)):i,u);
s=1
}
return s?e:f?n.call(e):c?n(e[0],r):o
},
now:function(){
return new Date().getTime()
}
}),v.ready.promise=function(t){
if(!r){
r=v.Deferred();
if(i.readyState==='complete')
setTimeout(v.ready,1);
else if(i.addEventListener)
i.addEventListener('DOMContentLoaded',A,!1),e.addEventListener('load',v.ready,!1);
else{
i.attachEvent('onreadystatechange',A),e.attachEvent('onload',v.ready);
var n=!1;
try{
n=e.frameElement==null&&i.documentElement
}catch(s){
}
n&&n.doScroll&&function o(){
if(!v.isReady){
try{
n.doScroll('left')
}catch(e){
return setTimeout(o,50)
}
v.ready()
}
}()
}
}
return r.promise(t)
},v.each('Boolean Number String Function Array Date RegExp Object'.split(' '),function(e,t){
O['[object '+t+']']=t.toLowerCase()
}),n=v(i);
var M={};
v.Callbacks=function(e){
e=typeof e=='string'?M[e]||_(e):v.extend({},e);
var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){
n=e.memory&&t,r=!0,u=s||0,s=0,o=a.length,i=!0;
for(;a&&u<o;u++)
if(a[u].apply(t[0],t[1])===!1&&e.stopOnFalse){
n=!1;
break
}
i=!1,a&&(f?f.length&&l(f.shift()):n?a=[]:c.disable())
},c={
add:function(){
if(a){
var t=a.length;
(function r(t){
v.each(t,function(t,n){
var i=v.type(n);
i==='function'?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&i!=='string'&&r(n)
})
}(arguments),i?o=a.length:n&&(s=t,l(n)))
}
return this
},
remove:function(){
return a&&v.each(arguments,function(e,t){
var n;
while((n=v.inArray(t,a,n))>-1)
a.splice(n,1),i&&(n<=o&&o--,n<=u&&u--)
}),this
},
has:function(e){
return v.inArray(e,a)>-1
},
empty:function(){
return a=[],this
},
disable:function(){
return a=f=n=t,this
},
disabled:function(){
return!a
},
lock:function(){
return f=t,n||c.disable(),this
},
locked:function(){
return!f
},
fireWith:function(e,t){
return t=t||[],t=[
e,
t.slice?t.slice():t
],a&&(!r||f)&&(i?f.push(t):l(t)),this
},
fire:function(){
return c.fireWith(this,arguments),this
},
fired:function(){
return!!r
}
};
return c
},v.extend({
Deferred:function(e){
var t=[
[
'resolve',
'done',
v.Callbacks('once memory'),
'resolved'
],
[
'reject',
'fail',
v.Callbacks('once memory'),
'rejected'
],
[
'notify',
'progress',
v.Callbacks('memory')
]
],n='pending',r={
state:function(){
return n
},
always:function(){
return i.done(arguments).fail(arguments),this
},
then:function(){
var e=arguments;
return v.Deferred(function(n){
v.each(t,function(t,r){
var s=r[0],o=e[t];
i[r[1]](v.isFunction(o)?function(){
var e=o.apply(this,arguments);
e&&v.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+'With'](this===i?n:this,[e])
}:n[s])
}),e=null
}).promise()
},
promise:function(e){
return e!=null?v.extend(e,r):r
}
},i={};
return r.pipe=r.then,v.each(t,function(e,s){
var o=s[2],u=s[3];
r[s[1]]=o.add,u&&o.add(function(){
n=u
},t[e^1][2].disable,t[2][2].lock),i[s[0]]=o.fire,i[s[0]+'With']=o.fireWith
}),r.promise(i),e&&e.call(i,i),i
},
when:function(e){
var t=0,n=l.call(arguments),r=n.length,i=r!==1||e&&v.isFunction(e.promise)?r:0,s=i===1?e:v.Deferred(),o=function(e,t,n){
return function(r){
t[e]=this,n[e]=arguments.length>1?l.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)
}
},u,a,f;
if(r>1){
u=new Array(r),a=new Array(r),f=new Array(r);
for(;t<r;t++)
n[t]&&v.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i
}
return i||s.resolveWith(f,n),s.promise()
}
}),v.support=function(){
var t,n,r,s,o,u,a,f,l,c,h,p=i.createElement('div');
p.setAttribute('className','t'),p.innerHTML='  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>',n=p.getElementsByTagName('*'),r=p.getElementsByTagName('a')[0];
if(!n||!r||!n.length)
return{};
s=i.createElement('select'),o=s.appendChild(i.createElement('option')),u=p.getElementsByTagName('input')[0],r.style.cssText='top:1px;float:left;opacity:.5',t={
leadingWhitespace:p.firstChild.nodeType===3,
tbody:!p.getElementsByTagName('tbody').length,
htmlSerialize:!!p.getElementsByTagName('link').length,
style:/top/.test(r.getAttribute('style')),
hrefNormalized:r.getAttribute('href')==='/a',
opacity:/^0.5/.test(r.style.opacity),
cssFloat:!!r.style.cssFloat,
checkOn:u.value==='on',
optSelected:o.selected,
getSetAttribute:p.className!=='t',
enctype:!!i.createElement('form').enctype,
html5Clone:i.createElement('nav').cloneNode(!0).outerHTML!=='<:nav></:nav>',
boxModel:i.compatMode==='CSS1Compat',
submitBubbles:!0,
changeBubbles:!0,
focusinBubbles:!1,
deleteExpando:!0,
noCloneEvent:!0,
inlineBlockNeedsLayout:!1,
shrinkWrapBlocks:!1,
reliableMarginRight:!0,
boxSizingReliable:!0,
pixelPosition:!1
},u.checked=!0,t.noCloneChecked=u.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!o.disabled;
try{
delete p.test
}catch(d){
t.deleteExpando=!1
}
!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent('onclick',h=function(){
t.noCloneEvent=!1
}),p.cloneNode(!0).fireEvent('onclick'),p.detachEvent('onclick',h)),u=i.createElement('input'),u.value='t',u.setAttribute('type','radio'),t.radioValue=u.value==='t',u.setAttribute('checked','checked'),u.setAttribute('name','t'),p.appendChild(u),a=i.createDocumentFragment(),a.appendChild(p.lastChild),t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=u.checked,a.removeChild(u),a.appendChild(p);
if(p.attachEvent)
for(l in{
submit:!0,
change:!0,
focusin:!0
})
f='on'+l,c=f in p,c||(p.setAttribute(f,'return;'),c=typeof p[f]=='function'),t[l+'Bubbles']=c;
return v(function(){
var n,r,s,o,u='padding:0;margin:0;border:0;display:block;overflow:hidden;',a=i.getElementsByTagName('body')[0];
if(!a)
return;
n=i.createElement('div'),n.style.cssText='visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px',a.insertBefore(n,a.firstChild),r=i.createElement('div'),n.appendChild(r),r.innerHTML='<table><tr><td></td><td>t</td></tr></table>',s=r.getElementsByTagName('td'),s[0].style.cssText='padding:0;margin:0;border:0;display:none',c=s[0].offsetHeight===0,s[0].style.display='',s[1].style.display='none',t.reliableHiddenOffsets=c&&s[0].offsetHeight===0,r.innerHTML='',r.style.cssText='box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;',t.boxSizing=r.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(r,null)||{}).top!=='1%',t.boxSizingReliable=(e.getComputedStyle(r,null)||{width:'4px'}).width==='4px',o=i.createElement('div'),o.style.cssText=r.style.cssText=u,o.style.marginRight=o.style.width='0',r.style.width='1px',r.appendChild(o),t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),typeof r.style.zoom!='undefined'&&(r.innerHTML='',r.style.cssText=u+'width:1px;padding:1px;display:inline;zoom:1',t.inlineBlockNeedsLayout=r.offsetWidth===3,r.style.display='block',r.style.overflow='visible',r.innerHTML='<div></div>',r.firstChild.style.width='5px',t.shrinkWrapBlocks=r.offsetWidth!==3,n.style.zoom=1),a.removeChild(n),n=r=s=o=null
}),a.removeChild(p),n=r=s=o=u=a=p=null,t
}();
var D=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;
v.extend({
cache:{},
deletedIds:[],
uuid:0,
expando:'jQuery'+(v.fn.jquery+Math.random()).replace(/\D/g,''),
noData:{
embed:!0,
object:'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000',
applet:!0
},
hasData:function(e){
return e=e.nodeType?v.cache[e[v.expando]]:e[v.expando],!!e&&!B(e)
},
data:function(e,n,r,i){
if(!v.acceptData(e))
return;
var s,o,u=v.expando,a=typeof n=='string',f=e.nodeType,l=f?v.cache:e,c=f?e[u]:e[u]&&u;
if((!c||!l[c]||!i&&!l[c].data)&&a&&r===t)
return;
c||(f?e[u]=c=v.deletedIds.pop()||v.guid++:c=u),l[c]||(l[c]={},f||(l[c].toJSON=v.noop));
if(typeof n=='object'||typeof n=='function')
i?l[c]=v.extend(l[c],n):l[c].data=v.extend(l[c].data,n);
return s=l[c],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[v.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[v.camelCase(n)])):o=s,o
},
removeData:function(e,t,n){
if(!v.acceptData(e))
return;
var r,i,s,o=e.nodeType,u=o?v.cache:e,a=o?e[v.expando]:v.expando;
if(!u[a])
return;
if(t){
r=n?u[a]:u[a].data;
if(r){
v.isArray(t)||(t in r?t=[t]:(t=v.camelCase(t),t in r?t=[t]:t=t.split(' ')));
for(i=0,s=t.length;i<s;i++)
delete r[t[i]];
if(!(n?B:v.isEmptyObject)(r))
return
}
}
if(!n){
delete u[a].data;
if(!B(u[a]))
return
}
o?v.cleanData([e],!0):v.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null
},
_data:function(e,t,n){
return v.data(e,t,n,!0)
},
acceptData:function(e){
var t=e.nodeName&&v.noData[e.nodeName.toLowerCase()];
return!t||t!==!0&&e.getAttribute('classid')===t
}
}),v.fn.extend({
data:function(e,n){
var r,i,s,o,u,a=this[0],f=0,l=null;
if(e===t){
if(this.length){
l=v.data(a);
if(a.nodeType===1&&!v._data(a,'parsedAttrs')){
s=a.attributes;
for(u=s.length;f<u;f++)
o=s[f].name,o.indexOf('data-')||(o=v.camelCase(o.substring(5)),H(a,o,l[o]));
v._data(a,'parsedAttrs',!0)
}
}
return l
}
return typeof e=='object'?this.each(function(){
v.data(this,e)
}):(r=e.split('.',2),r[1]=r[1]?'.'+r[1]:'',i=r[1]+'!',v.access(this,function(n){
if(n===t)
return l=this.triggerHandler('getData'+i,[r[0]]),l===t&&a&&(l=v.data(a,e),l=H(a,e,l)),l===t&&r[1]?this.data(r[0]):l;
r[1]=n,this.each(function(){
var t=v(this);
t.triggerHandler('setData'+i,r),v.data(this,e,n),t.triggerHandler('changeData'+i,r)
})
},null,n,arguments.length>1,null,!1))
},
removeData:function(e){
return this.each(function(){
v.removeData(this,e)
})
}
}),v.extend({
queue:function(e,t,n){
var r;
if(e)
return t=(t||'fx')+'queue',r=v._data(e,t),n&&(!r||v.isArray(n)?r=v._data(e,t,v.makeArray(n)):r.push(n)),r||[]
},
dequeue:function(e,t){
t=t||'fx';
var n=v.queue(e,t),r=n.length,i=n.shift(),s=v._queueHooks(e,t),o=function(){
v.dequeue(e,t)
};
i==='inprogress'&&(i=n.shift(),r--),i&&(t==='fx'&&n.unshift('inprogress'),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()
},
_queueHooks:function(e,t){
var n=t+'queueHooks';
return v._data(e,n)||v._data(e,n,{
empty:v.Callbacks('once memory').add(function(){
v.removeData(e,t+'queue',!0),v.removeData(e,n,!0)
})
})
}
}),v.fn.extend({
queue:function(e,n){
var r=2;
return typeof e!='string'&&(n=e,e='fx',r--),arguments.length<r?v.queue(this[0],e):n===t?this:this.each(function(){
var t=v.queue(this,e,n);
v._queueHooks(this,e),e==='fx'&&t[0]!=='inprogress'&&v.dequeue(this,e)
})
},
dequeue:function(e){
return this.each(function(){
v.dequeue(this,e)
})
},
delay:function(e,t){
return e=v.fx?v.fx.speeds[e]||e:e,t=t||'fx',this.queue(t,function(t,n){
var r=setTimeout(t,e);
n.stop=function(){
clearTimeout(r)
}
})
},
clearQueue:function(e){
return this.queue(e||'fx',[])
},
promise:function(e,n){
var r,i=1,s=v.Deferred(),o=this,u=this.length,a=function(){
--i||s.resolveWith(o,[o])
};
typeof e!='string'&&(n=e,e=t),e=e||'fx';
while(u--)
r=v._data(o[u],e+'queueHooks'),r&&r.empty&&(i++,r.empty.add(a));
return a(),s.promise(n)
}
});
var j,F,I,q=/[\t\r\n]/g,R=/\r/g,U=/^(?:button|input)$/i,z=/^(?:button|input|object|select|textarea)$/i,W=/^a(?:rea|)$/i,X=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,V=v.support.getSetAttribute;
v.fn.extend({
attr:function(e,t){
return v.access(this,v.attr,e,t,arguments.length>1)
},
removeAttr:function(e){
return this.each(function(){
v.removeAttr(this,e)
})
},
prop:function(e,t){
return v.access(this,v.prop,e,t,arguments.length>1)
},
removeProp:function(e){
return e=v.propFix[e]||e,this.each(function(){
try{
this[e]=t,delete this[e]
}catch(n){
}
})
},
addClass:function(e){
var t,n,r,i,s,o,u;
if(v.isFunction(e))
return this.each(function(t){
v(this).addClass(e.call(this,t,this.className))
});
if(e&&typeof e=='string'){
t=e.split(y);
for(n=0,r=this.length;n<r;n++){
i=this[n];
if(i.nodeType===1)
if(!i.className&&t.length===1)
i.className=e;
else{
s=' '+i.className+' ';
for(o=0,u=t.length;o<u;o++)
s.indexOf(' '+t[o]+' ')<0&&(s+=t[o]+' ');
i.className=v.trim(s)
}
}
}
return this
},
removeClass:function(e){
var n,r,i,s,o,u,a;
if(v.isFunction(e))
return this.each(function(t){
v(this).removeClass(e.call(this,t,this.className))
});
if(e&&typeof e=='string'||e===t){
n=(e||'').split(y);
for(u=0,a=this.length;u<a;u++){
i=this[u];
if(i.nodeType===1&&i.className){
r=(' '+i.className+' ').replace(q,' ');
for(s=0,o=n.length;s<o;s++)
while(r.indexOf(' '+n[s]+' ')>=0)
r=r.replace(' '+n[s]+' ',' ');
i.className=e?v.trim(r):''
}
}
}
return this
},
toggleClass:function(e,t){
var n=typeof e,r=typeof t=='boolean';
return v.isFunction(e)?this.each(function(n){
v(this).toggleClass(e.call(this,n,this.className,t),t)
}):this.each(function(){
if(n==='string'){
var i,s=0,o=v(this),u=t,a=e.split(y);
while(i=a[s++])
u=r?u:!o.hasClass(i),o[u?'addClass':'removeClass'](i)
}else if(n==='undefined'||n==='boolean')
this.className&&v._data(this,'__className__',this.className),this.className=this.className||e===!1?'':v._data(this,'__className__')||''
})
},
hasClass:function(e){
var t=' '+e+' ',n=0,r=this.length;
for(;n<r;n++)
if(this[n].nodeType===1&&(' '+this[n].className+' ').replace(q,' ').indexOf(t)>=0)
return!0;
return!1
},
val:function(e){
var n,r,i,s=this[0];
if(!arguments.length){
if(s)
return n=v.valHooks[s.type]||v.valHooks[s.nodeName.toLowerCase()],n&&'get'in n&&(r=n.get(s,'value'))!==t?r:(r=s.value,typeof r=='string'?r.replace(R,''):r==null?'':r);
return
}
return i=v.isFunction(e),this.each(function(r){
var s,o=v(this);
if(this.nodeType!==1)
return;
i?s=e.call(this,r,o.val()):s=e,s==null?s='':typeof s=='number'?s+='':v.isArray(s)&&(s=v.map(s,function(e){
return e==null?'':e+''
})),n=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()];
if(!n||!('set'in n)||n.set(this,s,'value')===t)
this.value=s
})
}
}),v.extend({
valHooks:{
option:{
get:function(e){
var t=e.attributes.value;
return!t||t.specified?e.value:e.text
}
},
select:{
get:function(e){
var t,n,r=e.options,i=e.selectedIndex,s=e.type==='select-one'||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;
for(;a<u;a++){
n=r[a];
if((n.selected||a===i)&&(v.support.optDisabled?!n.disabled:n.getAttribute('disabled')===null)&&(!n.parentNode.disabled||!v.nodeName(n.parentNode,'optgroup'))){
t=v(n).val();
if(s)
return t;
o.push(t)
}
}
return o
},
set:function(e,t){
var n=v.makeArray(t);
return v(e).find('option').each(function(){
this.selected=v.inArray(v(this).val(),n)>=0
}),n.length||(e.selectedIndex=-1),n
}
}
},
attrFn:{},
attr:function(e,n,r,i){
var s,o,u,a=e.nodeType;
if(!e||a===3||a===8||a===2)
return;
if(i&&v.isFunction(v.fn[n]))
return v(e)[n](r);
if(typeof e.getAttribute=='undefined')
return v.prop(e,n,r);
u=a!==1||!v.isXMLDoc(e),u&&(n=n.toLowerCase(),o=v.attrHooks[n]||(X.test(n)?F:j));
if(r!==t){
if(r===null){
v.removeAttr(e,n);
return
}
return o&&'set'in o&&u&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+''),r)
}
return o&&'get'in o&&u&&(s=o.get(e,n))!==null?s:(s=e.getAttribute(n),s===null?t:s)
},
removeAttr:function(e,t){
var n,r,i,s,o=0;
if(t&&e.nodeType===1){
r=t.split(y);
for(;o<r.length;o++)
i=r[o],i&&(n=v.propFix[i]||i,s=X.test(i),s||v.attr(e,i,''),e.removeAttribute(V?i:n),s&&n in e&&(e[n]=!1))
}
},
attrHooks:{
type:{
set:function(e,t){
if(U.test(e.nodeName)&&e.parentNode)
v.error('type property can\'t be changed');
else if(!v.support.radioValue&&t==='radio'&&v.nodeName(e,'input')){
var n=e.value;
return e.setAttribute('type',t),n&&(e.value=n),t
}
}
},
value:{
get:function(e,t){
return j&&v.nodeName(e,'button')?j.get(e,t):t in e?e.value:null
},
set:function(e,t,n){
if(j&&v.nodeName(e,'button'))
return j.set(e,t,n);
e.value=t
}
}
},
propFix:{
tabindex:'tabIndex',
readonly:'readOnly',
'for':'htmlFor',
'class':'className',
maxlength:'maxLength',
cellspacing:'cellSpacing',
cellpadding:'cellPadding',
rowspan:'rowSpan',
colspan:'colSpan',
usemap:'useMap',
frameborder:'frameBorder',
contenteditable:'contentEditable'
},
prop:function(e,n,r){
var i,s,o,u=e.nodeType;
if(!e||u===3||u===8||u===2)
return;
return o=u!==1||!v.isXMLDoc(e),o&&(n=v.propFix[n]||n,s=v.propHooks[n]),r!==t?s&&'set'in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&'get'in s&&(i=s.get(e,n))!==null?i:e[n]
},
propHooks:{
tabIndex:{
get:function(e){
var n=e.getAttributeNode('tabindex');
return n&&n.specified?parseInt(n.value,10):z.test(e.nodeName)||W.test(e.nodeName)&&e.href?0:t
}
}
}
}),F={
get:function(e,n){
var r,i=v.prop(e,n);
return i===!0||typeof i!='boolean'&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t
},
set:function(e,t,n){
var r;
return t===!1?v.removeAttr(e,n):(r=v.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n
}
},V||(I={
name:!0,
id:!0,
coords:!0
},j=v.valHooks.button={
get:function(e,n){
var r;
return r=e.getAttributeNode(n),r&&(I[n]?r.value!=='':r.specified)?r.value:t
},
set:function(e,t,n){
var r=e.getAttributeNode(n);
return r||(r=i.createAttribute(n),e.setAttributeNode(r)),r.value=t+''
}
},v.each([
'width',
'height'
],function(e,t){
v.attrHooks[t]=v.extend(v.attrHooks[t],{
set:function(e,n){
if(n==='')
return e.setAttribute(t,'auto'),n
}
})
}),v.attrHooks.contenteditable={
get:j.get,
set:function(e,t,n){
t===''&&(t='false'),j.set(e,t,n)
}
}),v.support.hrefNormalized||v.each([
'href',
'src',
'width',
'height'
],function(e,n){
v.attrHooks[n]=v.extend(v.attrHooks[n],{
get:function(e){
var r=e.getAttribute(n,2);
return r===null?t:r
}
})
}),v.support.style||(v.attrHooks.style={
get:function(e){
return e.style.cssText.toLowerCase()||t
},
set:function(e,t){
return e.style.cssText=t+''
}
}),v.support.optSelected||(v.propHooks.selected=v.extend(v.propHooks.selected,{
get:function(e){
var t=e.parentNode;
return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null
}
})),v.support.enctype||(v.propFix.enctype='encoding'),v.support.checkOn||v.each([
'radio',
'checkbox'
],function(){
v.valHooks[this]={
get:function(e){
return e.getAttribute('value')===null?'on':e.value
}
}
}),v.each([
'radio',
'checkbox'
],function(){
v.valHooks[this]=v.extend(v.valHooks[this],{
set:function(e,t){
if(v.isArray(t))
return e.checked=v.inArray(v(e).val(),t)>=0
}
})
});
var $=/^(?:textarea|input|select)$/i,J=/^([^\.]*|)(?:\.(.+)|)$/,K=/(?:^|\s)hover(\.\S+|)\b/,Q=/^key/,G=/^(?:mouse|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=function(e){
return v.event.special.hover?e:e.replace(K,'mouseenter$1 mouseleave$1')
};
v.event={
add:function(e,n,r,i,s){
var o,u,a,f,l,c,h,p,d,m,g;
if(e.nodeType===3||e.nodeType===8||!n||!r||!(o=v._data(e)))
return;
r.handler&&(d=r,r=d.handler,s=d.selector),r.guid||(r.guid=v.guid++),a=o.events,a||(o.events=a={}),u=o.handle,u||(o.handle=u=function(e){
return typeof v=='undefined'||!!e&&v.event.triggered===e.type?t:v.event.dispatch.apply(u.elem,arguments)
},u.elem=e),n=v.trim(Z(n)).split(' ');
for(f=0;f<n.length;f++){
l=J.exec(n[f])||[],c=l[1],h=(l[2]||'').split('.').sort(),g=v.event.special[c]||{},c=(s?g.delegateType:g.bindType)||c,g=v.event.special[c]||{},p=v.extend({
type:c,
origType:l[1],
data:i,
handler:r,
guid:r.guid,
selector:s,
needsContext:s&&v.expr.match.needsContext.test(s),
namespace:h.join('.')
},d),m=a[c];
if(!m){
m=a[c]=[],m.delegateCount=0;
if(!g.setup||g.setup.call(e,i,h,u)===!1)
e.addEventListener?e.addEventListener(c,u,!1):e.attachEvent&&e.attachEvent('on'+c,u)
}
g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),v.event.global[c]=!0
}
e=null
},
global:{},
remove:function(e,t,n,r,i){
var s,o,u,a,f,l,c,h,p,d,m,g=v.hasData(e)&&v._data(e);
if(!g||!(h=g.events))
return;
t=v.trim(Z(t||'')).split(' ');
for(s=0;s<t.length;s++){
o=J.exec(t[s])||[],u=a=o[1],f=o[2];
if(!u){
for(u in h)
v.event.remove(e,u+t[s],n,r,!0);
continue
}
p=v.event.special[u]||{},u=(r?p.delegateType:p.bindType)||u,d=h[u]||[],l=d.length,f=f?new RegExp('(^|\\.)'+f.split('.').sort().join('\\.(?:.*\\.|)')+'(\\.|$)'):null;
for(c=0;c<d.length;c++)
m=d[c],(i||a===m.origType)&&(!n||n.guid===m.guid)&&(!f||f.test(m.namespace))&&(!r||r===m.selector||r==='**'&&m.selector)&&(d.splice(c--,1),m.selector&&d.delegateCount--,p.remove&&p.remove.call(e,m));
d.length===0&&l!==d.length&&((!p.teardown||p.teardown.call(e,f,g.handle)===!1)&&v.removeEvent(e,u,g.handle),delete h[u])
}
v.isEmptyObject(h)&&(delete g.handle,v.removeData(e,'events',!0))
},
customEvent:{
getData:!0,
setData:!0,
changeData:!0
},
trigger:function(n,r,s,o){
if(!s||s.nodeType!==3&&s.nodeType!==8){
var u,a,f,l,c,h,p,d,m,g,y=n.type||n,b=[];
if(Y.test(y+v.event.triggered))
return;
y.indexOf('!')>=0&&(y=y.slice(0,-1),a=!0),y.indexOf('.')>=0&&(b=y.split('.'),y=b.shift(),b.sort());
if((!s||v.event.customEvent[y])&&!v.event.global[y])
return;
n=typeof n=='object'?n[v.expando]?n:new v.Event(y,n):new v.Event(y),n.type=y,n.isTrigger=!0,n.exclusive=a,n.namespace=b.join('.'),n.namespace_re=n.namespace?new RegExp('(^|\\.)'+b.join('\\.(?:.*\\.|)')+'(\\.|$)'):null,h=y.indexOf(':')<0?'on'+y:'';
if(!s){
u=v.cache;
for(f in u)
u[f].events&&u[f].events[y]&&v.event.trigger(n,r,u[f].handle.elem,!0);
return
}
n.result=t,n.target||(n.target=s),r=r!=null?v.makeArray(r):[],r.unshift(n),p=v.event.special[y]||{};
if(p.trigger&&p.trigger.apply(s,r)===!1)
return;
m=[[
s,
p.bindType||y
]];
if(!o&&!p.noBubble&&!v.isWindow(s)){
g=p.delegateType||y,l=Y.test(g+y)?s:s.parentNode;
for(c=s;l;l=l.parentNode)
m.push([
l,
g
]),c=l;
c===(s.ownerDocument||i)&&m.push([
c.defaultView||c.parentWindow||e,
g
])
}
for(f=0;f<m.length&&!n.isPropagationStopped();f++)
l=m[f][0],n.type=m[f][1],d=(v._data(l,'events')||{})[n.type]&&v._data(l,'handle'),d&&d.apply(l,r),d=h&&l[h],d&&v.acceptData(l)&&d.apply&&d.apply(l,r)===!1&&n.preventDefault();
return n.type=y,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(s.ownerDocument,r)===!1)&&(y!=='click'||!v.nodeName(s,'a'))&&v.acceptData(s)&&h&&s[y]&&(y!=='focus'&&y!=='blur'||n.target.offsetWidth!==0)&&!v.isWindow(s)&&(c=s[h],c&&(s[h]=null),v.event.triggered=y,s[y](),v.event.triggered=t,c&&(s[h]=c)),n.result
}
return
},
dispatch:function(n){
n=v.event.fix(n||e.event);
var r,i,s,o,u,a,f,c,h,p,d=(v._data(this,'events')||{})[n.type]||[],m=d.delegateCount,g=l.call(arguments),y=!n.exclusive&&!n.namespace,b=v.event.special[n.type]||{},w=[];
g[0]=n,n.delegateTarget=this;
if(b.preDispatch&&b.preDispatch.call(this,n)===!1)
return;
if(m&&(!n.button||n.type!=='click'))
for(s=n.target;s!=this;s=s.parentNode||this)
if(s.disabled!==!0||n.type!=='click'){
u={},f=[];
for(r=0;r<m;r++)
c=d[r],h=c.selector,u[h]===t&&(u[h]=c.needsContext?v(h,this).index(s)>=0:v.find(h,this,null,[s]).length),u[h]&&f.push(c);
f.length&&w.push({
elem:s,
matches:f
})
}
d.length>m&&w.push({
elem:this,
matches:d.slice(m)
});
for(r=0;r<w.length&&!n.isPropagationStopped();r++){
a=w[r],n.currentTarget=a.elem;
for(i=0;i<a.matches.length&&!n.isImmediatePropagationStopped();i++){
c=a.matches[i];
if(y||!n.namespace&&!c.namespace||n.namespace_re&&n.namespace_re.test(c.namespace))
n.data=c.data,n.handleObj=c,o=((v.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,g),o!==t&&(n.result=o,o===!1&&(n.preventDefault(),n.stopPropagation()))
}
}
return b.postDispatch&&b.postDispatch.call(this,n),n.result
},
props:'attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which'.split(' '),
fixHooks:{},
keyHooks:{
props:'char charCode key keyCode'.split(' '),
filter:function(e,t){
return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e
}
},
mouseHooks:{
props:'button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement'.split(' '),
filter:function(e,n){
var r,s,o,u=n.button,a=n.fromElement;
return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||i,s=r.documentElement,o=r.body,e.pageX=n.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e
}
},
fix:function(e){
if(e[v.expando])
return e;
var t,n,r=e,s=v.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;
e=v.Event(r);
for(t=o.length;t;)
n=o[--t],e[n]=r[n];
return e.target||(e.target=r.srcElement||i),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e
},
special:{
load:{noBubble:!0},
focus:{delegateType:'focusin'},
blur:{delegateType:'focusout'},
beforeunload:{
setup:function(e,t,n){
v.isWindow(this)&&(this.onbeforeunload=n)
},
teardown:function(e,t){
this.onbeforeunload===t&&(this.onbeforeunload=null)
}
}
},
simulate:function(e,t,n,r){
var i=v.extend(new v.Event,n,{
type:e,
isSimulated:!0,
originalEvent:{}
});
r?v.event.trigger(i,null,t):v.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()
}
},v.event.handle=v.event.dispatch,v.removeEvent=i.removeEventListener?function(e,t,n){
e.removeEventListener&&e.removeEventListener(t,n,!1)
}:function(e,t,n){
var r='on'+t;
e.detachEvent&&(typeof e[r]=='undefined'&&(e[r]=null),e.detachEvent(r,n))
},v.Event=function(e,t){
if(!(this instanceof v.Event))
return new v.Event(e,t);
e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?tt:et):this.type=e,t&&v.extend(this,t),this.timeStamp=e&&e.timeStamp||v.now(),this[v.expando]=!0
},v.Event.prototype={
preventDefault:function(){
this.isDefaultPrevented=tt;
var e=this.originalEvent;
if(!e)
return;
e.preventDefault?e.preventDefault():e.returnValue=!1
},
stopPropagation:function(){
this.isPropagationStopped=tt;
var e=this.originalEvent;
if(!e)
return;
e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0
},
stopImmediatePropagation:function(){
this.isImmediatePropagationStopped=tt,this.stopPropagation()
},
isDefaultPrevented:et,
isPropagationStopped:et,
isImmediatePropagationStopped:et
},v.each({
mouseenter:'mouseover',
mouseleave:'mouseout'
},function(e,t){
v.event.special[e]={
delegateType:t,
bindType:t,
handle:function(e){
var n,r=this,i=e.relatedTarget,s=e.handleObj,o=s.selector;
if(!i||i!==r&&!v.contains(r,i))
e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;
return n
}
}
}),v.support.submitBubbles||(v.event.special.submit={
setup:function(){
if(v.nodeName(this,'form'))
return!1;
v.event.add(this,'click._submit keypress._submit',function(e){
var n=e.target,r=v.nodeName(n,'input')||v.nodeName(n,'button')?n.form:t;
r&&!v._data(r,'_submit_attached')&&(v.event.add(r,'submit._submit',function(e){
e._submit_bubble=!0
}),v._data(r,'_submit_attached',!0))
})
},
postDispatch:function(e){
e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&v.event.simulate('submit',this.parentNode,e,!0))
},
teardown:function(){
if(v.nodeName(this,'form'))
return!1;
v.event.remove(this,'._submit')
}
}),v.support.changeBubbles||(v.event.special.change={
setup:function(){
if($.test(this.nodeName)){
if(this.type==='checkbox'||this.type==='radio')
v.event.add(this,'propertychange._change',function(e){
e.originalEvent.propertyName==='checked'&&(this._just_changed=!0)
}),v.event.add(this,'click._change',function(e){
this._just_changed&&!e.isTrigger&&(this._just_changed=!1),v.event.simulate('change',this,e,!0)
});
return!1
}
v.event.add(this,'beforeactivate._change',function(e){
var t=e.target;
$.test(t.nodeName)&&!v._data(t,'_change_attached')&&(v.event.add(t,'change._change',function(e){
this.parentNode&&!e.isSimulated&&!e.isTrigger&&v.event.simulate('change',this.parentNode,e,!0)
}),v._data(t,'_change_attached',!0))
})
},
handle:function(e){
var t=e.target;
if(this!==t||e.isSimulated||e.isTrigger||t.type!=='radio'&&t.type!=='checkbox')
return e.handleObj.handler.apply(this,arguments)
},
teardown:function(){
return v.event.remove(this,'._change'),!$.test(this.nodeName)
}
}),v.support.focusinBubbles||v.each({
focus:'focusin',
blur:'focusout'
},function(e,t){
var n=0,r=function(e){
v.event.simulate(t,e.target,v.event.fix(e),!0)
};
v.event.special[t]={
setup:function(){
n++===0&&i.addEventListener(e,r,!0)
},
teardown:function(){
--n===0&&i.removeEventListener(e,r,!0)
}
}
}),v.fn.extend({
on:function(e,n,r,i,s){
var o,u;
if(typeof e=='object'){
typeof n!='string'&&(r=r||n,n=t);
for(u in e)
this.on(u,n,r,e[u],s);
return this
}
r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=='string'?(i=r,r=t):(i=r,r=n,n=t));
if(i===!1)
i=et;
else if(!i)
return this;
return s===1&&(o=i,i=function(e){
return v().off(e),o.apply(this,arguments)
},i.guid=o.guid||(o.guid=v.guid++)),this.each(function(){
v.event.add(this,e,i,r,n)
})
},
one:function(e,t,n,r){
return this.on(e,t,n,r,1)
},
off:function(e,n,r){
var i,s;
if(e&&e.preventDefault&&e.handleObj)
return i=e.handleObj,v(e.delegateTarget).off(i.namespace?i.origType+'.'+i.namespace:i.origType,i.selector,i.handler),this;
if(typeof e=='object'){
for(s in e)
this.off(s,n,e[s]);
return this
}
if(n===!1||typeof n=='function')
r=n,n=t;
return r===!1&&(r=et),this.each(function(){
v.event.remove(this,e,r,n)
})
},
bind:function(e,t,n){
return this.on(e,null,t,n)
},
unbind:function(e,t){
return this.off(e,null,t)
},
live:function(e,t,n){
return v(this.context).on(e,this.selector,t,n),this
},
die:function(e,t){
return v(this.context).off(e,this.selector||'**',t),this
},
delegate:function(e,t,n,r){
return this.on(t,e,n,r)
},
undelegate:function(e,t,n){
return arguments.length===1?this.off(e,'**'):this.off(t,e||'**',n)
},
trigger:function(e,t){
return this.each(function(){
v.event.trigger(e,t,this)
})
},
triggerHandler:function(e,t){
if(this[0])
return v.event.trigger(e,t,this[0],!0)
},
toggle:function(e){
var t=arguments,n=e.guid||v.guid++,r=0,i=function(n){
var i=(v._data(this,'lastToggle'+e.guid)||0)%r;
return v._data(this,'lastToggle'+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1
};
i.guid=n;
while(r<t.length)
t[r++].guid=n;
return this.click(i)
},
hover:function(e,t){
return this.mouseenter(e).mouseleave(t||e)
}
}),v.each('blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu'.split(' '),function(e,t){
v.fn[t]=function(e,n){
return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)
},Q.test(t)&&(v.event.fixHooks[t]=v.event.keyHooks),G.test(t)&&(v.event.fixHooks[t]=v.event.mouseHooks)
}),function(e,t){
function nt(e,t,n,r){
n=n||[],t=t||g;
var i,s,a,f,l=t.nodeType;
if(!e||typeof e!='string')
return n;
if(l!==1&&l!==9)
return[];
a=o(t);
if(!a&&!r)
if(i=R.exec(e))
if(f=i[1]){
if(l===9){
s=t.getElementById(f);
if(!s||!s.parentNode)
return n;
if(s.id===f)
return n.push(s),n
}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(f))&&u(t,s)&&s.id===f)
return n.push(s),n
}else{
if(i[2])
return S.apply(n,x.call(t.getElementsByTagName(e),0)),n;
if((f=i[3])&&Z&&t.getElementsByClassName)
return S.apply(n,x.call(t.getElementsByClassName(f),0)),n
}
return vt(e.replace(j,'$1'),t,n,r,a)
}
function rt(e){
return function(t){
var n=t.nodeName.toLowerCase();
return n==='input'&&t.type===e
}
}
function it(e){
return function(t){
var n=t.nodeName.toLowerCase();
return(n==='input'||n==='button')&&t.type===e
}
}
function st(e){
return N(function(t){
return t=+t,N(function(n,r){
var i,s=e([],n.length,t),o=s.length;
while(o--)
n[i=s[o]]&&(n[i]=!(r[i]=n[i]))
})
})
}
function ot(e,t,n){
if(e===t)
return n;
var r=e.nextSibling;
while(r){
if(r===t)
return-1;
r=r.nextSibling
}
return 1
}
function ut(e,t){
var n,r,s,o,u,a,f,l=L[d][e+' '];
if(l)
return t?0:l.slice(0);
u=e,a=[],f=i.preFilter;
while(u){
if(!n||(r=F.exec(u)))
r&&(u=u.slice(r[0].length)||u),a.push(s=[]);
n=!1;
if(r=I.exec(u))
s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=r[0].replace(j,' ');
for(o in i.filter)
(r=J[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=o,n.matches=r);
if(!n)
break
}
return t?u.length:u?nt.error(e):L(e,a).slice(0)
}
function at(e,t,r){
var i=t.dir,s=r&&t.dir==='parentNode',o=w++;
return t.first?function(t,n,r){
while(t=t[i])
if(s||t.nodeType===1)
return e(t,n,r)
}:function(t,r,u){
if(!u){
var a,f=b+' '+o+' ',l=f+n;
while(t=t[i])
if(s||t.nodeType===1){
if((a=t[d])===l)
return t.sizset;
if(typeof a=='string'&&a.indexOf(f)===0){
if(t.sizset)
return t
}else{
t[d]=l;
if(e(t,r,u))
return t.sizset=!0,t;
t.sizset=!1
}
}
}else
while(t=t[i])
if(s||t.nodeType===1)
if(e(t,r,u))
return t
}
}
function ft(e){
return e.length>1?function(t,n,r){
var i=e.length;
while(i--)
if(!e[i](t,n,r))
return!1;
return!0
}:e[0]
}
function lt(e,t,n,r,i){
var s,o=[],u=0,a=e.length,f=t!=null;
for(;u<a;u++)
if(s=e[u])
if(!n||n(s,r,i))
o.push(s),f&&t.push(u);
return o
}
function ct(e,t,n,r,i,s){
return r&&!r[d]&&(r=ct(r)),i&&!i[d]&&(i=ct(i,s)),N(function(s,o,u,a){
var f,l,c,h=[],p=[],d=o.length,v=s||dt(t||'*',u.nodeType?[u]:u,[]),m=e&&(s||!t)?lt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;
n&&n(m,g,u,a);
if(r){
f=lt(g,p),r(f,[],u,a),l=f.length;
while(l--)
if(c=f[l])
g[p[l]]=!(m[p[l]]=c)
}
if(s){
if(i||e){
if(i){
f=[],l=g.length;
while(l--)
(c=g[l])&&f.push(m[l]=c);
i(null,g=[],f,a)
}
l=g.length;
while(l--)
(c=g[l])&&(f=i?T.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))
}
}else
g=lt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):S.apply(o,g)
})
}
function ht(e){
var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[' '],a=o?1:0,f=at(function(e){
return e===t
},u,!0),l=at(function(e){
return T.call(t,e)>-1
},u,!0),h=[function(e,n,r){
return!o&&(r||n!==c)||((t=n).nodeType?f(e,n,r):l(e,n,r))
}];
for(;a<s;a++)
if(n=i.relative[e[a].type])
h=[at(ft(h),n)];
else{
n=i.filter[e[a].type].apply(null,e[a].matches);
if(n[d]){
r=++a;
for(;r<s;r++)
if(i.relative[e[r].type])
break;
return ct(a>1&&ft(h),a>1&&e.slice(0,a-1).join('').replace(j,'$1'),n,a<r&&ht(e.slice(a,r)),r<s&&ht(e=e.slice(r)),r<s&&e.join(''))
}
h.push(n)
}
return ft(h)
}
function pt(e,t){
var r=t.length>0,s=e.length>0,o=function(u,a,f,l,h){
var p,d,v,m=[],y=0,w='0',x=u&&[],T=h!=null,N=c,C=u||s&&i.find.TAG('*',h&&a.parentNode||a),k=b+=N==null?1:Math.E;
T&&(c=a!==g&&a,n=o.el);
for(;(p=C[w])!=null;w++){
if(s&&p){
for(d=0;v=e[d];d++)
if(v(p,a,f)){
l.push(p);
break
}
T&&(b=k,n=++o.el)
}
r&&((p=!v&&p)&&y--,u&&x.push(p))
}
y+=w;
if(r&&w!==y){
for(d=0;v=t[d];d++)
v(x,m,a,f);
if(u){
if(y>0)
while(w--)
!x[w]&&!m[w]&&(m[w]=E.call(l));
m=lt(m)
}
S.apply(l,m),T&&!u&&m.length>0&&y+t.length>1&&nt.uniqueSort(l)
}
return T&&(b=k,c=N),x
};
return o.el=0,r?N(o):o
}
function dt(e,t,n){
var r=0,i=t.length;
for(;r<i;r++)
nt(e,t[r],n);
return n
}
function vt(e,t,n,r,s){
var o,u,f,l,c,h=ut(e),p=h.length;
if(!r&&h.length===1){
u=h[0]=h[0].slice(0);
if(u.length>2&&(f=u[0]).type==='ID'&&t.nodeType===9&&!s&&i.relative[u[1].type]){
t=i.find.ID(f.matches[0].replace($,''),t,s)[0];
if(!t)
return n;
e=e.slice(u.shift().length)
}
for(o=J.POS.test(e)?-1:u.length-1;o>=0;o--){
f=u[o];
if(i.relative[l=f.type])
break;
if(c=i.find[l])
if(r=c(f.matches[0].replace($,''),z.test(u[0].type)&&t.parentNode||t,s)){
u.splice(o,1),e=r.length&&u.join('');
if(!e)
return S.apply(n,x.call(r,0)),n;
break
}
}
}
return a(e,h)(r,t,s,n,z.test(e)),n
}
function mt(){
}
var n,r,i,s,o,u,a,f,l,c,h=!0,p='undefined',d=('sizcache'+Math.random()).replace('.',''),m=String,g=e.document,y=g.documentElement,b=0,w=0,E=[].pop,S=[].push,x=[].slice,T=[].indexOf||function(e){
var t=0,n=this.length;
for(;t<n;t++)
if(this[t]===e)
return t;
return-1
},N=function(e,t){
return e[d]=t==null||t,e
},C=function(){
var e={},t=[];
return N(function(n,r){
return t.push(n)>i.cacheLength&&delete e[t.shift()],e[n+' ']=r
},e)
},k=C(),L=C(),A=C(),O='[\\x20\\t\\r\\n\\f]',M='(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+',_=M.replace('w','w#'),D='([*^$|!~]?=)',P='\\['+O+'*('+M+')'+O+'*(?:'+D+O+'*(?:([\'"])((?:\\\\.|[^\\\\])*?)\\3|('+_+')|)|)'+O+'*\\]',H=':('+M+')(?:\\((?:([\'"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:'+P+')|[^:]|\\\\.)*|.*))\\)|)',B=':(even|odd|eq|gt|lt|nth|first|last)(?:\\('+O+'*((?:-\\d)?\\d*)'+O+'*\\)|)(?=[^-]|$)',j=new RegExp('^'+O+'+|((?:^|[^\\\\])(?:\\\\.)*)'+O+'+$','g'),F=new RegExp('^'+O+'*,'+O+'*'),I=new RegExp('^'+O+'*([\\x20\\t\\r\\n\\f>+~])'+O+'*'),q=new RegExp(H),R=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,U=/^:not/,z=/[\x20\t\r\n\f]*[+~]/,W=/:not\($/,X=/h\d/i,V=/input|select|textarea|button/i,$=/\\(?!\\)/g,J={
ID:new RegExp('^#('+M+')'),
CLASS:new RegExp('^\\.('+M+')'),
NAME:new RegExp('^\\[name=[\'"]?('+M+')[\'"]?\\]'),
TAG:new RegExp('^('+M.replace('w','w*')+')'),
ATTR:new RegExp('^'+P),
PSEUDO:new RegExp('^'+H),
POS:new RegExp(B,'i'),
CHILD:new RegExp('^:(only|nth|first|last)-child(?:\\('+O+'*(even|odd|(([+-]|)(\\d*)n|)'+O+'*(?:([+-]|)'+O+'*(\\d+)|))'+O+'*\\)|)','i'),
needsContext:new RegExp('^'+O+'*[>+~]|'+B,'i')
},K=function(e){
var t=g.createElement('div');
try{
return e(t)
}catch(n){
return!1
}finally{
t=null
}
},Q=K(function(e){
return e.appendChild(g.createComment('')),!e.getElementsByTagName('*').length
}),G=K(function(e){
return e.innerHTML='<a href=\'#\'></a>',e.firstChild&&typeof e.firstChild.getAttribute!==p&&e.firstChild.getAttribute('href')==='#'
}),Y=K(function(e){
e.innerHTML='<select></select>';
var t=typeof e.lastChild.getAttribute('multiple');
return t!=='boolean'&&t!=='string'
}),Z=K(function(e){
return e.innerHTML='<div class=\'hidden e\'></div><div class=\'hidden\'></div>',!e.getElementsByClassName||!e.getElementsByClassName('e').length?!1:(e.lastChild.className='e',e.getElementsByClassName('e').length===2)
}),et=K(function(e){
e.id=d+0,e.innerHTML='<a name=\''+d+'\'></a><div name=\''+d+'\'></div>',y.insertBefore(e,y.firstChild);
var t=g.getElementsByName&&g.getElementsByName(d).length===2+g.getElementsByName(d+0).length;
return r=!g.getElementById(d),y.removeChild(e),t
});
try{
x.call(y.childNodes,0)[0].nodeType
}catch(tt){
x=function(e){
var t,n=[];
for(;t=this[e];e++)
n.push(t);
return n
}
}
nt.matches=function(e,t){
return nt(e,null,null,t)
},nt.matchesSelector=function(e,t){
return nt(t,null,null,[e]).length>0
},s=nt.getText=function(e){
var t,n='',r=0,i=e.nodeType;
if(i){
if(i===1||i===9||i===11){
if(typeof e.textContent=='string')
return e.textContent;
for(e=e.firstChild;e;e=e.nextSibling)
n+=s(e)
}else if(i===3||i===4)
return e.nodeValue
}else
for(;t=e[r];r++)
n+=s(t);
return n
},o=nt.isXML=function(e){
var t=e&&(e.ownerDocument||e).documentElement;
return t?t.nodeName!=='HTML':!1
},u=nt.contains=y.contains?function(e,t){
var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;
return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))
}:y.compareDocumentPosition?function(e,t){
return t&&!!(e.compareDocumentPosition(t)&16)
}:function(e,t){
while(t=t.parentNode)
if(t===e)
return!0;
return!1
},nt.attr=function(e,t){
var n,r=o(e);
return r||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):r||Y?e.getAttribute(t):(n=e.getAttributeNode(t),n?typeof e[t]=='boolean'?e[t]?t:null:n.specified?n.value:null:null)
},i=nt.selectors={
cacheLength:50,
createPseudo:N,
match:J,
attrHandle:G?{}:{
href:function(e){
return e.getAttribute('href',2)
},
type:function(e){
return e.getAttribute('type')
}
},
find:{
ID:r?function(e,t,n){
if(typeof t.getElementById!==p&&!n){
var r=t.getElementById(e);
return r&&r.parentNode?[r]:[]
}
}:function(e,n,r){
if(typeof n.getElementById!==p&&!r){
var i=n.getElementById(e);
return i?i.id===e||typeof i.getAttributeNode!==p&&i.getAttributeNode('id').value===e?[i]:t:[]
}
},
TAG:Q?function(e,t){
if(typeof t.getElementsByTagName!==p)
return t.getElementsByTagName(e)
}:function(e,t){
var n=t.getElementsByTagName(e);
if(e==='*'){
var r,i=[],s=0;
for(;r=n[s];s++)
r.nodeType===1&&i.push(r);
return i
}
return n
},
NAME:et&&function(e,t){
if(typeof t.getElementsByName!==p)
return t.getElementsByName(name)
},
CLASS:Z&&function(e,t,n){
if(typeof t.getElementsByClassName!==p&&!n)
return t.getElementsByClassName(e)
}
},
relative:{
'>':{
dir:'parentNode',
first:!0
},
' ':{dir:'parentNode'},
'+':{
dir:'previousSibling',
first:!0
},
'~':{dir:'previousSibling'}
},
preFilter:{
ATTR:function(e){
return e[1]=e[1].replace($,''),e[3]=(e[4]||e[5]||'').replace($,''),e[2]==='~='&&(e[3]=' '+e[3]+' '),e.slice(0,4)
},
CHILD:function(e){
return e[1]=e[1].toLowerCase(),e[1]==='nth'?(e[2]||nt.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==='even'||e[2]==='odd')),e[4]=+(e[6]+e[7]||e[2]==='odd')):e[2]&&nt.error(e[0]),e
},
PSEUDO:function(e){
var t,n;
if(J.CHILD.test(e[0]))
return null;
if(e[3])
e[2]=e[3];
else if(t=e[4])
q.test(t)&&(n=ut(t,!0))&&(n=t.indexOf(')',t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t;
return e.slice(0,3)
}
},
filter:{
ID:r?function(e){
return e=e.replace($,''),function(t){
return t.getAttribute('id')===e
}
}:function(e){
return e=e.replace($,''),function(t){
var n=typeof t.getAttributeNode!==p&&t.getAttributeNode('id');
return n&&n.value===e
}
},
TAG:function(e){
return e==='*'?function(){
return!0
}:(e=e.replace($,'').toLowerCase(),function(t){
return t.nodeName&&t.nodeName.toLowerCase()===e
})
},
CLASS:function(e){
var t=k[d][e+' '];
return t||(t=new RegExp('(^|'+O+')'+e+'('+O+'|$)'))&&k(e,function(e){
return t.test(e.className||typeof e.getAttribute!==p&&e.getAttribute('class')||'')
})
},
ATTR:function(e,t,n){
return function(r,i){
var s=nt.attr(r,e);
return s==null?t==='!=':t?(s+='',t==='='?s===n:t==='!='?s!==n:t==='^='?n&&s.indexOf(n)===0:t==='*='?n&&s.indexOf(n)>-1:t==='$='?n&&s.substr(s.length-n.length)===n:t==='~='?(' '+s+' ').indexOf(n)>-1:t==='|='?s===n||s.substr(0,n.length+1)===n+'-':!1):!0
}
},
CHILD:function(e,t,n,r){
return e==='nth'?function(e){
var t,i,s=e.parentNode;
if(n===1&&r===0)
return!0;
if(s){
i=0;
for(t=s.firstChild;t;t=t.nextSibling)
if(t.nodeType===1){
i++;
if(e===t)
break
}
}
return i-=r,i===n||i%n===0&&i/n>=0
}:function(t){
var n=t;
switch(e){
case'only':
case'first':
while(n=n.previousSibling)
if(n.nodeType===1)
return!1;
if(e==='first')
return!0;
n=t;
case'last':
while(n=n.nextSibling)
if(n.nodeType===1)
return!1;
return!0
}
}
},
PSEUDO:function(e,t){
var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||nt.error('unsupported pseudo: '+e);
return r[d]?r(t):r.length>1?(n=[
e,
e,
'',
t
],i.setFilters.hasOwnProperty(e.toLowerCase())?N(function(e,n){
var i,s=r(e,t),o=s.length;
while(o--)
i=T.call(e,s[o]),e[i]=!(n[i]=s[o])
}):function(e){
return r(e,0,n)
}):r
}
},
pseudos:{
not:N(function(e){
var t=[],n=[],r=a(e.replace(j,'$1'));
return r[d]?N(function(e,t,n,i){
var s,o=r(e,null,i,[]),u=e.length;
while(u--)
if(s=o[u])
e[u]=!(t[u]=s)
}):function(e,i,s){
return t[0]=e,r(t,null,s,n),!n.pop()
}
}),
has:N(function(e){
return function(t){
return nt(e,t).length>0
}
}),
contains:N(function(e){
return function(t){
return(t.textContent||t.innerText||s(t)).indexOf(e)>-1
}
}),
enabled:function(e){
return e.disabled===!1
},
disabled:function(e){
return e.disabled===!0
},
checked:function(e){
var t=e.nodeName.toLowerCase();
return t==='input'&&!!e.checked||t==='option'&&!!e.selected
},
selected:function(e){
return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0
},
parent:function(e){
return!i.pseudos.empty(e)
},
empty:function(e){
var t;
e=e.firstChild;
while(e){
if(e.nodeName>'@'||(t=e.nodeType)===3||t===4)
return!1;
e=e.nextSibling
}
return!0
},
header:function(e){
return X.test(e.nodeName)
},
text:function(e){
var t,n;
return e.nodeName.toLowerCase()==='input'&&(t=e.type)==='text'&&((n=e.getAttribute('type'))==null||n.toLowerCase()===t)
},
radio:rt('radio'),
checkbox:rt('checkbox'),
file:rt('file'),
password:rt('password'),
image:rt('image'),
submit:it('submit'),
reset:it('reset'),
button:function(e){
var t=e.nodeName.toLowerCase();
return t==='input'&&e.type==='button'||t==='button'
},
input:function(e){
return V.test(e.nodeName)
},
focus:function(e){
var t=e.ownerDocument;
return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)
},
active:function(e){
return e===e.ownerDocument.activeElement
},
first:st(function(){
return[0]
}),
last:st(function(e,t){
return[t-1]
}),
eq:st(function(e,t,n){
return[n<0?n+t:n]
}),
even:st(function(e,t){
for(var n=0;n<t;n+=2)
e.push(n);
return e
}),
odd:st(function(e,t){
for(var n=1;n<t;n+=2)
e.push(n);
return e
}),
lt:st(function(e,t,n){
for(var r=n<0?n+t:n;--r>=0;)
e.push(r);
return e
}),
gt:st(function(e,t,n){
for(var r=n<0?n+t:n;++r<t;)
e.push(r);
return e
})
}
},f=y.compareDocumentPosition?function(e,t){
return e===t?(l=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1
}:function(e,t){
if(e===t)
return l=!0,0;
if(e.sourceIndex&&t.sourceIndex)
return e.sourceIndex-t.sourceIndex;
var n,r,i=[],s=[],o=e.parentNode,u=t.parentNode,a=o;
if(o===u)
return ot(e,t);
if(!o)
return-1;
if(!u)
return 1;
while(a)
i.unshift(a),a=a.parentNode;
a=u;
while(a)
s.unshift(a),a=a.parentNode;
n=i.length,r=s.length;
for(var f=0;f<n&&f<r;f++)
if(i[f]!==s[f])
return ot(i[f],s[f]);
return f===n?ot(e,s[f],-1):ot(i[f],t,1)
},[
0,
0
].sort(f),h=!l,nt.uniqueSort=function(e){
var t,n=[],r=1,i=0;
l=h,e.sort(f);
if(l){
for(;t=e[r];r++)
t===e[r-1]&&(i=n.push(r));
while(i--)
e.splice(n[i],1)
}
return e
},nt.error=function(e){
throw new Error('Syntax error, unrecognized expression: '+e)
},a=nt.compile=function(e,t){
var n,r=[],i=[],s=A[d][e+' '];
if(!s){
t||(t=ut(e)),n=t.length;
while(n--)
s=ht(t[n]),s[d]?r.push(s):i.push(s);
s=A(e,pt(i,r))
}
return s
},g.querySelectorAll&&function(){
var e,t=vt,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,i=[':focus'],s=[':active'],u=y.matchesSelector||y.mozMatchesSelector||y.webkitMatchesSelector||y.oMatchesSelector||y.msMatchesSelector;
K(function(e){
e.innerHTML='<select><option selected=\'\'></option></select>',e.querySelectorAll('[selected]').length||i.push('\\['+O+'*(?:checked|disabled|ismap|multiple|readonly|selected|value)'),e.querySelectorAll(':checked').length||i.push(':checked')
}),K(function(e){
e.innerHTML='<p test=\'\'></p>',e.querySelectorAll('[test^=\'\']').length&&i.push('[*^$]='+O+'*(?:""|\'\')'),e.innerHTML='<input type=\'hidden\'/>',e.querySelectorAll(':enabled').length||i.push(':enabled',':disabled')
}),i=new RegExp(i.join('|')),vt=function(e,r,s,o,u){
if(!o&&!u&&!i.test(e)){
var a,f,l=!0,c=d,h=r,p=r.nodeType===9&&e;
if(r.nodeType===1&&r.nodeName.toLowerCase()!=='object'){
a=ut(e),(l=r.getAttribute('id'))?c=l.replace(n,'\\$&'):r.setAttribute('id',c),c='[id=\''+c+'\'] ',f=a.length;
while(f--)
a[f]=c+a[f].join('');
h=z.test(e)&&r.parentNode||r,p=a.join(',')
}
if(p)
try{
return S.apply(s,x.call(h.querySelectorAll(p),0)),s
}catch(v){
}finally{
l||r.removeAttribute('id')
}
}
return t(e,r,s,o,u)
},u&&(K(function(t){
e=u.call(t,'div');
try{
u.call(t,'[test!=\'\']:sizzle'),s.push('!=',H)
}catch(n){
}
}),s=new RegExp(s.join('|')),nt.matchesSelector=function(t,n){
n=n.replace(r,'=\'$1\']');
if(!o(t)&&!s.test(n)&&!i.test(n))
try{
var a=u.call(t,n);
if(a||e||t.document&&t.document.nodeType!==11)
return a
}catch(f){
}
return nt(n,null,null,[t]).length>0
})
}(),i.pseudos.nth=i.pseudos.eq,i.filters=mt.prototype=i.pseudos,i.setFilters=new mt,nt.attr=v.attr,v.find=nt,v.expr=nt.selectors,v.expr[':']=v.expr.pseudos,v.unique=nt.uniqueSort,v.text=nt.getText,v.isXMLDoc=nt.isXML,v.contains=nt.contains
}(e);
var nt=/Until$/,rt=/^(?:parents|prev(?:Until|All))/,it=/^.[^:#\[\.,]*$/,st=v.expr.match.needsContext,ot={
children:!0,
contents:!0,
next:!0,
prev:!0
};
v.fn.extend({
find:function(e){
var t,n,r,i,s,o,u=this;
if(typeof e!='string')
return v(e).filter(function(){
for(t=0,n=u.length;t<n;t++)
if(v.contains(u[t],this))
return!0
});
o=this.pushStack('','find',e);
for(t=0,n=this.length;t<n;t++){
r=o.length,v.find(e,this[t],o);
if(t>0)
for(i=r;i<o.length;i++)
for(s=0;s<r;s++)
if(o[s]===o[i]){
o.splice(i--,1);
break
}
}
return o
},
has:function(e){
var t,n=v(e,this),r=n.length;
return this.filter(function(){
for(t=0;t<r;t++)
if(v.contains(this,n[t]))
return!0
})
},
not:function(e){
return this.pushStack(ft(this,e,!1),'not',e)
},
filter:function(e){
return this.pushStack(ft(this,e,!0),'filter',e)
},
is:function(e){
return!!e&&(typeof e=='string'?st.test(e)?v(e,this.context).index(this[0])>=0:v.filter(e,this).length>0:this.filter(e).length>0)
},
closest:function(e,t){
var n,r=0,i=this.length,s=[],o=st.test(e)||typeof e!='string'?v(e,t||this.context):0;
for(;r<i;r++){
n=this[r];
while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){
if(o?o.index(n)>-1:v.find.matchesSelector(n,e)){
s.push(n);
break
}
n=n.parentNode
}
}
return s=s.length>1?v.unique(s):s,this.pushStack(s,'closest',e)
},
index:function(e){
return e?typeof e=='string'?v.inArray(this[0],v(e)):v.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1
},
add:function(e,t){
var n=typeof e=='string'?v(e,t):v.makeArray(e&&e.nodeType?[e]:e),r=v.merge(this.get(),n);
return this.pushStack(ut(n[0])||ut(r[0])?r:v.unique(r))
},
addBack:function(e){
return this.add(e==null?this.prevObject:this.prevObject.filter(e))
}
}),v.fn.andSelf=v.fn.addBack,v.each({
parent:function(e){
var t=e.parentNode;
return t&&t.nodeType!==11?t:null
},
parents:function(e){
return v.dir(e,'parentNode')
},
parentsUntil:function(e,t,n){
return v.dir(e,'parentNode',n)
},
next:function(e){
return at(e,'nextSibling')
},
prev:function(e){
return at(e,'previousSibling')
},
nextAll:function(e){
return v.dir(e,'nextSibling')
},
prevAll:function(e){
return v.dir(e,'previousSibling')
},
nextUntil:function(e,t,n){
return v.dir(e,'nextSibling',n)
},
prevUntil:function(e,t,n){
return v.dir(e,'previousSibling',n)
},
siblings:function(e){
return v.sibling((e.parentNode||{}).firstChild,e)
},
children:function(e){
return v.sibling(e.firstChild)
},
contents:function(e){
return v.nodeName(e,'iframe')?e.contentDocument||e.contentWindow.document:v.merge([],e.childNodes)
}
},function(e,t){
v.fn[e]=function(n,r){
var i=v.map(this,t,n);
return nt.test(e)||(r=n),r&&typeof r=='string'&&(i=v.filter(r,i)),i=this.length>1&&!ot[e]?v.unique(i):i,this.length>1&&rt.test(e)&&(i=i.reverse()),this.pushStack(i,e,l.call(arguments).join(','))
}
}),v.extend({
filter:function(e,t,n){
return n&&(e=':not('+e+')'),t.length===1?v.find.matchesSelector(t[0],e)?[t[0]]:[]:v.find.matches(e,t)
},
dir:function(e,n,r){
var i=[],s=e[n];
while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!v(s).is(r)))
s.nodeType===1&&i.push(s),s=s[n];
return i
},
sibling:function(e,t){
var n=[];
for(;e;e=e.nextSibling)
e.nodeType===1&&e!==t&&n.push(e);
return n
}
});
var ct='abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video',ht=/ jQuery\d+="(?:null|\d+)"/g,pt=/^\s+/,dt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,vt=/<([\w:]+)/,mt=/<tbody/i,gt=/<|&#?\w+;/,yt=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,wt=new RegExp('<(?:'+ct+')[\\s/>]','i'),Et=/^(?:checkbox|radio)$/,St=/checked\s*(?:[^=]|=\s*.checked.)/i,xt=/\/(java|ecma)script/i,Tt=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Nt={
option:[
1,
'<select multiple=\'multiple\'>',
'</select>'
],
legend:[
1,
'<fieldset>',
'</fieldset>'
],
thead:[
1,
'<table>',
'</table>'
],
tr:[
2,
'<table><tbody>',
'</tbody></table>'
],
td:[
3,
'<table><tbody><tr>',
'</tr></tbody></table>'
],
col:[
2,
'<table><tbody></tbody><colgroup>',
'</colgroup></table>'
],
area:[
1,
'<map>',
'</map>'
],
_default:[
0,
'',
''
]
},Ct=lt(i),kt=Ct.appendChild(i.createElement('div'));
Nt.optgroup=Nt.option,Nt.tbody=Nt.tfoot=Nt.colgroup=Nt.caption=Nt.thead,Nt.th=Nt.td,v.support.htmlSerialize||(Nt._default=[
1,
'X<div>',
'</div>'
]),v.fn.extend({
text:function(e){
return v.access(this,function(e){
return e===t?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))
},null,e,arguments.length)
},
wrapAll:function(e){
if(v.isFunction(e))
return this.each(function(t){
v(this).wrapAll(e.call(this,t))
});
if(this[0]){
var t=v(e,this[0].ownerDocument).eq(0).clone(!0);
this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){
var e=this;
while(e.firstChild&&e.firstChild.nodeType===1)
e=e.firstChild;
return e
}).append(this)
}
return this
},
wrapInner:function(e){
return v.isFunction(e)?this.each(function(t){
v(this).wrapInner(e.call(this,t))
}):this.each(function(){
var t=v(this),n=t.contents();
n.length?n.wrapAll(e):t.append(e)
})
},
wrap:function(e){
var t=v.isFunction(e);
return this.each(function(n){
v(this).wrapAll(t?e.call(this,n):e)
})
},
unwrap:function(){
return this.parent().each(function(){
v.nodeName(this,'body')||v(this).replaceWith(this.childNodes)
}).end()
},
append:function(){
return this.domManip(arguments,!0,function(e){
(this.nodeType===1||this.nodeType===11)&&this.appendChild(e)
})
},
prepend:function(){
return this.domManip(arguments,!0,function(e){
(this.nodeType===1||this.nodeType===11)&&this.insertBefore(e,this.firstChild)
})
},
before:function(){
if(!ut(this[0]))
return this.domManip(arguments,!1,function(e){
this.parentNode.insertBefore(e,this)
});
if(arguments.length){
var e=v.clean(arguments);
return this.pushStack(v.merge(e,this),'before',this.selector)
}
},
after:function(){
if(!ut(this[0]))
return this.domManip(arguments,!1,function(e){
this.parentNode.insertBefore(e,this.nextSibling)
});
if(arguments.length){
var e=v.clean(arguments);
return this.pushStack(v.merge(this,e),'after',this.selector)
}
},
remove:function(e,t){
var n,r=0;
for(;(n=this[r])!=null;r++)
if(!e||v.filter(e,[n]).length)
!t&&n.nodeType===1&&(v.cleanData(n.getElementsByTagName('*')),v.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n);
return this
},
empty:function(){
var e,t=0;
for(;(e=this[t])!=null;t++){
e.nodeType===1&&v.cleanData(e.getElementsByTagName('*'));
while(e.firstChild)
e.removeChild(e.firstChild)
}
return this
},
clone:function(e,t){
return e=e==null?!1:e,t=t==null?e:t,this.map(function(){
return v.clone(this,e,t)
})
},
html:function(e){
return v.access(this,function(e){
var n=this[0]||{},r=0,i=this.length;
if(e===t)
return n.nodeType===1?n.innerHTML.replace(ht,''):t;
if(typeof e=='string'&&!yt.test(e)&&(v.support.htmlSerialize||!wt.test(e))&&(v.support.leadingWhitespace||!pt.test(e))&&!Nt[(vt.exec(e)||[
'',
''
])[1].toLowerCase()]){
e=e.replace(dt,'<$1></$2>');
try{
for(;r<i;r++)
n=this[r]||{},n.nodeType===1&&(v.cleanData(n.getElementsByTagName('*')),n.innerHTML=e);
n=0
}catch(s){
}
}
n&&this.empty().append(e)
},null,e,arguments.length)
},
replaceWith:function(e){
return ut(this[0])?this.length?this.pushStack(v(v.isFunction(e)?e():e),'replaceWith',e):this:v.isFunction(e)?this.each(function(t){
var n=v(this),r=n.html();
n.replaceWith(e.call(this,t,r))
}):(typeof e!='string'&&(e=v(e).detach()),this.each(function(){
var t=this.nextSibling,n=this.parentNode;
v(this).remove(),t?v(t).before(e):v(n).append(e)
}))
},
detach:function(e){
return this.remove(e,!0)
},
domManip:function(e,n,r){
e=[].concat.apply([],e);
var i,s,o,u,a=0,f=e[0],l=[],c=this.length;
if(!v.support.checkClone&&c>1&&typeof f=='string'&&St.test(f))
return this.each(function(){
v(this).domManip(e,n,r)
});
if(v.isFunction(f))
return this.each(function(i){
var s=v(this);
e[0]=f.call(this,i,n?s.html():t),s.domManip(e,n,r)
});
if(this[0]){
i=v.buildFragment(e,this,l),o=i.fragment,s=o.firstChild,o.childNodes.length===1&&(o=s);
if(s){
n=n&&v.nodeName(s,'tr');
for(u=i.cacheable||c-1;a<c;a++)
r.call(n&&v.nodeName(this[a],'table')?Lt(this[a],'tbody'):this[a],a===u?o:v.clone(o,!0,!0))
}
o=s=null,l.length&&v.each(l,function(e,t){
t.src?v.ajax?v.ajax({
url:t.src,
type:'GET',
dataType:'script',
async:!1,
global:!1,
'throws':!0
}):v.error('no ajax'):v.globalEval((t.text||t.textContent||t.innerHTML||'').replace(Tt,'')),t.parentNode&&t.parentNode.removeChild(t)
})
}
return this
}
}),v.buildFragment=function(e,n,r){
var s,o,u,a=e[0];
return n=n||i,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,e.length===1&&typeof a=='string'&&a.length<512&&n===i&&a.charAt(0)==='<'&&!bt.test(a)&&(v.support.checkClone||!St.test(a))&&(v.support.html5Clone||!wt.test(a))&&(o=!0,s=v.fragments[a],u=s!==t),s||(s=n.createDocumentFragment(),v.clean(e,n,s,r),o&&(v.fragments[a]=u&&s)),{
fragment:s,
cacheable:o
}
},v.fragments={},v.each({
appendTo:'append',
prependTo:'prepend',
insertBefore:'before',
insertAfter:'after',
replaceAll:'replaceWith'
},function(e,t){
v.fn[e]=function(n){
var r,i=0,s=[],o=v(n),u=o.length,a=this.length===1&&this[0].parentNode;
if((a==null||a&&a.nodeType===11&&a.childNodes.length===1)&&u===1)
return o[t](this[0]),this;
for(;i<u;i++)
r=(i>0?this.clone(!0):this).get(),v(o[i])[t](r),s=s.concat(r);
return this.pushStack(s,e,o.selector)
}
}),v.extend({
clone:function(e,t,n){
var r,i,s,o;
v.support.html5Clone||v.isXMLDoc(e)||!wt.test('<'+e.nodeName+'>')?o=e.cloneNode(!0):(kt.innerHTML=e.outerHTML,kt.removeChild(o=kt.firstChild));
if((!v.support.noCloneEvent||!v.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!v.isXMLDoc(e)){
Ot(e,o),r=Mt(e),i=Mt(o);
for(s=0;r[s];++s)
i[s]&&Ot(r[s],i[s])
}
if(t){
At(e,o);
if(n){
r=Mt(e),i=Mt(o);
for(s=0;r[s];++s)
At(r[s],i[s])
}
}
return r=i=null,o
},
clean:function(e,t,n,r){
var s,o,u,a,f,l,c,h,p,d,m,g,y=t===i&&Ct,b=[];
if(!t||typeof t.createDocumentFragment=='undefined')
t=i;
for(s=0;(u=e[s])!=null;s++){
typeof u=='number'&&(u+='');
if(!u)
continue;
if(typeof u=='string')
if(!gt.test(u))
u=t.createTextNode(u);
else{
y=y||lt(t),c=t.createElement('div'),y.appendChild(c),u=u.replace(dt,'<$1></$2>'),a=(vt.exec(u)||[
'',
''
])[1].toLowerCase(),f=Nt[a]||Nt._default,l=f[0],c.innerHTML=f[1]+u+f[2];
while(l--)
c=c.lastChild;
if(!v.support.tbody){
h=mt.test(u),p=a==='table'&&!h?c.firstChild&&c.firstChild.childNodes:f[1]==='<table>'&&!h?c.childNodes:[];
for(o=p.length-1;o>=0;--o)
v.nodeName(p[o],'tbody')&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o])
}
!v.support.leadingWhitespace&&pt.test(u)&&c.insertBefore(t.createTextNode(pt.exec(u)[0]),c.firstChild),u=c.childNodes,c.parentNode.removeChild(c)
}
u.nodeType?b.push(u):v.merge(b,u)
}
c&&(u=c=y=null);
if(!v.support.appendChecked)
for(s=0;(u=b[s])!=null;s++)
v.nodeName(u,'input')?_t(u):typeof u.getElementsByTagName!='undefined'&&v.grep(u.getElementsByTagName('input'),_t);
if(n){
m=function(e){
if(!e.type||xt.test(e.type))
return r?r.push(e.parentNode?e.parentNode.removeChild(e):e):n.appendChild(e)
};
for(s=0;(u=b[s])!=null;s++)
if(!v.nodeName(u,'script')||!m(u))
n.appendChild(u),typeof u.getElementsByTagName!='undefined'&&(g=v.grep(v.merge([],u.getElementsByTagName('script')),m),b.splice.apply(b,[
s+1,
0
].concat(g)),s+=g.length)
}
return b
},
cleanData:function(e,t){
var n,r,i,s,o=0,u=v.expando,a=v.cache,f=v.support.deleteExpando,l=v.event.special;
for(;(i=e[o])!=null;o++)
if(t||v.acceptData(i)){
r=i[u],n=r&&a[r];
if(n){
if(n.events)
for(s in n.events)
l[s]?v.event.remove(i,s):v.removeEvent(i,s,n.handle);
a[r]&&(delete a[r],f?delete i[u]:i.removeAttribute?i.removeAttribute(u):i[u]=null,v.deletedIds.push(r))
}
}
}
}),function(){
var e,t;
v.uaMatch=function(e){
e=e.toLowerCase();
var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf('compatible')<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];
return{
browser:t[1]||'',
version:t[2]||'0'
}
},e=v.uaMatch(o.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),v.browser=t,v.sub=function(){
function e(t,n){
return new e.fn.init(t,n)
}
v.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,i){
return i&&i instanceof v&&!(i instanceof e)&&(i=e(i)),v.fn.init.call(this,r,i,t)
},e.fn.init.prototype=e.fn;
var t=e(i);
return e
}
}();
var Dt,Pt,Ht,Bt=/alpha\([^)]*\)/i,jt=/opacity=([^)]*)/,Ft=/^(top|right|bottom|left)$/,It=/^(none|table(?!-c[ea]).+)/,qt=/^margin/,Rt=new RegExp('^('+m+')(.*)$','i'),Ut=new RegExp('^('+m+')(?!px)[a-z%]+$','i'),zt=new RegExp('^([-+])=('+m+')','i'),Wt={BODY:'block'},Xt={
position:'absolute',
visibility:'hidden',
display:'block'
},Vt={
letterSpacing:0,
fontWeight:400
},$t=[
'Top',
'Right',
'Bottom',
'Left'
],Jt=[
'Webkit',
'O',
'Moz',
'ms'
],Kt=v.fn.toggle;
v.fn.extend({
css:function(e,n){
return v.access(this,function(e,n,r){
return r!==t?v.style(e,n,r):v.css(e,n)
},e,n,arguments.length>1)
},
show:function(){
return Yt(this,!0)
},
hide:function(){
return Yt(this)
},
toggle:function(e,t){
var n=typeof e=='boolean';
return v.isFunction(e)&&v.isFunction(t)?Kt.apply(this,arguments):this.each(function(){
(n?e:Gt(this))?v(this).show():v(this).hide()
})
}
}),v.extend({
cssHooks:{
opacity:{
get:function(e,t){
if(t){
var n=Dt(e,'opacity');
return n===''?'1':n
}
}
}
},
cssNumber:{
fillOpacity:!0,
fontWeight:!0,
lineHeight:!0,
opacity:!0,
orphans:!0,
widows:!0,
zIndex:!0,
zoom:!0
},
cssProps:{'float':v.support.cssFloat?'cssFloat':'styleFloat'},
style:function(e,n,r,i){
if(!e||e.nodeType===3||e.nodeType===8||!e.style)
return;
var s,o,u,a=v.camelCase(n),f=e.style;
n=v.cssProps[a]||(v.cssProps[a]=Qt(f,a)),u=v.cssHooks[n]||v.cssHooks[a];
if(r===t)
return u&&'get'in u&&(s=u.get(e,!1,i))!==t?s:f[n];
o=typeof r,o==='string'&&(s=zt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(v.css(e,n)),o='number');
if(r==null||o==='number'&&isNaN(r))
return;
o==='number'&&!v.cssNumber[a]&&(r+='px');
if(!u||!('set'in u)||(r=u.set(e,r,i))!==t)
try{
f[n]=r
}catch(l){
}
},
css:function(e,n,r,i){
var s,o,u,a=v.camelCase(n);
return n=v.cssProps[a]||(v.cssProps[a]=Qt(e.style,a)),u=v.cssHooks[n]||v.cssHooks[a],u&&'get'in u&&(s=u.get(e,!0,i)),s===t&&(s=Dt(e,n)),s==='normal'&&n in Vt&&(s=Vt[n]),r||i!==t?(o=parseFloat(s),r||v.isNumeric(o)?o||0:s):s
},
swap:function(e,t,n){
var r,i,s={};
for(i in t)
s[i]=e.style[i],e.style[i]=t[i];
r=n.call(e);
for(i in t)
e.style[i]=s[i];
return r
}
}),e.getComputedStyle?Dt=function(t,n){
var r,i,s,o,u=e.getComputedStyle(t,null),a=t.style;
return u&&(r=u.getPropertyValue(n)||u[n],r===''&&!v.contains(t.ownerDocument,t)&&(r=v.style(t,n)),Ut.test(r)&&qt.test(n)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=r,r=u.width,a.width=i,a.minWidth=s,a.maxWidth=o)),r
}:i.documentElement.currentStyle&&(Dt=function(e,t){
var n,r,i=e.currentStyle&&e.currentStyle[t],s=e.style;
return i==null&&s&&s[t]&&(i=s[t]),Ut.test(i)&&!Ft.test(t)&&(n=s.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),s.left=t==='fontSize'?'1em':i,i=s.pixelLeft+'px',s.left=n,r&&(e.runtimeStyle.left=r)),i===''?'auto':i
}),v.each([
'height',
'width'
],function(e,t){
v.cssHooks[t]={
get:function(e,n,r){
if(n)
return e.offsetWidth===0&&It.test(Dt(e,'display'))?v.swap(e,Xt,function(){
return tn(e,t,r)
}):tn(e,t,r)
},
set:function(e,n,r){
return Zt(e,n,r?en(e,t,r,v.support.boxSizing&&v.css(e,'boxSizing')==='border-box'):0)
}
}
}),v.support.opacity||(v.cssHooks.opacity={
get:function(e,t){
return jt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||'')?0.01*parseFloat(RegExp.$1)+'':t?'1':''
},
set:function(e,t){
var n=e.style,r=e.currentStyle,i=v.isNumeric(t)?'alpha(opacity='+t*100+')':'',s=r&&r.filter||n.filter||'';
n.zoom=1;
if(t>=1&&v.trim(s.replace(Bt,''))===''&&n.removeAttribute){
n.removeAttribute('filter');
if(r&&!r.filter)
return
}
n.filter=Bt.test(s)?s.replace(Bt,i):s+' '+i
}
}),v(function(){
v.support.reliableMarginRight||(v.cssHooks.marginRight={
get:function(e,t){
return v.swap(e,{display:'inline-block'},function(){
if(t)
return Dt(e,'marginRight')
})
}
}),!v.support.pixelPosition&&v.fn.position&&v.each([
'top',
'left'
],function(e,t){
v.cssHooks[t]={
get:function(e,n){
if(n){
var r=Dt(e,t);
return Ut.test(r)?v(e).position()[t]+'px':r
}
}
}
})
}),v.expr&&v.expr.filters&&(v.expr.filters.hidden=function(e){
return e.offsetWidth===0&&e.offsetHeight===0||!v.support.reliableHiddenOffsets&&(e.style&&e.style.display||Dt(e,'display'))==='none'
},v.expr.filters.visible=function(e){
return!v.expr.filters.hidden(e)
}),v.each({
margin:'',
padding:'',
border:'Width'
},function(e,t){
v.cssHooks[e+t]={
expand:function(n){
var r,i=typeof n=='string'?n.split(' '):[n],s={};
for(r=0;r<4;r++)
s[e+$t[r]+t]=i[r]||i[r-2]||i[0];
return s
}
},qt.test(e)||(v.cssHooks[e+t].set=Zt)
});
var rn=/%20/g,sn=/\[\]$/,on=/\r?\n/g,un=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,an=/^(?:select|textarea)/i;
v.fn.extend({
serialize:function(){
return v.param(this.serializeArray())
},
serializeArray:function(){
return this.map(function(){
return this.elements?v.makeArray(this.elements):this
}).filter(function(){
return this.name&&!this.disabled&&(this.checked||an.test(this.nodeName)||un.test(this.type))
}).map(function(e,t){
var n=v(this).val();
return n==null?null:v.isArray(n)?v.map(n,function(e,n){
return{
name:t.name,
value:e.replace(on,'\r\n')
}
}):{
name:t.name,
value:n.replace(on,'\r\n')
}
}).get()
}
}),v.param=function(e,n){
var r,i=[],s=function(e,t){
t=v.isFunction(t)?t():t==null?'':t,i[i.length]=encodeURIComponent(e)+'='+encodeURIComponent(t)
};
n===t&&(n=v.ajaxSettings&&v.ajaxSettings.traditional);
if(v.isArray(e)||e.jquery&&!v.isPlainObject(e))
v.each(e,function(){
s(this.name,this.value)
});
else
for(r in e)
fn(r,e[r],n,s);
return i.join('&').replace(rn,'+')
};
var ln,cn,hn=/#.*$/,pn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,dn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,vn=/^(?:GET|HEAD)$/,mn=/^\/\//,gn=/\?/,yn=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bn=/([?&])_=[^&]*/,wn=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,En=v.fn.load,Sn={},xn={},Tn=['*/']+['*'];
try{
cn=s.href
}catch(Nn){
cn=i.createElement('a'),cn.href='',cn=cn.href
}
ln=wn.exec(cn.toLowerCase())||[],v.fn.load=function(e,n,r){
if(typeof e!='string'&&En)
return En.apply(this,arguments);
if(!this.length)
return this;
var i,s,o,u=this,a=e.indexOf(' ');
return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),v.isFunction(n)?(r=n,n=t):n&&typeof n=='object'&&(s='POST'),v.ajax({
url:e,
type:s,
dataType:'html',
data:n,
complete:function(e,t){
r&&u.each(r,o||[
e.responseText,
t,
e
])
}
}).done(function(e){
o=arguments,u.html(i?v('<div>').append(e.replace(yn,'')).find(i):e)
}),this
},v.each('ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend'.split(' '),function(e,t){
v.fn[t]=function(e){
return this.on(t,e)
}
}),v.each([
'get',
'post'
],function(e,n){
v[n]=function(e,r,i,s){
return v.isFunction(r)&&(s=s||i,i=r,r=t),v.ajax({
type:n,
url:e,
data:r,
success:i,
dataType:s
})
}
}),v.extend({
getScript:function(e,n){
return v.get(e,t,n,'script')
},
getJSON:function(e,t,n){
return v.get(e,t,n,'json')
},
ajaxSetup:function(e,t){
return t?Ln(e,v.ajaxSettings):(t=e,e=v.ajaxSettings),Ln(e,t),e
},
ajaxSettings:{
url:cn,
isLocal:dn.test(ln[1]),
global:!0,
type:'GET',
contentType:'application/x-www-form-urlencoded; charset=UTF-8',
processData:!0,
async:!0,
accepts:{
xml:'application/xml, text/xml',
html:'text/html',
text:'text/plain',
json:'application/json, text/javascript',
'*':Tn
},
contents:{
xml:/xml/,
html:/html/,
json:/json/
},
responseFields:{
xml:'responseXML',
text:'responseText'
},
converters:{
'* text':e.String,
'text html':!0,
'text json':v.parseJSON,
'text xml':v.parseXML
},
flatOptions:{
context:!0,
url:!0
}
},
ajaxPrefilter:Cn(Sn),
ajaxTransport:Cn(xn),
ajax:function(e,n){
function T(e,n,s,a){
var l,y,b,w,S,T=n;
if(E===2)
return;
E=2,u&&clearTimeout(u),o=t,i=a||'',x.readyState=e>0?4:0,s&&(w=An(c,x,s));
if(e>=200&&e<300||e===304)
c.ifModified&&(S=x.getResponseHeader('Last-Modified'),S&&(v.lastModified[r]=S),S=x.getResponseHeader('Etag'),S&&(v.etag[r]=S)),e===304?(T='notmodified',l=!0):(l=On(c,w),T=l.state,y=l.data,b=l.error,l=!b);
else{
b=T;
if(!T||e)
T='error',e<0&&(e=0)
}
x.status=e,x.statusText=(n||T)+'',l?d.resolveWith(h,[
y,
T,
x
]):d.rejectWith(h,[
x,
T,
b
]),x.statusCode(g),g=t,f&&p.trigger('ajax'+(l?'Success':'Error'),[
x,
c,
l?y:b
]),m.fireWith(h,[
x,
T
]),f&&(p.trigger('ajaxComplete',[
x,
c
]),--v.active||v.event.trigger('ajaxStop'))
}
typeof e=='object'&&(n=e,e=t),n=n||{};
var r,i,s,o,u,a,f,l,c=v.ajaxSetup({},n),h=c.context||c,p=h!==c&&(h.nodeType||h instanceof v)?v(h):v.event,d=v.Deferred(),m=v.Callbacks('once memory'),g=c.statusCode||{},b={},w={},E=0,S='canceled',x={
readyState:0,
setRequestHeader:function(e,t){
if(!E){
var n=e.toLowerCase();
e=w[n]=w[n]||e,b[e]=t
}
return this
},
getAllResponseHeaders:function(){
return E===2?i:null
},
getResponseHeader:function(e){
var n;
if(E===2){
if(!s){
s={};
while(n=pn.exec(i))
s[n[1].toLowerCase()]=n[2]
}
n=s[e.toLowerCase()]
}
return n===t?null:n
},
overrideMimeType:function(e){
return E||(c.mimeType=e),this
},
abort:function(e){
return e=e||S,o&&o.abort(e),T(0,e),this
}
};
d.promise(x),x.success=x.done,x.error=x.fail,x.complete=m.add,x.statusCode=function(e){
if(e){
var t;
if(E<2)
for(t in e)
g[t]=[
g[t],
e[t]
];
else
t=e[x.status],x.always(t)
}
return this
},c.url=((e||c.url)+'').replace(hn,'').replace(mn,ln[1]+'//'),c.dataTypes=v.trim(c.dataType||'*').toLowerCase().split(y),c.crossDomain==null&&(a=wn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ln[1]&&a[2]===ln[2]&&(a[3]||(a[1]==='http:'?80:443))==(ln[3]||(ln[1]==='http:'?80:443)))),c.data&&c.processData&&typeof c.data!='string'&&(c.data=v.param(c.data,c.traditional)),kn(Sn,c,n,x);
if(E===2)
return x;
f=c.global,c.type=c.type.toUpperCase(),c.hasContent=!vn.test(c.type),f&&v.active++===0&&v.event.trigger('ajaxStart');
if(!c.hasContent){
c.data&&(c.url+=(gn.test(c.url)?'&':'?')+c.data,delete c.data),r=c.url;
if(c.cache===!1){
var N=v.now(),C=c.url.replace(bn,'$1_='+N);
c.url=C+(C===c.url?(gn.test(c.url)?'&':'?')+'_='+N:'')
}
}
(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader('Content-Type',c.contentType),c.ifModified&&(r=r||c.url,v.lastModified[r]&&x.setRequestHeader('If-Modified-Since',v.lastModified[r]),v.etag[r]&&x.setRequestHeader('If-None-Match',v.etag[r])),x.setRequestHeader('Accept',c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=='*'?', '+Tn+'; q=0.01':''):c.accepts['*']);
for(l in c.headers)
x.setRequestHeader(l,c.headers[l]);
if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&E!==2){
S='abort';
for(l in{
success:1,
error:1,
complete:1
})
x[l](c[l]);
o=kn(xn,c,n,x);
if(!o)
T(-1,'No Transport');
else{
x.readyState=1,f&&p.trigger('ajaxSend',[
x,
c
]),c.async&&c.timeout>0&&(u=setTimeout(function(){
x.abort('timeout')
},c.timeout));
try{
E=1,o.send(b,T)
}catch(k){
if(!(E<2))
throw k;
T(-1,k)
}
}
return x
}
return x.abort()
},
active:0,
lastModified:{},
etag:{}
});
var Mn=[],_n=/\?/,Dn=/(=)\?(?=&|$)|\?\?/,Pn=v.now();
v.ajaxSetup({
jsonp:'callback',
jsonpCallback:function(){
var e=Mn.pop()||v.expando+'_'+Pn++;
return this[e]=!0,e
}
}),v.ajaxPrefilter('json jsonp',function(n,r,i){
var s,o,u,a=n.data,f=n.url,l=n.jsonp!==!1,c=l&&Dn.test(f),h=l&&!c&&typeof a=='string'&&!(n.contentType||'').indexOf('application/x-www-form-urlencoded')&&Dn.test(a);
if(n.dataTypes[0]==='jsonp'||c||h)
return s=n.jsonpCallback=v.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,o=e[s],c?n.url=f.replace(Dn,'$1'+s):h?n.data=a.replace(Dn,'$1'+s):l&&(n.url+=(_n.test(f)?'&':'?')+n.jsonp+'='+s),n.converters['script json']=function(){
return u||v.error(s+' was not called'),u[0]
},n.dataTypes[0]='json',e[s]=function(){
u=arguments
},i.always(function(){
e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,Mn.push(s)),u&&v.isFunction(o)&&o(u[0]),u=o=t
}),'script'
}),v.ajaxSetup({
accepts:{script:'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript'},
contents:{script:/javascript|ecmascript/},
converters:{
'text script':function(e){
return v.globalEval(e),e
}
}
}),v.ajaxPrefilter('script',function(e){
e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type='GET',e.global=!1)
}),v.ajaxTransport('script',function(e){
if(e.crossDomain){
var n,r=i.head||i.getElementsByTagName('head')[0]||i.documentElement;
return{
send:function(s,o){
n=i.createElement('script'),n.async='async',e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){
if(i||!n.readyState||/loaded|complete/.test(n.readyState))
n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||o(200,'success')
},r.insertBefore(n,r.firstChild)
},
abort:function(){
n&&n.onload(0,1)
}
}
}
});
var Hn,Bn=e.ActiveXObject?function(){
for(var e in Hn)
Hn[e](0,1)
}:!1,jn=0;
v.ajaxSettings.xhr=e.ActiveXObject?function(){
return!this.isLocal&&Fn()||In()
}:Fn,function(e){
v.extend(v.support,{
ajax:!!e,
cors:!!e&&'withCredentials'in e
})
}(v.ajaxSettings.xhr()),v.support.ajax&&v.ajaxTransport(function(n){
if(!n.crossDomain||v.support.cors){
var r;
return{
send:function(i,s){
var o,u,a=n.xhr();
n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);
if(n.xhrFields)
for(u in n.xhrFields)
a[u]=n.xhrFields[u];
n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i['X-Requested-With']&&(i['X-Requested-With']='XMLHttpRequest');
try{
for(u in i)
a.setRequestHeader(u,i[u])
}catch(f){
}
a.send(n.hasContent&&n.data||null),r=function(e,i){
var u,f,l,c,h;
try{
if(r&&(i||a.readyState===4)){
r=t,o&&(a.onreadystatechange=v.noop,Bn&&delete Hn[o]);
if(i)
a.readyState!==4&&a.abort();
else{
u=a.status,l=a.getAllResponseHeaders(),c={},h=a.responseXML,h&&h.documentElement&&(c.xml=h);
try{
c.text=a.responseText
}catch(p){
}
try{
f=a.statusText
}catch(p){
f=''
}
!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)
}
}
}catch(d){
i||s(-1,d)
}
c&&s(u,f,c,l)
},n.async?a.readyState===4?setTimeout(r,0):(o=++jn,Bn&&(Hn||(Hn={},v(e).unload(Bn)),Hn[o]=r),a.onreadystatechange=r):r()
},
abort:function(){
r&&r(0,1)
}
}
}
});
var qn,Rn,Un=/^(?:toggle|show|hide)$/,zn=new RegExp('^(?:([-+])=|)('+m+')([a-z%]*)$','i'),Wn=/queueHooks$/,Xn=[Gn],Vn={
'*':[function(e,t){
var n,r,i=this.createTween(e,t),s=zn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;
if(s){
n=+s[2],r=s[3]||(v.cssNumber[e]?'':'px');
if(r!=='px'&&u){
u=v.css(i.elem,e,!0)||n||1;
do
a=a||'.5',u/=a,v.style(i.elem,e,u+r);
while(a!==(a=i.cur()/o)&&a!==1&&--f)
}
i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n
}
return i
}]
};
v.Animation=v.extend(Kn,{
tweener:function(e,t){
v.isFunction(e)?(t=e,e=['*']):e=e.split(' ');
var n,r=0,i=e.length;
for(;r<i;r++)
n=e[r],Vn[n]=Vn[n]||[],Vn[n].unshift(t)
},
prefilter:function(e,t){
t?Xn.unshift(e):Xn.push(e)
}
}),v.Tween=Yn,Yn.prototype={
constructor:Yn,
init:function(e,t,n,r,i,s){
this.elem=e,this.prop=n,this.easing=i||'swing',this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(v.cssNumber[n]?'':'px')
},
cur:function(){
var e=Yn.propHooks[this.prop];
return e&&e.get?e.get(this):Yn.propHooks._default.get(this)
},
run:function(e){
var t,n=Yn.propHooks[this.prop];
return this.options.duration?this.pos=t=v.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yn.propHooks._default.set(this),this
}
},Yn.prototype.init.prototype=Yn.prototype,Yn.propHooks={
_default:{
get:function(e){
var t;
return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=v.css(e.elem,e.prop,!1,''),!t||t==='auto'?0:t):e.elem[e.prop]
},
set:function(e){
v.fx.step[e.prop]?v.fx.step[e.prop](e):e.elem.style&&(e.elem.style[v.cssProps[e.prop]]!=null||v.cssHooks[e.prop])?v.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now
}
}
},Yn.propHooks.scrollTop=Yn.propHooks.scrollLeft={
set:function(e){
e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)
}
},v.each([
'toggle',
'show',
'hide'
],function(e,t){
var n=v.fn[t];
v.fn[t]=function(r,i,s){
return r==null||typeof r=='boolean'||!e&&v.isFunction(r)&&v.isFunction(i)?n.apply(this,arguments):this.animate(Zn(t,!0),r,i,s)
}
}),v.fn.extend({
fadeTo:function(e,t,n,r){
return this.filter(Gt).css('opacity',0).show().end().animate({opacity:t},e,n,r)
},
animate:function(e,t,n,r){
var i=v.isEmptyObject(e),s=v.speed(t,n,r),o=function(){
var t=Kn(this,v.extend({},e),s);
i&&t.stop(!0)
};
return i||s.queue===!1?this.each(o):this.queue(s.queue,o)
},
stop:function(e,n,r){
var i=function(e){
var t=e.stop;
delete e.stop,t(r)
};
return typeof e!='string'&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||'fx',[]),this.each(function(){
var t=!0,n=e!=null&&e+'queueHooks',s=v.timers,o=v._data(this);
if(n)
o[n]&&o[n].stop&&i(o[n]);
else
for(n in o)
o[n]&&o[n].stop&&Wn.test(n)&&i(o[n]);
for(n=s.length;n--;)
s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1));
(t||!r)&&v.dequeue(this,e)
})
}
}),v.each({
slideDown:Zn('show'),
slideUp:Zn('hide'),
slideToggle:Zn('toggle'),
fadeIn:{opacity:'show'},
fadeOut:{opacity:'hide'},
fadeToggle:{opacity:'toggle'}
},function(e,t){
v.fn[e]=function(e,n,r){
return this.animate(t,e,n,r)
}
}),v.speed=function(e,t,n){
var r=e&&typeof e=='object'?v.extend({},e):{
complete:n||!n&&t||v.isFunction(e)&&e,
duration:e,
easing:n&&t||t&&!v.isFunction(t)&&t
};
r.duration=v.fx.off?0:typeof r.duration=='number'?r.duration:r.duration in v.fx.speeds?v.fx.speeds[r.duration]:v.fx.speeds._default;
if(r.queue==null||r.queue===!0)
r.queue='fx';
return r.old=r.complete,r.complete=function(){
v.isFunction(r.old)&&r.old.call(this),r.queue&&v.dequeue(this,r.queue)
},r
},v.easing={
linear:function(e){
return e
},
swing:function(e){
return 0.5-Math.cos(e*Math.PI)/2
}
},v.timers=[],v.fx=Yn.prototype.init,v.fx.tick=function(){
var e,n=v.timers,r=0;
qn=v.now();
for(;r<n.length;r++)
e=n[r],!e()&&n[r]===e&&n.splice(r--,1);
n.length||v.fx.stop(),qn=t
},v.fx.timer=function(e){
e()&&v.timers.push(e)&&!Rn&&(Rn=setInterval(v.fx.tick,v.fx.interval))
},v.fx.interval=13,v.fx.stop=function(){
clearInterval(Rn),Rn=null
},v.fx.speeds={
slow:600,
fast:200,
_default:400
},v.fx.step={},v.expr&&v.expr.filters&&(v.expr.filters.animated=function(e){
return v.grep(v.timers,function(t){
return e===t.elem
}).length
});
var er=/^(?:body|html)$/i;
v.fn.offset=function(e){
if(arguments.length)
return e===t?this:this.each(function(t){
v.offset.setOffset(this,e,t)
});
var n,r,i,s,o,u,a,f={
top:0,
left:0
},l=this[0],c=l&&l.ownerDocument;
if(!c)
return;
return(r=c.body)===l?v.offset.bodyOffset(l):(n=c.documentElement,v.contains(n,l)?(typeof l.getBoundingClientRect!='undefined'&&(f=l.getBoundingClientRect()),i=tr(c),s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,u=i.pageYOffset||n.scrollTop,a=i.pageXOffset||n.scrollLeft,{
top:f.top+u-s,
left:f.left+a-o
}):f)
},v.offset={
bodyOffset:function(e){
var t=e.offsetTop,n=e.offsetLeft;
return v.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(v.css(e,'marginTop'))||0,n+=parseFloat(v.css(e,'marginLeft'))||0),{
top:t,
left:n
}
},
setOffset:function(e,t,n){
var r=v.css(e,'position');
r==='static'&&(e.style.position='relative');
var i=v(e),s=i.offset(),o=v.css(e,'top'),u=v.css(e,'left'),a=(r==='absolute'||r==='fixed')&&v.inArray('auto',[
o,
u
])>-1,f={},l={},c,h;
a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),v.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),'using'in t?t.using.call(e,f):i.css(f)
}
},v.fn.extend({
position:function(){
if(!this[0])
return;
var e=this[0],t=this.offsetParent(),n=this.offset(),r=er.test(t[0].nodeName)?{
top:0,
left:0
}:t.offset();
return n.top-=parseFloat(v.css(e,'marginTop'))||0,n.left-=parseFloat(v.css(e,'marginLeft'))||0,r.top+=parseFloat(v.css(t[0],'borderTopWidth'))||0,r.left+=parseFloat(v.css(t[0],'borderLeftWidth'))||0,{
top:n.top-r.top,
left:n.left-r.left
}
},
offsetParent:function(){
return this.map(function(){
var e=this.offsetParent||i.body;
while(e&&!er.test(e.nodeName)&&v.css(e,'position')==='static')
e=e.offsetParent;
return e||i.body
})
}
}),v.each({
scrollLeft:'pageXOffset',
scrollTop:'pageYOffset'
},function(e,n){
var r=/Y/.test(n);
v.fn[e]=function(i){
return v.access(this,function(e,i,s){
var o=tr(e);
if(s===t)
return o?n in o?o[n]:o.document.documentElement[i]:e[i];
o?o.scrollTo(r?v(o).scrollLeft():s,r?s:v(o).scrollTop()):e[i]=s
},e,i,arguments.length,null)
}
}),v.each({
Height:'height',
Width:'width'
},function(e,n){
v.each({
padding:'inner'+e,
content:n,
'':'outer'+e
},function(r,i){
v.fn[i]=function(i,s){
var o=arguments.length&&(r||typeof i!='boolean'),u=r||(i===!0||s===!0?'margin':'border');
return v.access(this,function(n,r,i){
var s;
return v.isWindow(n)?n.document.documentElement['client'+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body['scroll'+e],s['scroll'+e],n.body['offset'+e],s['offset'+e],s['client'+e])):i===t?v.css(n,r,i,u):v.style(n,r,i,u)
},n,o?i:t,o,null)
}
})
}),e.jQuery=e.$=v,typeof define=='function'&&define.amd&&define.amd.jQuery&&define('jquery',[],function(){
return v
})
}(window));
window.oneJQuery=jQuery.noConflict(true);
one.Application=Ext.extend(Ext.Panel,{
constructor:function(config){
this.addEvents('relaunch','historytokenchanged');
one.Application.superclass.constructor.call(this,config)
},
prepareForLaunch:function(oldApplication,callback,scope){
if(callback){
callback.call(scope||window)
}
},
applyHistoryToken:function(token){
},
handleKeyEvent:function(ev,el){
}
});
one.Credentials=Ext.data.Record.create([
{
name:'login',
type:'string'
},
{
name:'password',
type:'string'
}
]);
Ext.ns('web');
Ext.ns('one.backend');
one.backend.Base=Ext.extend(Ext.util.Observable,{
maxActiveRequests:Infinity,
constructor:function(config){
Ext.apply(this,config);
this.addEvents('beforerequest','afterrequest','idle','busy');
one.backend.Base.superclass.constructor.call(this,config);
this.requestQueue=[];
this.numActiveRequests=0;
this.paused=this.busyState=false
},
queueRequest:function(ajaxOptions,inFront){
Ext.applyIf(ajaxOptions,{
method:'POST',
url:this.url||this.defaultUrl,
scope:this
});
this.requestQueue[inFront?'unshift':'push'](ajaxOptions);
this.processPendingRequests()
},
processPendingRequests:function(){
while(!this.paused&&this.requestQueue.length&&this.numActiveRequests<this.maxActiveRequests){
var ajaxOptions=this.requestQueue.shift();
if(ajaxOptions.beforerequest){
if(ajaxOptions.beforerequest.call(ajaxOptions.scope||this,ajaxOptions)===false){
continue
}
}
if(this.fireEvent('beforerequest',ajaxOptions)){
this.numActiveRequests+=1;
var callback=function(options,success,response){
this.numActiveRequests-=1;
this.fireEvent('afterrequest',ajaxOptions,success,response);
if(success){
if(ajaxOptions.success){
ajaxOptions.success.call(ajaxOptions.scope||this,response,ajaxOptions)
}
}else if(ajaxOptions.failure){
ajaxOptions.failure.call(ajaxOptions.scope||this,response,ajaxOptions)
}
if(ajaxOptions.callback){
ajaxOptions.callback.call(ajaxOptions.scope||this,ajaxOptions,success,response)
}
this.processPendingRequests()
}.createDelegate(this);
if(ajaxOptions.file){
var xhr=new XMLHttpRequest;
xhr.onreadystatechange=function(){
if(xhr&&xhr.readyState===4){
callback(ajaxOptions,xhr.status>=200&&xhr.status<400,xhr)
}
}.createDelegate(this);
var up=xhr.upload;
if(up){
for(var eventName in up){
if(eventName.match(/^on/)&&eventName in ajaxOptions){
up[eventName]=ajaxOptions[eventName]
}
}
up.startTime=new Date().getTime()
}
xhr.open(ajaxOptions.method,ajaxOptions.url,true);
if(ajaxOptions.headers){
Ext.iterate(ajaxOptions.headers,function(name,value){
xhr.setRequestHeader(name,value)
})
}
xhr.send(ajaxOptions.file)
}else{
Ext.Ajax.request(Ext.applyIf({
success:Ext.emptyFn,
failure:Ext.emptyFn,
callback:callback
},ajaxOptions))
}
}
}
if(!this.busyState&&this.numActiveRequests){
this.fireEvent('busy',this.numActiveRequests)
}else if(this.busyState&&!this.numActiveRequests){
this.fireEvent('idle',0)
}
this.busyState=!!this.numActiveRequests
},
resumeOperations:function(){
this.paused=false;
this.processPendingRequests()
},
getStore:function(Constructor,options){
var store=new Constructor(options),backendAPI=this,proxy=store.proxy,originalConnectionOptions=proxy.conn;
proxy.useAjax=false;
proxy.conn={
abort:Ext.emptyFn,
nextRequestId:1,
request:function(ajaxOptions){
ajaxOptions.url=ajaxOptions.url||this.url;
Ext.applyIf(ajaxOptions,originalConnectionOptions);
backendAPI.queueRequest(ajaxOptions);
return{
tId:this.nextRequestId+=1,
conn:this
}
}
};
return store
}
});
Ext.ux.Base64={
base64s:'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',
encode:function(decStr){
if(typeof window.btoa==='function'){
return window.btoa(decStr)
}
var base64s=this.base64s;
var bits;
var dual;
var i=0;
var encOut='';
while(decStr.length>=i+3){
bits=(decStr.charCodeAt(i+=1)&255)<<16|(decStr.charCodeAt(i+=1)&255)<<8|decStr.charCodeAt(i+=1)&255;
encOut+=base64s.charAt((bits&16515072)>>18)+base64s.charAt((bits&258048)>>12)+base64s.charAt((bits&4032)>>6)+base64s.charAt(bits&63)
}
if(decStr.length-i>0&&decStr.length-i<3){
dual=Boolean(decStr.length-i-1);
bits=(decStr.charCodeAt(i+=1)&255)<<16|(dual?(decStr.charCodeAt(i)&255)<<8:0);
encOut+=base64s.charAt((bits&16515072)>>18)+base64s.charAt((bits&258048)>>12)+(dual?base64s.charAt((bits&4032)>>6):'=')+'='
}
return encOut
},
decode:function(encStr){
if(typeof window.atob==='function'){
return window.atob(encStr)
}
var base64s=this.base64s;
var bits;
var decOut='';
var i;
if(encStr){
for(i=0;i<encStr.length;i+=4){
bits=(base64s.indexOf(encStr.charAt(i))&255)<<18|(base64s.indexOf(encStr.charAt(i+1))&255)<<12|(base64s.indexOf(encStr.charAt(i+2))&255)<<6|base64s.indexOf(encStr.charAt(i+3))&255;
decOut+=String.fromCharCode((bits&16711680)>>16,(bits&65280)>>8,bits&255)
}
if(encStr.charCodeAt(i-2)===61){
return decOut.substring(0,decOut.length-2)
}else if(encStr.charCodeAt(i-1)===61){
return decOut.substring(0,decOut.length-1)
}
}
return decOut
}
};
web.UIState=Ext.extend(Object,{
constructor:function(cfg){
this.dal=cfg.dal;
this.fakeLocalStorage=[]
},
hasLocalStorage:function(){
try{
localStorage['test-localStorage']='';
delete localStorage['test-localStorage'];
return true
}catch(e){
return false
}
}(),
getLocalStorageObject:function(){
return this.hasLocalStorage?localStorage:this.fakeLocalStorage
},
_makeKey:function(name){
return this.dal.domain+'.uiState.'+name
},
get:function(name){
return this.getLocalStorageObject()[this._makeKey(name)]
},
set:function(name,value){
this.getLocalStorageObject()[this._makeKey(name)]=value
},
'delete':function(name){
delete this.getLocalStorageObject()[this._makeKey(name)]
}
});
(function(root,factory){
if(typeof exports==='object'){
module.exports=factory()
}else if(typeof define==='function'&&define.amd){
define(factory)
}else{
root.one=root.one||{};
root.one.validation=factory()
}
}(this,function(){
'use strict';
function concatRegExps(){
var source='',i=0;
for(;i<arguments.length;i+=1){
if(Object.prototype.toString.call(arguments[i])==='[object RegExp]'){
source+=arguments[i].source
}else{
source+=arguments[i]
}
}
return source
}
var ipv4DigitRegExpSource=/(?:[0-9]|1?[0-9][0-9]|2[0-4][0-9]|25[0-5])/.source,validation={functions:{}},fragments={
visibleNonAsciiChar:/[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԥԱ-Ֆՙա-ևא-תװ-ײء-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨऄ-हऽॐक़-ॡॱॲॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡഅ-ഌഎ-ഐഒ-നപ-ഹഽൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜໝༀཀ-ཇཉ-ཬྈ-ྋက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-Ⴥა-ჺჼᄀ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₔℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⴀ-ⴥⴰ-ⵥⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆷㇰ-ㇿ㐀-䶵一-鿋ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙟꙢ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋꞌꟻ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-鶴侮-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ̀-ͯ҃-҉֑-ׇֽֿׁׂׅׄؐ-ًؚ-ٰٞۖ-ۜ۞-۪ۤۧۨ-ܑۭܰ-݊ަ-ް߫-߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࠭ऀ-ः़ा-ॎ॑-ॕॢॣঁ-ঃ়া-ৄেৈো-্ৗৢৣਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑੰੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୢୣஂா-ூெ-ைொ-்ௗఁ-ఃా-ౄె-ైొ-్ౕౖౢౣಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣംഃാ-ൄെ-ൈൊ-്ൗൢൣංඃ්ා-ුූෘ-ෟෲෳัิ-ฺ็-๎ັິ-ູົຼ່-ໍ༹༘༙༵༷༾༿ཱ-྄྆྇ྐ-ྗྙ-ྼ࿆ါ-ှၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏႚ-ႝ፟ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳា-៓៝᠋-᠍ᢩᤠ-ᤫᤰ-᤻ᦰ-ᧀᧈᧉᨗ-ᨛᩕ-ᩞ᩠-᩿᩼ᬀ-ᬄ᬴-᭄᭫-᭳ᮀ-ᮂᮡ-᮪ᰤ-᰷᳐-᳔᳒-᳨᳭ᳲ᷀-᷽ᷦ-᷿⃐-⃰⳯-⳱ⷠ-〪ⷿ-゙゚〯꙯-꙲꙼꙽꛰꛱ꠂ꠆ꠋꠣ-ꠧꢀꢁꢴ-꣄꣠-꣱ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀ꨩ-ꨶꩃꩌꩍꩻꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꯣ-ꯪ꯬꯭ﬞ︀-️︠-︦²³¹¼-¾٠-٩۰-۹߀-߉०-९০-৯৴-৹੦-੯૦-૯୦-୯௦-௲౦-౯౸-౾೦-೯൦-൵๐-๙໐-໙༠-༳၀-၉႐-႙፩-፼ᛮ-ᛰ០-៩៰-៹᠐-᠙᥆-᥏᧐-᧚᪀-᪉᪐-᪙᭐-᭙᮰-᮹᱀-᱉᱐-᱙⁰⁴-⁹₀-₉⅐-ↂↅ-↉①-⒛⓪-⓿❶-➓⳽〇〡-〩〸-〺㆒-㆕㈠-㈩㉑-㉟㊀-㊉㊱-㊿꘠-꘩ꛦ-ꛯ꠰-꠵꣐-꣙꤀-꤉꧐-꧙꩐-꩙꯰-꯹０-９¡«·»¿;·՚-՟։֊־׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾।॥॰෴๏๚๛༄-༒༺-༽྅࿐-࿔၊-၏჻፡-፨᐀᙭᙮᚛᚜᛫-᛭᜵᜶។-៖៘-៚᠀-᠊᥄᥅᧞᧟᨞᨟᪠-᪦᪨-᪭᭚-᭠᰻-᰿᱾᱿᳓‐-‧‰-⁃⁅-⁑⁓-⁞⁽⁾₍₎〈〉❨-❵⟅⟆⟦-⟯⦃-⦘⧘-⧛⧼⧽⳹-⳼⳾⳿⸀-⸮⸰⸱、-〃〈-】〔-〟〰〽゠・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꯫﴾﴿︐-︙︰-﹒﹔-﹡﹣﹨﹪﹫！-＃％-＊，-／：；？＠［-］＿｛｝｟-･¢-©¬®-±´¶¸×÷˂-˅˒-˟˥-˫˭˯-˿͵΄΅϶҂؆-؈؋؎؏۩۽۾߶৲৳৺৻૱୰௳-௺౿ೱೲ൹฿༁-༃༓-༗༚-༟༴༶༸྾-࿅࿇-࿌࿎࿏࿕-࿘႞႟፠᎐-᎙៛᥀᧠-᧿᭡-᭪᭴-᭼᾽᾿-῁῍-῏῝-῟῭-`´῾⁄⁒⁺-⁼₊-₌₠-₸℀℁℃-℆℈℉℔№-℘℞-℣℥℧℩℮℺℻⅀-⅄⅊-⅍⅏←-⌨⌫-⏨␀-␦⑀-⑊⒜-ⓩ─-⛍⛏-⛡⛣⛨-⛿✁-✄✆-✉✌-✧✩-❋❍❏-❒❖-❞❡-❧➔➘-➯➱-➾⟀-⟄⟇-⟊⟌⟐-⟥⟰-⦂⦙-⧗⧜-⧻⧾-⭌⭐-⭙⳥-⳪⺀-⺙⺛-⻳⼀-⿕⿰-⿻〄〒〓〠〶〷〾〿゛゜㆐㆑㆖-㆟㇀-㇣㈀-㈞㈪-㉐㉠-㉿㊊-㊰㋀-㋾㌀-㏿䷀-䷿꒐-꓆꜀-꜖꜠꜡꞉꞊꠨-꠫꠶-꠹꩷-꩹﬩﷼﷽﹢﹤-﹦﹩＄＋＜-＞＾｀｜～￠-￦￨-\uffee\ufffc\ufffd]/,
printableAsciiChar:/[\x21-\x7e]*/,
visibleAsciiChar:/[\x20-\x7e]*/,
subDomainPart:/[_a-z0-9](?:[_\-a-z0-9]*[_a-z0-9])?/i,
domainPart:/[a-z0-9](?:[\-a-z0-9]*[a-z0-9])?/i,
tld:/[a-z][\-a-z]*[a-z]/i,
port:/\d{1,5}/,
localpart:/[a-z0-9!#$%&'*+\/=?\^_`{|}~\-:][\.a-z0-9!#$%&'*+\/=?\^_`{|}~\-]*/i,
user:/[^:@\/]+/i,
uuid:/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i,
lowerCaseUuid:/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/,
upperCaseUuid:/[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}/,
password:/[^@\/]+?/i,
pathname:/[\w\-\.~%!$&'\(\)*+,;=:@\/]*/,
search:/[\w\-\.~%!$&'\(\)*+,;=:@\/?]*/,
hash:/[\w\-\.~%!$&'\(\)*+,;=:@\/?#]*/,
ipv4:new RegExp('(?:'+ipv4DigitRegExpSource+'\\.){3}'+ipv4DigitRegExpSource)
},name;
var alphanumericalPlusVisibleNonAsciiChars=new RegExp(fragments.visibleNonAsciiChar.source.replace(/^\[/,'[a-z0-9')),alphabeticalPlusVisibleNonAsciiChars=new RegExp(fragments.visibleNonAsciiChar.source.replace(/^\[/,'[a-z'));
fragments.domainPartIdn=new RegExp(concatRegExps(alphanumericalPlusVisibleNonAsciiChars,'(?:',new RegExp(alphanumericalPlusVisibleNonAsciiChars.source.replace(/^\[/,'[\\-')+'*'),alphanumericalPlusVisibleNonAsciiChars,')?'));
fragments.tldIdn=new RegExp(concatRegExps(alphabeticalPlusVisibleNonAsciiChars,new RegExp(alphabeticalPlusVisibleNonAsciiChars.source.replace(/^\[/,'[\\-')+'*'),alphabeticalPlusVisibleNonAsciiChars));
fragments.domain=fragments.domainName=new RegExp('(?:'+fragments.subDomainPart.source+'\\.)*'+'(?:'+fragments.domainPart.source+'\\.)+'+fragments.tld.source,'i');
fragments.domainIdn=fragments.domainNameIdn=new RegExp('(?:'+fragments.domainPartIdn.source+'\\.)+'+fragments.tldIdn.source,'i');
fragments.email=fragments.emailAddress=new RegExp(fragments.localpart.source+'@'+fragments.domain.source,'i');
fragments.emailIdn=fragments.emailAddressIdn=new RegExp(fragments.localpart.source+'@'+fragments.domainIdn.source,'i');
fragments.mailtoUrl=new RegExp('mailto:'+fragments.email.source,'i');
fragments.mailtoUrlIdn=new RegExp('mailto:'+fragments.emailIdn.source,'i');
fragments.searchHash=new RegExp(concatRegExps('(?:\\?',fragments.search,')?','(?:#',fragments.hash,')?'));
fragments.pathnameSearchHash=new RegExp(concatRegExps('(?:',fragments.pathname,fragments.searchHash,')?'));
fragments.rootRelativeUrl=new RegExp(concatRegExps('/',new RegExp(fragments.pathnameSearchHash.source.replace(/\?$/,''))));
function createHttpishUrlRegExp(options){
options=options||{};
return new RegExp(concatRegExps(options.scheme||'https?','://','(?:',fragments.user,'(?::',fragments.password,')?@',')?','(?:',options.localhost?'localhost|':'',options.idn?fragments.domainIdn:fragments.domain,'|',fragments.ipv4,')','(?::',fragments.port,')?','(?:/',fragments.pathnameSearchHash,'|',fragments.searchHash,')'),'i')
}
fragments.httpUrl=createHttpishUrlRegExp({scheme:/https?/});
fragments.httpUrlIdn=createHttpishUrlRegExp({
scheme:/https?/,
idn:true
});
fragments.ftpUrl=createHttpishUrlRegExp({scheme:/ftp/});
fragments.ftpUrlIdn=createHttpishUrlRegExp({
scheme:/ftp/,
idn:true
});
function getFlagsStringFromRegExp(regExp){
var flagsString='';
if(regExp.ignoreCase){
flagsString+='i'
}
if(regExp.global){
flagsString+='g'
}
if(regExp.multiline){
flagsString+='m'
}
return flagsString
}
for(name in fragments){
if(fragments.hasOwnProperty(name)){
validation[name]=new RegExp('^'+fragments[name].source+'$',getFlagsStringFromRegExp(fragments[name]));
validation.functions[name]=function(name){
return function(value){
return validation[name].test(value)
}
}(name)
}
}
validation.fragments=fragments;
validation.createHttpishUrlRegExp=createHttpishUrlRegExp;
return validation
}));
/*! http://mths.be/punycode v1.3.0 by @mathias */
;
(function(root){
var freeExports=typeof exports=='object'&&exports&&!exports.nodeType&&exports;
var freeModule=typeof module=='object'&&module&&!module.nodeType&&module;
var freeGlobal=typeof global=='object'&&global;
if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){
root=freeGlobal
}
var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter='-',regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={
'overflow':'Overflow: input needs wider integers to process',
'not-basic':'Illegal input >= 0x80 (not a basic code point)',
'invalid-input':'Invalid input'
},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;
function error(type){
throw RangeError(errors[type])
}
function map(array,fn){
var length=array.length;
var result=[];
while(length--){
result[length]=fn(array[length])
}
return result
}
function mapDomain(string,fn){
var labels=string.split(regexSeparators);
return map(labels,function(label){
var parts=label.split('@');
return map(parts,fn).join('@')
}).join('.')
}
function ucs2decode(string){
var output=[],counter=0,length=string.length,value,extra;
while(counter<length){
value=string.charCodeAt(counter++);
if(value>=55296&&value<=56319&&counter<length){
extra=string.charCodeAt(counter++);
if((extra&64512)==56320){
output.push(((value&1023)<<10)+(extra&1023)+65536)
}else{
output.push(value);
counter--
}
}else{
output.push(value)
}
}
return output
}
function ucs2encode(array){
return map(array,function(value){
var output='';
if(value>65535){
value-=65536;
output+=stringFromCharCode(value>>>10&1023|55296);
value=56320|value&1023
}
output+=stringFromCharCode(value);
return output
}).join('')
}
function basicToDigit(codePoint){
if(codePoint-48<10){
return codePoint-22
}
if(codePoint-65<26){
return codePoint-65
}
if(codePoint-97<26){
return codePoint-97
}
return base
}
function digitToBasic(digit,flag){
return digit+22+75*(digit<26)-((flag!=0)<<5)
}
function adapt(delta,numPoints,firstTime){
var k=0;
delta=firstTime?floor(delta/damp):delta>>1;
delta+=floor(delta/numPoints);
for(;delta>baseMinusTMin*tMax>>1;k+=base){
delta=floor(delta/baseMinusTMin)
}
return floor(k+(baseMinusTMin+1)*delta/(delta+skew))
}
function decode(input){
var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;
basic=input.lastIndexOf(delimiter);
if(basic<0){
basic=0
}
for(j=0;j<basic;++j){
if(input.charCodeAt(j)>=128){
error('not-basic')
}
output.push(input.charCodeAt(j))
}
for(index=basic>0?basic+1:0;index<inputLength;){
for(oldi=i,w=1,k=base;;k+=base){
if(index>=inputLength){
error('invalid-input')
}
digit=basicToDigit(input.charCodeAt(index++));
if(digit>=base||digit>floor((maxInt-i)/w)){
error('overflow')
}
i+=digit*w;
t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;
if(digit<t){
break
}
baseMinusT=base-t;
if(w>floor(maxInt/baseMinusT)){
error('overflow')
}
w*=baseMinusT
}
out=output.length+1;
bias=adapt(i-oldi,out,oldi==0);
if(floor(i/out)>maxInt-n){
error('overflow')
}
n+=floor(i/out);
i%=out;
output.splice(i++,0,n)
}
return ucs2encode(output)
}
function encode(input){
var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;
input=ucs2decode(input);
inputLength=input.length;
n=initialN;
delta=0;
bias=initialBias;
for(j=0;j<inputLength;++j){
currentValue=input[j];
if(currentValue<128){
output.push(stringFromCharCode(currentValue))
}
}
handledCPCount=basicLength=output.length;
if(basicLength){
output.push(delimiter)
}
while(handledCPCount<inputLength){
for(m=maxInt,j=0;j<inputLength;++j){
currentValue=input[j];
if(currentValue>=n&&currentValue<m){
m=currentValue
}
}
handledCPCountPlusOne=handledCPCount+1;
if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){
error('overflow')
}
delta+=(m-n)*handledCPCountPlusOne;
n=m;
for(j=0;j<inputLength;++j){
currentValue=input[j];
if(currentValue<n&&++delta>maxInt){
error('overflow')
}
if(currentValue==n){
for(q=delta,k=base;;k+=base){
t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;
if(q<t){
break
}
qMinusT=q-t;
baseMinusT=base-t;
output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));
q=floor(qMinusT/baseMinusT)
}
output.push(stringFromCharCode(digitToBasic(q,0)));
bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);
delta=0;
++handledCPCount
}
}
++delta;
++n
}
return output.join('')
}
function toUnicode(input){
return mapDomain(input,function(string){
return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string
})
}
function toASCII(input){
return mapDomain(input,function(string){
return regexNonASCII.test(string)?'xn--'+encode(string):string
})
}
punycode={
'version':'1.3.0',
'ucs2':{
'decode':ucs2decode,
'encode':ucs2encode
},
'decode':decode,
'encode':encode,
'toASCII':toASCII,
'toUnicode':toUnicode
};
if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){
define('punycode',function(){
return punycode
})
}else if(freeExports&&freeModule){
if(module.exports==freeExports){
freeModule.exports=punycode
}else{
for(key in punycode){
punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])
}
}
}else{
root.punycode=punycode
}
}(this));
(function(root,factory){
if(typeof exports==='object'){
module.exports=factory()
}else if(typeof define==='function'&&define.amd){
define(factory)
}else{
root.unicodeRegExp=factory()
}
}(this,function(xregexp){
var unicodeRegExp={};
unicodeRegExp.letter=/[A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]/;
unicodeRegExp.mark=/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u08FE\u0900-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C01-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C82\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D02\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8\u19C9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1DC0-\u1DE6\u1DFC-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE26]/;
unicodeRegExp.number=/[0-9²³¹¼-¾٠-٩۰-۹߀-߉०-९০-৯৴-৹੦-੯૦-૯୦-୯୲-୷௦-௲౦-౯౸-౾೦-೯൦-൵๐-๙໐-໙༠-༳၀-၉႐-႙፩-፼ᛮ-ᛰ០-៩៰-៹᠐-᠙᥆-᥏᧐-᧚᪀-᪉᪐-᪙᭐-᭙᮰-᮹᱀-᱉᱐-᱙⁰⁴-⁹₀-₉⅐-ↂↅ-↉①-⒛⓪-⓿❶-➓⳽〇〡-〩〸-〺㆒-㆕㈠-㈩㉈-㉏㉑-㉟㊀-㊉㊱-㊿꘠-꘩ꛦ-ꛯ꠰-꠵꣐-꣙꤀-꤉꧐-꧙꩐-꩙꯰-꯹０-９]/;
unicodeRegExp.punctuation=/[\u0021-\u0023\u0025-\u002A\u002C-\u002F\u003A\u003B\u003F\u0040\u005B-\u005D\u005F\u007B\u007D\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/;
unicodeRegExp.symbol=/[\u0024+<->\u005E`\u007C~¢-¦¨©¬®-±´¸×÷˂-˅˒-˟˥-˫˭˯-˿͵΄΅϶҂֏؆-؈؋؎؏۞۩۽۾߶৲৳৺৻૱୰௳-௺౿൹฿༁-༃༓༕-༗༚-༟༴༶༸྾-࿅࿇-࿌࿎࿏࿕-࿘႞႟᎐-᎙៛᥀᧞-᧿᭡-᭪᭴-᭼᾽᾿-῁῍-῏῝-῟῭-`´῾⁄⁒⁺-⁼₊-₌₠-₹℀℁℃-℆℈℉℔№-℘℞-℣℥℧℩℮℺℻⅀-⅄⅊-⅍⅏←-⌨⌫-⏳␀-␦⑀-⑊⒜-ⓩ─-⛿✁-❧➔-⟄⟇-⟥⟰-⦂⦙-⧗⧜-⧻⧾-⭌⭐-⭙⳥-⳪⺀-⺙⺛-⻳⼀-⿕⿰-⿻〄〒〓〠〶〷〾〿゛゜㆐㆑㆖-㆟㇀-㇣㈀-㈞㈪-㉇㉐㉠-㉿㊊-㊰㋀-㋾㌀-㏿䷀-䷿꒐-꓆꜀-꜖꜠꜡꞉꞊꠨-꠫꠶-꠹꩷-꩹﬩﮲-﯁﷼﷽﹢﹤-﹦﹩＄＋＜-＞＾｀｜～￠-￦￨-￮￼�]/;
unicodeRegExp.separator=/[\u0020\u00A0\u1680\u180E\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/;
unicodeRegExp.other=/[\u0000-\u001F\u007F-\u009F\u00AD\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BA-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/;
unicodeRegExp.spliceCharacterClassRegExps=function(){
var args=Array.prototype.slice.call(arguments);
return new RegExp('['+args.map(function(regExp){
return regExp.source.replace(/^\[|\]$/g,'')
}).join('')+']')
};
unicodeRegExp.visible=unicodeRegExp.spliceCharacterClassRegExps(unicodeRegExp.letter,unicodeRegExp.mark,unicodeRegExp.number,unicodeRegExp.punctuation,unicodeRegExp.symbol);
unicodeRegExp.printable=unicodeRegExp.spliceCharacterClassRegExps(unicodeRegExp.visible,unicodeRegExp.separator);
function parseCharCode(u4,x2,literal){
if(u4||x2){
return parseInt(u4||x2,16)
}else{
return literal.charCodeAt(0)
}
}
function charCodeToRegExpToken(charCode){
if(charCode>=32&&charCode<127){
return String.fromCharCode(charCode)
}else{
var hexStr=charCode.toString(16);
return'\\u'+'0000'.slice(hexStr.length)+hexStr
}
}
var characterClassToken=/(?:\\u([0-9a-f]{4})|\\x([0-9a-f]{2})|([^\-]))(?:-(?:\\u([0-9a-f]{4})|\\x([0-9a-f]{2})|([^\-])))?/gi;
unicodeRegExp.removeCharacterFromCharacterClassRegExp=function(regExp,ch){
var charCode=ch.charCodeAt(0);
return new RegExp('['+regExp.source.replace(/^\[|\]$/g,'').replace(characterClassToken,function($0,fromU4,fromX2,fromLiteral,toU4,toX2,toLiteral){
var fromCharCode=parseCharCode(fromU4,fromX2,fromLiteral);
if(toU4||toX2||toLiteral){
var toCharCode=parseCharCode(toU4,toX2,toLiteral);
if(charCode===fromCharCode){
if(charCode+1<toCharCode){
return charCodeToRegExpToken(charCode+1)+'-'+charCodeToRegExpToken(toCharCode)
}else{
return charCodeToRegExpToken(toCharCode)
}
}else if(charCode===toCharCode){
if(fromCharCode<charCode-1){
return charCodeToRegExpToken(fromCharCode)+'-'+charCodeToRegExpToken(charCode-1)
}else{
return charCodeToRegExpToken(fromCharCode)
}
}else if(charCode>fromCharCode&&charCode<toCharCode){
return charCodeToRegExpToken(fromCharCode)+(charCode>fromCharCode+1?'-'+charCodeToRegExpToken(charCode-1):'')+(charCode+1<toCharCode?charCodeToRegExpToken(charCode+1)+'-':'')+charCodeToRegExpToken(toCharCode)
}else{
return $0
}
}else{
if(charCode===fromCharCode){
return''
}else{
return charCodeToRegExpToken(fromCharCode)
}
}
})+']')
};
return unicodeRegExp
}));
(function(root,factory){
if(typeof exports==='object'){
module.exports=factory(require('one-validation'),require('punycode'),require('unicoderegexp'))
}else if(typeof define==='function'&&define.amd){
define([
'one-validation',
'punycode',
'unicoderegexp'
],factory)
}else{
root.purify=factory(root.one.validation,root.punycode,root.unicodeRegExp)
}
}(this,function(oneValidation,punycode,unicodeRegExp){
var purify={};
purify.boolean=function(rawValue,defaultValue){
if(typeof rawValue==='boolean'){
return rawValue
}else if(typeof rawValue==='string'){
var isTrue=/^(?:1|on|true|yes)$/i.test(rawValue),isFalse=/^(?:0|off|false|no)$/i.test(rawValue);
return isTrue?true:isFalse?false:defaultValue
}
return defaultValue
};
purify.email=purify.emailAddress=function(rawValue,defaultValue){
var fragments,encodedEmail,encodedDomain;
try{
if(typeof rawValue==='string'&&oneValidation.emailIdn.test(rawValue)){
fragments=rawValue.split('@');
encodedDomain=fragments.length===2&&punycode.toASCII(fragments[1]).toLowerCase();
var decodedDomain=punycode.toUnicode(encodedDomain);
if(!/\.[^\.]{2,}$/.test(decodedDomain)){
encodedDomain=undefined
}
}
}catch(e){
encodedDomain=undefined
}finally{
encodedEmail=encodedDomain&&fragments[0]+'@'+encodedDomain;
if(typeof encodedEmail==='string'&&oneValidation.email.test(encodedEmail)){
return encodedEmail
}else{
return defaultValue
}
}
};
purify.emailIdn=purify.emailAddressIdn=function(rawValue,defaultValue){
var fragments,decodedDomain,decodedEmail;
try{
if(typeof rawValue==='string'&&oneValidation.emailIdn.test(rawValue)){
fragments=rawValue.split('@');
decodedDomain=fragments.length===2&&punycode.toUnicode(fragments[1]).toLowerCase();
if(!/\.[^\.]{2,}$/.test(decodedDomain)){
decodedDomain=undefined
}
}
}catch(e){
decodedDomain=undefined
}finally{
decodedEmail=decodedDomain&&fragments[0]+'@'+decodedDomain;
if(typeof decodedEmail==='string'&&oneValidation.emailIdn.test(decodedEmail)){
return decodedEmail
}else{
return defaultValue
}
}
};
purify.domain=purify.domainName=function(rawValue,defaultValue){
var encodedDomain;
try{
if(typeof rawValue==='string'&&oneValidation.domainIdn.test(rawValue)){
encodedDomain=punycode.toASCII(rawValue.toLowerCase());
var decodedDomain=punycode.toUnicode(encodedDomain);
if(!/\.[^\.]{2,}$/.test(decodedDomain)){
encodedDomain=undefined
}
}
}catch(e){
encodedDomain=undefined
}finally{
if(typeof encodedDomain==='string'&&oneValidation.domain.test(encodedDomain)){
return encodedDomain
}else{
return defaultValue
}
}
};
purify.domainIdn=purify.domainNameIdn=function(rawValue,defaultValue){
var decodedDomain;
try{
if(typeof rawValue==='string'&&oneValidation.domainIdn.test(rawValue)){
decodedDomain=punycode.toUnicode(rawValue.toLowerCase());
if(!/\.[^\.]{2,}$/.test(decodedDomain)){
decodedDomain=undefined
}
}
}catch(e){
decodedDomain=undefined
}finally{
if(typeof decodedDomain==='string'&&oneValidation.domainIdn.test(decodedDomain)){
return decodedDomain
}else{
return defaultValue
}
}
};
purify.url=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&oneValidation.httpUrl.test(rawValue)){
return rawValue
}
return defaultValue
};
var urlWithLocalhostRegExp=new RegExp('^(?:'+oneValidation.createHttpishUrlRegExp({
scheme:/https?/,
localhost:true
}).source+')$');
purify.urlWithLocalhost=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&urlWithLocalhostRegExp.test(rawValue)){
return rawValue
}
return defaultValue
};
purify.integer=function(rawValue,defaultValue){
var integer;
if(typeof rawValue==='string'){
integer=parseInt(rawValue,10)
}else if(typeof rawValue==='number'){
integer=Math.floor(rawValue)
}
if(typeof integer==='number'&&isFinite(integer)&&!isNaN(integer)){
return integer
}else{
return defaultValue
}
};
purify.integerInRange=function(rawValue,lower,upper,defaultValue){
var integer=purify.integer(rawValue);
if(typeof integer==='number'&&!isNaN(integer)&&isFinite(integer)&&(typeof lower==='undefined'||integer>=lower)&&(typeof upper==='undefined'||integer<=upper)){
return integer
}
return defaultValue
};
purify.positiveInteger=function(rawValue,defaultValue){
var integer=purify.integer(rawValue);
if(typeof integer!=='undefined'&&!isNaN(integer)&&isFinite(integer)&&integer>=1){
return integer
}
return defaultValue
};
purify.positiveIntegerOrZero=function(rawValue,defaultValue){
var integer=purify.integer(rawValue);
if(typeof integer!=='undefined'&&!isNaN(integer)&&isFinite(integer)&&integer>=0){
return integer
}
return defaultValue
};
purify.float=function(rawValue,defaultValue){
var number;
if(typeof rawValue==='string'){
if(/^[\-+]?[0-9]*\.?[0-9]+$/.test(rawValue)){
number=parseFloat(rawValue)
}
}else if(typeof rawValue==='number'){
number=rawValue
}
if(typeof number!=='undefined'&&!isNaN(number)&&isFinite(number)){
return number
}
return defaultValue
};
purify.positiveFloat=function(rawValue,defaultValue){
var number;
if(typeof rawValue==='string'){
if(/^\+?[0-9]*\.?[0-9]+$/.test(rawValue)){
number=parseFloat(rawValue)
}
}else if(typeof rawValue==='number'){
number=rawValue
}
if(typeof number!=='undefined'&&!isNaN(number)&&isFinite(number)&&number>0){
return number
}
return defaultValue
};
purify.positiveFloatOrZero=function(rawValue,defaultValue){
var number;
if(typeof rawValue==='string'){
if(/^\+?[0-9]*\.?[0-9]+$/.test(rawValue)){
number=parseFloat(rawValue)
}
}else if(typeof rawValue==='number'){
number=rawValue
}
if(typeof number!=='undefined'&&!isNaN(number)&&isFinite(number)&&number>=0){
return number
}
return defaultValue
};
var nonEmptyVisibleUnicodeRegExp=new RegExp('^'+unicodeRegExp.visible.source+'+$');
purify.nonEmptyVisibleUnicode=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&nonEmptyVisibleUnicodeRegExp.test(rawValue)){
return rawValue
}
return defaultValue
};
var visibleUnicodeRegExp=new RegExp('^'+unicodeRegExp.visible.source+'*$');
purify.visibleUnicode=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&visibleUnicodeRegExp.test(rawValue)){
return rawValue
}
return defaultValue
};
var nonEmptyPrintableUnicodeRegExp=new RegExp('^'+unicodeRegExp.printable.source+'+$');
purify.nonEmptyPrintableUnicode=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&nonEmptyPrintableUnicodeRegExp.test(rawValue)){
return rawValue
}
return defaultValue
};
var printableUnicodeRegExp=new RegExp('^'+unicodeRegExp.printable.source+'*$');
purify.printableUnicode=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&printableUnicodeRegExp.test(rawValue)){
return rawValue
}
return defaultValue
};
purify.nonEmptyVisibleAscii=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&/^[\x21-\x7e]+$/.test(rawValue)){
return rawValue
}
return defaultValue
};
purify.visibleAscii=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&/^[\x21-\x7e]*$/.test(rawValue)){
return rawValue
}
return defaultValue
};
purify.nonEmptyPrintableAscii=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&/^[\x20-\x7e]+$/.test(rawValue)){
return rawValue
}
return defaultValue
};
purify.printableAscii=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&/^[\x20-\x7e]*$/.test(rawValue)){
return rawValue
}
return defaultValue
};
purify.alphaNumeric=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&/^[a-z0-9]*$/i.test(rawValue)){
return rawValue
}else if(typeof rawValue==='number'&&isFinite(rawValue)&&!isNaN(rawValue)&&rawValue===Math.floor(rawValue)){
return String(rawValue)
}
return defaultValue
};
purify.nonEmptyAlphaNumeric=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&/^[a-z0-9]+$/i.test(rawValue)){
return rawValue
}else if(typeof rawValue==='number'&&isFinite(rawValue)&&!isNaN(rawValue)&&rawValue===Math.floor(rawValue)){
return String(rawValue)
}
return defaultValue
};
purify.alphaNumericWithDot=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&/^[a-z0-9\.]*$/i.test(rawValue)){
return rawValue
}else if(typeof rawValue==='number'&&isFinite(rawValue)&&!isNaN(rawValue)){
return String(rawValue)
}
return defaultValue
};
purify.nonEmptyAlphaNumericWithDot=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&/^[a-z0-9\.]+$/i.test(rawValue)){
return rawValue
}else if(typeof rawValue==='number'&&isFinite(rawValue)&&!isNaN(rawValue)){
return String(rawValue)
}
return defaultValue
};
purify.uuid=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&oneValidation.uuid.test(rawValue)){
return rawValue
}
return defaultValue
};
purify.upperCaseUuid=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&oneValidation.upperCaseUuid.test(rawValue)){
return rawValue
}
return defaultValue
};
purify.lowerCaseUuid=function(rawValue,defaultValue){
if(typeof rawValue==='string'&&oneValidation.lowerCaseUuid.test(rawValue)){
return rawValue
}
return defaultValue
};
purify.json=function(rawValue,defaultValue){
if(typeof rawValue==='string'){
try{
return JSON.parse(rawValue)
}catch(e){
}
}
return defaultValue
};
return purify
}));
(function($){
function noop(){
}
function genericCallback(data){
lastValue=[data]
}
function callIfDefined(method,object,parameters){
return method&&method.apply(object.context||object,parameters)
}
function qMarkOrAmp(url){
return/\?/.test(url)?'&':'?'
}
var STR_ASYNC='async',STR_CHARSET='charset',STR_EMPTY='',STR_ERROR='error',STR_INSERT_BEFORE='insertBefore',STR_JQUERY_JSONP='_jqjsp',STR_ON='on',STR_ON_CLICK=STR_ON+'click',STR_ON_ERROR=STR_ON+STR_ERROR,STR_ON_LOAD=STR_ON+'load',STR_ON_READY_STATE_CHANGE=STR_ON+'readystatechange',STR_READY_STATE='readyState',STR_REMOVE_CHILD='removeChild',STR_SCRIPT_TAG='<script>',STR_SUCCESS='success',STR_TIMEOUT='timeout',win=window,Deferred=$.Deferred,head=$('head')[0]||document.documentElement,pageCache={},count=0,lastValue,xOptionsDefaults={
callback:STR_JQUERY_JSONP,
url:location.href
},opera=win.opera,oldIE=!!$('<div>').html('<!--[if IE]><i><![endif]-->').find('i').length;
function jsonp(xOptions){
xOptions=$.extend({},xOptionsDefaults,xOptions);
var successCallback=xOptions.success,errorCallback=xOptions.error,completeCallback=xOptions.complete,dataFilter=xOptions.dataFilter,callbackParameter=xOptions.callbackParameter,successCallbackName=xOptions.callback,cacheFlag=xOptions.cache,pageCacheFlag=xOptions.pageCache,charset=xOptions.charset,url=xOptions.url,data=xOptions.data,timeout=xOptions.timeout,pageCached,done=0,cleanUp=noop,supportOnload,supportOnreadystatechange,firstChild,script,scriptAfter,timeoutTimer;
Deferred&&Deferred(function(defer){
defer.done(successCallback).fail(errorCallback);
successCallback=defer.resolve;
errorCallback=defer.reject
}).promise(xOptions);
xOptions.abort=function(){
!done++&&cleanUp()
};
if(callIfDefined(xOptions.beforeSend,xOptions,[xOptions])===!1||done){
return xOptions
}
url=url||STR_EMPTY;
data=data?typeof data=='string'?data:$.param(data,xOptions.traditional):STR_EMPTY;
url+=data?qMarkOrAmp(url)+data:STR_EMPTY;
callbackParameter&&(url+=qMarkOrAmp(url)+encodeURIComponent(callbackParameter)+'=?');
!cacheFlag&&!pageCacheFlag&&(url+=qMarkOrAmp(url)+'_'+new Date().getTime()+'=');
url=url.replace(/=\?(&|$)/,'='+successCallbackName+'$1');
function notifySuccess(json){
if(!done++){
cleanUp();
pageCacheFlag&&(pageCache[url]={s:[json]});
dataFilter&&(json=dataFilter.apply(xOptions,[json]));
callIfDefined(successCallback,xOptions,[
json,
STR_SUCCESS,
xOptions
]);
callIfDefined(completeCallback,xOptions,[
xOptions,
STR_SUCCESS
])
}
}
function notifyError(type){
if(!done++){
cleanUp();
pageCacheFlag&&type!=STR_TIMEOUT&&(pageCache[url]=type);
callIfDefined(errorCallback,xOptions,[
xOptions,
type
]);
callIfDefined(completeCallback,xOptions,[
xOptions,
type
])
}
}
if(pageCacheFlag&&(pageCached=pageCache[url])){
pageCached.s?notifySuccess(pageCached.s[0]):notifyError(pageCached)
}else{
win[successCallbackName]=genericCallback;
script=$(STR_SCRIPT_TAG)[0];
script.id=STR_JQUERY_JSONP+count++;
if(charset){
script[STR_CHARSET]=charset
}
opera&&opera.version()<11.6?(scriptAfter=$(STR_SCRIPT_TAG)[0]).text='document.getElementById(\''+script.id+'\').'+STR_ON_ERROR+'()':script[STR_ASYNC]=STR_ASYNC;
if(oldIE){
script.htmlFor=script.id;
script.event=STR_ON_CLICK
}
script[STR_ON_LOAD]=script[STR_ON_ERROR]=script[STR_ON_READY_STATE_CHANGE]=function(result){
if(!script[STR_READY_STATE]||!/i/.test(script[STR_READY_STATE])){
try{
script[STR_ON_CLICK]&&script[STR_ON_CLICK]()
}catch(_){
}
result=lastValue;
lastValue=0;
result?notifySuccess(result[0]):notifyError(STR_ERROR)
}
};
script.src=url;
cleanUp=function(i){
timeoutTimer&&clearTimeout(timeoutTimer);
script[STR_ON_READY_STATE_CHANGE]=script[STR_ON_LOAD]=script[STR_ON_ERROR]=null;
head[STR_REMOVE_CHILD](script);
scriptAfter&&head[STR_REMOVE_CHILD](scriptAfter)
};
head[STR_INSERT_BEFORE](script,firstChild=head.firstChild);
scriptAfter&&head[STR_INSERT_BEFORE](scriptAfter,firstChild);
timeoutTimer=timeout>0&&setTimeout(function(){
notifyError(STR_TIMEOUT)
},timeout)
}
return xOptions
}
jsonp.setup=function(xOptions){
$.extend(xOptionsDefaults,xOptions)
};
$.jsonp=jsonp
}(oneJQuery));